"use strict";async function fetchBody(t){let e=await fetch(t);return await e.text()}async function postData(t,e={}){let i=new URLSearchParams(e);return(await fetch(t,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/x-www-form-urlencoded"},redirect:"follow",referrerPolicy:"no-referrer",body:i})).json()}async function postJson(t,e){return(await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).json()}class CTimeChecker{constructor(){this._startTime=(new Date).getTime(),this._stopTime=(new Date).getTime()}startChecker(){this._startTime=(new Date).getTime()}stopChecker(){return this._stopTime=(new Date).getTime(),(this._stopTime-this._startTime)/1e3}static startChecker(){CTimeChecker.sc=(new Date).getTime()}static stopChecker(){return CTimeChecker.ed=(new Date).getTime(),(CTimeChecker.ed-CTimeChecker.sc)/1e3}}var ELanguageStringKind,EBinaryDataKind,EDirType,ETreeItemState,EPositionAlign,EPositionUnit,EFitMode;!function(t){t[t.WORD=0]="WORD",t[t.SENTENCE=1]="SENTENCE"}(ELanguageStringKind||(ELanguageStringKind={}));class CLanguage{static get codes(){return this._codes}static get names(){return this._names}static get localNames(){return this._localNames}static get localCode(){return CLanguage._localCode}static set localCode(t){this._localCode!=t&&(this._localCode=t,this.doChangeCountry())}static async doChangeCountry(){await this.doSetDictionary();for(let t=0;t<CSystem.controls.length;t++){CSystem.controls.getRow(t).get(0).asObject.doChangeCountry(CLanguage._localCode)}for(let t=0;t<this.onChangeCountry.length;t++)await this.onChangeCountry[t](this)}static async doSetDictionary(){for(let t=0;t<this.onSetDictionary.length;t++)await this.onSetDictionary[t](this)}static count(){return 104}static getLanguage(t){return{code:this._codes[t],name:this._names[t],localName:this._localNames[t]}}static getLanguageFromCode(t){let e=-1;for(let i=0;i<this._codes.length;i++)if(t==this._codes[i]){e=i;break}return-1==e?void 0:{code:this._codes[e],name:this._names[e],localName:this._localNames[e]}}static getLanguageFromCountry(t){let e=-1;for(let i=0;i<this._names.length;i++)if(t==this._names[i]){e=i;break}return-1==e?void 0:{code:this._codes[e],name:this._names[e],localName:this._localNames[e]}}static loadDictionary(t){this._dictionary.clear();for(let e=0;e<t.length;e++){if(this._dictionary.has(t[e].code))throw new Error("Exists dictionary code : "+t[e].code);this._dictionary.set(t[e].code,t[e].text)}}static getTextWithUndefined(t){return this._dictionary.get(t)}static getText(t,e){if(t.indexOf(",")>=0){let e=t.split(","),i="";for(let t=0;t<e.length;t++){let s=this._dictionary.get(e[t]);i+=s||e[t]}return i}{let i=this._dictionary.get(t);return null==i?e||t:i}}static browserCountryCode(){return navigator.language||navigator.userLanguage}}CLanguage._localCode="",CLanguage._dictionary=new Map,CLanguage._codes=["ko","en","gl","gu","el","nl","ne","no","da","de","lo","lv","la","ru","ro","lb","lt","mr","mi","mk","mg","ml","ms","mt","mn","hmn","my","eu","vi","be","bn","bs","bg","sm","sr","ceb","st","so","sn","su","sw","sv","gd","es","sk","sl","sd","si","ar","hy","is","ht","ga","az","af","sq","am","et","eo","yo","ur","uz","uk","cy","ig","yi","it","id","ja","jw","ka","zu","zh-CN","zh-TW","ny","cs","kk","ca","kn","co","xh","ku","hr","km","ky","tl","ta","tg","th","tr","te","ps","pa","fa","pt","pl","fr","fy","fi","haw","ha","hu","iw","hi"],CLanguage._names=["Korean","English","Galician","Gujarati","Greek","Dutch","Nepali","Norwegian","Danish","German","Lao","Latvian","Latin","Russian","Romanian","Luxembourgish","Lithuanian","Marathi","Maori","Macedonian","Malagasy","Malayalam","Malay","Maltese","Mongolian","Mongolian","Myanmar(Burmese)","Basque","Vietnamese","Belarusian","Bengali","Bosnian","Bulgarian","Samoan","Serbian","CebuAno","Sesotho","Somali","Shona","Sundar","Swahili","Swedish","ScottishGaelic","Spanish","Slovak","Slovenian","Sindhi","Sinhalese","Arabic","Armenian","Icelandic","Haitian","Irish","Azerbaijani","Afrikaans","Albanian","Amharic","Estonian","Esperanto","Yoruba","Urdu","Uzbek","Ukrainian","Welsh","Igbo","Yiddish","Italian","Indonesian","Japanese","Javanese","Georgian","Zulu","Chinese(Simplified)","Chinese(Traditional)","Chewara","Czech","Kazakh","Catalan","Kannada","Corsican","Cosa","Kurdish","Croatian","Khmer","Kyrgyz","Tagalog","Tamil","Tajik","Thai","Turkish","Telugu","Pashto","Punjabi","Persian","Portuguese","Polish","French","Frisian","Finnish","HAWEI","Hausa","Hungarian","Hebrew","Hindi"],CLanguage._localNames=["한국어","English","Galego","ગુજરાતી","Ελληνικά","Nederlands","नेपाली","norsk","dansk","Deutsch","ລາວ","Latviešu valoda","Latine","русский","românesc","Lëtzebuergesch","Lietuvių","मराठी","Maori","Македонски","Malagasy","മലയാളം","Melayu","Malti","Монгол хэл дээр","Mongolian","မြန်မာ (ဗမာ)","Euskal","Tiếng việt","Беларуская","বাঙালি","Bosanski","български","Samoa","Сербиан","Cebu Ano","Sesotho","Somali","Shona","Sundar","Kiswahili","Svenska","Gàidhlig na h-Alba","Español","slovenský","Slovenščina","سنڌي","සිංහල","العربية","Հայերեն","Íslensku","Ayisyen","Gaeilge","Azərbaycan","Afrikaans","shqiptar","አማርኛ","Eesti keel","Esperanto","Yorùbá","اردو","O'zbek","Українська","Cymraeg","Igbo","Yiddish","italiano","Orang indonesia","日本","Jawa","ქართული","Zulu","中文（简体）","中文（繁體）","Chiwara","Česky","Қазақша","Català","ಕನ್ನಡ","Corsa","Cosa","Kurdî","hrvatski","ភាសាខ្មែរ","Kirghiz","Tagalog","தமிழ்","Тоҷикӣ","ไทย","Türk","తెలుగు","پښتو","ਪੰਜਾਬੀ","فارسی","Português","Polski","Le français","Frysk","suomalainen","HAWEI","Hausa","magyar","עברית","हिन्दी"],CLanguage.onChangeCountry=new Array,CLanguage.onSetDictionary=new Array;class CStringUtil{static lpad(t,e,i){if(t.length>=i)return t;let s=(i-t.length)/e.length;for(let i=0;i<s;i++)t=e+t;return t}static rpad(t,e,i){if(t.length>=i)return t;let s=(i-t.length)/e.length;for(let i=0;i<s;i++)t+=e;return t}static strToBase64(t){return btoa(unescape(encodeURIComponent(t)))}static strToUriBase64(t){let e=this.strToBase64(t);return e=this.replaceAll(e,"/","@"),e=this.replaceAll(e,"+","^"),e=this.replaceAll(e,"=","*"),e}static strToUriBase64Prefix(t,e){let i=this.strToBase64(e);return i=this.replaceAll(i,"/","@"),i=this.replaceAll(i,"+","^"),i=this.replaceAll(i,"=","*"),i=t+";"+i,i}static base64ToUriBase64(t){let e=this.replaceAll(t,"/","@");return e=this.replaceAll(e,"+","^"),e=this.replaceAll(e,"=","*"),e}static base64ToUriBase64Prefix(t,e){let i=this.replaceAll(e,"/","@");return i=this.replaceAll(i,"+","^"),i=this.replaceAll(i,"=","*"),i=t+";"+i,i}static uriBase64ToBase64(t){let e=this.replaceAll(t,"*","=");return e=this.replaceAll(e,"^","+"),e=this.replaceAll(e,"@","/"),e}static base64ToStr(t){return decodeURIComponent(escape(atob(t)))}static UriBase64ToStr(t){let e=this.replaceAll(t,"*","=");return e=this.replaceAll(e,"^","+"),e=this.replaceAll(e,"@","/"),this.base64ToStr(e)}static setStringToText(t,e){let i="";for(let s of t)""!=i&&(i+=e),i+=s;return i}static setStringFromText(t,e,i){t.clear();let s=e.split(i);for(let e=0;e<s.length;e++)t.add(s[e])}static replaceAll(t,e,i){let s=t.split(e),o="";for(let t=0;t<s.length;t++)0!=t&&(o+=i),o+=s[t];return o}static getTextWidth(t,e){if(null!=CSystem.bufferingContext){t.setFont(CSystem.bufferingContext);let i=e.split("\n"),s=0;for(let t=0;t<i.length;t++)s=CCalc.max(CSystem.bufferingContext.measureText(i[t]).width,s);return s}return-1}static getTextHeight(t,e){let i=e.split("\n");return t.fontSize*i.length+t.lineSpacing*(i.length-1)}static getTextPathData(t,e){return new Promise((function(t){t("")}))}static getTextPathDataEach(t,e){return new Promise((function(t){}))}static sheetDataToMap(t){let e=new Map,i={openidx:-1,closeidx:-1,isSearch:!1},s=0,o=0,a="";for(let n=0;n<t.length;n++)a+=t[n],i.isSearch||'"'!=t[n]||'"'!=a?!i.isSearch||'"'!=t[n]||n+1<t.length&&'"'==t[n+1]||n-1>=0&&'"'==t[n-1]?i.isSearch||"\n"!=t[n]?i.isSearch||"\t"!=t[n]?n==t.length-1&&("\r"==a.charAt(a.length-1)&&(a=CStringUtil.replaceAll(a,"\r","")),e.set(s+","+o,a)):(a=a.substr(0,a.length-1),"\r"==a.charAt(a.length-1)&&(a=CStringUtil.replaceAll(a,"\r","")),e.set(s+","+o,a),s++,a=""):(a=a.substr(0,a.length-1),"\r"==a.charAt(a.length-1)&&(a=CStringUtil.replaceAll(a,"\r","")),e.set(s+","+o,a),o++,s=0,a=""):(i.isSearch=!1,i.closeidx=n,a=a.substr(1,a.length-2),a=CStringUtil.replaceAll(a,'""','"'),n==t.length-1&&("\r"==a.charAt(a.length-1)&&(a=CStringUtil.replaceAll(a,"\r","")),e.set(s+","+o,a))):(i.isSearch=!0,i.openidx=n,n==t.length-1&&("\r"==a.charAt(a.length-1)&&(a=CStringUtil.replaceAll(a,"\r","")),e.set(s+","+o,a)));return e}static sha256(t){return new Promise((function(e){const i=(new TextEncoder).encode(t);crypto.subtle.digest("SHA-256",i).then((t=>{const i=Array.from(new Uint8Array(t)).map((t=>("00"+t.toString(16)).slice(-2))).join("");e(i)}))}))}static errorMessage(t){let e="unknown error";return"string"==typeof t?e=t:t instanceof Error&&(e=t.message),e}static base64ToUrlSafe(t){return t.replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}static base64FromUrlSafe(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");for(;e.length%4;)e+="=";return e}static nulltext(){let t=new Uint8Array([0]);return(new TextDecoder).decode(t)}static cellTextToStr(t){let e="";return e=(t.indexOf("\n")>=0||t.indexOf("\t")>=0)&&t.indexOf('"')>=0?'"'+CStringUtil.replaceAll(t,'"','""')+'"':t.indexOf("\n")>=0||t.indexOf("\t")>=0?'"'+t+'"':t,e}static capitalizeFirstLetter(t){return t.charAt(0).toUpperCase()+t.slice(1)}}class CDatetime extends Date{get year(){return this.getFullYear()}get month(){return this.getMonth()+1}get day(){return this.getDate()}get dayOfWeek(){return this.getDay()}get yearS(){return this.getFullYear()+""}get monthS(){let t=this.getMonth()+1+"";return 1==t.length&&(t="0"+t),t}get dayS(){let t=this.getDate()+"";return 1==t.length&&(t="0"+t),t}toString(t=!1,e=!1){return CDatetime.toTimeString(this,t,e)}getFirstDayDate(t){return null!=t?new CDatetime(t.year,t.month-1):new CDatetime(this.year,this.month-1)}getLastDayDate(t){return null!=t?new CDatetime(t.year,t.month-1,CDatetime.getLastDay(t.year,t.month)):new CDatetime(this.year,this.month-1,CDatetime.getLastDay(this.year,this.month))}getLastDay(){return CDatetime.getLastDay(this.getFullYear(),this.getMonth()+1)}addSecond(t){this.setSeconds(this.getSeconds()+t)}addMinute(t){this.setMinutes(this.getMinutes()+t)}addHour(t){this.setHours(this.getHours()+t)}addDay(t){this.setDate(this.getDate()+t)}addMonth(t){this.setMonth(this.getMonth()+t)}addYear(t){this.setFullYear(this.getFullYear()+t)}static isLeapYear(t){return t%4==0&&t%100!=0||t%400==0}static isValidMonth(t){return t>=1&&t<=12}static isValidDay(t,e,i){if(!this.isValidMonth(e))return!1;let s=new Array(31,28,31,30,31,30,31,31,30,31,30,31);return(t%4==0&&t%100!=0||t%400==0)&&(s[1]=29),i>=1&&i<=s[e-1]}static getLastDay(t,e){let i=new Array(31,28,31,30,31,30,31,31,30,31,30,31);return(t%4==0&&t%100!=0||t%400==0)&&(i[1]=29),i[e-1]}static toTimeString(t,e=!1,i=!1){let s=t.getFullYear()+"",o=t.getMonth()+1+"",a=t.getDate()+"",n=t.getHours()+"",r=t.getMinutes()+"",l=t.getSeconds()+"",h=t.getMilliseconds()+"";return 1==(""+o).length&&(o="0"+o),1==(""+a).length&&(a="0"+a),1==(""+n).length&&(n="0"+n),1==(""+r).length&&(r="0"+r),1==(""+l).length&&(l="0"+l),1==(""+h).length&&(h="00"+h),2==(""+h).length&&(h="0"+h),e?i?s+"-"+o+"-"+a+" "+n+":"+r+":"+l:s+"-"+o+"-"+a+" "+n+":"+r+":"+l+"."+h:i?s+""+o+a+n+r+l:s+""+o+a+n+r+l+h}static getCurrentTime(){return this.toTimeString(new Date)}static getNowYear(){return this.getCurrentTime().substring(0,4)}static getNowMonth(){return this.getCurrentTime().substring(4,6)}static getNowDay(){return this.getCurrentTime().substring(6,8)}static getNowHour(){return this.getCurrentTime().substring(8,10)}static getNowMinute(){return this.getCurrentTime().substring(10,12)}static getNowSecond(){return this.getCurrentTime().substring(12,14)}static getNowMilliSecond(){return this.getCurrentTime().substring(14,17)}static getNowDayOfWeek(){return(new Date).getDay()}static getDayOfWeek(t){return t.getDay()}static stringToDate(t,e=!1){const i=parseInt(t.substring(0,4),10),s=parseInt(t.substring(4,6),10)-1,o=parseInt(t.substring(6,8),10),a=parseInt(t.substring(8,10),10),n=parseInt(t.substring(10,12),10),r=parseInt(t.substring(12,14),10);if(e){const e=parseInt(t.substring(14,17),10);return new Date(i,s,o,a,n,r,e)}return new Date(i,s,o,a,n,r)}static dateToYYYYMMDD(t,e=!1){let i=t.getFullYear()+"",s=t.getMonth()+1+"",o=t.getDate()+"";return 1==(""+s).length&&(s="0"+s),1==(""+o).length&&(o="0"+o),e?i+"-"+s+"-"+o:i+""+s+o}static getYYYYMMDD(t=!1){let e=new Date,i=e.getFullYear()+"",s=e.getMonth()+1+"",o=e.getDate()+"";return 1==(""+s).length&&(s="0"+s),1==(""+o).length&&(o="0"+o),t?i+"-"+s+"-"+o:i+""+s+o}static getYYYYMMDDHHMMSS(t=!1){let e=new Date,i=e.getFullYear()+"",s=e.getMonth()+1+"",o=e.getDate()+"",a=e.getHours()+"",n=e.getMinutes()+"",r=e.getSeconds()+"";return 1==(""+s).length&&(s="0"+s),1==(""+o).length&&(o="0"+o),1==(""+a).length&&(a="0"+a),1==(""+n).length&&(n="0"+n),1==(""+r).length&&(r="0"+r),t?i+"-"+s+"-"+o+" "+a+":"+n+":"+r:i+""+s+o+a+n+r}static getYYYYMMDDHHMMSSZZZ(t=!1){let e=new Date,i=e.getFullYear()+"",s=e.getMonth()+1+"",o=e.getDate()+"",a=e.getHours()+"",n=e.getMinutes()+"",r=e.getSeconds()+"",l=e.getMilliseconds()+"";return 1==(""+s).length&&(s="0"+s),1==(""+o).length&&(o="0"+o),1==(""+a).length&&(a="0"+a),1==(""+n).length&&(n="0"+n),1==(""+r).length&&(r="0"+r),1==(""+l).length&&(l="00"+l),2==(""+l).length&&(l="0"+l),t?i+"-"+s+"-"+o+" "+a+":"+n+":"+r+"."+l:i+""+s+o+a+n+r+l}}class CHSLA{constructor(t,e,i,s=1){this.h=t,this.s=e,this.l=i,this.a=s}toColor(){return"hsla("+this.h+","+CCalc.cr(100,0,1,this.s,2)+"%,"+CCalc.cr(100,0,1,this.l,2)+"%,"+this.a+")"}}class CRGBA{constructor(t,e,i,s=1){this.r=t,this.g=e,this.b=i,this.a=s}toColor(){return"rgba("+this.r+","+this.g+","+this.b+","+this.a+")"}static getColor(t,e,i,s=1){return new CRGBA(t,e,i,s).toColor()}}class CColor{constructor(t){if(this.r=0,this.g=0,this.b=0,this.a=0,-1!=t.indexOf("#"))3==(t=t.replace(/^\s*#|\s*$/g,"")).length&&(t=t.replace(/(.)/g,"$1$1")),this.r=parseInt(t.substr(0,2),16),this.g=parseInt(t.substr(2,2),16),this.b=parseInt(t.substr(4,2),16),this.a=1;else if(-1!=t.indexOf("rgb"))if(-1!=t.indexOf("a")){let e=(t=t.replace(" ","").replace("rgba(","").replace(")","")).split(",");this.r=parseInt(e[0]),this.g=parseInt(e[1]),this.b=parseInt(e[2]),this.a=parseFloat(e[3])}else{let e=(t=t.replace(" ","").replace("rgb(","").replace(")","")).split(",");this.r=parseInt(e[0]),this.g=parseInt(e[1]),this.b=parseInt(e[2]),this.a=1}else if(-1!=t.indexOf("hsl"))if(-1!=t.indexOf("a")){let e=(t=t.replace(" ","").replace("hsla(","").replace(")","")).split(","),i=new CHSLA(parseFloat(e[0]),CCalc.cr(1,0,100,parseFloat(e[1].replace("%","")),2),CCalc.cr(1,0,100,parseFloat(e[2].replace("%","")),2),parseFloat(e[3])),s=CColor.hslToRGB(i);this.r=s.r,this.g=s.g,this.b=s.b,this.a=s.a}else{let e=(t=t.replace(" ","").replace("hsl(","").replace(")","")).split(","),i=new CHSLA(parseFloat(e[0]),CCalc.cr(1,0,100,parseFloat(e[1].replace("%","")),2),CCalc.cr(1,0,100,parseFloat(e[2].replace("%","")),2)),s=CColor.hslToRGB(i);this.r=s.r,this.g=s.g,this.b=s.b,this.a=1}else this.r=255,this.g=255,this.b=255,this.a=1}toColor(){return"rgba("+this.r+","+this.g+","+this.b+","+this.a+")"}toHSLAColor(){return CColor.rgbToHSL(new CRGBA(this.r,this.g,this.b,this.a)).toColor()}toHSLA(){return CColor.rgbToHSL(new CRGBA(this.r,this.g,this.b,this.a))}toRGBA(){return new CRGBA(this.r,this.g,this.b,this.a)}toUint8Array(){let t=new Uint8Array(4);return t[0]=this.r,t[1]=this.g,t[2]=this.b,t[3]=Math.round(CCalc.cr(1,this.a,255,0,4)),t}fromUint8Array(t){this.r=t[0],this.g=t[1],this.b=t[2],this.a=CCalc.cr(1,0,255,t[3],2)}static changeHue(t,e){let i=new CColor(t),s=this.rgbToHSL(new CRGBA(i.r,i.g,i.b,i.a));return s.h+=e,s.h>360?s.h-=360:s.h<0&&(s.h+=360),this.hslToRGB(s).toColor()}static rgbToHSL(t){let e=t.r/255,i=t.g/255,s=t.b/255,o=t.a,a=Math.max(e,i,s),n=Math.min(e,i,s),r=a-n,l=(a+n)/2,h=0,d=0;return h=0==r?0:a==e?(i-s)/r%6*60:a==i?60*((s-e)/r+2):60*((e-i)/r+4),h<0&&(h=360+h),d=0==r?0:r/(1-Math.abs(2*l-1)),new CHSLA(h,d,l,o)}static hslToRGB(t){var e,i,s,o=t.h,a=t.s,n=t.l,r=t.a,l=(1-Math.abs(2*n-1))*a,h=l*(1-Math.abs(o/60%2-1)),d=n-l/2;return o<60?(e=l,i=h,s=0):o<120?(e=h,i=l,s=0):o<180?(e=0,i=l,s=h):o<240?(e=0,i=h,s=l):o<300?(e=h,i=0,s=l):(e=l,i=0,s=h),e=this.normalize_rgb_value(e,d),i=this.normalize_rgb_value(i,d),s=this.normalize_rgb_value(s,d),new CRGBA(e,i,s,r)}static normalize_rgb_value(t,e){return(t=Math.floor(255*(t+e)))<0&&(t=0),t}static rgbToHex(t,e,i){return"#"+((1<<24)+(t<<16)+(e<<8)+i).toString(16).slice(1)}static randomColor(t=0,e=255){return"rgba("+CCalc.getRandom(t,e)+","+CCalc.getRandom(t,e)+","+CCalc.getRandom(t,e)+",1)"}}class CSequence{static getSequence(t=""){let e="",i=CSequence._map.get(t);return null==i?(CSequence._map.set(t,1),e=t+"1"):(i++,CSequence._map.set(t,i),e=t+i),e}}CSequence._map=new Map;class CCalc{static cr(t,e,i,s,o){let a=0;switch(o){case 1:if(0==s)throw new Error("zero devide");a=e*i/s;break;case 2:if(0==i)throw new Error("zero devide");a=t*s/i;break;case 3:if(0==e)throw new Error("zero devide");a=t*s/e;break;case 4:if(0==t)throw new Error("zero devide");a=e*i/t}return a}static min(t,e){return t<e?t:e}static max(t,e){return t>e?t:e}static minMax(t,e){return t<e?{min:t,max:e}:{min:e,max:t}}static minMaxPoint(t,e){let i=CCalc.minMax(t.x,e.x),s=CCalc.minMax(t.y,e.y);return{min:new CPoint(i.min,s.min),max:new CPoint(i.max,s.max)}}static crRange2Value(t,e,i,s,o){return(o-s)*((i-t)/(e-t))+s}static getNowValue(t,e,i){return(e-t)*i+t}static getRandom(t,e){return(e-t)*Math.random()+t}static sind(t){let e=t*(Math.PI/180);return Math.sin(e)}static sindy(t,e){return this.sind(t)*e}static cosd(t){let e=t*(Math.PI/180);return Math.cos(e)}static cosdx(t,e){return this.cosd(t)*e}static isIn(t,e){let i=!1;for(let s=0;s<e.length;s++)if(t==e[s]){i=!0;break}return i}}class CByte{static numberToUint8Array(t){let e=new Uint8Array(8);return new DataView(e.buffer,0).setFloat64(0,t),e}static Uint8ArrayToNumber(t){return new DataView(t.buffer,0).getFloat64(0)}static stringToUint8ArrayWithLength(t){let e=(new TextEncoder).encode(t),i=new Uint8Array(8),s=new Uint8Array(e.length+i.length);new DataView(s.buffer,0).setFloat64(0,e.length);for(let t=0;t<e.length;t++)s[t+8]=e[t];return s}static Uint8ArrayToStringWithLength(t){let e=new DataView(t.buffer).getFloat64(0),i=new Uint8Array(e);for(let s=0;s<e;s++)i[s]=t[s+8];return new TextDecoder("utf-8").decode(i)}static stringToUint8Array(t){return(new TextEncoder).encode(t)}static Uint8ArrayToString(t){return new TextDecoder("utf-8").decode(t)}static booleanToUint8Array(t){let e=new Uint8Array(1);return e[0]=t?1:0,e}static Uint8ArrayToBoolean(t){return 1==t[0]}static colorToUint8Array(t){return new CColor(t).toUint8Array()}static Uint8ArrayToColor(t){let e=new CColor("#000000");return e.fromUint8Array(t),e.toColor()}static UintToUint8Array(t){let e=t.toString(16);e.length%2==1&&(e=CStringUtil.lpad(e,"0",e.length+1));let i=new Uint8Array(e.length/2),s=0;for(let t=0;t<e.length;t++)t%2==0&&(i[s]=parseInt(e.substr(t,2),16),s++);return i}static Uint8ArrayToUint(t){let e="";for(let i=0;i<t.length;i++)e+=CStringUtil.lpad(t[i].toString(16),"0",2);return parseInt(e,16)}static bufferCopy(t,e,i){let s=new Uint8Array(i);for(let o=0;o<i;o++)s[o]=t[o+e];return s}static booleansToNumber(t){let e=0,i="";for(let e=0;e<t.length;e++)t[e]?i+="1":i+="0";return i="1"+i,e=parseInt(i,2),e}static numberToBooleans(t){let e=t.toString(2),i=[];for(let t=1;t<e.length;t++)"1"==e[t]?i[t-1]=!0:i[t-1]=!1;return i}static number4bitToNumber(t){let e=0,i="";for(let e=0;e<t.length;e++){let s=t[e];s>15&&(s%=16),i+=s.toString(16)}return i="1"+i,e=parseInt(i,16),e}static numberTo4bitNumbers(t){let e=t.toString(16),i=[];for(let t=1;t<e.length;t++)i[t-1]=parseInt(e[t],16);return i}static number1byteToNumber(t){let e=new Uint8Array(8);for(let i=0;i<8;i++){let s=t[i];s>255&&(s%=256),e[i]=s}return this.Uint8ArrayToNumber(e)}static numberTo1byteNumbers(t){let e=this.numberToUint8Array(t),i=[];for(let t=0;t<e.length;t++)i[t]=e[t];return i}static bufferToHexString(t){let e="";for(let i=0;i<t.length;i++)e+=CStringUtil.lpad(t[i].toString(16),"0",2);return e}static hexStringToBuffer(t){let e=new Uint8Array(t.length/2),i=0;for(let s=0;s<t.length;s++)s%2==0&&(e[i]=parseInt(t.substr(s,2),16),i++);return e}static bufferToBase64(t){var e=t.byteLength;let i="";for(var s=0;s<e;s++)i+=String.fromCharCode(t[s]);return btoa(i)}static base64ToBuffer(t){let e=atob(t),i=new ArrayBuffer(e.length),s=new Uint8Array(i);for(let t=0;t<e.length;t++)s[t]=e.charCodeAt(t);return s}}class CBufferUtil{static bufferToBase64(t){return CByte.bufferToBase64(t)}static base64ToBuffer(t){return CByte.base64ToBuffer(t)}static bufferCompress(t){return new Promise(((e,i)=>{try{e(window.pako.deflate(t))}catch(t){i(t)}}))}static bufferDecompress(t){return new Promise(((e,i)=>{try{e(window.pako.inflate(t))}catch(t){i(t)}}))}static async bufferEncrypt(t,e,i=!1){const s=i?new Uint8Array(16):crypto.getRandomValues(new Uint8Array(16)),o=(new TextEncoder).encode(e),a=new Uint8Array([...o,...s]),n=i?new Uint8Array(16):crypto.getRandomValues(new Uint8Array(16)),r=await crypto.subtle.digest("SHA-256",a),l={name:"AES-CBC",iv:n},h=await crypto.subtle.importKey("raw",r,l,!1,["encrypt"]),d=await crypto.subtle.encrypt(l,h,t);return{buffer:new Uint8Array(d),salt:window.btoa(String.fromCharCode(...s)),iv:window.btoa(String.fromCharCode(...n))}}static async bufferDecrypt(t,e,i,s){let o;o=i?Uint8Array.from(atob(i),(t=>t.charCodeAt(0))):Uint8Array.from(atob("AAAAAAAAAAAAAAAAAAAAAA=="),(t=>t.charCodeAt(0)));const a=(new TextEncoder).encode(e),n=new Uint8Array([...a,...o]);let r;r=s?Uint8Array.from(atob(s),(t=>t.charCodeAt(0))):Uint8Array.from(atob("AAAAAAAAAAAAAAAAAAAAAA=="),(t=>t.charCodeAt(0)));const l=await crypto.subtle.digest("SHA-256",n),h={name:"AES-CBC",iv:r},d=await crypto.subtle.importKey("raw",l,h,!1,["decrypt"]),g=await crypto.subtle.decrypt(h,d,t);return new Uint8Array(g)}static async bufferCompressWithEncrypt(t,e,i=!1){let s=await this.bufferCompress(t);return await this.bufferEncrypt(s,e,i)}static async bufferDecompressWithDecrypt(t,e,i,s){let o=await this.bufferDecrypt(t,e,i,s);return await this.bufferDecompress(o)}static stringToBuffer(t){return(new TextEncoder).encode(t)}static stringFromBuffer(t){return new TextDecoder("utf-8").decode(t)}static async stringEncrypt(t,e,i=!1,s=!1){let o=CBufferUtil.stringToBuffer(t);if(s){let t=await CBufferUtil.bufferCompressWithEncrypt(o,e,!i);return{base64:CBufferUtil.bufferToBase64(t.buffer),buffer:t.buffer,salt:t.salt,iv:t.iv}}{let t=await CBufferUtil.bufferEncrypt(o,e,!i);return{base64:CBufferUtil.bufferToBase64(t.buffer),buffer:t.buffer,salt:t.salt,iv:t.iv}}}static async stringDecrypt(t,e,i,s,o=!1){let a;if(a="string"==typeof t?CBufferUtil.base64ToBuffer(t):t,o){let t=await CBufferUtil.bufferDecompressWithDecrypt(a,e,i,s);return CBufferUtil.stringFromBuffer(t)}{let t=await CBufferUtil.bufferDecrypt(a,e,i,s);return CBufferUtil.stringFromBuffer(t)}}static splitBuffer(t,e){let i=Math.floor(t.length/e),s=t.length%e,o=new Array;for(let a=0;a<e;a++)a==e-1?o.push(t.subarray(i*a,i*a+i+s)):o.push(t.subarray(i*a,i*a+i));return o}}class CSymbol{}CSymbol.SYM_TREE_ITEM=Symbol("treeitem"),function(t){t[t.BYTE=0]="BYTE",t[t.NUMBER=1]="NUMBER",t[t.BOOLEAN=2]="BOOLEAN",t[t.BIGINT=3]="BIGINT",t[t.STRING=4]="STRING",t[t.BUFFER=5]="BUFFER"}(EBinaryDataKind||(EBinaryDataKind={}));class CCustomBinaryDataWriter{copyTo(){let t=this.getBuffer();return new Uint8Array(t.length)}static joinBuffer(t){let e=0;for(let i=0;i<t.length;i++)e+=t[i].length;let i=new Uint8Array(e),s=0;for(let e=0;e<t.length;e++)i.set(t[e],s),s+=t[e].length;return i}static getByteBuffer(t){let e=new Uint8Array(2),i=new DataView(e.buffer,0);return i.setUint8(0,EBinaryDataKind.BYTE),i.setUint8(1,t),e}static getNumberBuffer(t){let e=new Uint8Array(9),i=new DataView(e.buffer,0);return i.setUint8(0,EBinaryDataKind.NUMBER),i.setFloat64(1,t),e}static getBooleanBuffer(t){let e=new Uint8Array(2),i=new DataView(e.buffer,0);return i.setUint8(0,EBinaryDataKind.BOOLEAN),t?i.setUint8(1,1):i.setUint8(1,0),e}static getBigIntBuffer(t){let e=(new TextEncoder).encode(t.toString()),i=new Uint8Array(9),s=new DataView(i.buffer,0);return s.setUint8(0,EBinaryDataKind.BIGINT),s.setFloat64(1,e.byteLength),CCustomBinaryDataWriter.joinBuffer([i,e])}static getStringBuffer(t){let e=(new TextEncoder).encode(t),i=new Uint8Array(9),s=new DataView(i.buffer,0);return s.setUint8(0,EBinaryDataKind.STRING),s.setFloat64(1,e.byteLength),CCustomBinaryDataWriter.joinBuffer([i,e])}static getBufferBuffer(t){let e=new Uint8Array(9),i=new DataView(e.buffer,0);return i.setUint8(0,EBinaryDataKind.BUFFER),i.setFloat64(1,t.byteLength),CCustomBinaryDataWriter.joinBuffer([e,t])}}class CBinaryDataWriter extends CCustomBinaryDataWriter{get size(){let t=0;this.orgBuffer&&(t+=this.orgBuffer.byteLength);for(let e=0;e<this.buffers.length;e++)t+=this.buffers[e].byteLength;return t}constructor(t){super(),this.buffers=new Array,null!=t&&(this.orgBuffer=t,this.buffers.push(this.orgBuffer))}unshiftByte(t){return this.buffers.unshift(CCustomBinaryDataWriter.getByteBuffer(t)),this}unshiftNumber(t){return this.buffers.unshift(CCustomBinaryDataWriter.getNumberBuffer(t)),this}unshiftBoolean(t){return this.buffers.unshift(CCustomBinaryDataWriter.getBooleanBuffer(t)),this}unshiftBigInt(t){return this.buffers.unshift(CCustomBinaryDataWriter.getBigIntBuffer(t)),this}unshiftString(t){return this.buffers.unshift(CCustomBinaryDataWriter.getStringBuffer(t)),this}unshiftBuffer(t){return this.buffers.unshift(CCustomBinaryDataWriter.getBufferBuffer(t)),this}putByte(t){return this.buffers.push(CCustomBinaryDataWriter.getByteBuffer(t)),this}putNumber(t){return this.buffers.push(CCustomBinaryDataWriter.getNumberBuffer(t)),this}putBoolean(t){return this.buffers.push(CCustomBinaryDataWriter.getBooleanBuffer(t)),this}putBigInt(t){return this.buffers.push(CCustomBinaryDataWriter.getBigIntBuffer(t)),this}putString(t){return this.buffers.push(CCustomBinaryDataWriter.getStringBuffer(t)),this}putBuffer(t){return this.buffers.push(CCustomBinaryDataWriter.getBufferBuffer(t)),this}getBuffer(){return CCustomBinaryDataWriter.joinBuffer(this.buffers)}getArrayBuffer(){let t=this.buffers.reduce(((t,e)=>t+e.length),0),e=new ArrayBuffer(t),i=new Uint8Array(e),s=0;return this.buffers.forEach((t=>{i.set(t,s),s+=t.length})),e}}class CBinaryDataReader{constructor(t){if(this.position=0,t instanceof Uint8Array)this.buffer=t;else{let e=new Uint8Array(t);this.buffer=e}}getValue(){let t=new DataView(this.buffer.buffer,this.buffer.byteOffset,this.buffer.length),e=t.getUint8(this.position);switch(this.position++,e){case EBinaryDataKind.BYTE:{let e=t.getUint8(this.position);return this.position++,{kind:EBinaryDataKind.BYTE,value:e}}case EBinaryDataKind.NUMBER:{let e=t.getFloat64(this.position);return this.position+=8,{kind:EBinaryDataKind.NUMBER,value:e}}case EBinaryDataKind.BOOLEAN:{let e=t.getUint8(this.position);return this.position++,{kind:EBinaryDataKind.BOOLEAN,value:1==e}}case EBinaryDataKind.BIGINT:{let e=t.getFloat64(this.position);this.position+=8;let i=this.buffer.subarray(this.position,this.position+e);this.position+=e;let s=new TextDecoder("utf-8").decode(i),o=BigInt(s);return{kind:EBinaryDataKind.BIGINT,value:o}}case EBinaryDataKind.STRING:{let e=t.getFloat64(this.position);this.position+=8;let i=this.buffer.subarray(this.position,this.position+e);return this.position+=e,{kind:EBinaryDataKind.STRING,value:new TextDecoder("utf-8").decode(i)}}case EBinaryDataKind.BUFFER:{let e=t.getFloat64(this.position);this.position+=8;let i=this.buffer.subarray(this.position,this.position+e);return this.position+=e,{kind:EBinaryDataKind.BUFFER,value:i}}default:throw new Error("Invalid data")}}getByte(){let t=this.getValue();if(t.kind==EBinaryDataKind.BYTE)return t.value;throw new Error("Not byte value")}getNumber(){let t=this.getValue();if(t.kind==EBinaryDataKind.NUMBER)return t.value;throw new Error("Not number value")}getBoolean(){let t=this.getValue();if(t.kind==EBinaryDataKind.BOOLEAN)return t.value;throw new Error("Not boolean value")}getBigint(){let t=this.getValue();if(t.kind==EBinaryDataKind.BIGINT)return t.value;throw new Error("Not bigint value")}getString(){let t=this.getValue();if(t.kind==EBinaryDataKind.STRING)return t.value;throw new Error("Not string value")}getBuffer(){let t=this.getValue();if(t.kind==EBinaryDataKind.BUFFER)return t.value;throw new Error("Not buffer value")}toArray(){let t=this.position;if(this.position=0,this.buffer.length>0){let e=new Array;for(;this.position<this.buffer.length-1;)e.push(this.getValue());return this.position=t,e}return this.position=t,[]}values(){let t=this.position;if(this.position=0,this.buffer.length>0){let e=new Array;for(;this.position<this.buffer.length-1;)e.push(this.getValue().value);return this.position=t,e}return this.position=t,[]}toJson(){return JSON.stringify(this.values())}}class CMap2{constructor(){this.__data=new Map}set(t,e,i){let s=this.__data.get(t);null==s&&(s=new Map,this.__data.set(t,s)),s.set(e,i)}get(t,e){let i=this.__data.get(t);return null==i&&(i=new Map,this.__data.set(t,i)),null==e?i:i.get(e)}delete(t,e){if(null==e)this.__data.delete(t);else{let i=this.__data.get(t);null!=i&&i.delete(e)}}has(t,e){if(null!=e){let i=this.__data.get(t);if(null!=i){return null!=i.get(e)}return!1}return null!=this.__data.get(t)}childClear(t){let e=this.__data.get(t);null!=e&&e.clear()}forEach(t){this.__data.forEach((function(e,i){e.forEach((function(e,s){t(i,s,e)}))}))}clear(){this.__data.clear()}}class CGroupMap{constructor(){this.__data=new Map,this.onChange=new Array}doChange(t,e){for(let i=0;i<this.onChange.length;i++)this.onChange[i](t,e)}set(t,e){let i=this.__data.get(t);null==i&&(i=new Array,this.__data.set(t,i)),i.push(e),this.doChange(t,e)}get(t){let e=this.__data.get(t);return null==e&&(e=new Array,this.__data.set(t,e)),e}delete(t,e){if(null==e)return this.__data.delete(t);{let i=this.__data.get(t);if(null!=i)for(let t=0;t<i.length;t++)if(i[t]==e){i.splice(t,1);break}}this.doChange(t,e)}deleteValue(t){let e=!1,i=this;this.__data.forEach((function(s,o){if(!e)for(let a=0;a<s.length;a++)if(s[a]==t){s.splice(a,1),e=!0,i.doChange(o);break}}))}childClear(t){this.__data.set(t,[]),this.doChange(t)}clear(){this.__data.clear(),this.doChange()}toArray(){let t=new Array;return this.__data.forEach((function(e,i){t.push({key:i,value:e})})),t}has(t){return null!=this.__data.get(t)}}class CGroupMap2{constructor(){this.__data=new Map}count(t,e){return this.get(t,e).length}set(t,e,i){let s=this.__data.get(t);null==s&&(s=new Map,this.__data.set(t,s));let o=s.get(e);null==o&&(o=new Array,s.set(e,o)),o.push(i)}get(t,e){let i=this.__data.get(t);if(null==i&&(i=new Map,this.__data.set(t,i)),null==e)return i;{let t=i.get(e);return null==t&&(t=new Array,i.set(e,t)),t}}delete(t,e,i){if(null!=i&&null!=e){let s=this.get(t,e);for(let t=s.length-1;t>=0;t--)s[t]==i&&s.splice(t,1)}else if(null!=i&&null==e){this.get(t).forEach((function(t,e){for(let e=t.length-1;e>=0;e--)t[e]==i&&t.splice(e,1)}))}else if(null==e)this.__data.delete(t);else{let i=this.__data.get(t);null!=i&&i.delete(e)}}childClear(t){let e=this.__data.get(t);null!=e&&e.clear()}forEach(t){this.__data.forEach((function(e,i){e.forEach((function(s,o){t(i,e,s)}))}))}clear(){this.__data.clear()}}class CQueue{constructor(t=-1){this._idx=-1,this._position=-1,this._data=new Map,this._limitCount=-1,this._limitCount=t}get limitCount(){return this._limitCount}set limitCount(t){if(this._limitCount=t,-1!=t){let e=t-this._data.size;for(let t=0;t<e;t++)this.pop()}}get count(){return this._data.size}doToData(t){[]}push(t){return this._idx++,this._data.set(this._idx,t),-1!=this._limitCount&&this._data.size>this._limitCount&&this.pop(),this._idx}pop(){if(0==this._data.size)throw new Error("empry data");this._position++;let t=this._data.get(this._position);if(this._data.delete(this._position),null!=t)return t;throw new Error("pop is undefined")}view(t){let e=this._data.get(this._position+t+1);if(null!=e)return e;throw new Error("pop is undefined")}loopView(t){for(let e=0;e<this.count;e++)t(this.view(e))}clear(){this._data.clear(),this._idx=-1,this._position=-1}}class CEnum{static toArray(t){let e=Object.keys(t),i=new Array;for(let t=0;t<e.length;t++){let s=parseInt(e[t]);isNaN(s)&&i.push(e[t])}return i}}class CClass{get className(){return this.constructor.name}is(t){return this instanceof t}as(){return this}getProperty(t){return new Function("obj","return obj."+t)(this)}setProperty(t,e){if("string"==typeof this.getProperty(t)){new Function("obj","obj."+t+" = `"+e+"`")(this,e)}else if(null==this.getProperty);else if(""!=e){new Function("obj","obj."+t+" = "+e)(this,e)}}instanceOf(t){return new Function("obj","return obj instanceof "+t)(this)}addProperties(){let t=new Array;return t.push({instance:this.className,propertyName:"className",readOnly:!0,enum:[]}),t}static hasFunction(t,e){return null!=t[e]&&t[e]instanceof Function}static objectUndefined(t,e){t[e]=void 0}static createClass(t,e,i){let s="";for(let t=0;t<e.length;t++)s+=0==t?e[t]:","+e[t];return i(new Function(...e,"return new "+t+"("+s+");"))}static instanceOf(t,e){return new Function("obj","return obj instanceof "+e)(t)}static async getClassHash(t){return await CStringUtil.sha256(new Function("return "+t+".toString()")())}}class CDataClass extends CClass{doRemove(){null!=this.onRemove&&this.onRemove(this)}toData(){let t={};return this.doToData(t),t}fromData(t){this.doFromData(t)}equal(t){return JSON.stringify(this.toData())==JSON.stringify(t.toData())}copyFrom(t){this.fromData(t.toData())}remove(){this.doRemove()}static putData(t,e,i,s=void 0,o=!1){o?JSON.stringify(i)!=JSON.stringify(s)&&(t[e]=i):i!=s&&(t[e]=i)}static getData(t,e,i=void 0,s=!1){if(null!=t)return null!=t[e]?s?JSON.stringify(t[e])!=JSON.stringify(i)?t[e]:i:t[e]!=i?t[e]:i:i;console.error("get data error : Not exists object",e,i,s)}}class CResourceClass extends CDataClass{constructor(){super(...arguments),this.__resource="",this._resource=""}get resource(){return this._resource}set resource(t){if(null==t)throw new Error("Invalid resource name(undefined) / class : "+this.className);this._resource!=t&&(this._resource=t,""!=t&&(this.__resource=t,CSystem.resourcesLoad?this.doResource():CSystem.requestResources.push(this)))}get lastResourceName(){return this.__resource}doToData(t){CDataClass.putData(t,"resource",this._resource,"")}doFromData(t){this.resource=CDataClass.getData(t,"resource","")}doResource(){let t=CSystem.resources.get(this._resource);if(null==t)throw new Error("Not exists resource : "+this._resource);try{t.kind&&"root"==t.kind?this.fromAllChildData(t):this.fromData(t)}catch(t){console.error("Resource load error : "+this._resource,t)}null!=this.onResource&&this.onResource(this)}fromAllChildData(t){}}class CNotifyChangeObject extends CResourceClass{constructor(){super(...arguments),this._useChangeEvent=!0}get useChangeEvent(){return this._useChangeEvent}set useChangeEvent(t){this._useChangeEvent=t}}class CNotifyChangeNotifyObject extends CNotifyChangeObject{doChange(){null!=this.onChange&&this.useChangeEvent&&this.onChange(this)}}class CNotifyChangeKindObject extends CNotifyChangeObject{doChange(t){null!=this.onChange&&this.useChangeEvent&&this.onChange(this,t)}}class ArrayString extends Array{}class ArrayNumber extends Array{}class CList extends CNotifyChangeKindObject{constructor(){super(...arguments),this.__data=new Array}static get CON_CHANGE_ADD(){return"a"}static get CON_CHANGE_INSERT(){return"i"}static get CON_CHANGE_DELETE(){return"d"}static get CON_CHANGE_SET(){return"s"}get length(){return this.__data.length}set length(t){this.__data.length=t}get array(){let t=new Array;for(let e=0;e<this.__data.length;e++)t.push(this.get(e));return t}doRemove(){this.__data=[],super.doRemove()}add(t){this.__data.push(t),this.doChange(CList.CON_CHANGE_ADD)}insert(t,e){this.__data.splice(t,0,e),this.doChange(CList.CON_CHANGE_INSERT)}delete(t,e=1){let i=this.__data.length>t&&t>=0;return this.__data.splice(t,e),this.doChange(CList.CON_CHANGE_DELETE),i}get(t){return this.__data[t]}set(t,e){this.__data[t]=e,this.doChange(CList.CON_CHANGE_SET)}deleteAll(){for(let t=this.__data.length-1;t>=0;t--)this.delete(t)}clear(){this.deleteAll()}sort(t){return this.__data.sort(t)}swap(t,e){if(t<0||t>this.length-1)throw new Error("invalid index1");if(e<0||e>this.length-1)throw new Error("invalid index2");let i=this.get(e);this.set(e,this.get(t)),this.set(t,i)}toData(){let t=[];return this.doToData(t),t}addProperties(){let t=super.addProperties();for(let e=0;e<this.length;e++)t.push({instance:this.get(e),propertyName:"__data["+e+"]",readOnly:!1,enum:[]});return t}}class CStringList extends CList{doToData(t){super.doToData(t);for(let e=0;e<this.length;e++)t.push(this.get(e))}doFromData(t){super.doFromData(t),this.clear();for(let e=0;e<t.length;e++)this.add(t[e])}}class CNumberList extends CList{doToData(t){super.doToData(t);for(let e=0;e<this.length;e++)t.push(this.get(e))}doFromData(t){super.doFromData(t),this.clear();for(let e=0;e<t.length;e++)this.add(t[e])}}class CMap extends CNotifyChangeObject{constructor(){super(...arguments),this.__data=new Map}static get CON_CHANGE_SET(){return"s"}static get CON_CHANGE_DELETE(){return"d"}static get CON_CHANGE_CLEAR(){return"c"}get size(){return this.__data.size}doRemove(){this.__data.clear(),super.doRemove()}doChange(t,e,i){null!=this.onChange&&this.onChange(this,t,e,i)}set(t,e){let i=this.__data.set(t,e);return this.doChange(CMap.CON_CHANGE_SET,t,e),i}get(t){return this.__data.get(t)}delete(t){let e=this.__data.delete(t);return this.doChange(CMap.CON_CHANGE_DELETE,t),e}clear(){this.__data.clear(),this.doChange(CMap.CON_CHANGE_CLEAR)}keys(){return this.__data.keys()}values(){return this.__data.values()}forEach(t){this.__data.forEach(t)}has(t){return this.__data.has(t)}toArray(){let t=new Array;return this.__data.forEach((function(e,i){let s={key:i,value:e};t.push(s)})),t}toData(){let t=[];return this.doToData(t),t}}class CNNMap extends CMap{doToData(t){super.doToData(t),this.forEach((function(e,i){t.push({key:i,value:e})}))}doFromData(t){super.doFromData(t),this.clear();for(let e=0;e<t.length;e++)this.set(t[e].key,t[e].value)}}class CSSMap extends CMap{doToData(t){super.doToData(t),this.forEach((function(e,i){t.push({key:i,value:e})}))}doFromData(t){super.doFromData(t),this.clear();for(let e=0;e<t.length;e++)this.set(t[e].key,t[e].value)}}class CSet extends CNotifyChangeKindObject{constructor(){super(...arguments),this.__data=new Set}static get CON_CHANGE_ADD(){return"a"}static get CON_CHANGE_DELETE(){return"d"}static get CON_CHANGE_CLEAR(){return"c"}get size(){return this.__data.size}doRemove(){this.__data.clear(),super.doRemove()}add(t){let e=this.__data.add(t);return this.doChange(CSet.CON_CHANGE_ADD),e}delete(t){let e=this.__data.delete(t);return this.doChange(CSet.CON_CHANGE_DELETE),e}clear(){this.__data.clear(),this.doChange(CSet.CON_CHANGE_CLEAR)}has(t){return this.__data.has(t)}forEach(t){this.__data.forEach(t)}toArray(){let t=new Array;return this.__data.forEach((function(e){t.push(e)})),t}toData(){let t=[];return this.doToData(t),t}}class CNotifyQueue extends CNotifyChangeKindObject{static get CON_CHANGE_PUSH(){return"p"}static get CON_CHANGE_POP(){return"po"}static get CON_CHANGE_CLEAR(){return"c"}static get CON_CHANGE_LIMIT_COUNT(){return"l"}get limitCount(){return this._queue.limitCount}set limitCount(t){t!=this._queue.limitCount&&(this._queue.limitCount=t,this.doChange(CNotifyQueue.CON_CHANGE_LIMIT_COUNT))}get count(){return this._queue.count}constructor(t=-1){super(),this._queue=new CQueue(t)}doRemove(){this._queue.clear(),super.doRemove()}push(t){let e=this._queue.push(t);return this.doChange(CNotifyQueue.CON_CHANGE_PUSH),e}pop(){let t=this._queue.pop();return this.doChange(CNotifyQueue.CON_CHANGE_POP),t}view(t){return this._queue.view(t)}loopView(t){for(let e=0;e<this.count;e++)t(this.view(e))}clear(){this._queue.clear(),this.doChange(CNotifyQueue.CON_CHANGE_CLEAR)}toData(){let t=[];return this.doToData(t),t}}class CStringSet extends CSet{doToData(t){super.doToData(t),this.forEach((function(e){t.push(e)}))}doFromData(t){super.doFromData(t),this.clear();for(let e=0;e<t.length;e++)this.add(t[e])}}class CVariable extends CNotifyChangeNotifyObject{get type(){return typeof this._data}get asString(){return this._data+""}set asString(t){t!=this._data&&(this._data=t,this.doChange())}get asNumber(){return this._data}set asNumber(t){t!=this._data&&(this._data=t,this.doChange())}get asBoolean(){return this._data}set asBoolean(t){t!=this._data&&(this._data=t,this.doChange())}get asObject(){return this._data}set asObject(t){t!=this._data&&(this._data=t,this.doChange())}get value(){return this._data}constructor(t){super(),null!=t&&(this._data=t)}doRemove(){this._data=void 0,super.doRemove()}asType(){return this._data}setType(t){t!=this._data&&(this._data=t,this.doChange())}}class CRowData extends CNotifyChangeObject{get length(){return this._data.length}constructor(t){super(),this._data=new Array;let e=this;if(null!=t)for(let i=0;i<t.length;i++){let s=new CVariable(t[i]);s.index=i,s.onChange=function(){e.doChange(s.index,s)},this._data.push(s)}}doToData(t){for(let e=0;e<this._data.length;e++)"object"==typeof this._data[e].value?this._data[e].value instanceof CDataClass&&t.push(this._data[e].value.toData()):t.push(this._data[e].value)}doFromData(t){this._data=[];for(let e=0;e<t.length;e++){let i=new CVariable(t[e]);this._data.push(i)}}doRemove(){this._data=[],super.doRemove()}doChange(t,e){this.useChangeEvent&&null!=this.onChange&&this.onChange(this,t,e)}get(t){return this._data[t]}getValues(){let t=[];for(let e=0;e<this._data.length;e++)t.push(this._data[e].value);return t}toData(){let t=[];return this.doToData(t),t}}class CGridData extends CNotifyChangeObject{static get CON_CHANGE_ADD(){return"a"}static get CON_CHANGE_INSERT(){return"i"}static get CON_CHANGE_DELETE(){return"d"}static get CON_CHANGE_CLEAR(){return"c"}static get CON_CHANGE_SET(){return"s"}static get CON_CHANGE_DATA(){return"da"}get columnCount(){return this._columnCount}get data(){return this._data}get indexes(){return this._indexes}get length(){return this._data.length}constructor(t,e,i){super(),this.__useIndex=!1,this._data=new CList,this._indexes=new CMap;let s=this;if(this._columnCount=t,this._indexColumns=e,this._uniqueColumns=i,null!=this._uniqueColumns){for(let t=0;t<this._uniqueColumns.length;t++){let e=new CMap;this._indexes.set(this._uniqueColumns[t],e)}this._uniqueColumns.length>0&&(this.__useIndex=!0)}if(null!=e){for(let t=0;t<e.length;t++){let i=new CMap;this._indexes.set(e[t],i)}e.length>0&&(this.__useIndex=!0)}this._data.onChange=function(t,e){CList.CON_CHANGE_ADD==e&&s.doChange(CGridData.CON_CHANGE_ADD),CList.CON_CHANGE_INSERT==e&&s.doChange(CGridData.CON_CHANGE_INSERT),CList.CON_CHANGE_DELETE==e&&s.doChange(CGridData.CON_CHANGE_DELETE),CList.CON_CHANGE_SET==e&&s.doChange(CGridData.CON_CHANGE_SET)}}doToData(t){super.doToData(t),CDataClass.putData(t,"columnCount",this._columnCount);let e=new Array;for(let t=0;t<this._data.length;t++)e.push(this._data.get(t).toData());CDataClass.putData(t,"data",e,[],!0),CDataClass.putData(t,"indexColumns",this._indexColumns,void 0),CDataClass.putData(t,"uniqueColumns",this._uniqueColumns,void 0)}doFromData(t){if(super.doFromData(t),this.clear(),this.indexes.clear(),this._columnCount=CDataClass.getData(t,"columnCount",0),this._indexColumns=CDataClass.getData(t,"indexColumns",void 0),this._uniqueColumns=CDataClass.getData(t,"uniqueColumns",void 0),null!=this._uniqueColumns){for(let t=0;t<this._uniqueColumns.length;t++){let e=new CMap;this._indexes.set(this._uniqueColumns[t],e)}this._uniqueColumns.length>0&&(this.__useIndex=!0)}if(null!=this._indexColumns){for(let t=0;t<this._indexColumns.length;t++){let e=new CMap;this._indexes.set(this._indexColumns[t],e)}this._indexColumns.length>0&&(this.__useIndex=!0)}let e=CDataClass.getData(t,"data",[],!0);for(let t=0;t<e.length;t++)this.add(e[t])}doRemove(){this._data.remove(),this._indexes.remove(),this._indexColumns=void 0,this._uniqueColumns=void 0,super.doRemove()}doChange(t,e,i){this.useChangeEvent&&null!=this.onChange&&this.onChange(this,t,e,i)}doAdd(t){let e=this;if(null!=this._uniqueColumns&&this._uniqueColumns.length>0)for(let e=0;e<this._uniqueColumns.length;e++){if(this.findIndexRow(this._uniqueColumns[e],t[this._uniqueColumns[e]]).length>0)throw new Error("column "+this._uniqueColumns[e]+" is duplicated")}let i=new CRowData(t);return i.onChange=function(t,s,o){e.doChange(CGridData.CON_CHANGE_DATA,o,i)},this.__useIndex&&this.addIndex(this._data.length,i),this._data.add(i),this.useChangeEvent&&null!=this.onAdd&&this.onAdd(this,i),i}doInsert(t,e){let i=this;if(null!=this._uniqueColumns&&this._uniqueColumns.length>0)for(let t=0;t<this._uniqueColumns.length;t++){if(this.findIndexRow(this._uniqueColumns[t],e[this._uniqueColumns[t]]).length>0)throw new Error("column "+this._uniqueColumns[t]+" is duplicated")}let s=new CRowData(e);return s.onChange=function(t,e,o){i.doChange(CGridData.CON_CHANGE_DATA,o,s)},this.__useIndex&&this.addIndex(t,s),this._data.insert(t,s),this.useChangeEvent&&null!=this.onInsert&&this.onInsert(this,t,s),s}doDelete(t){let e=this._data.delete(t);this.__useIndex&&e&&this.deleteIndex(t),this.useChangeEvent&&null!=this.onDelete&&this.onDelete(this)}doSet(t,e){let i=this;if(null!=this._uniqueColumns&&this._uniqueColumns.length>0)for(let t=0;t<this._uniqueColumns.length;t++){if(this.findIndexRow(this._uniqueColumns[t],e[this._uniqueColumns[t]]).length>0)throw new Error("column "+this._uniqueColumns[t]+" is duplicated")}let s=new CRowData(e);return s.onChange=function(t,e,o){i.doChange(CGridData.CON_CHANGE_DATA,o,s)},this.__useIndex&&this.setIndex(t,s),this._data.set(t,s),this.useChangeEvent&&null!=this.onSet&&this.onSet(this,t,s),s}doClear(){this._data.clear(),this._indexes.clear(),this.useChangeEvent&&null!=this.onClear&&this.onClear(this)}addIndex(t,e){this._indexes.forEach((function(i,s){let o=e.get(s),a=i.get(o.value);null==a&&(a=new Set,i.set(o.value,a)),a.add({index:t})}))}setIndex(t,e){this._indexes.forEach((function(e,i){e.forEach((function(e,i){e.delete({index:t})}))})),this.addIndex(t,e)}deleteIndex(t){this._indexes.forEach((function(e,i){let s=new Array;e.forEach((function(e,i){let o;e.forEach((function(e){e.index==t&&(o=e),e.index>t&&e.index--})),e.delete(o),0==e.size&&s.push(i)}));for(let t=0;t<s.length;t++)e.delete(s[t])}))}add(t){return this.doAdd(t)}insert(t,e){return this.doInsert(t,e)}delete(t){if("number"==typeof t)this.doDelete(t);else for(let e=0;e<t.length;e++)this.doDelete(t[e])}set(t,e){return this.doSet(t,e)}deleteAll(){for(let t=this.length-1;t>=0;t--)this.delete(t)}clear(){this.doClear()}getRow(t){return this._data.get(t)}getRowValues(t){return this._data.get(t).getValues()}getRowIndex(t){let e=-1;for(let i=0;this._data.length;i++)if(this._data[i]==t){e=i;break}return e}cell(t,e){if(e<this._data.length&&t<this._data.get(e).length)return this._data.get(e).get(t)}setCell(t,e,i){if(!(e<this._data.length&&t<this._data.get(e).length))throw new Error("invalid column or row : "+t+","+e);"boolean"==typeof i&&(this._data.get(e).get(t).asBoolean=i),"number"==typeof i&&(this._data.get(e).get(t).asNumber=i),"string"==typeof i&&(this._data.get(e).get(t).asString=i),"object"==typeof i&&(this._data.get(e).get(t).asObject=i)}findIndexRow(t,e){let i=new Array,s=this._indexes.get(t);if(null!=s){let t=s.get(e);null!=t&&t.forEach((function(t){i.push(t.index)}))}return i}findIndex(t,e){let i=new Array,s=this.findIndexRow(t,e);for(let t=0;t<s.length;t++)i.push(this._data.get(s[t]));return i}sort(t){return this._data.sort(t)}sortColumn(t,e=!0){return e?this.sort((function(e,i){let s=0;return e.get(t).value>i.get(t).value&&(s=1),e.get(t).value<i.get(t).value&&(s=-1),s})):this.sort((function(e,i){let s=0;return e.get(t).value>i.get(t).value&&(s=-1),e.get(t).value<i.get(t).value&&(s=1),s}))}loopColumn(t,e){for(let i=0;i<this.length;i++)e(this.getRow(i).get(t))}}class CTableData extends CGridData{get columnNames(){return this._columnNames}get indexColumnNames(){return this._indexColumnNames}get uniqueColumnNames(){return this._uniqueColumnNames}constructor(t,e,i){function s(e){let i=-1;for(let s=0;s<t.length;s++)if(t[s]==e){i=s;break}return i}let o,a;if(null!=e){o=new Array;for(let t=0;t<e.length;t++){let i=s(e[t]);-1!=i&&o.push(i)}}if(null!=i){a=new Array;for(let t=0;t<i.length;t++){let e=s(i[t]);-1!=e&&a.push(e)}}super(t.length,o,a),this._columnNames=new Map;for(let e=0;e<t.length;e++)this._columnNames.set(t[e],e);this._indexColumnNames=e,this._uniqueColumnNames=i}doToData(t){super.doToData(t);let e=new Array;this._columnNames.forEach((function(t,i){let s={name:i,columnIndex:t};e.push(s)})),CDataClass.putData(t,"columnNames",e,[],!0),CDataClass.putData(t,"indexColumnNames",this._indexColumnNames,void 0),CDataClass.putData(t,"uniqueColumnNames",this._uniqueColumnNames,void 0)}doFromData(t){super.doFromData(t);let e=CDataClass.getData(t,"columnNames",[]);this._columnNames.clear();for(let t=0;t<e.length;t++)this._columnNames.set(e[t].name,e[t].columnIndex);this._indexColumnNames=CDataClass.getData(t,"indexColumnNames",void 0),this._uniqueColumnNames=CDataClass.getData(t,"uniqueColumnNames",void 0)}doRemove(){this._columnNames.clear(),this._indexColumnNames=void 0,this._uniqueColumnNames=void 0,super.doRemove()}cell(t,e){if("string"!=typeof t)return this._data.get(e).get(t);{let i=this._columnNames.get(t);if(null!=i)return this._data.get(e).get(i)}}findIndexRow(t,e){let i,s=new Array;i="string"==typeof t?this._columnNames.get(t):t;let o=this._indexes.get(i);if(null!=o){let t=o.get(e);null!=t&&t.forEach((function(t){s.push(t.index)}))}return s}findIndex(t,e){let i,s=new Array;i="string"==typeof t?this._columnNames.get(t):t;let o=this.findIndexRow(i,e);for(let t=0;t<o.length;t++)s.push(this._data.get(o[t]));return s}find(t){let e;for(let i=0;i<t.length&&!(i>0&&0==e.length);i++){let s=this._columnNames.get(t[i].columnName);if(null!=s)if(0==i)e=this.findIndex(s,t[i].value);else for(let o=e.length-1;o>=0;o--){e[o].get(s).value!=t[i].value&&e.splice(o,1)}}return e}}class CFlowItem extends CDataClass{constructor(t){super(),this._id="",this._object=void 0,this._isFinish=!1,this._parent=t}get parent(){return this._parent}get id(){return this._id}set id(t){this._id=t}get isFinish(){return this._isFinish}get object(){return this._object}set object(t){this._object=t}doExecute(){this._isFinish=!1,null!=this.onExecute&&this.onExecute(this)}doFinish(){this._isFinish=!0,this.parent.itemFinish(this),null!=this.onFinish&&this.onFinish(this)}doToData(t){}doFromData(t){}execute(){this.doExecute()}finish(){this.doFinish()}}class CFlowModel extends CDataClass{constructor(){super(...arguments),this._items=new CSet,this._idMap=new CMap,this._previousItems=new CMap,this._nextItems=new CMap}get items(){return this._items}get previousItems(){return this._previousItems}get nextItems(){return this._nextItems}doCheckPrevious(t){if(this._previousItems.has(t)){let e=this._previousItems.get(t);if(null!=e){let i=!0;e.forEach((function(t){0==t.isFinish&&(i=!1)})),i&&t.execute()}}}doItemFinish(t){if(this._nextItems.has(t)){let e=this._nextItems.get(t);if(null!=e){let t=this;e.forEach((function(e){t.doCheckPrevious(e)}))}}}doBeforeItemDelete(t){null!=this.onBeforeItemDelete&&this.onBeforeItemDelete(this,t)}doToData(t){}doFromData(t){}getItem(t){return this._idMap.get(t)}addItem(t,e=void 0){if(!this._idMap.has(t)){let i=new CFlowItem(this);return i.id=t,null!=e&&(i.onExecute=e),this._items.add(i),this._idMap.set(t,i),i}}deleteItem(t){let e=this._idMap.get(t);if(null!=e){this.doBeforeItemDelete(e),this._previousItems.has(e)&&this._previousItems.delete(e),this._nextItems.has(e)&&this._nextItems.delete(e);for(let t of this._previousItems.values())t.has(e)&&t.delete(e);for(let t of this._nextItems.values())t.has(e)&&t.delete(e);this._items.delete(e),this._idMap.delete(t)}}addLink(t,e){if(null==this._nextItems.get(t)){let i=new CSet;i.add(e),this._nextItems.set(t,i)}else{let i=this._nextItems.get(t);null!=i&&i.add(e)}if(null==this._previousItems.get(e)){let i=new CSet;i.add(t),this._previousItems.set(e,i)}else{let i=this._previousItems.get(e);null!=i&&i.add(t)}}deleteLink(t,e){if(this._previousItems.has(e)){let i=this._previousItems.get(e);null!=i&&i.has(t)&&i.delete(t),this._previousItems.delete(e)}if(this._nextItems.has(t)){let i=this._nextItems.get(t);null!=i&&i.has(e)&&i.delete(e),this._nextItems.delete(t)}}startItems(){let t=new CList,e=this;return this._items.forEach((function(i){if(e._previousItems.has(i)){let s=e._previousItems.get(i);0==s?.size&&t.add(i)}else t.add(i)})),t}stopItems(){let t=new CList,e=this;return this._items.forEach((function(i){if(e._nextItems.has(i)){let s=e._nextItems.get(i);0==s?.size&&t.add(i)}else t.add(i)})),t}getFlowCount(t){let e=0,i=this;return function t(s){if(i._nextItems.has(s)){let e=i._nextItems.get(s);null!=e&&e.forEach((function(e){t(e)}))}else e++}(t),e}getFlow(t){let e=new CList,i=this;return function t(s,o){if(i._nextItems.has(s)){let e=i._nextItems.get(s);null!=e&&e.forEach((function(e){t(e,o+","+e.id)}))}else e.add(o)}(t,t.id),e}getAllFlow(){let t=new CList,e=this.startItems();for(let i=0;i<e.length;i++){let s=this.getFlow(e[i]);for(let e=0;e<s.length;e++)t.add(s.get(e))}return t}getAllFlowCount(){let t=0,e=this.startItems();for(let i=0;i<e.length;i++)t+=this.getFlowCount(e[i]);return t}itemFinish(t){this.doItemFinish(t)}}class CAutoIncId{get nextId(){if(this.__id++,this.__id>Number.MAX_SAFE_INTEGER&&(this.__id=0),-1!=this.__len){let t=this.__id+"";return t.length<this.__len&&(t=CStringUtil.lpad(t,"0",this.__len)),this.__preFix+t}return this.__preFix+this.__id+""}constructor(t,e){this.__id=0,this.__preFix="",this.__len=-1,null!=t&&(this.__preFix=t),null!=e&&(this.__len=e)}}!function(t){t[t.LAST_ADD=0]="LAST_ADD",t[t.LAST_DELETE=1]="LAST_DELETE"}(EDirType||(EDirType={}));class CFileUtil{static extractFileName(t){let e=this.posixFilename(t).split("/");return e[e.length-1]}static extractFileNameWithoutExt(t){let e=this.posixFilename(t).split("/");return e[e.length-1].split(".")[0]}static extractFileExt(t){let e=this.extractFileName(this.posixFilename(t));if(e.indexOf(".")>=0){let t=e.split(".");return t[t.length-1]}return""}static extractFilePath(t,e=!0){let i=this.posixFilename(t).split("/"),s="/";for(let t=1;t<i.length-1;t++)s+=1==t?i[t]:"/"+i[t];return e?s:s+"/"}static posixFilename(t){return CStringUtil.replaceAll(t,"\\","/")}static getDirName(t,e=EDirType.LAST_DELETE){let i=this.posixFilename(t);return e==EDirType.LAST_ADD?"/"!=i[i.length-1]?i+"/":i:"/"==i[i.length-1]?i.substr(0,i.length-1):i}}class CArrayUtil{static orderBy(t,e){return t.sort(((t,i)=>{for(let s=0;s<e.length;s++){const o=e[s];let a=0;if(a="string"==typeof t[o.fieldName]&&"string"==typeof i[o.fieldName]?t[o.fieldName].localeCompare(i[o.fieldName]):t[o.fieldName]<i[o.fieldName]?-1:t[o.fieldName]>i[o.fieldName]?1:0,0!==a)return o.isAsc?a:-a}return 0}))}static distinct(t,e){let i=new CIndexes([{fieldNames:t.join(),isUnique:!1}]);for(let t=0;t<e.length;t++)i.setIndexData(e[t]);let s=i.getIndex(t.join()),o=[],a={};return s&&function e(i,s){i.forEach((function(i,n){i instanceof Map?(0==s&&(a={}),a[t[s]]=n,e(i,s+1)):i instanceof Set&&(a[t[s]]=n,o.push(Object.assign({},a)))}))}(s,0),o}}class CNotifyChangeObjectMaker{static _getFullName(t,e,i){let s="";return"string"==typeof e&&(s=t instanceof Array&&/^[+-]?\d+(\.\d+)?$/.test(e)?i+"["+e+"]":i+"."+e),s}static newNotifyObject(t,e,i,s,o,a=""){return"object"==typeof t&&"Object"==t.constructor.name?new Proxy(t,{get(t,i){let s=CNotifyChangeObjectMaker._getFullName(t,i,a);return e?e(t,i,s):t[i]},set(e,o,n){let r=CNotifyChangeObjectMaker._getFullName(e,o,a),l=!0;return i&&(l=i(e,o,e[o],n,r)),l&&e[o]!=n&&(e[o]=n,s&&(s(e,o,n,r),t.onChange&&t.onChange(e,o,n))),!0},deleteProperty(t,e){let i=CNotifyChangeObjectMaker._getFullName(t,e,a);return!o||o(t,e,i)}}):t}static newNotifyObjectWithChildProperties(t,e,i,s,o,a=""){return function t(e,i,s,o,a,n=""){let r=Object.keys(e);for(let l=0;l<r.length;l++)if("object"==typeof e[r[l]]){let h="";h=e instanceof Array&&/^[+-]?\d+(\.\d+)?$/.test(r[l])?n+"["+r[l]+"]":n+"."+r[l],"Object"==e[r[l]].constructor.name&&(e[r[l]]=t(e[r[l]],i,s,o,a,h))}return CNotifyChangeObjectMaker.newNotifyObject(e,i,s,o,a,n)}(t,e,i,s,o,a)}}class CCustomObjectListData extends CDataClass{constructor(){super(...arguments),this.onBeforeChange=new Array,this.onChange=new Array}get length(){return this.doLength()}doBeforeChange(t,e,i,s,o){let a=!0;for(let n=0;n<this.onBeforeChange.length;n++)this.onBeforeChange[n](this,t,e,i,s,o)||(a=!1);return a}doChange(t,e,i){for(let s=0;s<this.onChange.length;s++)this.onChange[s](this,t,e,i)}doAdd(t){let e=this.doBeforeChange("add",t),i={...t};if(e){try{this.doAddData(i),this.doDataIndexing("add",i)}catch(t){this.doDelete(i),this.doDataIndexing("delete",i)}this.doChange("add",i)}return i}doInsert(t,e){let i=this.doBeforeChange("insert",e),s={...e};if(i){try{this.doInsertData(t,s),this.doDataIndexing("insert",s)}catch(t){this.doDelete(s),this.doDataIndexing("delete",s)}this.doChange("insert",s)}return s}doSet(t,e){let i=this.doBeforeChange("set",e),s={...e};if(i){try{this._oldData=this.doGetData(t),this.doDataIndexing("delete",this._oldData),this.doSetData(t,s),this.doDataIndexing("set",s)}catch(e){throw this.doRestoreData(t),e}finally{this._oldData=void 0}this.doChange("set",s)}return s}doDelete(t,e){if("number"==typeof t){let i=this.doGetData(t);if(this.doBeforeChange("delete",i)){if(e){for(let i=t;i<t+e;i++)this.doDataIndexing("delete",this.doGetData(i));this.doDeleteData(t,e)}else try{this.doDataIndexing("delete",i),this.doDeleteData(t,1)}catch(t){this.doDelete(i),this.doDataIndexing("delete",i)}this.doChange("delete",i)}}else{let e=this.doFindIndex(t),i=this.doGetData(e);if(this.doBeforeChange("delete",i)){try{this.doDataIndexing("delete",i),this.doDeleteData(e,1)}catch(t){this.doDelete(i),this.doDataIndexing("delete",i)}this.doChange("delete",i)}}}doClear(){this.doBeforeChange("clear",void 0)&&(this.doClearData(),this.doDataIndexing("clear"),this.doChange("clear",void 0))}doRestoreData(t){this._oldData&&(this.doGetData(t)!=this._oldData?(this.doDataIndexing("delete",this._oldData),this.doInsert(t,this._oldData)):(this.doDelete(t),this.doInsert(t,this._oldData)))}doDataIndexing(t,e){}add(t){return this.doAdd(t)}insert(t,e){return this.doInsert(t,e)}set(t,e){return this.doSet(t,e)}delete(t,e){this.doDelete(t,e)}clear(){this.doClear()}get(t){return this.doGetData(t)}}class CCustomNotifyObjectListData extends CCustomObjectListData{constructor(t=[]){super(),this.ignoreProxyPropertyNameList=t}doAdd(t){let e=this,i=CNotifyChangeObjectMaker.newNotifyObjectWithChildProperties(t,void 0,(function(t,s,o,a){let n=e.doBeforeChange("modify",i,s,o,a);return n&&e.doDataIndexing("delete",i),n}),(function(t,s,o){e.doDataIndexing("modify",i),e.doChange("modify",i,s)}));if(this.doBeforeChange("add",i)){try{this.doAddData(i),this.doDataIndexing("add",i)}catch(t){this.doDelete(i),this.doDataIndexing("delete",i)}this.doChange("add",i)}return i}doInsert(t,e){let i=this,s=CNotifyChangeObjectMaker.newNotifyObjectWithChildProperties(e,void 0,(function(t,e,o,a){let n=i.doBeforeChange("modify",s,e,o,a);return n&&i.doDataIndexing("delete",s),n}),(function(t,e,o){i.doDataIndexing("modify",s),i.doChange("modify",s,e)}));if(this.doBeforeChange("insert",s)){try{this.doInsertData(t,s),this.doDataIndexing("insert",s)}catch(t){this.doDelete(s),this.doDataIndexing("delete",s)}this.doChange("insert",s)}return s}doSet(t,e){let i=this,s=CNotifyChangeObjectMaker.newNotifyObjectWithChildProperties(e,void 0,(function(t,e,o,a){let n=i.doBeforeChange("modify",s,e,o,a);return n&&i.doDataIndexing("delete",s),n}),(function(t,e,o){i.doDataIndexing("modify",s),i.doChange("modify",s,e)}));if(this.doBeforeChange("set",s)){try{this._oldData=this.doGetData(t),this.doDataIndexing("delete",this._oldData),this.doSetData(t,s),this.doDataIndexing("set",s)}catch(e){throw this.doRestoreData(t),e}finally{this._oldData=void 0}this.doChange("set",s)}return s}}class CIndexes{constructor(t=[]){this.indexKeyList=new Array,this.indexes=new Map;for(let e=0;e<t.length;e++){this.indexKeyList.push(t[e]);let i=new Map;this.indexes.set(t[e].fieldNames,i)}}getIndexKey(t){let e="";for(let i=0;i<t.length;i++)""!=e&&(e+=","),e+=t[i];return e}addIndex(t,e=!1){this.indexKeyList.push({fieldNames:t,isUnique:e});let i=new Map;this.indexes.set(t,i)}hasIndex(t){return null!=this.indexes.get(t)}getIndex(t){return this.indexes.get(t)}getIndexData(t){let e=new Array;for(let i=0;i<t.length;i++)e.push(t[i].fieldName);let i=this.indexes.get(this.getIndexKey(e));if(i){let e=new Array;for(let s=0;s<t.length;s++){let o=i?.get(t[s].value);if(!o)return[];s==t.length-1&&o.forEach((function(t){e.push(t)})),i=o}return e}throw new Error("Not exists index : "+this.getIndexKey(e))}setIndexData(t,e){for(let i=0;i<this.indexKeyList.length;i++){let s=this.indexKeyList[i];this.setIndexDataFromKey(s.fieldNames,s.isUnique,t,e)}}setIndexDataFromKey(t,e,i,s){let o=t.split(","),a=this.indexes.get(t);null==a&&(a=new Map,this.indexes.set(t,a));for(let n=0;n<o.length;n++)if(null!=i[o[n]])if(n==o.length-1){let r=a?.get(i[o[n]]);if(null==r&&(r=new Set,a?.set(i[o[n]],r)),r.size>0&&e)throw new Error("Duplicate entry not allowed : "+t);s?r.add(s):r.add(i)}else{let t=a?.get(i[o[n]]);null==t&&(t=new Map,a?.set(i[o[n]],t)),a=t}}deleteIndexData(t,e){for(let i=0;i<this.indexKeyList.length;i++){let s=this.indexKeyList[i],o=s.fieldNames.split(","),a=this.indexes.get(s.fieldNames),n=[];for(let i=0;i<o.length;i++)if(i==o.length-1){if(a){n.push({key:o[i],data:t[o[i]]});let r=a.get(t[o[i]]);if(r)if(e){if(r.delete(e),0==r.size){let t=[];for(let e=0;e<n.length;e++)t.push({fieldName:n[e].key,value:n[e].data});this.deleteIndex(s.fieldNames,t)}n=[]}else{if(r.delete(t),0==r.size){let t=[];for(let e=0;e<n.length;e++)t.push({fieldName:n[e].key,value:n[e].data});this.deleteIndex(s.fieldNames,t)}n=[]}}}else if(a){n.push({key:o[i],data:t[o[i]]});let e=a.get(t[o[i]]);a=e}else a=void 0}}deleteIndex(t,e){let i=[],s=this.indexes.get(t);s&&i.push(s);for(let t=0;t<e.length;t++)s&&(s=s.get(e[t].value),s&&i.push(s));let o={};for(let t=0;t<i.length;t++)o["data"+(t+1)]=i[t];for(let t=i.length-1;t>=1;t--){let s=i[t],o=i[t-1];if(s instanceof Set||s instanceof Map){if(!o||0!=s.size)break;o.delete(e[t-1].value)}}}isInvalidUnique(t){for(let e=0;e<this.indexKeyList.length;e++)if(this.indexKeyList[e].isUnique){let i=this.indexKeyList[e].fieldNames,s=i.split(","),o=this.indexes.get(i);null==o&&(o=new Map,this.indexes.set(i,o));for(let e=0;e<s.length;e++)if(t[s[e]])if(e==s.length-1){let a=o?.get(t[s[e]]);if(null==a&&(a=new Set,o?.set(t[s[e]],a)),a.size>0)return{result:!0,key:i}}else{let i=o?.get(t[s[e]]);null==i&&(i=new Map,o?.set(t[s[e]],i)),o=i}}return{result:!1,key:""}}clear(){this.indexes.clear()}dataSet(t){for(let e=0;e<t.length;e++)this.setIndexData(t)}toData(){let t=[];return this.indexes.forEach((function(e,i){!function e(i){i.forEach((function(i,s){if(i instanceof Map)e(i);else{let e=Array.from(i);t.push(e)}}))}(e)})),t}}class CCustomIndexesObjectListData extends CCustomObjectListData{constructor(t=[]){super(),this.indexes=new CIndexes(t)}doDataIndexing(t,e){e&&("add"!=t&&"insert"!=t&&"modify"!=t&&"set"!=t||this.indexes.setIndexData(e),"delete"==t&&this.indexes.deleteIndexData(e)),"clear"==t&&this.indexes.clear()}doSetIndex(t,e){this.indexes.addIndex(t);let i=new Array;this.loopData((function(t){i.push(t)}));for(let s=0;s<i.length;s++)this.indexes.setIndexDataFromKey(t,e,i[s])}doGetIndex(t,e){let i=this.indexes.getIndexData(t);return e&&i.sort(e),i}doGetIndexFullScan(t){let e=new Array;return this.loopData((function(i){let s=!1;for(let e=0;e<t.length;e++){if(i[t[e].fieldName]!=t[e].value){s=!1;break}s=!0}s&&e.push(i)})),e}addIndex(t,e=!1){this.doSetIndex(t,e)}getIndex(t,e=!1){let i=this.doGetIndex(t);return i.length>0?i:e?this.doGetIndexFullScan(t):[]}}class CCustomIndexedNotifyListData extends CCustomNotifyObjectListData{constructor(t=[],e=[]){super(e),this.indexes=new CIndexes(t)}doDataIndexing(t,e){e&&("add"!=t&&"insert"!=t&&"modify"!=t&&"set"!=t||this.indexes.setIndexData(e),"delete"==t&&this.indexes.deleteIndexData(e)),"clear"==t&&this.indexes.clear()}doSetIndex(t,e){this.indexes.addIndex(t);let i=new Array;this.loopData((function(t){i.push(t)}));for(let s=0;s<i.length;s++)this.indexes.setIndexDataFromKey(t,e,i[s])}doGetIndex(t,e){let i=this.indexes.getIndexData(t);return e&&i.sort(e),i}doGetIndexFullScan(t){let e=new Array;return this.loopData((function(i){let s=!1;for(let e=0;e<t.length;e++){if(i[t[e].fieldName]!=t[e].value){s=!1;break}s=!0}s&&e.push(i)})),e}addIndex(t,e=!1){this.doSetIndex(t,e)}getIndex(t,e=!1){let i=this.doGetIndex(t);return i.length>0?i:e?this.doGetIndexFullScan(t):[]}}class COnItemField{constructor(t,e){this.leftListField="",this.rightListField="",this.leftListField=t,this.rightListField=e}}class COnItemRightField{constructor(t,e){this.rightListField="",this.rightListField=t,this.value=e}}class CObjectList extends CCustomIndexesObjectListData{constructor(){super(...arguments),this._data=new Array}get array(){return this._data}set array(t){this.indexes.clear(),this._data=t;for(let e=0;e<t.length;e++)this.doDataIndexing("add",t[e])}doFindIndex(t){let e=-1;for(let i=0;i<this._data.length;i++)if(t==this._data[i]){e=i;break}return e}doAddData(t){this._data.push(t)}doGetData(t){return this._data[t]}doSetData(t,e){this._data[t]=e}doInsertData(t,e){this._data.splice(t,0,e)}doDeleteData(t,e){e?this._data.splice(t,e):this._data.splice(t,1)}doClearData(){this._data=[]}doLength(){return this._data.length}doToData(t){t.indexKeyList=this.indexes.indexKeyList,t.data=this._data}doFromData(t){this.clear(),this.indexes=new CIndexes(t.indexKeyList);for(let e=0;e<t.data.length;e++)this.add(t.data[e])}loopData(t){for(let e=0;e<this._data.length;e++)t(this._data[e])}sort(t){return this._data.sort(t)}where(t,e,i=[]){return CObjectList.where(this,t,e,i)}join(t,e=[]){return CObjectList.join({leftList:this,rightList:t.list,select:t.select,where:t.where,on:t.on},e)}orderBy(t,e=[]){return CObjectList.orderBy(this,t,e)}distinct(t,e,i=[]){if(e instanceof Array){let s=new CObjectList(i);for(let o=0;o<e.length;o++){let a=CObjectList.distinct(this,t,CObjectList.anyToWhereCondition(e[o]),i);for(let t=0;t<a.length;t++)s.add(a.get(t))}return s}return e?CObjectList.distinct(this,t,CObjectList.anyToWhereCondition(e),i):CObjectList.distinct(this,t,[],i)}groupBy(t,e,i,s=[]){return CObjectList.groupBy(this,t,e,i,s)}findIndexData(t){let e=Object.keys(t),i=[];for(let s=0;s<e.length;s++)i.push({fieldName:e[s],value:t[e[s]]});return this.getIndex(i)}static anyToWhereCondition(t){let e=[],i=Object.keys(t);for(let s=0;s<i.length;s++)e.push({fieldName:i[s],value:t[i[s]]});return e}static anyToOrderBy(t){let e=[],i=Object.keys(t);for(let s=0;s<i.length;s++)e.push({fieldName:i[s],isAsc:!("DESC"==t[i[s]].toUpperCase())});return e}static orderBy(t,e,i=[]){let s=[],o=Object.keys(e);for(let t=0;t<o.length;t++){let i=!("DESC"==e[o[t]].toUpperCase());s.push({fieldName:o[t],isAsc:i})}let a=CArrayUtil.orderBy(t.array,s),n=new CObjectList(i);return n.array=a,n}static distinct(t,e,i,s=[]){let o,a=new CObjectList(s);o=i.length>0?CArrayUtil.distinct(e,t.getIndex(i)):CArrayUtil.distinct(e,t.array);for(let t=0;t<o.length;t++)a.add(o[t]);return a}static whereArray(t,e,i,s=[]){let o=[];for(let t=0;t<s.length;t++)o.push({fieldNames:s[t],isUnique:!1});let a=new CObjectList(o);for(let e=0;e<t.length;e++)a.add(t[e]);return a.where(e,i,s)}static where(t,e,i,s=[]){let o=[];for(let t=0;t<s.length;t++)o.push({fieldNames:s[t],isUnique:!1});let a=new CObjectList(o);if(e instanceof Array)for(let s=0;s<e.length;s++){let o=t.getIndex(CObjectList.anyToWhereCondition(e[s]));for(let t=0;t<o.length;t++)if(i){let e={};for(let s=0;s<i.length;s++)e[i[s]]=o[t][i[s]];a.add(e)}else a.add(o[t])}else{let s=t.getIndex(this.anyToWhereCondition(e));for(let t=0;t<s.length;t++)if(i){let e={};for(let o=0;o<i.length;o++)e[i[o]]=s[t][i[o]];a.add(e)}else a.add(s[t])}return a}static groupBy(t,e,i,s,o=[]){t.addIndex(e.join(),!1);let a=new CObjectList(o),n=t.distinct(e,i,[{fieldNames:e.join(),isUnique:!1}]);for(let i=0;i<n.length;i++){let o=[],r=n.get(i);for(let t=0;t<e.length;t++)o.push({fieldName:e[t],value:n.get(i)[e[t]]});let l=t.getIndex(o),h=new Array(s.length);for(let t=0;t<l.length;t++)for(let e=0;e<s.length;e++)null==h[e]?"count"==s[e].fn?h[e]=l.length:"sum"!=s[e].fn&&"avg"!=s[e].fn&&"min"!=s[e].fn&&"max"!=s[e].fn||(h[e]=l[t][s[e].fieldName]):"sum"==s[e].fn||"avg"==s[e].fn?h[e]+=l[t][s[e].fieldName]:"min"==s[e].fn?h[e]>l[t][s[e].fieldName]&&(h[e]=l[t][s[e].fieldName]):"max"==s[e].fn&&h[e]<l[t][s[e].fieldName]&&(h[e]=l[t][s[e].fieldName]);for(let t=0;t<h.length;t++)"avg"==s[t].fn?r[s[t].fieldName]=h[t]/l.length:r[s[t].fieldName]=h[t];a.add(r)}return a}static join(t,e=[]){if(0==t.on.length)throw new Error("Not exists on");let i=[],s=t.leftList,o=t.rightList;if(t.where){if(t.where.leftListWhere)i=CObjectList.anyToWhereCondition(t.where.leftListWhere),s=t.leftList.where(i,t.select.leftListFields,e);else{let i=[];for(let t=0;t<e.length;t++)i.push({fieldNames:e[t],isUnique:!1});s=new CObjectList(i),s.array=t.leftList.array}t.where.rightListWhere?o=t.rightList.where(t.where.rightListWhere):(o=new CObjectList,o.array=t.rightList.array)}else for(let t=0;t<e.length;t++)s.addIndex(e[t],!1);let a=[];for(let e=0;e<t.on.length;e++){let i=t.on[e];if("string"==typeof i){let t=i.split(",");if(2!=t.length||""==t[0]||""==t[1])throw new Error("Invalid on field : "+i);a.push(new COnItemField(t[0],t[1]))}else i instanceof COnItemRightField&&a.push(i)}let n="";for(let t=0;t<a.length;t++)""!=n&&(n+=","),n+=a[t].rightListField;o.addIndex(n),i=[];for(let t=0;t<a.length;t++){let e=a[t];e instanceof COnItemField?i.push({fieldName:e.rightListField,value:""}):e instanceof COnItemRightField&&i.push({fieldName:e.rightListField,value:e.value})}let r=[];for(let e=0;e<s.length;e++){let n=s.get(e);for(let t=0;t<a.length;t++){let e=a[t];e instanceof COnItemField&&(i[t].value=n[e.leftListField])}let l=o.getIndex(i);if(0==l.length);else{let i=t.select.rightListFields;if(i){for(let t=0;t<i.length;t++)if(i[t].indexOf(">")>=0){let e=i[t].split(">");n[e[1]]=l[0][e[0]]}else n[i[t]]=l[0][i[t]];s.set(e,n)}if(l.length>1)for(let e=1;e<l.length;e++){let i=Object.assign({},n),s=t.select.rightListFields;if(s)for(let t=0;t<s.length;t++)if(s[t].indexOf(">")>=0){let o=s[t].split(">");i[o[1]]=l[e][o[0]]}else i[s[t]]=l[e][s[t]];r.push(i)}}}for(let t=0;t<r.length;t++)s.add(r[t]);return s}}class CNotifyObjectList extends CCustomIndexedNotifyListData{constructor(){super(...arguments),this._data=new Array}get array(){return this._data}set array(t){this.indexes.clear(),this._data=t;for(let e=0;e<t.length;e++)this.doDataIndexing("add",t[e])}doFindIndex(t){let e=-1;for(let i=0;i<this._data.length;i++)if(t==this._data[i]){e=i;break}return e}doAddData(t){this._data.push(t)}doGetData(t){return this._data[t]}doSetData(t,e){this._data[t]=e}doInsertData(t,e){this._data.splice(t,0,e)}doDeleteData(t,e){e?this._data.splice(t,e):this._data.splice(t,1)}doClearData(){this._data=[]}doLength(){return this._data.length}doToData(t){t.indexKeyList=this.indexes.indexKeyList,t.data=this._data}doFromData(t){this.clear(),this.indexes=new CIndexes(t.indexKeyList);for(let e=0;e<t.data.length;e++)this.add(t.data[e])}loopData(t){for(let e=0;e<this._data.length;e++)t(this._data[e])}sort(t){return this._data.sort(t)}where(t,e,i=[]){return CObjectList.where(this,t,e,i)}join(t,e=[]){return CObjectList.join({leftList:this,rightList:t.list,select:t.select,where:t.where,on:t.on},e)}orderBy(t,e=[]){return CObjectList.orderBy(this,t,e)}distinct(t,e,i=[]){if(e instanceof Array){let s=new CObjectList(i);for(let o=0;o<e.length;o++){let a=CObjectList.distinct(this,t,CObjectList.anyToWhereCondition(e[o]),i);for(let t=0;t<a.length;t++)s.add(a.get(t))}return s}return e?CObjectList.distinct(this,t,CObjectList.anyToWhereCondition(e),i):CObjectList.distinct(this,t,[],i)}groupBy(t,e,i,s=[]){return CObjectList.groupBy(this,t,e,i,s)}findIndexData(t){let e=Object.keys(t),i=[];for(let s=0;s<e.length;s++)i.push({fieldName:e[s],value:t[e[s]]});return this.getIndex(i)}}class CCustomSortedList extends CDataClass{get data(){return this._data}get length(){return this._data.length}constructor(t){super(),this._data=new Array,this._sortFieldNames=t}compareObjects(t,e,i){for(let s of i){if(t[s]<e[s])return-1;if(t[s]>e[s])return 1}return 0}binarySearch(t,e){let i=0,s=this._data.length-1,o=-1;for(;i<=s;){let a=Math.floor((i+s)/2),n=this.compareObjects(this._data[a],e,t);0===n?(o=a,s=a-1):n<0?i=a+1:s=a-1}return o}findInsertIndex(t,e){let i=0,s=this._data.length-1;for(;i<=s;){let o=Math.floor((i+s)/2),a=this.compareObjects(this._data[o],e,t);0===a||a<0?i=o+1:s=o-1}return i}doPut(t){let e=this.findInsertIndex(this._sortFieldNames,t);return e>=this._data.length?this._data.push(t):this._data.splice(e,0,t),e}doDelete(t,e){if("number"==typeof t)e?this._data.splice(t,e):this._data.splice(t,1);else{let e=this.binarySearch(this._sortFieldNames,t);e>=0&&this._data.splice(e,1)}}doClear(){this._data=[]}doGet(t){return this._data[t]}put(t){return this.doPut(t)}delete(t,e){this.doDelete(t,e)}clear(){this.doClear()}get(t){return this.doGet(t)}getIndex(t){return this.binarySearch(this._sortFieldNames,t)}find(t,e){let i=[],s=this.binarySearch(this._sortFieldNames,t);-1==s&&(s=this.findInsertIndex(this._sortFieldNames,t));let o=this.findInsertIndex(this._sortFieldNames,e)-1;if(o>s&&s>=0&&o>=0)for(let t=s;t<=o;t++)i.push(this._data[t]);return i}}class CSortedList extends CCustomSortedList{constructor(){super(...arguments),this.onChange=new Array}doChange(t,e){for(let i=0;i<this.onChange.length;i++)this.onChange[i](this,t,e)}doToData(t){t.data=this._data}doFromData(t){this.clear();for(let e=0;e<t.data.length;e++)this.put(t.data[e])}}class CTreeData extends CDataClass{get length(){return this._data.length}get rootTreeData(){let t=this.parentItem,e=this;for(;t;)e=t.parentData,t=e.parentItem;return e}constructor(t,e){super(),this._data=new Array,this.parentItem=e,t&&null==e&&(this.indexes=new CIndexes(t))}doToData(t){let e=[];for(let t=0;t<this.length;t++)e.push(this.getItem(t).toData());CDataClass.putData(t,"items",e,[],!0)}doFromData(t){this.clear();let e=CDataClass.getData(t,"items",[],!0),i={};for(let t=0;t<e.length;t++){this.add(i).fromData(e[t])}}doDataIndexing(t,e){this.indexes&&(e&&("add"!=t&&"insert"!=t&&"modify"!=t&&"set"!=t||this.indexes.setIndexData(e),"delete"==t&&this.indexes.deleteIndexData(e)),"clear"==t&&this.indexes.clear())}doResetIndex(){if(this.indexes){let t=this.rootTreeData.toArray();this.indexes.clear();for(let e=0;e<t.length;e++)this.doDataIndexing("add",t[e].value)}}doAdd(t){let e=new CTreeItem(t,this);try{this._data.push(e),e.index=this._data.length-1;let t=e.toArray();for(let e=0;e<t.length;e++)this.doDataIndexing("add",t[e].value)}catch(t){this.doResetIndex()}return e}doAddItem(t){try{this._data.push(t),t.index=this._data.length-1;let e=t.toArray();for(let t=0;t<e.length;t++)this.doDataIndexing("add",e[t].value)}catch(t){this.doResetIndex()}return t}doInsert(t,e){let i=new CTreeItem(e,this);try{this._data.splice(t,0,i),i.index=t;for(let e=t+1;e<this._data.length;e++)this._data[e].index=e;let e=i.toArray();for(let t=0;t<e.length;t++)this.doDataIndexing("insert",e[t].value)}catch(t){this.doResetIndex()}return i}doInsertItem(t,e){try{this._data.splice(t,0,e),e.index=t;for(let e=t+1;e<this._data.length;e++)this._data[e].index=e;let i=e.toArray();for(let t=0;t<i.length;t++)this.doDataIndexing("insert",i[t].value)}catch(t){this.doResetIndex()}return e}doDelete(t){try{if("number"==typeof t){let e=this._data[t];this._data.splice(t,1);for(let e=t;e<this._data.length;e++)this._data[e].index=e;let i=e.toArray();for(let t=0;t<i.length;t++)this.doDataIndexing("delete",i[t].value)}else for(let e=this._data.length-1;e>=0;e--)if(this._data[e].value==t){let t=this._data[e];this._data.splice(e,1);for(let t=e;t<this._data.length;t++)this._data[t].index=t;let i=t.toArray();for(let t=0;t<i.length;t++)this.doDataIndexing("delete",i[t].value)}}catch(t){this.doResetIndex()}}doSet(t,e){let i=new CTreeItem(e,this);try{let e=this._data[t].toArray();for(let t=0;t<e.length;t++)this.doDataIndexing("delete",e[t].value);this._data[t]=i,i.index=t;let s=i.toArray();for(let t=0;t<s.length;t++)this.doDataIndexing("set",s[t].value)}catch(t){this.doResetIndex()}return i}doClear(){this._data=[],this.indexes&&this.indexes.clear()}doGetValue(t){if("number"==typeof t)return this._data[t].value;{let e,i=t.split(","),s=this;for(let t=0;t<i.length;t++){let i=s.doGetItem(t);e=this._data[t].value,s=i.childItems}return e}}doGetItem(t){if("number"==typeof t)return this._data[t];{let e,i=t.split(","),s=this;for(let t=0;t<i.length;t++){let i=this._data[t];e=i,s=i.childItems}return e}}dataIndexing(t,e){this.doDataIndexing(t,e)}add(t){return this.doAdd(t)}insert(t,e){return this.doInsert(t,e)}addItem(t){return this.doAddItem(t)}insertItem(t,e){return this.doInsertItem(t,e)}delete(t){this.doDelete(t)}set(t,e){return this.doSet(t,e)}clear(){this.doClear()}getValue(t){return this.doGetValue(t)}getItem(t){return this.doGetItem(t)}toArray(t=!0,e=!1){let i=new Array;if(t){function s(t){for(let e=0;e<t.length;e++)i.push(t.getItem(e)),s(t.getItem(e).childItems)}s(e?this.rootTreeData:this)}else for(let o=0;o<this._data.length;o++)i.push(this._data[o]);return i}toValueArray(t=!0,e=!1){let i=new Array;if(t){function s(t){for(let e=0;e<t.length;e++)i.push(t.getItem(e).value),s(t.getItem(e).childItems)}s(e?this.rootTreeData:this)}else for(let o=0;o<this._data.length;o++)i.push(this._data[o].value);return i}getIndexData(t,e){if(this.indexes){let i=this.indexes.getIndexData(t);return e&&(i=CArrayUtil.orderBy(i,e)),i}return[]}loopWithChild(t){!function e(i){for(let s=0;s<i.length;s++)t(s,i.getItem(s)),e(i.getItem(s).childItems)}(this)}}class CTreeItem extends CDataClass{get parentItem(){return this.parentData.parentItem}get absoluteIndex(){let t=this.getParents(),e="";for(let i=0;i<t.length;i++)""!=e&&(e+=","),e+=t[i].index;return e}get value(){return this._value}set value(t){this.doSetValue(t)}constructor(t,e){super(),this.index=-1,this.parentData=e,this.childItems=new CTreeData(void 0,this),this.childItems.indexes=this.parentData.indexes,this._value=t,this.doSetValue(t)}doSetValue(t){let e=this.parentData.indexes;e&&e.deleteIndexData(this.value),t[CSymbol.SYM_TREE_ITEM]=this,this._value=t,e&&e.setIndexData(this.value)}doToData(t){let e={...this.value};delete e[CSymbol.SYM_TREE_ITEM],CDataClass.putData(t,"value",e);let i=[];for(let t=0;t<this.childItems.length;t++)i.push(this.childItems.getItem(t).toData());CDataClass.putData(t,"childList",i)}doFromData(t){!function t(e,i){e.childItems.clear(),e.value=CDataClass.getData(i,"value");let s=CDataClass.getData(i,"childList");for(let i=0;i<s.length;i++){t(e.addChild({...e.value}),s[i])}}(this,t)}getParents(t=!0){let e=new Array;t&&e.push(this);let i=this.parentData.parentItem;for(;i;)e.unshift(i),i=i.parentData.parentItem;return e}getLevel(){return this.getParents().length}delete(){this.parentData.delete(this.index)}addChild(t){return this.childItems.add(t)}insertChild(t,e){return this.childItems.insert(t,e)}setChild(t,e){return this.childItems.set(t,e)}deleteChild(t){this.childItems.delete(t)}clearChild(){this.childItems.clear()}getChildValue(t){return this.childItems.getValue(t)}getChildItem(t){return this.childItems.getItem(t)}toArray(t=!0){let e=this.childItems.toArray(t);return e.unshift(this),e}toValueArray(t=!0){let e=this.childItems.toValueArray(t);return e.unshift(this.value),e}}class CNotifyTreeData extends CTreeData{constructor(){super(...arguments),this.onChange=new Array}doAdd(t){let e=new CNotifyTreeItem(t,this);try{this._data.push(e),e.index=this._data.length-1;let t=e.toArray();for(let e=0;e<t.length;e++)this.doDataIndexing("add",t[e].value)}catch(t){this.doResetIndex()}return this.doChange("add",e),e}doInsert(t,e){let i=new CNotifyTreeItem(e,this);try{this._data.splice(t,0,i),i.index=t;for(let e=t+1;e<this._data.length;e++)this._data[e].index=e;let e=i.toArray();for(let t=0;t<e.length;t++)this.doDataIndexing("insert",e[t].value)}catch(t){this.doResetIndex()}return this.doChange("insert",i),i}doDelete(t){super.doDelete(t),this.doChange("delete")}doSet(t,e){let i=new CNotifyTreeItem(e,this);try{let e=this._data[t].toArray();for(let t=0;t<e.length;t++)this.doDataIndexing("delete",e[t].value);this._data[t]=i,i.index=t;let s=i.toArray();for(let t=0;t<s.length;t++)this.doDataIndexing("set",s[t].value)}catch(t){this.doResetIndex()}return this.doChange("set",i),i}doClear(){super.doClear(),this.doChange("clear")}doChange(t,e){for(let i=0;i<this.onChange.length;i++)this.onChange[i](this,t,e)}change(t,e){this.doChange(t,e)}add(t){return this.doAdd(t)}insert(t,e){return this.doInsert(t,e)}set(t,e){return this.doSet(t,e)}}class CNotifyTreeItem extends CTreeItem{doBeforeChange(t,e,i,s){let o=!0;for(let a=0;a<this.onBeforeChange.length;a++)this.onBeforeChange[a](this,t,e,i,s)||(o=!1);return o}constructor(t,e){super(t,e),this.onBeforeChange=new Array,this.onChange=new Array,this.parentData=e}doChange(t,e){for(let i=0;i<this.onChange.length;i++)this.onChange[i](this,t,e);this.parentData.change("modify",this)}doSetValue(t){let e,i=this,s=this.parentData.indexes;s&&s.deleteIndexData(this.value),t[CSymbol.SYM_TREE_ITEM]=this,e=CNotifyChangeObjectMaker.newNotifyObjectWithChildProperties(t,void 0,(function(t,s,o,a){if(e){let t=i.doBeforeChange(e,s,o,a);return t&&i.parentData.dataIndexing("delete",e),t}return!1}),(function(t,s,o){e&&(i.parentData.dataIndexing("modify",e),i.doChange(e,s))})),this._value=e,s&&s.setIndexData(this.value)}}class CStateTreeData extends CDataClass{get length(){return this._data.length}get rootTreeData(){let t=this.parentItem,e=this;for(;t;)e=t.parentData,t=e.parentItem;return e}constructor(t,e){super(),this._data=new Array,this.onChange=new Array,this.onChangeState=new Array,this.parentItem=e,t&&null==e&&(this.indexes=new CIndexes(t))}doToData(t){let e=[];for(let t=0;t<this.length;t++)e.push(this.getItem(t).toData());CDataClass.putData(t,"items",e)}doFromData(t){this.clear();let e=CDataClass.getData(t,"items");for(let t=0;t<e.length;t++)this.add(e[t])}doDataIndexing(t,e){this.indexes&&(e&&("add"!=t&&"insert"!=t&&"modify"!=t&&"set"!=t||this.indexes.setIndexData(e),"delete"==t&&this.indexes.deleteIndexData(e)),"clear"==t&&this.indexes.clear())}doResetIndex(){if(this.indexes){let t=this.rootTreeData.toArray();this.indexes.clear();for(let e=0;e<t.length;e++)this.doDataIndexing("add",t[e].value)}}doAdd(t){let e=new CStateTreeItem(t,this);try{this._data.push(e),e.index=this._data.length-1;let t=e.toArray();for(let e=0;e<t.length;e++)this.doDataIndexing("add",t[e].value);this.doChange("add",e)}catch(t){this.doResetIndex()}return e}doAddItem(t){try{this._data.push(t),t.index=this._data.length-1;let e=t.toArray();for(let t=0;t<e.length;t++)this.doDataIndexing("add",e[t].value)}catch(t){this.doResetIndex()}return t}doInsert(t,e){let i=new CStateTreeItem(e,this);try{this._data.splice(t,0,i),i.index=t;for(let e=t+1;e<this._data.length;e++)this._data[e].index=e;let e=i.toArray();for(let t=0;t<e.length;t++)this.doDataIndexing("insert",e[t].value);this.doChange("insert",i)}catch(t){this.doResetIndex()}return i}doInsertItem(t,e){try{this._data.splice(t,0,e),e.index=t;for(let e=t+1;e<this._data.length;e++)this._data[e].index=e;let i=e.toArray();for(let t=0;t<i.length;t++)this.doDataIndexing("insert",i[t].value)}catch(t){this.doResetIndex()}return e}doDelete(t){try{if("number"==typeof t){let e=this._data[t];this._data.splice(t,1);for(let e=t;e<this._data.length;e++)this._data[e].index=e;let i=e.toArray();for(let t=0;t<i.length;t++)this.doDataIndexing("delete",i[t].value);return this.doChange("delete",e),e}{let e;for(let i=this._data.length-1;i>=0;i--)if(this._data[i].value==t){e=this._data[i],this._data.splice(i,1);for(let t=i;t<this._data.length;t++)this._data[t].index=t;let t=e.toArray();for(let e=0;e<t.length;e++)this.doDataIndexing("delete",t[e].value);this.doChange("delete",e)}return e}}catch(t){this.doResetIndex()}}doSet(t,e){let i=new CStateTreeItem(e,this);try{let e=this._data[t].toArray();for(let t=0;t<e.length;t++)this.doDataIndexing("delete",e[t].value);this._data[t]=i,i.index=t;let s=i.toArray();for(let t=0;t<s.length;t++)this.doDataIndexing("set",s[t].value);this.doChange("set",i)}catch(t){this.doResetIndex()}return i}doSetItem(t,e){try{let i=this._data[t].toArray();for(let t=0;t<i.length;t++)this.doDataIndexing("delete",i[t].value);this._data[t]=e,e.index=t;let s=e.toArray();for(let t=0;t<s.length;t++)this.doDataIndexing("set",s[t].value);this.doChange("set",e)}catch(t){this.doResetIndex()}return e}doClear(){this._data=[],this.indexes&&this.indexes.clear(),this.doChange("clear")}doGetValue(t){if("number"==typeof t)return this._data[t].value;{let e,i=t.split(","),s=this;for(let t=0;t<i.length;t++){let i=s.doGetItem(t);e=this._data[t].value,s=i.childItems}return e}}doGetItem(t){if("number"==typeof t)return this._data[t];{let e,i=t.split(","),s=this;for(let t=0;t<i.length;t++){let i=this._data[t];e=i,s=i.childItems}return e}}doChange(t,e){let i=this.rootTreeData;i!=this&&i.doChange("modify",e);for(let i=0;i<this.onChange.length;i++)this.onChange[i](this,t,e)}doChangeState(t){this.doChange("state",t);for(let e=0;e<this.onChangeState.length;e++)this.onChangeState[e](this,t)}change(t,e){this.doChange(t,e)}changeState(t){this.doChangeState(t)}dataIndexing(t,e){this.doDataIndexing(t,e)}add(t){return this.doAdd(t)}addItem(t){return this.doAddItem(t)}insert(t,e){return this.doInsert(t,e)}insertItem(t,e){return this.doInsertItem(t,e)}delete(t){return this.doDelete(t)}set(t,e){return this.doSet(t,e)}setItem(t,e){return this.doSetItem(t,e)}clear(){this.doClear()}getValue(t){return this.doGetValue(t)}getItem(t){return this.doGetItem(t)}toArray(t=!0,e=!1){let i=new Array;if(t){function s(t){for(let e=0;e<t.length;e++)i.push(t.getItem(e)),s(t.getItem(e).childItems)}s(e?this.rootTreeData:this)}else for(let o=0;o<this._data.length;o++)i.push(this._data[o]);return i}toValueArray(t=!0,e=!1){let i=new Array;if(t){function s(t){for(let e=0;e<t.length;e++)i.push(t.getItem(e).value),s(t.getItem(e).childItems)}s(e?this.rootTreeData:this)}else for(let o=0;o<this._data.length;o++)i.push(this._data[o].value);return i}getIndexData(t,e){if(this.indexes){let i=this.indexes.getIndexData(t);return e&&(i=CArrayUtil.orderBy(i,e)),i}return[]}getExpandedItems(){let t=new Array;function e(t,i,s,o){if(s.push({level:t,index:i,item:o}),o.state==ETreeItemState.EXPAND)for(let a=0;a<o.childItems.length;a++)e(t+1,i+","+a,s,o.childItems.getItem(a))}for(let i=0;i<this.length;i++)e(0,i+"",t,this.getItem(i));return t}expandAll(){let t=this.toArray(!0,!0);for(let e=0;e<t.length;e++){t[e].expand()}}collapseAll(){let t=this.toArray(!0,!0);for(let e=0;e<t.length;e++){t[e].collapse()}}loopWithChild(t){!function e(i){for(let s=0;s<i.length;s++)t(s,i.getItem(s)),e(i.getItem(s).childItems)}(this)}swap(t,e){if(!(t>=0&&t<this.length&&e>=0&&e<this.length&&t!=e))throw new Error("Invalid index : "+t+","+e);{let i=this.getItem(e);this.setItem(e,this.getItem(t)),this.setItem(t,i)}}}!function(t){t[t.COLLAPSE=0]="COLLAPSE",t[t.EXPAND=1]="EXPAND"}(ETreeItemState||(ETreeItemState={}));class CStateTreeItem extends CDataClass{get parentItem(){return this.parentData.parentItem}get absoluteIndex(){let t=this.getParents(),e="";for(let i=0;i<t.length;i++)""!=e&&(e+=","),e+=t[i].index;return e}get value(){return this._value}set value(t){this.doSetValue(t)}get state(){return this._state}set state(t){this._state!=t&&(this._state=t,this.doChangeState())}doBeforeChange(t,e,i,s){let o=!0;for(let a=0;a<this.onBeforeChange.length;a++)this.onBeforeChange[a](this,t,e,i,s)||(o=!1);return o}constructor(t,e){super(),this.index=-1,this._state=ETreeItemState.COLLAPSE,this.onChangeState=new Array,this.onBeforeChange=new Array,this.onChange=new Array,this.parentData=e,this.childItems=new CStateTreeData(void 0,this),this.childItems.indexes=this.parentData.indexes,this._value=t,this.doSetValue(t)}doSetValue(t){let e,i=this,s=this.parentData.indexes;s&&s.deleteIndexData(this.value),t[CSymbol.SYM_TREE_ITEM]=this,e=CNotifyChangeObjectMaker.newNotifyObjectWithChildProperties(t,void 0,(function(t,s,o,a){if(e){let t=i.doBeforeChange(e,s,o,a);return t&&i.parentData.dataIndexing("delete",e),t}return!1}),(function(t,s,o){e&&(i.parentData.dataIndexing("modify",e),i.doChange(e,s))})),this._value=e,s&&s.setIndexData(this.value)}doToData(t){let e={...this.value};delete e[CSymbol.SYM_TREE_ITEM],CDataClass.putData(t,"value",e);let i=[];for(let t=0;t<this.childItems.length;t++)i.push(this.childItems.getItem(t).toData());CDataClass.putData(t,"childList",i)}doFromData(t){!function t(e,i){e.childItems.clear(),e.value=CDataClass.getData(i,"value");let s=CDataClass.getData(i,"childList");for(let i=0;i<s.length;i++){t(e.addChild({...e.value}),s[i])}}(this,t)}doChange(t,e){for(let i=0;i<this.onChange.length;i++)this.onChange[i](this,t,e);this.parentData.change("modify",this)}doChangeState(){let t=this.getParents(!0);for(let e=0;e<t.length;e++)t[e].parentData.changeState(this);for(let t=0;t<this.onChangeState.length;t++)this.onChangeState[t](this)}getParents(t=!0){let e=new Array;t&&e.push(this);let i=this.parentData.parentItem;for(;i;)e.unshift(i),i=i.parentData.parentItem;return e}getLevel(){return this.getParents().length}delete(){this.parentData.delete(this.index)}addChild(t){return this.childItems.add(t)}insertChild(t,e){return this.childItems.insert(t,e)}setChild(t,e){return this.childItems.set(t,e)}deleteChild(t){this.childItems.delete(t)}clearChild(){this.childItems.clear()}getChildValue(t){return this.childItems.getValue(t)}getChildItem(t){return this.childItems.getItem(t)}toArray(t=!0){let e=this.childItems.toArray(t);return e.unshift(this),e}toValueArray(t=!0){let e=this.childItems.toValueArray(t);return e.unshift(this.value),e}getExpandedItems(){let t=new Array;function e(t,i,s,o){if(s.push({level:t,index:i,item:o}),o.state==ETreeItemState.EXPAND)for(let a=0;a<o.childItems.length;a++)e(t+1,i+","+a,s,o.childItems[a])}for(let i=0;i<this.childItems.length;i++)e(0,i+"",t,this.childItems[i]);return t}expandAll(){let t=this.toArray(!0);for(let e=0;e<t.length;e++){t[e].expand()}}collapseAll(){let t=this.toArray(!0);for(let e=0;e<t.length;e++){t[e].collapse()}}expand(){this.state=ETreeItemState.EXPAND}collapse(){this.state=ETreeItemState.COLLAPSE}getState(){return 0==this.childItems.length?"empty":this.state}}class CDataSet extends CNotifyObjectList{get changeData(){if(this._clearData)return"clear";{let t=new Array;return this._changeData.forEach((function(e,i){let s="modify";if("add"==e||"insert"==e)s="add",t.push({kind:s,data:i});else if("delete"==e)s="delete",t.push({kind:s,id:i.id});else{if("modify"!=e)throw new Error("Invalid change kind : "+e);s="modify",t.push({kind:s,id:i.id,data:i})}})),t}}constructor(t,e){super(t,e),this._clearData=!1,this._newData=new Set,this._changeData=new Map,this.trackingChangeData=!1}doSet(t,e){throw new Error("Set is not supported")}doChange(t,e,i){super.doChange(t,e,i),this.trackingChangeData&&("add"==t?e&&(this._clearData=!1,this._newData.add(e),this._changeData.set(e,"add")):"insert"==t?e&&(this._clearData=!1,this._newData.add(e),this._changeData.set(e,"insert")):"delete"==t?e&&(this._clearData=!1,this._newData.has(e)?(this._newData.delete(e),this._changeData.delete(e)):this._changeData.set(e,"delete")):"modify"==t?e&&(this._clearData=!1,this._newData.has(e)||this._changeData.set(e,"modify")):"clear"==t&&(this.clearChangeData(),this._clearData=!0))}clearChangeData(){this._clearData=!1,this._changeData.clear(),this._newData.clear()}}class CAsyncSerialExecutor{static async exec(t,e,i,...s){this.functions.set(t,{fn:e,callback:i,args:s}),await CAsyncSerialExecutor.excute(t)}static async serialExec(t,e,...i){return new Promise((async function(s,o){await CAsyncSerialExecutor.exec(t,e,(async function(t){t instanceof Error?o(t):s(t)}),...i)}))}static async excute(t){if(!CAsyncSerialExecutor.workFunction.has(t)){CAsyncSerialExecutor.workFunction.add(t);try{for(;;){let e=CAsyncSerialExecutor.functions.get(t);if(0==e.length)break;CAsyncSerialExecutor.functions.childClear(t);for(let t=0;t<e.length;t++)try{let i=await e[t].fn(...e[t].args);await e[t].callback(i)}catch(i){await e[t].callback(new Error(CStringUtil.errorMessage(i)))}}}finally{0==CAsyncSerialExecutor.functions.get(t).length&&CAsyncSerialExecutor.functions.delete(t),CAsyncSerialExecutor.workFunction.delete(t)}}}}CAsyncSerialExecutor.workFunction=new Set,CAsyncSerialExecutor.functions=new CGroupMap;class CCustomFileMap{get databaseName(){return this._databaseName}get storeName(){return this._storeName}get size(){return"memory"==this._readType?this._map.size:this._set.size}get readType(){return this._readType}constructor(t,e,i,s){this._isLoad=!1,this._set=new Set,this._map=new Map,this.onLoad=new Array;let o=this;this._databaseName=t,this._storeName=e,this.db=new CIndexedDB(this.databaseName),s&&this.onLoad.push(s),this.db.onOpenSuccess.push((async function(t,e){await o.load()})),this.db.open(1,(function(t){t.objectStoreNames.contains(o._storeName)||t.createObjectStore(o._storeName,{keyPath:"key"})})),this._readType=i}async doPut(t,e){if(!this._isLoad)throw new Error("Data has not been loaded");await this.db.putObject(this._storeName,{key:t,value:e}),"memory"==this._readType?this._map.set(t,e):this._set.add(t)}async doGet(t){if(!this._isLoad)throw new Error("Data has not been loaded");if("memory"==this._readType){return this._map.get(t)}try{let e=await this.db.getObject(this._storeName,t);if(e)return e.value}catch(t){throw t}}async doDelete(t){if(!this._isLoad)throw new Error("Data has not been loaded");await this.db.deleteObject(this._storeName,t),"memory"==this._readType?this._map.delete(t):this._set.delete(t)}async doClear(){if(!this._isLoad)throw new Error("Data has not been loaded");let t=this;await this.loopDatabaseValue((async function(e,i){await t.delete(e)}))}async doLoad(){this._map.clear(),this._set.clear();let t=this;await this.loopDatabaseValue((async function(e,i){"memory"==t._readType?t._map.set(e,i):t._set.add(e)})),this._isLoad=!0;for(let t=0;t<this.onLoad.length;t++)this.onLoad[t](this)}async doLoop(t,e){if("memory"==this._readType){let i=[];this._map.forEach((function(t,e){i.push(e)}));for(let s=0;s<i.length;s++)if("serial"==t){let t=i[s];await this.getSerial(t,(async function(i){i&&await e(t,i)}))}else{let t=await this.get(i[s]);t&&await e(i[s],t)}}else{let i=[];this._set.forEach((function(t){i.push(t)}));for(let s=0;s<i.length;s++)if("serial"==t){let t=i[s];await this.getSerial(t,(async function(i){i&&await e(t,i)}))}else{let t=await this.get(i[s]);t&&await e(i[s],t)}}}async put(t,e){let i=this;await CAsyncSerialExecutor.serialExec(this.databaseName+"."+this.storeName+"."+t+".write",(async function(){await i.doPut(t,e)}))}async getSerial(t,e){let i=this;await CAsyncSerialExecutor.serialExec(this.databaseName+"."+this.storeName+"."+t+".write",(async function(){let s=await i.doGet(t);await e(s)}))}async get(t){return await this.doGet(t)}async delete(t){let e=this;await CAsyncSerialExecutor.serialExec(this.databaseName+"."+this.storeName+"."+t+".write",(async function(){await e.doDelete(t)}))}async clear(){await this.doClear()}async load(){let t=this;await CAsyncSerialExecutor.serialExec(this.databaseName+"."+this.storeName+".write",(async function(){await t.doLoad()}))}async loop(t,e){await this.doLoop(t,e)}async loopDatabaseValue(t){await this.db.loop(this._storeName,(async function(e,i,s){await t(e.toString(),i.value)}))}async close(){let t=this;await CAsyncSerialExecutor.serialExec(this.databaseName+"."+this.storeName+".write",(async function(){await t.db.close()}))}has(t){return"memory"==this._readType?this._map.has(t):this._set.has(t)}}class CFileMap extends CCustomFileMap{constructor(){super(...arguments),this.isModify=!1,this._modifyData=new Map,this.searchIndexes=new CIndexes([]),this.onChange=new Array}doDataIndexing(t,e,i){e&&("add"!=t&&"insert"!=t&&"modify"!=t&&"set"!=t||this.searchIndexes.setIndexData(e,i),"delete"==t&&this.searchIndexes.deleteIndexData(e,i)),"clear"==t&&this.searchIndexes.clear()}doGetIndex(t){return this.searchIndexes.getIndexData(t)}async doChange(t,e,i,s){"modify"==t&&e&&i&&this.isModify&&this._modifyData.set(e,i);for(let o=0;o<this.onChange.length;o++)await this.onChange[o](this,t,e,i,s)}async doModifyData(){let t=[];this._modifyData.forEach((function(e,i){let s=JSON.parse(JSON.stringify(e));t.push({key:i,value:s})}));for(let e=0;e<t.length;e++)await this.put(t[e].key,t[e].value)}async doPut(t,e){let i;if(this.searchIndexes.indexKeyList.length>0&&(i=await this.doGet(t)),await super.doPut(t,e),this.searchIndexes.indexKeyList.length>0)try{i&&this.doDataIndexing("delete",i,t),this.doDataIndexing("set",this.getNotifyItem(t,e),t)}catch(t){console.error("index put except",t)}await this.doChange("put",t,e)}async doGet(t){let e=await super.doGet(t);return e&&"disk"==this._readType&&(e=this.getNotifyItem(t,e)),e}async doDelete(t){let e=await this.get(t);if(await super.doDelete(t),e){try{this.searchIndexes.indexKeyList.length>0&&this.doDataIndexing("delete",e,t)}catch(t){console.error("index delete except",t)}await this.doChange("delete",t,e)}}async doClear(){await super.doClear();try{this.searchIndexes.indexKeyList.length>0&&this.doDataIndexing("clear")}catch(t){console.error("index clear except",t)}await this.doChange("clear")}async doLoad(){this._map.clear(),this._set.clear(),this.searchIndexes.clear();let t=this;await this.loopDatabaseValue((async function(e,i){let s=t.getNotifyItem(e,i);if("memory"==t._readType?t._map.set(e,s):t._set.add(e),t.searchIndexes.indexKeyList.length>0)try{t.doDataIndexing("set",s,e)}catch(t){console.error("index put except",t)}})),this._isLoad=!0;for(let t=0;t<this.onLoad.length;t++)await this.onLoad[t](this)}async modifyStart(){this.isModify=!0}async modifySave(){let t=this;await CAsyncSerialExecutor.serialExec(this.databaseName+"."+this.storeName+".write",(async function(){try{await t.doModifyData(),t._modifyData.clear()}finally{t.isModify=!1}}))}async modifyData(t){this.isModify=!0;try{this._modifyData.clear(),await t(),await this.doModifyData(),this._modifyData.clear()}finally{this.isModify=!1}}async array(t,e){let i=new Array;if("memory"==this._readType)this._map.forEach((function(e,s){if(t){let s=!0,o=Object.keys(t);for(let i=0;i<o.length;i++)e[o[i]]?e[o[i]]!=t[o[i]]&&(s=!1):s=!1;s&&i.push(e)}else i.push(e)}));else{await this.loop("none",(async function(e,s){if(t){let e=!0,o=Object.keys(t);for(let i=0;i<o.length;i++)s[o[i]]?s[o[i]]!=t[o[i]]&&(e=!1):e=!1;e&&i.push(s)}else i.push(s)}))}return e&&CArrayUtil.orderBy(i,CObjectList.anyToOrderBy(e)),i}arrayMemory(t,e){let i=new Array;if("memory"!=this._readType)throw new Error("Not supported in disk mode");return this._map.forEach((function(e,s){if(t){let s=!0,o=Object.keys(t);for(let i=0;i<o.length;i++)e[o[i]]?e[o[i]]!=t[o[i]]&&(s=!1):s=!1;s&&i.push(e)}else i.push(e)})),e&&CArrayUtil.orderBy(i,CObjectList.anyToOrderBy(e)),i}getIndex(t){return this.doGetIndex(t)}async findIndexData(t,e){let i=new Array,s=this.getIndex(CObjectList.anyToWhereCondition(t));if("memory"==this._readType)for(let t=0;t<s.length;t++){let e=this._map.get(s[t]);e&&i.push(e)}else for(let t=0;t<s.length;t++){let e=await this.get(s[t]);e&&i.push(e)}return e&&CArrayUtil.orderBy(i,CObjectList.anyToOrderBy(e)),i}findIndexDataMemory(t,e){let i=new Array,s=this.getIndex(CObjectList.anyToWhereCondition(t));if("memory"!=this._readType)throw new Error("Not supported in disk mode");for(let t=0;t<s.length;t++){let e=this._map.get(s[t]);e&&i.push(e)}return e&&CArrayUtil.orderBy(i,CObjectList.anyToOrderBy(e)),i}async keys(t){if(t){let e=Object.keys(t),i=[];for(let s=0;s<e.length;s++)i.push({fieldName:e[s],value:t[e[s]]});return this.getIndex(i)}{let t=[];return"memory"==this._readType?this._map.forEach((function(e,i){t.push(i)})):this._set.forEach((function(e){t.push(e)})),t}}async addIndex(t){this.searchIndexes.addIndex(t);let e=this;await this.loop("none",(async function(i,s){e.searchIndexes.setIndexDataFromKey(t,!1,s,i)}))}getNotifyItem(t,e){let i=this,s=CNotifyChangeObjectMaker.newNotifyObjectWithChildProperties(e,void 0,void 0,(function(s,o,a,n){"string"==typeof o&&i.doChange("modify",t,e,o)}),void 0);return Object.defineProperty(s,CFileMap.CON_SYM_KEY,{value:t,writable:!1}),s}async applyChangeData(t){if("clear"==t)await this.clear();else for(let e=0;e<t.length;e++)if("put"==t[e].kind||"modify"==t[e].kind){let i=t[e].key,s=t[e].data;i&&s&&await this.put(i,s)}else{let i=t[e].key;i&&await this.delete(i)}}}CFileMap.CON_SYM_KEY=Symbol("key");class CFileList{get length(){return this.map.size}get databaseName(){return this.map.databaseName}get storeName(){return this.map.storeName}constructor(t,e,i="memory",s){this.onLoad=new Array,this.onLoadComplete=new Array;let o=this;this.map=new CFileMap(t,e,i,s),this.map.onLoad.push((async function(){o.doLoadComplete()}))}async doLoadComplete(){for(let t=0;t<this.onLoadComplete.length;t++)this.onLoadComplete[t](this)}async doLoad(){await this.map.load()}async doAdd(t){let e=await this.idSet(t);if(this.has(e.id))throw new Error("Exists id : "+e.id);return await this.map.put(e.id,e.data),{id:e.id,data:this.map.getNotifyItem(e.id,t)}}async doGet(t){return await this.map.get(t)}async doSet(t,e){if(!this.has(t))throw new Error("Not exists id : "+t);return e.id||(e.id=t),await this.map.put(t,e),this.map.getNotifyItem(t,e)}async doDelete(t){await this.map.delete(t)}async doClear(){await this.map.clear()}async add(t){return await this.doAdd(t)}async get(t){return await this.doGet(t)}async set(t,e){return await this.doSet(t,e)}async delete(t){await this.doDelete(t)}async clear(){await this.doClear()}async nextId(){return await CIndexedDB.getSeq(this.databaseName+"."+this.storeName+".id")}async array(t,e){return await this.map.array(t,e)}arrayMemory(t,e){return this.map.arrayMemory(t,e)}async findIndexData(t,e){return this.map.findIndexData(t,e)}findIndexDataMemory(t,e){return this.map.findIndexDataMemory(t,e)}async addIndex(t){await this.map.addIndex(t)}async ids(t){return await this.map.keys(t)}async loop(t,e){let i=await this.ids(e);for(let e=0;e<i.length;e++){let s=await this.get(i[e]);s&&await t(s)}}has(t){return this.map.has(t)}getDataId(t){let e=t.id;return e||""}async idSet(t){let e="";return t.id?""==t.id?(e=await this.nextId(),delete t.id):(e=t.id,delete t.id):e=await this.nextId(),Object.defineProperty(t,"id",{value:e,writable:!1,enumerable:!0}),{data:t,id:e}}async applyChangeData(t){if("clear"==t)await this.clear();else for(let e=0;e<t.length;e++)if("add"==t[e].kind){let i=t[e].data;i&&await this.add(i)}else if("delete"==t[e].kind){let i=t[e].id;i&&await this.delete(i)}else{let i=t[e].id,s=t[e].data;i&&s&&await this.set(i,s)}}async modifyStart(){this.map.modifyStart()}async modifySave(){await this.map.modifySave()}async modifyData(t){await this.map.modifyData(t)}async load(){await this.doLoad()}async toObjectList(t,e,i,s){let o=[];t&&(o=t);let a=new CObjectList(o),n=null!=i?await this.findIndexData(i,s):await this.array();if(e)for(let t=0;t<n.length;t++){let i={};for(let s=0;s<e.length;s++)i[e[s]]=n[t][e[s]];a.add(i)}else for(let t=0;t<n.length;t++)a.add(n[t]);return a}toObjectListMemory(t,e,i,s){if("memory"==this.map.readType){let o=[];t&&(o=t);let a=new CObjectList(o),n=null!=i?this.findIndexDataMemory(i,s):this.arrayMemory();if(e)for(let t=0;t<n.length;t++){let i={};for(let s=0;s<e.length;s++)i[e[s]]=n[t][e[s]];a.add(i)}else for(let t=0;t<n.length;t++)a.add(n[t]);return a}throw new Error("Not supported in disk mode")}async where(t,e,i=[]){return CObjectList.whereArray(await this.findIndexData(t),t,e,i)}async join(t){if(0==t.length)throw new Error("Invalid condition");let e,i=t[0].where;e=i&&i.leftListWhere?await this.where(i.leftListWhere):await this.toObjectList([],void 0);for(let s=0;s<t.length;s++){let o,a=t[s].list;o=a instanceof CFileList?i&&i.rightListWhere?await a.where(i.rightListWhere):await a.toObjectList([],void 0):a,e=CObjectList.join({leftList:e,rightList:o,select:t[s].select,where:t[s].where,on:t[s].on},t[s].resultIndexFields)}return e}async orderBy(t,e=[]){return CObjectList.orderBy(await this.toObjectList([],void 0),t,e)}async distinct(t,e,i=[]){let s=await this.toObjectList([],void 0);if(e instanceof Array){let o=new CObjectList(i);for(let a=0;a<e.length;a++){let n=CObjectList.distinct(s,t,CObjectList.anyToWhereCondition(e[a]),i);for(let t=0;t<n.length;t++)o.add(n.get(t))}return o}return e?CObjectList.distinct(s,t,CObjectList.anyToWhereCondition(e),i):CObjectList.distinct(s,t,[],i)}async dataImport(t){if(!this.dataImportId)throw new Error("Not exists data import");{let e=this.dataImportId.now;this.dataImportId.now++,t.id=e+"",await this.add(t)}}async close(){await this.map.close()}}!function(t){t[t.NONE=0]="NONE",t[t.LEFT=1]="LEFT",t[t.TOP=2]="TOP",t[t.RIGHT=3]="RIGHT",t[t.BOTTOM=4]="BOTTOM",t[t.CLIENT=5]="CLIENT",t[t.FLOW=6]="FLOW",t[t.CENTER=7]="CENTER",t[t.LEFTTOP=8]="LEFTTOP",t[t.RIGHTTOP=9]="RIGHTTOP",t[t.LEFTBOTTOM=10]="LEFTBOTTOM",t[t.RIGHTBOTTOM=11]="RIGHTBOTTOM",t[t.MIDDLELEFT=12]="MIDDLELEFT",t[t.MIDDLETOP=13]="MIDDLETOP",t[t.MIDDLERIGHT=14]="MIDDLERIGHT",t[t.MIDDLEBOTTOM=15]="MIDDLEBOTTOM",t[t.HCENTER=16]="HCENTER",t[t.VCENTER=17]="VCENTER",t[t.TURN=18]="TURN",t[t.PATHDATA=19]="PATHDATA",t[t.GRID=20]="GRID",t[t.PARENT_SIZE=21]="PARENT_SIZE"}(EPositionAlign||(EPositionAlign={})),function(t){t[t.PIXEL=0]="PIXEL",t[t.PERCENT=1]="PERCENT"}(EPositionUnit||(EPositionUnit={})),function(t){t[t.ORIGINAL=0]="ORIGINAL",t[t.FIT=1]="FIT",t[t.STRETCH=2]="STRETCH"}(EFitMode||(EFitMode={}));class CPositionAlignInfo extends CNotifyChangeKindObject{constructor(){super(...arguments),this._turnAngle=0,this._turnRadiusX=0,this._turnRadiusY=0,this._pathMiddleValue=0,this._gridColumn=0,this._gridRow=0,this._gridRowHeight=0}static get CON_CHANGE_TURN_ANGLE(){return"changeTurnAngle"}static get CON_CHANGE_TURN_RADIUS_X(){return"changeTurnRadiusX"}static get CON_CHANGE_TURN_RADIUS_Y(){return"changeTurnRadiusY"}static get CON_CHANGE_PATH_MIDDLE_VALUE(){return"changePathMiddleValue"}static get CON_CHANGE_GRID_COLUMN(){return"changeGridColumn"}static get CON_CHANGE_GRID_ROW(){return"changeGridRow"}static get CON_CHANGE_GRID_ROW_HEIGHT(){return"changeGridRowHeight"}static get CON_CHANGE_UNIT(){return"changeUnit"}get turnAngle(){return this._turnAngle}set turnAngle(t){t!=this.turnAngle&&(this._turnAngle=t,this.doChange(CPositionAlignInfo.CON_CHANGE_TURN_ANGLE))}get turnRadiusX(){return this._turnRadiusX}set turnRadiusX(t){t!=this._turnRadiusX&&(this._turnRadiusX=t,this.doChange(CPositionAlignInfo.CON_CHANGE_TURN_RADIUS_X))}get turnRadiusY(){return this._turnRadiusY}set turnRadiusY(t){t!=this._turnRadiusY&&(this._turnRadiusY=t,this.doChange(CPositionAlignInfo.CON_CHANGE_TURN_RADIUS_Y))}get pathMiddleValue(){return this._pathMiddleValue}set pathMiddleValue(t){t!=this._pathMiddleValue&&(this._pathMiddleValue=t,this.doChange(CPositionAlignInfo.CON_CHANGE_PATH_MIDDLE_VALUE))}get gridColumn(){return this._gridColumn}set gridColumn(t){t!=this._gridColumn&&(this._gridColumn=t,this.doChange(CPositionAlignInfo.CON_CHANGE_GRID_COLUMN))}get gridRow(){return this._gridRow}set gridRow(t){t!=this._gridRow&&(this._gridRow=t,this.doChange(CPositionAlignInfo.CON_CHANGE_GRID_ROW))}get gridRowHeight(){return this._gridRowHeight}set gridRowHeight(t){t!=this._gridRowHeight&&(this._gridRowHeight=t,this.doChange(CPositionAlignInfo.CON_CHANGE_GRID_ROW_HEIGHT))}doToData(t){super.doToData(t),CDataClass.putData(t,"turnAngle",this.turnAngle,0),CDataClass.putData(t,"turnRadiusX",this.turnRadiusX,0),CDataClass.putData(t,"turnRadiusY",this.turnRadiusY,0),CDataClass.putData(t,"pathMiddleValue",this.pathMiddleValue,0),CDataClass.putData(t,"gridColumn",this.gridColumn,0),CDataClass.putData(t,"gridRow",this.gridRow,0),CDataClass.putData(t,"gridRowHeight",this.gridRowHeight,0)}doFromData(t){super.doFromData(t),this.turnAngle=CDataClass.getData(t,"turnAngle",0),this.turnRadiusX=CDataClass.getData(t,"turnRadiusX",0),this.turnRadiusY=CDataClass.getData(t,"turnRadiusY",0),this.pathMiddleValue=CDataClass.getData(t,"pathMiddleValue",0),this.gridColumn=CDataClass.getData(t,"gridColumn",0),this.gridRow=CDataClass.getData(t,"gridRow",0),this.gridRowHeight=CDataClass.getData(t,"gridRowHeight",0)}copyFrom(t){this.turnAngle=t.turnAngle,this.turnRadiusX=t.turnRadiusX,this.turnRadiusY=t.turnRadiusY,this.pathMiddleValue=t.pathMiddleValue,this.gridColumn=t.gridColumn,this.gridRow=t.gridRow,this.gridRowHeight=t.gridRowHeight}}class CPositionParentAlignInfo extends CNotifyChangeKindObject{static get CON_CHANGE_MARGIN_X(){return"changeMarginX"}static get CON_CHANGE_MARGIN_Y(){return"changeMarginY"}static get CON_CHANGE_GRID_COLUMN_COUNT(){return"changeGridColumnCount"}static get CON_CHANGE_GRID_ROW_COUNT(){return"changeGridRowCount"}static get CON_CHANGE_TURN_CENTER(){return"changeTurnCenter"}static get CON_CHANGE_TURN_AUTO_SET(){return"changeTurnAutoSet"}static get CON_CHANGE_TURN_AUTO_SET_START_ANGLE(){return"changeTurnAutoSetStartAngle"}static get CON_CHANGE_TURN_AUTO_SET_STOP_ANGLE(){return"changeTurnAutoSetStopAngle"}static get CON_CHANGE_TURN_AUTO_SET_RADIUS_X(){return"changeTurnAutoSetRadiusX"}static get CON_CHANGE_TURN_AUTO_SET_RADIUS_Y(){return"changeTurnAutoSetRadiusY"}static get CON_CHANGE_PATH_DATA(){return"changePathData"}static get CON_CHANGE_PATH_DATA_AUTO_SET(){return"changePathDataAutoSet"}static get CON_CHANGE_PATH_DATA_FIT_MODE(){return"changePathDataFitMode"}static get CON_CHANGE_PATH_DATA_START_MIDDLE_VALUE(){return"changePathDataStartMiddleValue"}static get CON_CHANGE_PATH_DATA_STOP_MIDDLE_VALUE(){return"changePathDataStopMiddleValue"}get marginX(){return this._marginX}set marginX(t){t!=this._marginX&&(this._marginX=t,this.doChange(CPositionParentAlignInfo.CON_CHANGE_MARGIN_X))}get marginY(){return this._marginY}set marginY(t){t!=this._marginY&&(this._marginY=t,this.doChange(CPositionParentAlignInfo.CON_CHANGE_MARGIN_Y))}get gridColumnCount(){return this._gridColumnCount}set gridColumnCount(t){t!=this._gridColumnCount&&(this._gridColumnCount=t,this.doChange(CPositionParentAlignInfo.CON_CHANGE_GRID_COLUMN_COUNT))}get gridRowCount(){return this._gridRowCount}set gridRowCount(t){t!=this._gridRowCount&&(this._gridRowCount=t,this.doChange(CPositionParentAlignInfo.CON_CHANGE_GRID_ROW_COUNT))}get turnCenter(){return this._turnCenter}get turnAutoSet(){return this._turnAutoSet}set turnAutoSet(t){t!=this._turnAutoSet&&(this._turnAutoSet=t,this.doChange(CPositionParentAlignInfo.CON_CHANGE_TURN_AUTO_SET))}get turnAutoSetStartAngle(){return this._turnAutoSetStartAngle}set turnAutoSetStartAngle(t){t!=this._turnAutoSetStartAngle&&(this._turnAutoSetStartAngle=t,this.doChange(CPositionParentAlignInfo.CON_CHANGE_TURN_AUTO_SET_START_ANGLE))}get turnAutoSetStopAngle(){return this._turnAutoSetStopAngle}set turnAutoSetStopAngle(t){t!=this._turnAutoSetStopAngle&&(this._turnAutoSetStopAngle=t,this.doChange(CPositionParentAlignInfo.CON_CHANGE_TURN_AUTO_SET_STOP_ANGLE))}get turnAutoSetRadiusX(){return this._turnAutoSetRadiusX}set turnAutoSetRadiusX(t){t!=this._turnAutoSetRadiusX&&(this._turnAutoSetRadiusX=t,this.doChange(CPositionParentAlignInfo.CON_CHANGE_TURN_AUTO_SET_RADIUS_X))}get turnAutoSetRadiusY(){return this._turnAutoSetRadiusY}set turnAutoSetRadiusY(t){t!=this._turnAutoSetRadiusY&&(this._turnAutoSetRadiusY=t,this.doChange(CPositionParentAlignInfo.CON_CHANGE_TURN_AUTO_SET_RADIUS_Y))}set turnAutoSetRadius(t){this.turnAutoSetRadiusX=t,this.turnAutoSetRadiusY=t}get pathData(){return this._pathData}set pathData(t){t!=this._pathData&&(this._pathData=t,this.doChange(CPositionParentAlignInfo.CON_CHANGE_PATH_DATA))}get pathDataAutoSet(){return this._pathDataAutoSet}set pathDataAutoSet(t){t!=this._pathDataAutoSet&&(this._pathDataAutoSet=t,this.doChange(CPositionParentAlignInfo.CON_CHANGE_PATH_DATA_AUTO_SET))}get pathDataFitMode(){return this._pathDataFitMode}set pathDataFitMode(t){t!=this._pathDataFitMode&&(this._pathDataFitMode=t,this.doChange(CPositionParentAlignInfo.CON_CHANGE_PATH_DATA_FIT_MODE))}get pathDataStartMiddleValue(){return this._pathDataStartMiddleValue}set pathDataStartMiddleValue(t){t!=this._pathDataStartMiddleValue&&(this._pathDataStartMiddleValue=t,this.doChange(CPositionParentAlignInfo.CON_CHANGE_PATH_DATA_START_MIDDLE_VALUE))}get pathDataStopMiddleValue(){return this._pathDataStopMiddleValue}set pathDataStopMiddleValue(t){t!=this._pathDataStopMiddleValue&&(this._pathDataStopMiddleValue=t,this.doChange(CPositionParentAlignInfo.CON_CHANGE_PATH_DATA_STOP_MIDDLE_VALUE))}constructor(){super(),this._marginX=0,this._marginY=0,this._gridColumnCount=5,this._gridRowCount=-1,this._turnCenter=new CNotifyPoint(.5,.5),this._turnAutoSet=!1,this._turnAutoSetStartAngle=0,this._turnAutoSetStopAngle=360,this._turnAutoSetRadiusX=100,this._turnAutoSetRadiusY=100,this._pathData="",this._pathDataAutoSet=!1,this._pathDataFitMode=EFitMode.STRETCH,this._pathDataStartMiddleValue=0,this._pathDataStopMiddleValue=1;let t=this;this._turnCenter.onChange=function(e,i){t.doChange(CPositionParentAlignInfo.CON_CHANGE_TURN_CENTER)}}doToData(t){super.doToData(t),CDataClass.putData(t,"marginX",this.marginX,0),CDataClass.putData(t,"marginY",this.marginY,0),CDataClass.putData(t,"gridColumnCount",this.gridColumnCount,5),CDataClass.putData(t,"gridRowCount",this.gridRowCount,-1),CDataClass.putData(t,"turnCenter",this.turnCenter.toData(),{x:.5,y:.5},!0),CDataClass.putData(t,"turnAutoSet",this.turnAutoSet,!1),CDataClass.putData(t,"turnAutoSetStartAngle",this.turnAutoSetStartAngle,0),CDataClass.putData(t,"turnAutoSetStopAngle",this.turnAutoSetStopAngle,360),CDataClass.putData(t,"turnAutoSetRadiusX",this.turnAutoSetRadiusX,100),CDataClass.putData(t,"turnAutoSetRadiusY",this.turnAutoSetRadiusY,100),CDataClass.putData(t,"pathData",this.pathData,""),CDataClass.putData(t,"pathDataAutoSet",this.pathDataAutoSet,!1),CDataClass.putData(t,"pathDataFitMode",this.pathDataFitMode,EFitMode.STRETCH),CDataClass.putData(t,"pathDataStartMiddleValue",this.pathDataStartMiddleValue,0),CDataClass.putData(t,"pathDataStopMiddleValue",this.pathDataStopMiddleValue,1)}doFromData(t){super.doFromData(t),this.marginX=CDataClass.getData(t,"marginX",0),this.marginY=CDataClass.getData(t,"marginY",0),this.gridColumnCount=CDataClass.getData(t,"gridColumnCount",5),this.gridRowCount=CDataClass.getData(t,"gridRowCount",-1),this.turnCenter.fromData(CDataClass.getData(t,"turnCenter",{x:.5,y:.5},!0)),this.turnAutoSet=CDataClass.getData(t,"turnAutoSet",!1),this.turnAutoSetStartAngle=CDataClass.getData(t,"turnAutoSetStartAngle",0),this.turnAutoSetStopAngle=CDataClass.getData(t,"turnAutoSetStopAngle",360),this.turnAutoSetRadiusX=CDataClass.getData(t,"turnAutoSetRadiusX",100),this.turnAutoSetRadiusY=CDataClass.getData(t,"turnAutoSetRadiusY",100),this.pathData=CDataClass.getData(t,"pathData",""),this.pathDataAutoSet=CDataClass.getData(t,"pathDataAutoSet",!1),this.pathDataFitMode=CDataClass.getData(t,"pathDataFitMode",EFitMode.STRETCH),this.pathDataStartMiddleValue=CDataClass.getData(t,"pathDataStartMiddleValue",0),this.pathDataStopMiddleValue=CDataClass.getData(t,"pathDataStopMiddleValue",1)}copyFrom(t){this.marginX=t.marginX,this.marginY=t.marginY,this.gridColumnCount=t.gridColumnCount,this.gridRowCount=t.gridRowCount,this.turnCenter.x=t.turnCenter.x,this.turnCenter.y=t.turnCenter.y,this.turnAutoSet=t.turnAutoSet,this.turnAutoSetStartAngle=t.turnAutoSetStartAngle,this.turnAutoSetStopAngle=t.turnAutoSetStopAngle,this.turnAutoSetRadiusX=t.turnAutoSetRadiusX,this.turnAutoSetRadiusY=t.turnAutoSetRadiusY,this.pathData=t.pathData,this.pathDataAutoSet=t.pathDataAutoSet,this.pathDataFitMode=t.pathDataFitMode,this.pathDataStartMiddleValue=t.pathDataStartMiddleValue,this.pathDataStopMiddleValue=t.pathDataStopMiddleValue}}class CTransform extends CNotifyChangeKindObject{constructor(){super(...arguments),this._translateX=0,this._translateY=0,this._translateZ=0,this._scaleX=1,this._scaleY=1,this._scaleZ=1,this._rotationPointX=.5,this._rotationPointY=.5,this._rotationPointZ=0,this._rotateX=0,this._rotateY=0,this._rotateZ=0,this._perspective=1e3,this._perspectiveX=.5,this._perspectiveY=.5}static get CON_CHANGE_SCALE_X(){return"changeScaleX"}static get CON_CHANGE_SCALE_Y(){return"changeScaleY"}static get CON_CHANGE_SCALE_Z(){return"changeScaleZ"}static get CON_CHANGE_ROTATION_POINT_X(){return"changeRotaionPointX"}static get CON_CHANGE_ROTATION_POINT_Y(){return"changeRotaionPointY"}static get CON_CHANGE_ROTATION_POINT_Z(){return"changeRotaionPointZ"}static get CON_CHANGE_TRANSLATE_X(){return"changeTranslateX"}static get CON_CHANGE_TRANSLATE_Y(){return"changeTranslateY"}static get CON_CHANGE_TRANSLATE_Z(){return"changeTranslateZ"}static get CON_CHANGE_ROTATE_X(){return"changeRotateX"}static get CON_CHANGE_ROTATE_Y(){return"changeRotateY"}static get CON_CHANGE_ROTATE_Z(){return"changeRotateZ"}static get CON_CHANGE_PERSPECTIVE(){return"changePerspective"}static get CON_CHANGE_PERSPECTIVE_X(){return"changePerspectiveX"}static get CON_CHANGE_PERSPECTIVE_Y(){return"changePerspectiveY"}get translateX(){return this._translateX}set translateX(t){this._translateX!=t&&(this._translateX=t,this.doChange(CTransform.CON_CHANGE_TRANSLATE_X))}get translateY(){return this._translateY}set translateY(t){this._translateY!=t&&(this._translateY=t,this.doChange(CTransform.CON_CHANGE_TRANSLATE_Y))}get translateZ(){return this._translateZ}set translateZ(t){this._translateZ!=t&&(this._translateZ=t,this.doChange(CTransform.CON_CHANGE_TRANSLATE_Z))}get scaleX(){return this._scaleX}set scaleX(t){this._scaleX!=t&&(this._scaleX=t,this.doChange(CTransform.CON_CHANGE_SCALE_X))}get scaleY(){return this._scaleY}set scaleY(t){this._scaleY!=t&&(this._scaleY=t,this.doChange(CTransform.CON_CHANGE_SCALE_Y))}get scaleZ(){return this._scaleZ}set scaleZ(t){this._scaleZ!=t&&(this._scaleZ=t,this.doChange(CTransform.CON_CHANGE_SCALE_Z))}get scale(){return(this._scaleX+this._scaleY+this._scaleZ)/3}set scale(t){this.scaleX=t,this.scaleY=t,this.scaleZ=t}get rotationPointX(){return this._rotationPointX}set rotationPointX(t){this._rotationPointX!=t&&(this._rotationPointX=t,this.doChange(CTransform.CON_CHANGE_ROTATION_POINT_X))}get rotationPointY(){return this._rotationPointY}set rotationPointY(t){this._rotationPointY!=t&&(this._rotationPointY=t,this.doChange(CTransform.CON_CHANGE_ROTATION_POINT_Y))}get rotationPointZ(){return this._rotationPointZ}set rotationPointZ(t){this._rotationPointZ!=t&&(this._rotationPointZ=t,this.doChange(CTransform.CON_CHANGE_ROTATION_POINT_Z))}get rotateX(){return this._rotateX}set rotateX(t){this._rotateX!=t&&(this._rotateX=t,this.doChange(CTransform.CON_CHANGE_ROTATE_X))}get rotateY(){return this._rotateY}set rotateY(t){this._rotateY!=t&&(this._rotateY=t,this.doChange(CTransform.CON_CHANGE_ROTATE_Y))}get rotateZ(){return this._rotateZ}set rotateZ(t){this._rotateZ!=t&&(this._rotateZ=t,this.doChange(CTransform.CON_CHANGE_ROTATE_Z))}get perspective(){return this._perspective}set perspective(t){this._perspective!=t&&(this._perspective=t,this.doChange(CTransform.CON_CHANGE_PERSPECTIVE))}get perspectiveX(){return this._perspectiveX}set perspectiveX(t){this._perspectiveX!=t&&(this._perspectiveX=t,this.doChange(CTransform.CON_CHANGE_PERSPECTIVE_X))}get perspectiveY(){return this._perspectiveY}set perspectiveY(t){this._perspectiveY!=t&&(this._perspectiveY=t,this.doChange(CTransform.CON_CHANGE_PERSPECTIVE_Y))}doToData(t){super.doToData(t),CDataClass.putData(t,"translateX",this.translateX,0),CDataClass.putData(t,"translateY",this.translateY,0),CDataClass.putData(t,"translateZ",this.translateZ,0),CDataClass.putData(t,"scaleX",this.scaleX,1),CDataClass.putData(t,"scaleY",this.scaleY,1),CDataClass.putData(t,"scaleZ",this.scaleZ,1),CDataClass.putData(t,"rotateX",this.rotateX,0),CDataClass.putData(t,"rotateY",this.rotateY,0),CDataClass.putData(t,"rotateZ",this.rotateZ,0),CDataClass.putData(t,"perspective",this.perspective,1e3),CDataClass.putData(t,"perspectiveX",this.perspectiveX,.5),CDataClass.putData(t,"perspectiveY",this.perspectiveY,.5),CDataClass.putData(t,"rotationPointX",this.rotationPointX,.5),CDataClass.putData(t,"rotationPointY",this.rotationPointY,.5),CDataClass.putData(t,"rotationPointZ",this.rotationPointZ,0)}doFromData(t){super.doFromData(t),this.translateX=CDataClass.getData(t,"translateX",0),this.translateY=CDataClass.getData(t,"translateY",0),this.translateZ=CDataClass.getData(t,"translateZ",0),this.scaleX=CDataClass.getData(t,"scaleX",1),this.scaleY=CDataClass.getData(t,"scaleY",1),this.scaleZ=CDataClass.getData(t,"scaleZ",1),this.rotateX=CDataClass.getData(t,"rotateX",0),this.rotateY=CDataClass.getData(t,"rotateY",0),this.rotateZ=CDataClass.getData(t,"rotateZ",0),this.perspective=CDataClass.getData(t,"perspective",1e3),this.perspectiveX=CDataClass.getData(t,"perspectiveX",.5),this.perspectiveY=CDataClass.getData(t,"perspectiveY",.5),this.rotationPointX=CDataClass.getData(t,"rotationPointX",.5),this.rotationPointY=CDataClass.getData(t,"rotationPointY",.5),this.rotationPointZ=CDataClass.getData(t,"rotationPointZ",0)}doChange(t){super.doChange(t),CCalc.isIn(t,[CTransform.CON_CHANGE_TRANSLATE_X,CTransform.CON_CHANGE_TRANSLATE_Y,CTransform.CON_CHANGE_TRANSLATE_Z])&&this.doChangeTranslate(),CCalc.isIn(t,[CTransform.CON_CHANGE_ROTATE_X,CTransform.CON_CHANGE_ROTATE_Y,CTransform.CON_CHANGE_ROTATE_Z])&&this.doChangeRotation(),CCalc.isIn(t,[CTransform.CON_CHANGE_SCALE_X,CTransform.CON_CHANGE_SCALE_Y,CTransform.CON_CHANGE_SCALE_Z])&&this.doChangeScale(),CCalc.isIn(t,[CTransform.CON_CHANGE_PERSPECTIVE,CTransform.CON_CHANGE_PERSPECTIVE_X,CTransform.CON_CHANGE_PERSPECTIVE_Y])&&this.doChangePerspectiveInfo()}doChangeRotationPoint(){this.useChangeEvent&&this.onChangeRotationPoint&&this.onChangeRotationPoint(this)}doChangeTranslate(){this.useChangeEvent&&null!=this.onChangeTranslate&&this.onChangeTranslate(this)}doChangeRotation(){this.useChangeEvent&&null!=this.onChangeRotation&&this.onChangeRotation(this)}doChangeScale(){this.useChangeEvent&&null!=this.onChangeScale&&this.onChangeScale(this)}doChangePerspectiveInfo(){this.useChangeEvent&&null!=this.onChangePerspectiveInfo&&this.onChangePerspectiveInfo(this)}setTransform(t){0==this.rotationPointZ?t.style.transformOrigin=100*this.rotationPointX+"% "+100*this.rotationPointY+"%":t.style.transformOrigin=100*this.rotationPointX+"% "+100*this.rotationPointY+"% "+100*this.rotationPointZ+"px",t.style.transform="translateX("+this._translateX+"px) translateY("+this._translateY+"px) translateZ("+this._translateZ+"px) scaleX("+this._scaleX+") scaleY("+this._scaleY+") scaleZ("+this._scaleZ+") rotateX("+this._rotateX+"deg) rotateY("+this._rotateY+"deg) rotateZ("+this._rotateZ+"deg)",t.style.perspective=this._perspective+"px",t.style.perspectiveOrigin=100*this._perspectiveX+"% "+100*this._perspectiveY+"%"}translatePoint(t,e,i){let s=new CPoint3D(this.translateX,this.translateY,this.translateZ),o=CPoint3D.getAngleToPoint3D(s,t,e,i);this.translateX=o.x,this.translateY=o.y,this.translateZ=o.z}}class CPosition extends CNotifyChangeKindObject{static get CON_CHANGE_ALIGN(){return"changeAlign"}static get CON_CHANGE_LEFT(){return"changeLeft"}static get CON_CHANGE_TOP(){return"changeTop"}static get CON_CHANGE_WIDTH(){return"changeWidth"}static get CON_CHANGE_HEIGHT(){return"changeHeight"}static get CON_CHANGE_MARGINS(){return"changeMargins"}static get CON_CHANGE_PADDING(){return"changePadding"}static get CON_CHANGE_ALIGN_INFO(){return"changeAlignInfo"}static get CON_CHANGE_PARENT_ALIGN_INFO(){return"changeParentAlignInfo"}constructor(){super(),this._align=EPositionAlign.NONE,this._left=0,this._top=0,this._width=0,this._height=0,this._margins=new CNotifyRect,this._padding=new CNotifyRect,this._alignInfo=new CPositionAlignInfo,this._parentAlignInfo=new CPositionParentAlignInfo;let t=this;this._margins.onChange=function(){t.doChange(CPosition.CON_CHANGE_MARGINS)},this._padding.onChange=function(){t.doChange(CPosition.CON_CHANGE_PADDING)},this._alignInfo.onChange=function(){t.doChange(CPosition.CON_CHANGE_ALIGN_INFO)},this._parentAlignInfo.onChange=function(){t.doChange(CPosition.CON_CHANGE_PARENT_ALIGN_INFO)}}get align(){return this._align}set align(t){this._align!=t&&(this._align=t,this.doChange(CPosition.CON_CHANGE_ALIGN))}get left(){return this._left}set left(t){this._left!=t&&(this._left=t,this.doChange(CPosition.CON_CHANGE_LEFT))}set leftNotNofity(t){this._left=t}get top(){return this._top}set top(t){this._top!=t&&(this._top=t,this.doChange(CPosition.CON_CHANGE_TOP))}set topNotNofity(t){this._top=t}get width(){return this._width}set width(t){this._width!=t&&(this._width=t,this.doChange(CPosition.CON_CHANGE_WIDTH))}set widthNotNofity(t){this._width=t}get height(){return this._height}set height(t){this._height!=t&&(this._height=t,this.doChange(CPosition.CON_CHANGE_HEIGHT))}set heightNotNofity(t){this._height=t}get right(){return this.left+this.width}get alignInfo(){return this._alignInfo}get parentAlignInfo(){return this._parentAlignInfo}get bottom(){return this.top+this.height}get leftTop(){return new CPoint(this.left,this.top)}get rightTop(){return new CPoint(this.right,this.top)}get leftBottom(){return new CPoint(this.left,this.bottom)}get rightBottom(){return new CPoint(this.right,this.bottom)}get margins(){return this._margins}get padding(){return this._padding}doToData(t){super.doToData(t),CDataClass.putData(t,"align",this.align,EPositionAlign.NONE),CDataClass.putData(t,"left",this.left,0),CDataClass.putData(t,"top",this.top,0),CDataClass.putData(t,"width",this.width,0),CDataClass.putData(t,"height",this.height,0),CDataClass.putData(t,"margins",this.margins.toData(),{},!0),CDataClass.putData(t,"padding",this.padding.toData(),{},!0),CDataClass.putData(t,"alignInfo",this.alignInfo.toData(),{},!0),CDataClass.putData(t,"parentAlignInfo",this.parentAlignInfo.toData(),{},!0)}doFromData(t){super.doFromData(t),this.align=CDataClass.getData(t,"align",EPositionAlign.NONE),this.left=CDataClass.getData(t,"left",0),this.top=CDataClass.getData(t,"top",0),this.width=CDataClass.getData(t,"width",0),this.height=CDataClass.getData(t,"height",0),this.margins.fromData(CDataClass.getData(t,"margins",{},!0)),this.padding.fromData(CDataClass.getData(t,"padding",{},!0)),this.alignInfo.fromData(CDataClass.getData(t,"alignInfo",{},!0)),this.parentAlignInfo.fromData(CDataClass.getData(t,"parentAlignInfo",{},!0))}doChange(t){t==CPosition.CON_CHANGE_ALIGN&&this.doChangeAlign(),t==CPosition.CON_CHANGE_ALIGN_INFO&&this.doChangeAlignInfo(),t==CPosition.CON_CHANGE_PARENT_ALIGN_INFO&&this.doChangeParentAlignInfo(),CCalc.isIn(t,[CPosition.CON_CHANGE_LEFT,CPosition.CON_CHANGE_TOP])&&this.doChangePosition(),CCalc.isIn(t,[CPosition.CON_CHANGE_WIDTH,CPosition.CON_CHANGE_HEIGHT])&&this.doChangeSize(),t==CPosition.CON_CHANGE_MARGINS&&this.doChangeMargins(),t==CPosition.CON_CHANGE_PADDING&&this.doChangePadding(),super.doChange(t)}doChangeAlign(){this.useChangeEvent&&null!=this.onChangeAlign&&this.onChangeAlign(this)}doChangeAlignInfo(){this.useChangeEvent&&null!=this.onChangeAlignInfo&&this.onChangeAlignInfo(this)}doChangeParentAlignInfo(){this.useChangeEvent&&null!=this.onChangeParentAlignInfo&&this.onChangeParentAlignInfo(this)}doChangePosition(){this.useChangeEvent&&null!=this.onChangePosition&&this.onChangePosition(this)}doChangeSize(){this.useChangeEvent&&null!=this.onChangeSize&&this.onChangeSize(this)}doChangeMargins(){this.useChangeEvent&&null!=this.onChangeMargins&&this.onChangeMargins(this)}doChangePadding(){this.useChangeEvent&&null!=this.onChangePadding&&this.onChangePadding(this)}isRelativeAlign(){return CCalc.isIn(this._align,[EPositionAlign.LEFT,EPositionAlign.TOP,EPositionAlign.RIGHT,EPositionAlign.BOTTOM,EPositionAlign.CLIENT,EPositionAlign.FLOW])}toRect(){return new CRect(this.left,this.top,this.left+this.width,this.top+this.height)}enumProperties(){let t=new Map;return t.set("align",CEnum.toArray(EPositionAlign)),t}equalRect(t){return this.left==t.left&&this.top==t.top&&this.width==t.width&&this.height==t.height}static getAlignPixelBounds(t,e,i){let s=new CPosition,o=i;if(i.align==EPositionAlign.NONE)return s.left=i.left,s.top=i.top,s.width=i.width,s.height=i.height,s;if(i.align==EPositionAlign.CENTER)return s.left=(t.width-i.width)/2,s.top=(t.height-i.height)/2,s.width=i.width,s.height=i.height,s;if(i.align==EPositionAlign.PARENT_SIZE)return s.left=0,s.top=0,s.width=t.width,s.height=t.height,s;if(i.align==EPositionAlign.LEFTTOP)return s.left=t.padding.left+o.margins.left,s.top=t.padding.top+o.margins.top,s.width=o.width,s.height=o.height,s;if(i.align==EPositionAlign.RIGHTTOP)return s.left=t.width-o.width-o.margins.right-t.padding.right,s.top=t.padding.top+o.margins.top,s.width=o.width,s.height=o.height,s;if(i.align==EPositionAlign.LEFTBOTTOM)return s.left=o.margins.left+t.padding.left,s.top=t.height-o.height-o.margins.bottom-t.padding.bottom,s.width=o.width,s.height=o.height,s;if(i.align==EPositionAlign.RIGHTBOTTOM)return s.left=t.width-o.width-o.margins.right-t.padding.right,s.top=t.height-o.height-o.margins.bottom-t.padding.bottom,s.width=o.width,s.height=o.height,s;if(i.align==EPositionAlign.MIDDLELEFT)return s.left=o.margins.left+t.padding.left,s.top=(t.height-o.height)/2,s.width=o.width,s.height=o.height,s;if(i.align==EPositionAlign.MIDDLETOP)return s.left=(t.width-o.width)/2,s.top=o.margins.top+t.padding.top,s.width=o.width,s.height=o.height,s;if(i.align==EPositionAlign.MIDDLERIGHT)return s.left=t.width-o.width-o.margins.right-t.padding.right,s.top=(t.height-o.height)/2,s.width=o.width,s.height=o.height,s;if(i.align==EPositionAlign.MIDDLEBOTTOM)return s.left=(t.width-o.width)/2,s.top=t.height-o.height-o.margins.bottom-t.padding.bottom,s.width=o.width,s.height=o.height,s;if(i.align==EPositionAlign.HCENTER)return s.left=(t.width-o.width)/2,s.top=o.margins.top+t.padding.top,s.height=t.height-o.margins.top-o.margins.bottom-t.padding.bottom,s.width=o.width,s;if(i.align==EPositionAlign.VCENTER)return s.left=o.margins.left+t.padding.left,s.top=(t.height-o.height)/2,s.width=t.width-o.margins.left-o.margins.right-t.padding.right,s.height=o.height,s;if(i.align==EPositionAlign.TURN){let a=t.width*t.parentAlignInfo.turnCenter.x,n=t.height*t.parentAlignInfo.turnCenter.y;if(t.parentAlignInfo.turnAutoSet){let r=-1,l=new Array;for(let t=0;t<e.length;t++)e[t].align==EPositionAlign.TURN&&l.push(e[t]);for(let t=0;t<l.length;t++)if(l[t]==i){r=t;break}if(-1!=r){let e=CCalc.crRange2Value(0,l.length-1,r,t.parentAlignInfo.turnAutoSetStartAngle,t.parentAlignInfo.turnAutoSetStopAngle),i=CPoint.getAngleToPoint(new CPoint(a,n),t.parentAlignInfo.turnAutoSetRadiusX,t.parentAlignInfo.turnAutoSetRadiusY,e);s.left=i.x-o.width/2,s.top=i.y-o.height/2}}else{let t=CPoint.getAngleToPoint(new CPoint(a,n),o.alignInfo.turnRadiusX,o.alignInfo.turnRadiusY,o.alignInfo.turnAngle);s.left=t.x-o.width/2,s.top=t.y-o.height/2}return s.width=o.width,s.height=o.height,s}if(i.align==EPositionAlign.PATHDATA)if(t.parentAlignInfo.pathDataAutoSet){let a=CSystem.resources.get(t.parentAlignInfo.pathData);if(null!=a){let n=-1,r=new Array;for(let t=0;t<e.length;t++)e[t].align==EPositionAlign.PATHDATA&&r.push(e[t]);for(let t=0;t<r.length;t++)if(r[t]==i){n=t;break}let l=CCalc.crRange2Value(0,r.length-1,n,t.parentAlignInfo.pathDataStartMiddleValue,t.parentAlignInfo.pathDataStopMiddleValue);if(!isNaN(l)){let e=Math.floor(CCalc.cr(a.points.length-1,0,1,l,2));if(t.parentAlignInfo.pathDataFitMode==EFitMode.FIT){let i=new CRect(0,0,t.width,t.height),n=new CRect(0,0,50,50);n=i.getFitRect(n,!0),s.left=a.points[e].x*n.width+n.left-o.width/2,s.top=a.points[e].y*n.height+n.top-o.height/2}else s.left=a.points[e].x*t.width-o.width/2,s.top=a.points[e].y*t.height-o.height/2;return s.width=o.width,s.height=o.height,s}}}else{let e=CSystem.resources.get(t.parentAlignInfo.pathData);if(null!=e){let i=o.alignInfo.pathMiddleValue;i>1&&(i=1);let a=Math.floor(CCalc.cr(e.points.length-1,0,1,i,2));if(t.parentAlignInfo.pathDataFitMode==EFitMode.FIT){let i=new CRect(0,0,t.width,t.height),o=new CRect(0,0,50,50);o=i.getFitRect(o,!0),s.left=e.points[a].points.x*o.width+o.left,s.top=e.points[a].y*o.height+o.top}else s.left=e.points[a].x*t.width,s.top=e.points[a].y*t.height;return s.width=o.width,s.height=o.height,s}}if(i.align==EPositionAlign.GRID){let e=t.parentAlignInfo.gridColumnCount,i=t.parentAlignInfo.gridRowCount;if(e<=0)return s;{let a=(t.width-(e-1)*t.parentAlignInfo.marginX-t.padding.left-t.padding.right)/e,n=0;return n=i<=0?o.alignInfo.gridRowHeight:(t.height-(i-1)*t.parentAlignInfo.marginY-t.padding.top-t.padding.bottom)/i,s.left=o.alignInfo.gridColumn*a+o.alignInfo.gridColumn*t.parentAlignInfo.marginX+t.padding.left,s.top=o.alignInfo.gridRow*n+o.alignInfo.gridRow*t.parentAlignInfo.marginY+t.padding.top,s.width=a,s.height=n,s}}let a=new Array,n=new Array,r=new Array,l=new Array,h=new Array,d=t.padding.left,g=t.padding.top,C=t.padding.right,c=t.padding.bottom,u=!0,p=!0,A=!0,m=!0,f=!0;for(let t=0;t<e.length;t++){if(e[t].align==EPositionAlign.LEFT&&u){if(e[t]==o){u=!1;continue}a.push(e[t]),d+=e[t].margins.left+e[t].width+e[t].margins.right}if(e[t].align==EPositionAlign.TOP&&p){if(e[t]==o){p=!1;continue}n.push(e[t]),g+=e[t].margins.top+e[t].height+e[t].margins.bottom}if(e[t].align==EPositionAlign.RIGHT&&A){if(e[t]==o){A=!1;continue}r.push(e[t]),C+=e[t].margins.left+e[t].width+e[t].margins.right}if(e[t].align==EPositionAlign.BOTTOM&&m){if(e[t]==o){m=!1;continue}l.push(e[t]),c+=e[t].margins.top+e[t].height+e[t].margins.bottom}if(e[t].align==EPositionAlign.FLOW&&f){if(e[t]==o){f=!1;continue}h.push(e[t])}}if(i.align==EPositionAlign.LEFT&&(s.left=d+o.margins.left,s.width=o.width,s.top=g+o.margins.top,s.height=t.height-c-g-o.margins.top-o.margins.bottom),i.align==EPositionAlign.TOP&&(s.left=t.padding.left+o.margins.left,s.top=g+o.margins.top,s.width=t.width-o.margins.left-o.margins.right-t.padding.left-t.padding.right,s.height=o.height),i.align==EPositionAlign.RIGHT&&(s.left=t.width-o.width-C-o.margins.right,s.top=g+o.margins.top,s.height=t.height-c-g-o.margins.top-o.margins.bottom,s.width=o.width),i.align==EPositionAlign.BOTTOM&&(s.left=t.padding.left+o.margins.left,s.top=t.height-o.height-c-o.margins.bottom,s.width=t.width-o.margins.left-o.margins.right-t.padding.left-t.padding.right,s.height=o.height),i.align==EPositionAlign.CLIENT&&(s.left=d+o.margins.left,s.top=g+o.margins.top,s.width=t.width-C-d-o.margins.left-o.margins.right,s.height=t.height-c-g-o.margins.top-o.margins.bottom),i.align==EPositionAlign.FLOW){let e=t.parentAlignInfo.marginX,i=t.parentAlignInfo.marginY,a=t.padding.left+e,n=a,r=t.padding.top+i,l=t.width,d=0;for(let t=0;t<h.length;t++)n+h[t].width>=l&&(n=a,r+=i+d,d=0),d<h[t].height&&(d=h[t].height),n+=h[t].width+e;n+o.width>=l&&(n=a,r+=i+d),s.left=n,s.top=r,s.width=o.width,s.height=o.height}return s}static getElementBounds(t){let e=new CPosition;return e.left=t.offsetLeft,e.top=t.offsetTop,e.width=t.offsetWidth,e.height=t.offsetHeight,e}}class CStopPropagationInfo extends CNotifyChangeKindObject{constructor(){super(...arguments),this._down=!1,this._move=!1,this._up=!1,this._cancel=!1,this._over=!1,this._out=!1,this._enter=!1,this._leave=!1,this._keyboard=!1,this._wheel=!1}static get CON_CHANGE_DOWN(){return"d"}static get CON_CHANGE_MOVE(){return"m"}static get CON_CHANGE_UP(){return"u"}static get CON_CHANGE_CANCEL(){return"c"}static get CON_CHANGE_OVER(){return"ov"}static get CON_CHANGE_OUT(){return"ou"}static get CON_CHANGE_ENTER(){return"e"}static get CON_CHANGE_LEAVE(){return"l"}static get CON_CHANGE_KEYBOARD(){return"k"}get down(){return this._down}set down(t){this._down!=t&&(this._down=t,this.doChange(CStopPropagationInfo.CON_CHANGE_DOWN))}get move(){return this._move}set move(t){this._move!=t&&(this._move=t,this.doChange(CStopPropagationInfo.CON_CHANGE_MOVE))}get up(){return this._up}set up(t){this._up!=t&&(this._up=t,this.doChange(CStopPropagationInfo.CON_CHANGE_UP))}get cancel(){return this._cancel}set cancel(t){this._cancel!=t&&(this._cancel=t,this.doChange(CStopPropagationInfo.CON_CHANGE_CANCEL))}get over(){return this._over}set over(t){this._over!=t&&(this._over=t,this.doChange(CStopPropagationInfo.CON_CHANGE_OVER))}get out(){return this._out}set out(t){this._out!=t&&(this._out=t,this.doChange(CStopPropagationInfo.CON_CHANGE_OUT))}get enter(){return this._enter}set enter(t){this._enter!=t&&(this._enter=t,this.doChange(CStopPropagationInfo.CON_CHANGE_ENTER))}get leave(){return this._leave}set leave(t){this._leave!=t&&(this._leave=t,this.doChange(CStopPropagationInfo.CON_CHANGE_LEAVE))}get keyboard(){return this._keyboard}set keyboard(t){this._keyboard!=t&&(this._keyboard=t,this.doChange(CStopPropagationInfo.CON_CHANGE_KEYBOARD))}get wheel(){return this._wheel}set wheel(t){this._wheel!=t&&(this._wheel=t,this.doChange("wheel"))}doToData(t){super.doToData(t),CDataClass.putData(t,"down",this.down,!1),CDataClass.putData(t,"move",this.move,!1),CDataClass.putData(t,"up",this.up,!1),CDataClass.putData(t,"cancel",this.cancel,!1),CDataClass.putData(t,"over",this.over,!1),CDataClass.putData(t,"out",this.out,!1),CDataClass.putData(t,"enter",this.enter,!1),CDataClass.putData(t,"leave",this.leave,!1),CDataClass.putData(t,"keyboard",this.keyboard,!1),CDataClass.putData(t,"wheel",this.wheel,!1)}doFromData(t){super.doFromData(t),this.down=CDataClass.getData(t,"down",!1),this.move=CDataClass.getData(t,"move",!1),this.up=CDataClass.getData(t,"up",!1),this.cancel=CDataClass.getData(t,"cancel",!1),this.over=CDataClass.getData(t,"over",!1),this.out=CDataClass.getData(t,"out",!1),this.enter=CDataClass.getData(t,"enter",!1),this.leave=CDataClass.getData(t,"leave",!1),this.keyboard=CDataClass.getData(t,"keyboard",!1),this.wheel=CDataClass.getData(t,"wheel",!1)}}class CFilterSet extends CNotifyChangeKindObject{constructor(){super(...arguments),this._blur=!1,this._brightness=!1,this._contrast=!1,this._shadow=!1,this._grayscale=!1,this._hueRotate=!1,this._invert=!1,this._opacity=!1}static get CON_CHANGE_BLUR(){return"changeBlur"}static get CON_CHANGE_BRIGHTNESS(){return"changeBrightness"}static get CON_CHANGE_CONTRAST(){return"changeContrast"}static get CON_CHANGE_SHADOW(){return"changeShadow"}static get CON_CHANGE_GRAYSCALE(){return"changeGrayscale"}static get CON_CHANGE_HUE_ROTATION(){return"changeHueRotaion"}static get CON_CHANGE_INVERT(){return"changeInvert"}static get CON_CHANGE_OPACITY(){return"changeOpacity"}get blur(){return this._blur}set blur(t){this._blur!=t&&(this._blur=t,this.doChange(CFilterSet.CON_CHANGE_BLUR))}get brightness(){return this._brightness}set brightness(t){this._brightness!=t&&(this._brightness=t,this.doChange(CFilterSet.CON_CHANGE_BRIGHTNESS))}get contrast(){return this._contrast}set contrast(t){this._contrast!=t&&(this._contrast=t,this.doChange(CFilterSet.CON_CHANGE_CONTRAST))}get shadow(){return this._shadow}set shadow(t){this._shadow!=t&&(this._shadow=t,this.doChange(CFilterSet.CON_CHANGE_SHADOW))}get grayscale(){return this._grayscale}set grayscale(t){this._grayscale!=t&&(this._grayscale=t,this.doChange(CFilterSet.CON_CHANGE_GRAYSCALE))}get hueRotate(){return this._hueRotate}set hueRotate(t){this._hueRotate!=t&&(this._hueRotate=t,this.doChange(CFilterSet.CON_CHANGE_HUE_ROTATION))}get invert(){return this._invert}set invert(t){this._invert!=t&&(this._invert=t,this.doChange(CFilterSet.CON_CHANGE_INVERT))}get opacity(){return this._opacity}set opacity(t){this._opacity!=t&&(this._opacity=t,this.doChange(CFilterSet.CON_CHANGE_OPACITY))}doToData(t){super.doToData(t),CDataClass.putData(t,"blur",this.blur,!1),CDataClass.putData(t,"brightness",this.brightness,!1),CDataClass.putData(t,"contrast",this.contrast,!1),CDataClass.putData(t,"shadow",this.shadow,!1),CDataClass.putData(t,"grayscale",this.grayscale,!1),CDataClass.putData(t,"hueRotate",this.hueRotate,!1),CDataClass.putData(t,"invert",this.invert,!1),CDataClass.putData(t,"opacity",this.opacity,!1)}doFromData(t){super.doFromData(t),this.blur=CDataClass.getData(t,"blur",!1),this.brightness=CDataClass.getData(t,"brightness",!1),this.contrast=CDataClass.getData(t,"contrast",!1),this.shadow=CDataClass.getData(t,"shadow",!1),this.grayscale=CDataClass.getData(t,"grayscale",!1),this.hueRotate=CDataClass.getData(t,"hueRotate",!1),this.invert=CDataClass.getData(t,"invert",!1),this.opacity=CDataClass.getData(t,"opacity",!1)}}class CFilter extends CNotifyChangeKindObject{static get CON_CHANGE_FILTER_SET(){return"changeFilterSet"}static get CON_CHANGE_BLUR_VALUE(){return"changeBlurValue"}static get CON_CHANGE_BRIGHTNESS_VALUE(){return"changeBrightnessValue"}static get CON_CHANGE_CONSTRAST_VALUE(){return"changeConstrastValue"}static get CON_CHANGE_SHADOW_X(){return"changeShadowX"}static get CON_CHANGE_SHADOW_Y(){return"changeShadowY"}static get CON_CHANGE_SHADOW_BLUR(){return"changeShadowBlur"}static get CON_CHANGE_SHADOW_COLOR(){return"changeShadowColor"}static get CON_CHANGE_GRAYSCALE_VALUE(){return"changeGrayscaleValue"}static get CON_CHANGE_HUE_ROTATE_VALUE(){return"changeHueRotateValue"}static get CON_CHANGE_INVERT_VALUE(){return"changeInvertValue"}static get CON_CHANGE_OPACITY_VALUE(){return"changeOpacityValue"}static get CON_CHANGE_CUSTOM(){return"changeCustom"}constructor(t){super(),this._filterSet=new CFilterSet,this._blurValue=5,this._brightnessValue=1,this._constrastValue=1,this._shadowX=5,this._shadowY=5,this._shadowBlur=5,this._shadowColor="rgba(0,0,0,1)",this._grayscaleValue=1,this._hueRotateValue=90,this._invertValue=1,this._opacityValue=1,this._customFilter="",this._element=t;let e=this;this._filterSet.onChange=function(){e.doChange(CFilter.CON_CHANGE_FILTER_SET)}}get element(){return this._element}get filterSet(){return this._filterSet}get blurValue(){return this._blurValue}set blurValue(t){this._blurValue!=t&&(this._blurValue=t,this.doChange(CFilter.CON_CHANGE_BLUR_VALUE))}get brightnessValue(){return this._brightnessValue}set brightnessValue(t){this._brightnessValue!=t&&(this._brightnessValue=t,this.doChange(CFilter.CON_CHANGE_BRIGHTNESS_VALUE))}get constrastValue(){return this._constrastValue}set constrastValue(t){this._constrastValue!=t&&(this._constrastValue=t,this.doChange(CFilter.CON_CHANGE_CONSTRAST_VALUE))}get shadowX(){return this._shadowX}set shadowX(t){this._shadowX!=t&&(this._shadowX=t,this.doChange(CFilter.CON_CHANGE_SHADOW_X))}get shadowY(){return this._shadowY}set shadowY(t){this._shadowY!=t&&(this._shadowY=t,this.doChange(CFilter.CON_CHANGE_SHADOW_Y))}get shadowBlur(){return this._shadowBlur}set shadowBlur(t){this._shadowBlur!=t&&(this._shadowBlur=t,this.doChange(CFilter.CON_CHANGE_SHADOW_BLUR))}get shadowColor(){return this._shadowColor}set shadowColor(t){this._shadowColor!=t&&(this._shadowColor=t,this.doChange(CFilter.CON_CHANGE_SHADOW_COLOR))}get grayscaleValue(){return this._grayscaleValue}set grayscaleValue(t){this._grayscaleValue!=t&&(this._grayscaleValue=t,this.doChange(CFilter.CON_CHANGE_GRAYSCALE_VALUE))}get hueRotateValue(){return this._hueRotateValue}set hueRotateValue(t){this._hueRotateValue!=t&&(this._hueRotateValue=t,this.doChange(CFilter.CON_CHANGE_HUE_ROTATE_VALUE))}get invertValue(){return this._invertValue}set invertValue(t){this._invertValue!=t&&(this._invertValue=t,this.doChange(CFilter.CON_CHANGE_INVERT_VALUE))}get opacityValue(){return this._opacityValue}set opacityValue(t){this._opacityValue!=t&&(this._opacityValue=t,this.doChange(CFilter.CON_CHANGE_OPACITY_VALUE))}get customFilter(){return this._customFilter}set customFilter(t){this._customFilter!=t&&(this._customFilter=t,this.doChange(CFilter.CON_CHANGE_CUSTOM))}getFilter(){let t="";return this._filterSet.blur&&(t+=" blur("+this._blurValue+"px)"),this._filterSet.brightness&&(t+=" brightness("+this._brightnessValue+")"),this._filterSet.contrast&&(t+=" contrast("+100*this._constrastValue+"%)"),this._filterSet.shadow&&(t+=" drop-shadow("+this._shadowX+"px "+this._shadowY+"px "+this._shadowBlur+"px "+this._shadowColor+")"),this._filterSet.grayscale&&(t+=" grayscale("+100*this._grayscaleValue+"%)"),this._filterSet.hueRotate&&(t+=" hue-rotate("+this._hueRotateValue+"deg)"),this._filterSet.invert&&(t+=" invert("+100*this._invertValue+"%)"),this._filterSet.opacity&&(t+=" invert("+100*this._opacityValue+"%)"),""!=this._customFilter&&(t+=" "+this.customFilter),t}doToData(t){super.doToData(t),CDataClass.putData(t,"filterSet",this.filterSet.toData(),{},!0),CDataClass.putData(t,"blurValue",this.blurValue,5),CDataClass.putData(t,"brightnessValue",this.brightnessValue,1),CDataClass.putData(t,"constrastValue",this.constrastValue,1),CDataClass.putData(t,"shadowX",this.shadowX,5),CDataClass.putData(t,"shadowY",this.shadowY,5),CDataClass.putData(t,"shadowBlur",this.shadowBlur,5),CDataClass.putData(t,"shadowColor",this.shadowColor,"rgba(0,0,0,1)"),CDataClass.putData(t,"grayscaleValue",this.grayscaleValue,1),CDataClass.putData(t,"hueRotateValue",this.hueRotateValue,90),CDataClass.putData(t,"invertValue",this.invertValue,1),CDataClass.putData(t,"opacityValue",this.opacityValue,1),CDataClass.putData(t,"customFilter",this.customFilter,"")}doFromData(t){super.doFromData(t),this.filterSet.fromData(CDataClass.getData(t,"filterSet",{},!0)),this.blurValue=CDataClass.getData(t,"blurValue",5),this.brightnessValue=CDataClass.getData(t,"brightnessValue",1),this.constrastValue=CDataClass.getData(t,"constrastValue",1),this.shadowX=CDataClass.getData(t,"shadowX",5),this.shadowY=CDataClass.getData(t,"shadowY",5),this.shadowBlur=CDataClass.getData(t,"shadowBlur",5),this.shadowColor=CDataClass.getData(t,"shadowColor","rgba(0,0,0,1)"),this.grayscaleValue=CDataClass.getData(t,"grayscaleValue",1),this.hueRotateValue=CDataClass.getData(t,"hueRotateValue",90),this.invertValue=CDataClass.getData(t,"invertValue",1),this.opacityValue=CDataClass.getData(t,"opacityValue",1),this.customFilter=CDataClass.getData(t,"customFilter","")}doChange(t){super.doChange(t),this.doApplyFilter()}doApplyFilter(){null!=this._element&&(this._element.style.filter=this.getFilter(),null!=this.onApplyFilter&&this.onApplyFilter(this))}allOff(){this.filterSet.blur=!1,this.filterSet.brightness=!1,this.filterSet.contrast=!1,this.filterSet.shadow=!1,this.filterSet.grayscale=!1,this.filterSet.hueRotate=!1,this.filterSet.invert=!1,this.filterSet.opacity=!1}}class CTransformerPoints extends CNotifyChangeNotifyObject{get leftTop(){return this._leftTop}get rightTop(){return this._rightTop}get leftBottom(){return this._leftBottom}get rightBottom(){return this._rightBottom}get leftC1(){return this._leftC1}get leftC2(){return this._leftC2}get topC1(){return this._topC1}get topC2(){return this._topC2}get rightC1(){return this._rightC1}get rightC2(){return this._rightC2}get bottomC1(){return this._bottomC1}get bottomC2(){return this._bottomC2}constructor(){super(),this._leftTop=new CNotifyPoint,this._rightTop=new CNotifyPoint,this._leftBottom=new CNotifyPoint,this._rightBottom=new CNotifyPoint,this._leftC1=new CNotifyPoint,this._leftC2=new CNotifyPoint,this._topC1=new CNotifyPoint,this._topC2=new CNotifyPoint,this._rightC1=new CNotifyPoint,this._rightC2=new CNotifyPoint,this._bottomC1=new CNotifyPoint,this._bottomC2=new CNotifyPoint;let t=this;this._leftTop.onChange=function(){t.doChange()},this._leftBottom.onChange=function(){t.doChange()},this._rightTop.onChange=function(){t.doChange()},this._rightBottom.onChange=function(){t.doChange()},this._leftC1.onChange=function(){t.doChange()},this._leftC2.onChange=function(){t.doChange()},this._topC1.onChange=function(){t.doChange()},this._topC2.onChange=function(){t.doChange()},this._rightC1.onChange=function(){t.doChange()},this._rightC2.onChange=function(){t.doChange()},this._bottomC1.onChange=function(){t.doChange()},this._bottomC2.onChange=function(){t.doChange()}}isEmpty(){return this._leftTop.isZero()&&this._leftBottom.isZero()&&this._rightBottom.isZero()&&this._rightTop.isZero()&&this._leftC1.isZero()&&this._leftC2.isZero()&&this._topC1.isZero()&&this._topC2.isZero()&&this._rightC1.isZero()&&this._rightC2.isZero()&&this._bottomC1.isZero()&&this._bottomC2.isZero()}getBounds(){let t=Number.MAX_VALUE,e=Number.MAX_VALUE,i=Number.MIN_VALUE,s=Number.MIN_VALUE;return this._leftTop.x<t&&(t=this._leftTop.x),this._leftBottom.x<t&&(t=this._leftBottom.x),this._rightTop.x<t&&(t=this._rightTop.x),this._rightBottom.x<t&&(t=this._rightBottom.x),this._leftC1.x<t&&(t=this._leftC1.x),this._leftC2.x<t&&(t=this._leftC2.x),this._topC1.x<t&&(t=this._topC1.x),this._topC2.x<t&&(t=this._topC2.x),this._rightC1.x<t&&(t=this._rightC1.x),this._rightC2.x<t&&(t=this._rightC2.x),this._bottomC1.x<t&&(t=this._bottomC1.x),this._bottomC2.x<t&&(t=this._bottomC2.x),this._leftTop.y<e&&(e=this._leftTop.y),this._leftBottom.y<e&&(e=this._leftBottom.y),this._rightTop.y<e&&(e=this._rightTop.y),this._rightBottom.y<e&&(e=this._rightBottom.y),this._leftC1.y<e&&(e=this._leftC1.y),this._leftC2.y<e&&(e=this._leftC2.y),this._topC1.y<e&&(e=this._topC1.y),this._topC2.y<e&&(e=this._topC2.y),this._rightC1.y<e&&(e=this._rightC1.y),this._rightC2.y<e&&(e=this._rightC2.y),this._bottomC1.y<e&&(e=this._rightC1.y),this._bottomC2.y<e&&(e=this._rightC2.y),this._leftTop.x>i&&(i=this._leftTop.x),this._leftBottom.x>i&&(i=this._leftBottom.x),this._rightTop.x>i&&(i=this._rightTop.x),this._rightBottom.x>i&&(i=this._rightBottom.x),this._leftC1.x>i&&(i=this._leftC1.x),this._leftC2.x>i&&(i=this._leftC2.x),this._topC1.x>i&&(i=this._topC1.x),this._topC2.x>i&&(i=this._topC2.x),this._rightC1.x>i&&(i=this._rightC1.x),this._rightC2.x>i&&(i=this._rightC2.x),this._bottomC1.x>i&&(i=this._rightC1.x),this._bottomC2.x>i&&(i=this._rightC2.x),this._leftTop.y>s&&(s=this._leftTop.y),this._leftBottom.y>s&&(s=this._leftBottom.y),this._rightTop.y>s&&(s=this._rightTop.y),this._rightBottom.y>s&&(s=this._rightBottom.y),this._leftC1.y>s&&(s=this._leftC1.y),this._leftC2.y>s&&(s=this._leftC2.y),this._topC1.y>s&&(s=this._topC1.y),this._topC2.y>s&&(s=this._topC2.y),this._rightC1.y>s&&(s=this._rightC1.y),this._rightC2.y>s&&(s=this._rightC2.y),this._bottomC1.y>s&&(s=this._rightC1.y),this._bottomC2.y>s&&(s=this._rightC2.y),t==Number.MAX_VALUE&&e==Number.MAX_VALUE&&i==Number.MIN_VALUE&&s==Number.MIN_VALUE?new CRect:new CRect(t,e,i,s)}}class CIndexedDB{constructor(t,e){this.onOpenError=new Array,this.onOpenSuccess=new Array,this.onOpenUpgradeNeeded=new Array,this.databaseName=t,e&&this.onOpenSuccess.push(e)}open(t,e,i){let s=this;return new Promise((function(o,a){let n=indexedDB.open(s.databaseName,t);n.onerror=function(t){for(let t=0;t<s.onOpenError.length;t++)s.onOpenError[t](s);t.target?a(new Error(t.target.error)):a(new Error("Open error"))},n.onsuccess=async function(t){s.db=t.target.result,i&&await i(s.db);for(let t=0;t<s.onOpenSuccess.length;t++)s.onOpenSuccess[t](s,s.db);o(s.db)},n.onupgradeneeded=function(t){if(e)try{e(t.target.result);for(let e=0;e<s.onOpenUpgradeNeeded.length;e++)s.onOpenUpgradeNeeded[e](s,t.target.result)}catch(t){a(new Error(CStringUtil.errorMessage(t)))}}}))}putObject(t,e,i){let s=this;return new Promise((function(o,a){try{if(s.db){let n;n=i||s.db.transaction([t],"readwrite");const r=n.objectStore(t).put(e);r.onsuccess=function(){o()},r.onerror=function(t){t.target?a(new Error(t.target.error)):a(new Error("Add object error"))}}else a(new Error("Invalid db"))}catch(t){a(new Error(CStringUtil.errorMessage(t)))}}))}getObject(t,e,i){let s=this;return new Promise((function(o,a){try{if(s.db){let n;n=i||s.db.transaction([t],"readonly");const r=n.objectStore(t).get(e);r.onsuccess=function(t){o(t.target.result)},r.onerror=function(t){t.target?a(new Error(t.target.error)):a(new Error("Get object error"))}}else a(new Error("Invalid db"))}catch(t){a(new Error(CStringUtil.errorMessage(t)))}}))}deleteObject(t,e,i){let s=this;return new Promise((function(o,a){try{if(s.db){let n;n=i||s.db.transaction([t],"readwrite");const r=n.objectStore(t).delete(e);r.onsuccess=function(t){o()},r.onerror=function(t){t.target?a(new Error(t.target.error)):a(new Error("Delete object error"))}}else a(new Error("Invalid db"))}catch(t){a(new Error(CStringUtil.errorMessage(t)))}}))}clearObject(t,e){let i=this;return new Promise((function(s,o){try{if(i.db){let a;a=e||i.db.transaction([t],"readonly");const n=a.objectStore(t).clear();n.onsuccess=function(t){s()},n.onerror=function(t){t.target?o(new Error(t.target.error)):o(new Error("Clear object error"))}}else o(new Error("Invalid db"))}catch(t){o(new Error(CStringUtil.errorMessage(t)))}}))}close(){this.db&&this.db.close()}loop(t,e){let i=this;return new Promise((function(s,o){if(i.db){const a=i.db.transaction([t],"readonly"),n=a.objectStore(t).openCursor();n.onsuccess=function(t){const i=t.target.result;if(i){const t=i.primaryKey,s=i.value;e(t,s,a),i.continue()}else s()},n.onerror=function(t){t.target?o(new Error(t.target.error)):o(new Error("Loop object error"))}}else o(new Error("Invalid db"))}))}loopKey(t,e){let i=this;return new Promise((function(s,o){if(i.db){const a=i.db.transaction([t],"readonly"),n=a.objectStore(t).openCursor();n.onsuccess=function(t){const i=t.target.result;if(i){const t=i.primaryKey;e(t,a),i.continue()}else s()},n.onerror=function(t){t.target?o(new Error(t.target.error)):o(new Error("Loop object error"))}}else o(new Error("Invalid db"))}))}transaction(t,e){return this.db?.transaction(t,e)}static async getSeq(t){return await CAsyncSerialExecutor.serialExec("systemseq",(async function(){return new Promise((async function(e,i){let s=null!=t?t:"",o=new CIndexedDB("seq");await o.open(1,(function(t){t.createObjectStore("data",{keyPath:"preFix"})}));let a=o.transaction("data","readwrite");try{let t=await o.getObject("data",s,a);t?(t.value++,await o.putObject("data",{preFix:s,value:t.value},a),e(s+t.value)):(await o.putObject("data",{preFix:s,value:1},a),e(s+"1"))}finally{a?.commit()}}))}))}static async deleteDatabase(t){return new Promise((function(e){let i=window.indexedDB.deleteDatabase(t);i.onerror=function(t){e(new Error("Database deletion failed."))},i.onsuccess=function(t){e()},i.onblocked=function(){e(new Error("Database deletion blocked"))}}))}}class CBrowserFile{constructor(){this.id="",this.directory="",this.fileFullName="",this.fileName="",this.fileType=EFileType.DIRECTORY,this.fileExt="",this.creationTime=0,this.modifyTime=0,this.accessTime=0,this.data="",this.size=0}static copyTo(t){let e=new CBrowserFile;if(e.directory=t.directory,e.fileFullName=t.fileFullName,e.fileName=t.fileName,e.fileExt=t.fileExt,e.fileType=t.fileType,e.creationTime=t.creationTime,e.modifyTime=t.modifyTime,e.accessTime=t.accessTime,t.data instanceof ArrayBuffer){e.data=new ArrayBuffer(t.data.byteLength);let i=new Uint8Array(e.data),s=new Uint8Array(t.data);for(let e=0;e<t.data.byteLength;e++)i[e]=s[e]}else e.data=t.data;return e.size=t.size,e}}class CBrowserFileStorage{constructor(t){this.onLoadComplete=new Array;let e=this;this.list=new CFileList(t,"files","disk"),this.list.onLoadComplete.push((async function(){e.doLoadComplete()}))}async doLoadComplete(){if(await this.list.addIndex("fileFullName"),await this.list.addIndex("directory"),await this.list.addIndex("fileExt"),0==this.list.length){let t=new CBrowserFile;t.fileFullName="/",t.fileType=EFileType.DIRECTORY,t.creationTime=(new Date).getTime(),t.modifyTime=(new Date).getTime(),await this.list.add(t)}for(let t=0;t<this.onLoadComplete.length;t++)this.onLoadComplete[t](this)}async doHasFile(t){return(await this.list.findIndexData({fileFullName:t})).length>0}async doGetFiles(t,e=!1,i=!1){let s=await this.getFile(t);if(null==s)throw new Error("Not exists directory : "+t);let o=new Array;if(i&&o.push(s),e){let a=this,n=new Array;async function r(t){if(null==await a.getFile(t))throw new Error("Not exists directory : "+t);let e=await a.getFiles(t);e.sort((function(t,e){let i=0;return t.fileType<e.fileType&&(i=1),t.fileType>e.fileType&&(i=-1),i}));for(let t=0;t<e.length;t++)n.push(e[t]),e[t].fileType==EFileType.DIRECTORY&&await r(e[t].fileFullName)}return await r(t),o.push(...n),o}{let l=await this.list.findIndexData({directory:t});CArrayUtil.orderBy(l,[{fieldName:"fileType",isAsc:!1},{fieldName:"fileName",isAsc:!0}]);for(let h=0;h<l.length;h++)l[h].fileType==EFileType.FILE&&(l[h].data=await this.doGetDataHandle(l[h].data));return o.push(...l),o}}async doSearchFileExt(t){return await this.list.findIndexData({fileExt:t})}async doRename(t,e){let i=await this.getFile(t);if(!i)throw new Error("Not exists file : "+t);{if(await this.getFile(e))throw new Error("Exists file : "+e);let s=this;async function o(t,e){await s.list.modifyStart();try{t.fileFullName=e,t.directory=CFileUtil.extractFilePath(e),t.fileExt=CFileUtil.extractFileExt(e),t.fileName=CFileUtil.extractFileName(e),t.fileType==EFileType.FILE&&(t.data=await s.doSetDataHandle(t.data)),t.modifyTime=(new Date).getTime(),t.accessTime=(new Date).getTime()}finally{await s.list.modifySave()}}if(i.fileType==EFileType.DIRECTORY){let a=await this.getFiles(t,!0);await o(i,e);for(let n=0;n<a.length;n++)await o(a[n],CStringUtil.replaceAll(a[n].fileFullName,t,e))}else await o(i,e)}}async doCreateDirectory(t){if(await this.hasFile(t))throw new Error("Exists file or directory : "+t);let e=new CBrowserFile;e.directory=CFileUtil.extractFilePath(t),e.fileFullName=t,e.fileName=CFileUtil.extractFileName(t),e.fileType=EFileType.DIRECTORY,e.fileExt="",e.creationTime=(new Date).getTime(),e.modifyTime=(new Date).getTime(),e.accessTime=0,e.data="",await this.list.add(e)}async doDeleteDirectory(t){let e=await this.getFile(t);if(!e)throw new Error("Not exists directory : "+t);{let i=await this.getFiles(t,!0);for(let t=0;t<i.length;t++)await this.list.delete(i[t].id);await this.list.delete(e.id)}}async doCopyDirectory(t,e,i){let s=await this.getFile(t);if(null==s||s.fileType==EFileType.FILE)throw new Error("Not exists directory : "+t);if(null==await this.getFile(e))throw new Error("Not exists parent directory : "+e);let o=CStringUtil.replaceAll(e+"/"+s.fileName,"//","/"),a=await this.getFiles(t,!0,!0);for(let e=0;e<a.length;e++){let s=CBrowserFile.copyTo(a[e]);s.fileType==EFileType.FILE&&(s.data=await this.doSetDataHandle(s.data)),s.fileFullName=CStringUtil.replaceAll(a[e].fileFullName,t,o),s.directory=CFileUtil.extractFilePath(s.fileFullName),s.creationTime=(new Date).getTime(),s.accessTime=(new Date).getTime(),await this.list.add(s),i&&await i(e+1,a.length)}}async doSetDataHandle(t){return t}async doGetDataHandle(t){return t}async doSaveFile(t,e){let i=await this.list.findIndexData({fileFullName:t});if(i.length>0){let s=i[0];if(s.fileType==EFileType.DIRECTORY)throw new Error("Exists directory : "+t);await this.list.modifyStart(),s.data=await this.doSetDataHandle(e),s.modifyTime=(new Date).getTime(),s.data instanceof ArrayBuffer?s.size=s.data.byteLength:s.size=CBufferUtil.stringToBuffer(s.data).length,await this.list.modifySave()}else{let i=new CBrowserFile;i.directory=CFileUtil.extractFilePath(t);let s=await this.getFile(i.directory);if(null==s||s.fileType!=EFileType.DIRECTORY)throw new Error("Not exists directory : "+i.directory);i.fileFullName=t,i.fileName=CFileUtil.extractFileName(t),i.fileType=EFileType.FILE,i.fileExt=CFileUtil.extractFileExt(t),i.creationTime=(new Date).getTime(),i.modifyTime=(new Date).getTime(),i.accessTime=0,i.data=await this.doSetDataHandle(e),i.data instanceof ArrayBuffer?i.size=i.data.byteLength:i.size=CBufferUtil.stringToBuffer(i.data).length,await this.list.add(i)}}async doGetFile(t){let e=await this.list.findIndexData({fileFullName:t});if(e.length>0){let t=e[0];return await this.list.modifyStart(),t.accessTime=(new Date).getTime(),await this.list.modifySave(),t.fileType==EFileType.FILE&&(t.data=await this.doGetDataHandle(t.data)),t}}async doDeleteFile(t){let e=await this.list.findIndexData({fileFullName:t});if(e.length>0){let i=e[0];if(i.fileType!=EFileType.FILE)throw new Error("Not exists file : "+t);await this.list.delete(i.id)}}async doCreateFile(t){if(await this.hasFile(t))throw new Error("Exists file or directory : "+t);await this.saveFile(t,"")}async doCopyFile(t,e){let i=await this.getFile(t);if(null==i||i.fileType!=EFileType.FILE)throw new Error("Not exists file : "+t);if(null!=await this.getFile(e))throw new Error("Exists file : "+e);let s=await this.getFile(CFileUtil.extractFilePath(e));if(null==s||s.fileType!=EFileType.DIRECTORY)throw new Error("Not exists directory : "+CFileUtil.extractFilePath(e));let o=CBrowserFile.copyTo(i);o.fileType==EFileType.FILE&&(o.data=await this.doSetDataHandle(o.data)),o.fileFullName=e,o.directory=CFileUtil.extractFilePath(o.fileFullName),o.creationTime=(new Date).getTime(),o.accessTime=(new Date).getTime(),await this.list.add(o)}async doCopyFiles(t,e,i){for(let e=0;e<t.length;e++)if(!await this.hasFile(t[e]))throw new Error("Not exists file : "+t[e]);let s=await this.getFile(e);if(null==s||s.fileType!=EFileType.DIRECTORY)throw new Error("Not exists parent directory : "+e);for(let s=0;s<t.length;s++){let o=await this.getFile(t[s]);o&&(o.fileType==EFileType.DIRECTORY&&await this.copyDirectory(t[s],e),o.fileType==EFileType.FILE&&await this.copyFile(t[s],CStringUtil.replaceAll(e+"/"+o.fileName,"//","/"))),i&&await i(s+1,t.length)}}async doDeleteFiles(t){for(let e=0;e<t.length;e++){let i=await this.getFile(t[e]);i&&(i.fileType==EFileType.DIRECTORY&&await this.deleteDirectory(t[e]),i.fileType==EFileType.FILE&&await this.deleteFile(t[e]))}}async hasFile(t){return await this.doHasFile(t)}async getFiles(t,e=!1,i=!1){return await this.doGetFiles(t,e,i)}async searchFileExt(t){return await this.doSearchFileExt(t)}async rename(t,e){return await this.doRename(t,e)}async createDirectory(t){await this.doCreateDirectory(t)}async deleteDirectory(t){await this.doDeleteDirectory(t)}async copyDirectory(t,e,i){await this.doCopyDirectory(t,e)}async saveFile(t,e){await this.doSaveFile(t,e)}async getFile(t){return await this.doGetFile(t)}async deleteFile(t){await this.doDeleteFile(t)}async createFile(t){await this.doCreateFile(t)}async copyFile(t,e){await this.doCopyFile(t,e)}async copyFiles(t,e,i){await this.doCopyFiles(t,e,i)}async deleteFiles(t){await this.doDeleteFiles(t)}async exists(t){return null!=await this.doGetFile(t)}}class CEncryptBrowserFileStorage extends CBrowserFileStorage{constructor(){super(...arguments),this.useEncryptCompress=!0,this.encryptToken=""}async doSetDataHandle(t){if(""!=this.encryptToken){if(t instanceof ArrayBuffer){if(this.useEncryptCompress){let e=new Uint8Array(t);return(await CBufferUtil.bufferCompressWithEncrypt(e,this.encryptToken,!0)).buffer.buffer}{let e=new Uint8Array(t);return(await CBufferUtil.bufferEncrypt(e,this.encryptToken,!0)).buffer.buffer}}return(await CBufferUtil.stringEncrypt(t,this.encryptToken,!1,this.useEncryptCompress)).base64}return t}async doGetDataHandle(t){if(""!=this.encryptToken){if(t instanceof ArrayBuffer){if(this.useEncryptCompress){let e=new Uint8Array(t);return(await CBufferUtil.bufferDecompressWithDecrypt(e,this.encryptToken)).buffer}{let e=new Uint8Array(t);return(await CBufferUtil.bufferDecrypt(e,this.encryptToken)).buffer}}return await CBufferUtil.stringDecrypt(t,this.encryptToken,void 0,void 0,this.useEncryptCompress)}return t}}class CAsmStream{constructor(t,e=0){this._position=0,this._mem=new Uint8Array(t.memory.buffer),this._view=new DataView(this._mem.buffer,0),this._startOffset=e,this._size=0}get position(){return this._position}set position(t){this._position=t}get view(){return this._view}get size(){return this._size}getRealPosition(){return this._startOffset+this._position}first(){this._position=0}putString(t){let e=(new TextEncoder).encode(t);this._view.setInt32(this.getRealPosition(),e.byteLength,!0);this._position;this._position+=4;for(let t=0;t<e.byteLength;t++)this._mem[this.getRealPosition()]=e[t],this._position++;this._size+=e.byteLength+4}getString(){let t=this._view.getInt32(this.getRealPosition(),!0);this._position+=4;let e=new Uint8Array(t);for(let i=0;i<t;i++)e[i]=this._mem[this.getRealPosition()],this._position++;return new TextDecoder("utf-8").decode(e)}putInt8(t){this._view.setInt8(this.getRealPosition(),t),this._position+=1,this._size+=1}getInt8(){let t=this._view.getInt8(this.getRealPosition());return this._position+=1,t}putInt16(t){this._view.setInt16(this.getRealPosition(),t,!0),this._position+=2,this._size+=2}getInt16(){let t=this._view.getInt16(this.getRealPosition(),!0);return this._position+=2,t}putInt32(t){this._view.setInt32(this.getRealPosition(),t,!0),this._position+=4,this._size+=4}getInt32(){let t=this._view.getInt32(this.getRealPosition(),!0);return this._position+=4,t}putNumber(t){this._view.setFloat64(this.getRealPosition(),t,!0),this._position+=8,this._size+=8}getNumber(){let t=this._view.getFloat64(this.getRealPosition(),!0);return this._position+=8,t}putUInt8(t){this._view.setUint8(this.getRealPosition(),t),this._position+=1,this._size+=1}getUInt8(){let t=this._view.getUint8(this.getRealPosition());return this._position+=1,t}putUInt16(t){this._view.setUint16(this.getRealPosition(),t,!0),this._position+=2,this._size+=2}getUInt16(){let t=this._view.getUint16(this.getRealPosition(),!0);return this._position+=2,t}putUInt32(t){this._view.setUint32(this.getRealPosition(),t,!0),this._position+=4,this._size+=4}getUInt32(){let t=this._view.getUint32(this.getRealPosition(),!0);return this._position+=4,t}}function loadAnimationAssembly(){let t=new CTimeChecker;t.startChecker(),console.log("Load assembly start");WebAssembly.instantiate(CByte.base64ToBuffer("AGFzbQEAAAAB4gEiYAJ/fwBgAX8Bf2ACf38Bf2ABfwBgA39/fwBgA39/fwF/YAAAYAJ/fABgAX8BfGACf3wBf2AEf39/fwF/YAV/f39/fwF/YAR/f39/AGABfAF/YAN/fHwBf2ACf38BfGADf39+AX9gAAF/YAN/fn8AYAJ+fwF/YAR/fn9/AGAHf35/fn9+fwF/YAJ8fwF/YAF8AXxgBXx8fHx8AXxgA39/fAF/YAV/f39/fABgBX9/f398AX9gB39/f39/f3wAYAN/fH8Bf2ACf3wBfGADf398AGAFf39/f38AYAZ/f39/f38AAhYCA2VudgVhYm9ydAAMA2FzbQJqcwADA/QB8gEAAAEBAQEDAAEAAwEBAQEEAwADAQEAAAAAAQEBAAAQBgEAAwMRBgEBAQIABAIBAAACBQQAAAAAAAAAAAABAQECAQEABwcAAAABAQAAAAEBAQEBAQEEAQECCwEICAEEEhMUAgAAAAAAAAAAARUFCRYLFwEBAQEAAAEBAAAAAAAADQEBAQgHAQEBAQcIAAsYAQEDAAAAAQABAAABAAAAAAAAAQAAAQAABgYBAgICDAABCA4BCgoEAgECAAUCBQUCAAMBAgICAgICAgAAGQkaAQ8BAg8bHAEJAR0ADgkeHwECIAohBAIHBgAAAAAAAAEKAgUCDQQFAXABAgIFBAEAmgEGtwEifwBBAAt/AEEBC38AQQILfwBBAwt/AEEEC38AQQULfwFBAAt/AUEAC38BQQALfwFBAAt/AUEAC38BQQALfwFBAAt/AUEAC38AQQALfwBBAQt/AEECC38BQQALfwFBAAt/AEEAC38AQQILfwFBAAt/AEEAC34BQgALfgFCAAt/AUEAC38BQQALfgFCAAt/AUEAC38AQX8LfwBB4NPiBAt/AEGs1OIEC38BQazU5AQLfwBBrNTkBAsHIQITZ2V0QmV6aWVyR3JhcGhWYWx1ZQDnAQZtZW1vcnkCAAgCqAEJCAEAQQELAeABDAE6Ct7WAfIBCQAgACABNgIECwkAIAAgATYCCAsRACAAIAAQAiAAIAAQAyAADwsHACAAKAIECw0AIAAQBUEDQX9zcQ8LCgAgABAFQQNxDwtQAQJ/IAAQkgEjCiEBIAEQBiECAkADQCACIAFHBEBBARogAhAHQQNGRQRAQQBB4K3iBEGgAUEQEAAACyACQRRqIAAQpwEgAhAGIQIMAQsLCwsTACAAIAAQBUEDQX9zcSABchACCwcAIAAoAggLEAAgACABIAAQBUEDcXIQAgtlAQJ/IAAQBiEBIAFBAEYEQEEBGiAAEApBAEYEfyAAIyFJBUEAC0UEQEEAQeCt4gRBgAFBEhAAAAsPCyAAEAohAkEBGiACRQRAQQBB4K3iBEGEAUEQEAAACyABIAIQAyACIAEQCwsHACAAKAIMCwcAIAAoAgALMgEBfyMeIQEgACABKAIASwRAQeCu4gRBoK/iBEEVQRwQAAALIAFBBGogAEEEbGoQDg8LIAEBfyAAEA0hASABQQJNBH9BAQUgARAPQSBxQQBHCw8LJQEBfyABEAohAyAAIAEgAnIQAiAAIAMQAyADIAAQCyABIAAQAwtBAQF/IAAjC0YEQCAAEAoiAUUEf0EAQeCt4gRBlAFBHhAAAAUgAQskCwsgABAMIAAjDCAAEBAEfyMNRQVBAgsQEQsqAQF/IABFBEAPCyAAQRRrIQJBABogAhAHIw1GBEAgAhASIwlBAWokCQsLKAEBfyMgIQECQANAIAEjIUkEQCABKAIAIAAQEyABQQRqIQEMAQsLCwsHACAAKAIACxAAQQQgABAVQQNBf3Nxag8LCQAgACABNgIACwkAIAAgATYCAAsJACAAIAE2AgQLCQAgACABNgIICwcAIAAoAgQLBwAgACgCCAsHACAAKAIAC4kDARZ/IAEQFSECQQEaIAJBAXFFBEBBAEHwr+IEQYwCQQ4QAAALIAJBA0F/c3EhA0EBGiADQQxPRQRAQQBB8K/iBEGOAkEOEAAACyADQYACSQRAQQAhBCADQQR2IQUFIAMiBkH8////AyIHIAYgB0kbIQhBHyAIZ2shBCAIIARBBGt2QQFBBHRzIQUgBEEIQQFrayEEC0EBGiAEQRdJBH8gBUEQSQVBAAtFBEBBAEHwr+IEQZwCQQ4QAAALIAEQGyEJIAEQHCEKIAkEQCAJIAoQGgsgCgRAIAogCRAZCyABAn8gACELIAQhDCAFIQ0gCyAMQQR0IA1qQQJ0aigCYAwAC0YEQAJAIAAhDiAEIQ8gBSEQIAohESAOIA9BBHQgEGpBAnRqIBE2AmALIApFBEACfyAAIRIgBCETIBIgE0ECdGooAgQMAAshFAJAIAAhFSAEIRYgFEEBIAV0QX9zcSIUIRcgFSAWQQJ0aiAXNgIECyAURQRAIAAgABAdQQEgBHRBf3NxEBcLCwsL7AQBG39BARogAUUEQEEAQfCv4gRByQFBDhAAAAsgARAVIQJBARogAkEBcUUEQEEAQfCv4gRBywFBDhAAAAsCfyABIQMgA0EEaiADEBVBA0F/c3FqDAALIQQgBBAVIQUgBUEBcQRAIAAgBBAeIAEgAkEEaiAFQQNBf3NxaiICEBgCfyABIQYgBkEEaiAGEBVBA0F/c3FqDAALIQQgBBAVIQULIAJBAnEEQAJ/IAEhByAHQQRrKAIADAALIQggCBAVIQlBARogCUEBcUUEQEEAQfCv4gRB3QFBEBAAAAsgACAIEB4gCCEBIAEgCUEEaiACQQNBf3NxaiICEBgLIAQgBUECchAYIAJBA0F/c3EhCkEBGiAKQQxPRQRAQQBB8K/iBEHpAUEOEAAAC0EBGiABQQRqIApqIARGRQRAQQBB8K/iBEHqAUEOEAAACyAEQQRrIAE2AgAgCkGAAkkEQEEAIQsgCkEEdiEMBSAKIg1B/P///wMiDiANIA5JGyEPQR8gD2drIQsgDyALQQRrdkEBQQR0cyEMIAtBCEEBa2shCwtBARogC0EXSQR/IAxBEEkFQQALRQRAQQBB8K/iBEH7AUEOEAAACwJ/IAAhECALIREgDCESIBAgEUEEdCASakECdGooAmAMAAshEyABQQAQGSABIBMQGiATBEAgEyABEBkLAkAgACEUIAshFSAMIRYgASEXIBQgFUEEdCAWakECdGogFzYCYAsgACAAEB1BASALdHIQFwJAIAAhGiALIRsCfyAAIRggCyEZIBggGUECdGooAgQMAAtBASAMdHIhHCAaIBtBAnRqIBw2AgQLC6QCAQl/IAKnIQNBARogAa0gAlhFBEBBAEHwr+IEQf4CQQ4QAAALIAFBBGpBD2pBD0F/c3FBBGshASADQQ9Bf3NxIQMCfyAAIQQgBCgCoAwMAAshBUEAIQYgBQRAQQEaIAEgBUEEak9FBEBBAEHwr+IEQYUDQRAQAAALIAFBEGsgBUYEQCABQRBrIQEgBRAVIQYFAQsFQQEaIAEgAEGkDGpPRQRAQQBB8K/iBEGSA0EFEAAACwsgAyABayEHIAdBBEEMakEEakkEQEEADwsgB0ECQQRsayEIIAEhCSAJIAhBAXIgBkECcXIQGCAJQQAQGSAJQQAQGiABQQRqIAhqIQUgBUEAQQJyEBgCQCAAIQogBSELIAogCzYCoAwLIAAgCRAfQQEPC/QBARB/QQAaIyFBD2pBD0F/c3EhAD8AIQEgAEGkDGpB//8DakH//wNBf3NxQRB2IQIgAiABSgR/IAIgAWtAAEEASAVBAAsEQAALIAAhAyADQQAQFwJAIAMhBEEAIQUgBCAFNgKgDAtBACEGA0AgBkEXSQRAAkAgAyEHIAYhCEEAIQkgByAIQQJ0aiAJNgIEC0EAIQoDQCAKQRBJBEACQCADIQsgBiEMIAohDUEAIQ4gCyAMQQR0IA1qQQJ0aiAONgJgCyAKQQFqIQoMAQsLIAZBAWohBgwBCwsgAEGkDGohD0EAGiADIA8/AKxCEIYQIBogAyQSC0ABAX8gAEEEayEBIABBAEcEfyAAQQ9xRQVBAAsEfyABEBVBAXFFBUEAC0UEQEEAQfCv4gRBsgRBAxAAAAsgAQ8LFgBBABogASABEBVBAXIQGCAAIAEQHwsbACAAIyFJBEAPCyMSRQRAECELIxIgABAiECMLKgAgACMhSQRAIABBABACIABBABADBSMGIAAQFmskBkEAGiAAQQRqECQLC8YCAQR/AkACQAJAAkAjCCEBIAFBAEYNACABQQFGDQEgAUECRg0CDAMLQQEkCEEAJAlBABAIIwwkCyMJQQFsDwsjDUUhAiMLEAYhAAJAA0AgACMMRwRAIAAkCyAAEAcgAkcEQCAAIAIQCUEAJAkgAEEUakEAEKcBIwlBAWwPCyAAEAYhAAwBCwsLQQAkCUEAEAgjCxAGIQAgACMMRgRAQQAQFCMLEAYhAAJAA0AgACMMRwRAIAAQByACRwRAIAAgAhAJIABBFGpBABCnAQsgABAGIQAMAQsLCyMRIQMjDCQRIAMkDCACJA0gAxAGJAtBAiQICyMJQQFsDwsjCyEAIAAjDEcEQCAAEAYkC0EBGiAAEAcjDUVGRQRAQQBB4K3iBEHlAUEUEAAACyAAECVBCg8LIwwjDBACIwwjDBADQQAkCAwAC0EADwtiAQF/QQAaQQAaQYAIQcgBbEHkAG4hAANAIAAQJmshACMIQQBGBEBBABojBq1ByAGtfkLkAICnQYAIaiQHQQAaDwsgAEEASg0AC0EAGiMGQYAIIwYjB2tBgAhJbGokB0EAGgsfACAAQQxNBH9BDAUgAEEEakEPakEPQX9zcUEEawsPCyUAIABB/P///wNLBEBBoK3iBEHwr+IEQc0DQR0QAAALIAAQKA8LIQAgAEH+////AUkEfyAAQQFBGyAAZ2t0akEBawUgAAsPC7wCARB/IAFBgAJJBEBBACECIAFBBHYhAwUgARAqIQRBBEEIbEEBayAEZ2shAiAEIAJBBGt2QQFBBHRzIQMgAkEIQQFrayECC0EBGiACQRdJBH8gA0EQSQVBAAtFBEBBAEHwr+IEQc4CQQ4QAAALAn8gACEFIAIhBiAFIAZBAnRqKAIEDAALQQBBf3MgA3RxIQdBACEIIAdFBEAgABAdQQBBf3MgAkEBanRxIQkgCUUEQEEAIQgFIAloIQICfyAAIQogAiELIAogC0ECdGooAgQMAAshB0EBGiAHRQRAQQBB8K/iBEHbAkESEAAACwJ/IAAhDCACIQ0gB2ghDiAMIA1BBHQgDmpBAnRqKAJgDAALIQgLBQJ/IAAhDyACIRAgB2ghESAPIBBBBHQgEWpBAnRqKAJgDAALIQgLIAgPC4cBAQd/QQAaIAFBgAJPBEAgARAqIQELPwAhAiABQQQgAkEQdEEEawJ/IAAhAyADKAKgDAwAC0d0aiEBIAFB//8DakH//wNBf3NxQRB2IQQgAiIFIAQiBiAFIAZKGyEHIAdAAEEASARAIARAAEEASARAAAsLPwAhCCAAIAJBEHQgCKxCEIYQIBoLsgEBBX8gARAVIQNBARogAkEEakEPcUVFBEBBAEHwr+IEQekCQQ4QAAALIANBA0F/c3EgAmshBCAEQQRBDGpPBEAgASACIANBAnFyEBggAUEEaiACaiEFIAUgBEEEa0EBchAYIAAgBRAfBSABIANBAUF/c3EQGAJ/IAEhByAHQQRqIAcQFUEDQX9zcWoMAAsCfyABIQYgBkEEaiAGEBVBA0F/c3FqDAALEBVBAkF/c3EQGAsLdQECfyABECkhAiAAIAIQKyEDIANFBEAgACACECwgACACECshA0EBGiADRQRAQQBB8K/iBEHzA0EQEAAACwtBARogAxAVQQNBf3NxIAJPRQRAQQBB8K/iBEH1A0EOEAAACyAAIAMQHiAAIAMgAhAtQQAaIAMPCxQAIxJFBEAQIQsjEiAAEC5BBGoPCwkAIAAgATYCDAsJACAAIAE2AhALaAECfyAAQez///8DTwRAQaCt4gRB4K3iBEGFAkEfEAAACyMGIwdPBEAQJwtBECAAahAvQQRrIQIgAiABEDAgAiAAEDEgAiMRIw0QESMGIAIQFmokBiACQRRqIQMgA0EAIAD8CwAgAw8LHgEBfyAAIAEQMiEDIAIEQCADIAIgAPwKAAALIAMPC3ABA38gAUUEQA8LQQEaIABFBEBBAEHgreIEQacCQQ4QAAALIAFBFGshAyADEAcjDUYEQCAAQRRrIQQgBBAHIQUgBSMNRUYEQCACBEAgBBASBSADEBILBSAFQQNGBH8jCEEBRgVBAAsEQCADEBILCwsLEQAgACABNgIAIAAgAUEAEDQLEQAgACABNgIEIAAgAUEAEDQLCQAgACABNgIACwkAIAAgATYCBAsJACAAIAE2AggLEQAgACABNgIAIAAgAUEAEDQLCQAgACABNgIECwkAIAAgATYCCAsJACAAIAE2AgwLBwAgACgCCAsHACAAKAIACwcAIAAoAhALTAEEfyAAQRRrIQIgASACEBVBA0F/c3FBEGtNBEAgAiABEDEgAA8LIAEgAhANEDIhAyADIAAgASIEIAIQQCIFIAQgBUkb/AoAACADDwsHACAAKAIACwcAIAAoAgQLEQAgACABNgIAIAAgAUEAEDQLCQAgACABOQMACwkAIAAgATkDCAsRACAAIAE2AgQgACABQQAQNAsRACAAIAE2AgggACABQQAQNAsRACAAIAE2AgwgACABQQAQNAsHACAAKAIQCwoAIABBFGsQSg8LEQAgACABNgIAIAAgAUEAEDQLCQAgACABNgIECwkAIAAgATYCCAsHACAAKAIICwcAIAAoAgQLBwAgACgCBAsHACAAKAIICwcAIAAoAgwLBwAgACgCDAsHACAAKAIECxoAIAAgAUECdGogAjYCAEEBGiAAIAJBARA0Cw0AIABBFGsQSkECdg8LDQAgAEEUaxBKQQF2DwuvAQEEfyAAIQIgAiAAQRRrEEpqIQMgAUEARyEEAkADQCACIANJBEAgAi8BACEFIAVBgAFJBEAgASAFRXEEQAwECyAEQQFqIQQFIAVBgBBJBEAgBEECaiEEBSAFQYD4A3FBgLADRgR/IAJBAmogA0kFQQALBEAgAi8BAkGA+ANxQYC4A0YEQCAEQQRqIQQgAkEEaiECDAULCyAEQQNqIQQLCyACQQJqIQIMAQsLCyAEDwu8AwEOfyAAIAFBAXRqIQUgAiEGAkADQCAAIAVJBEAgAC8BACEHIAdBgAFJBEAgBiAHOgAAIAZBAWohBiADIAdFcQRAIAYgAmsPCwUgB0GAEEkEQCAHQQZ2QcABciEIIAdBP3FBgAFyIQkgBiAJQQh0IAhyOwEAIAZBAmohBgUgB0GA8ANxQYCwA0YEQCAHQYC4A0kEfyAAQQJqIAVJBUEACwRAIAAvAQIhCiAKQYD4A3FBgLgDRgRAQYCABCAHQf8HcUEKdGogCkH/B3FyIQcgB0ESdkHwAXIhCyAHQQx2QT9xQYABciEMIAdBBnZBP3FBgAFyIQ0gB0E/cUGAAXIhDiAGIA5BGHQgDUEQdHIgDEEIdHIgC3I2AgAgBkEEaiEGIABBBGohAAwGCwsgBEEARwRAIARBAkYEQEGAteIEQfCy4gRB5gVBMRAAAAtB/f8DIQcLCyAHQQx2QeABciEPIAdBBnZBP3FBgAFyIRAgB0E/cUGAAXIhESAGIBBBCHQgD3I7AQAgBiAROgACIAZBA2ohBgsLIABBAmohAAwBCwsLIAMEQCAGIhJBAWohBiASQQA6AAALIAYgAmsPCwcAIAAoAggLBwAgACsDAAsHACAAKwMIC2IAIABBoI0GSQRAIABB5ABJBEBBASAAQQpPag8FQQMgAEGQzgBPaiAAQegHT2oPCwAFIABBgK3iBEkEQEEGIABBwIQ9T2oPBUEIIABBgJTr3ANPaiAAQYDC1y9Pag8LAAsAC4ECAgl/An4CQANAIAFBkM4ATwRAIAFBkM4AbiEDIAFBkM4AcCEEIAMhASAEQeQAbiEFIARB5ABwIQZBvLjiBCAFQQJ0ajUCACEMQby44gQgBkECdGo1AgAhDSACQQRrIQIgACACQQF0aiAMIA1CIIaENwMADAELCwsgAUHkAE8EQCABQeQAbiEHIAFB5ABwIQggByEBIAJBAmshAkG8uOIEIAhBAnRqKAIAIQkgACACQQF0aiAJNgIACyABQQpPBEAgAkECayECQby44gQgAUECdGooAgAhCiAAIAJBAXRqIAo2AgAFIAJBAWshAkEwIAFqIQsgACACQQF0aiALOwEACwtaAAJAA0AgAkECTwRAIAJBAmshAiAAIAJBAXRqQeC74gQgAadB/wFxQQJ0aigCADYCACABQgiIIQEMAQsLCyACQQFxBEAgAEHgu+IEIAGnQQZ0ai8BADsBAAsLgAECAn8CfgJ/IAEhAiACaUEBRgwACwRAQT8gAHmna0EfIAFna25BAWoPCyABrCEEIAQhBUEBIQMCQANAIAAgBVoEQCAAIAWAIQAgBSAFfiEFIANBAXQhAwwBCwsLAkADQCAAQgFaBEAgACAEgCEAIANBAWohAwwBCwsLIANBAWsPC5kBAQR+IAOsIQQgAyADQQFrcUEARgRAIANoQQdxrCEFIARCAX0hBgNAIAJBAWshAiAAIAJBAXRqQYDE4gQgASAGg6dBAXRqLwEAOwEAIAEgBYghASABQgBSDQALBQNAIAJBAWshAiABIASAIQcgACACQQF0akGAxOIEIAEgByAEfn2nQQF0ai8BADsBACAHIQEgAUIAUg0ACwsLCgAgACABEPIBDwsRACAAIAE2AgAgACABQQAQNAsJACAAIAE2AgQLCQAgACABNgIICwkAIAAgATYCDAsRACAAIAE2AgAgACABQQAQNAsJACAAIAE2AgQLCQAgACABNgIICwkAIAAgATYCDAsHACAAKAIAC+oGAhB/Dn5BACAEayEHQgEgB6yGIRcgF0IBfSEYIAMgAX0hGSADIAesiKchCCADIBiDIRogCBBeIQkgBiEKAkADQCAJQQBKBEACQAJAAkACQAJAAkACQAJAAkACQAJAAkAgCSEMIAxBCkYNACAMQQlGDQEgDEEIRg0CIAxBB0YNAyAMQQZGDQQgDEEFRg0FIAxBBEYNBiAMQQNGDQcgDEECRg0IIAxBAUYNCQwKCyAIQYCU69wDbiELIAhBgJTr3ANwIQgMCgsgCEGAwtcvbiELIAhBgMLXL3AhCAwJCyAIQYCt4gRuIQsgCEGAreIEcCEIDAgLIAhBwIQ9biELIAhBwIQ9cCEIDAcLIAhBoI0GbiELIAhBoI0GcCEIDAYLIAhBkM4AbiELIAhBkM4AcCEIDAULIAhB6AduIQsgCEHoB3AhCAwECyAIQeQAbiELIAhB5ABwIQgMAwsgCEEKbiELIAhBCnAhCAwCCyAIIQtBACEIDAELQQAhCwwACyALIApyBEAgACAKIg1BAWohCiANQQF0akEwIAtB//8DcWo7AQALIAlBAWshCSAIrSAHrIYgGnwhGyAbIAVYBEAjGiAJaiQaAkAgACEOIAohDyAFIRwgGyEdQeDN4gQgCUECdGo1AgAgB6yGIR4gGSEfIA4gD0EBa0EBdGohECAQLwEAIRECQANAIB0gH1QEfyAcIB19IB5aBUEACwR/IB0gHnwgH1QEf0EBBSAfIB19IB0gHnwgH31WCwVBAAsEQCARQQFrIREgHSAefCEdDAELCwsgECAROwEACyAKDwsMAQsLCwJAA0BBAQRAIBpCCn4hGiAFQgp+IQUgGiAHrIghICAgIAqshEIAUgRAIAAgCiISQQFqIQogEkEBdGpBMCAgp0H//wNxajsBAAsgGiAYgyEaIAlBAWshCSAaIAVUBEAjGiAJaiQaIBlB4M3iBEEAIAlrQQJ0ajUCAH4hGQJAIAAhEyAKIRQgBSEhIBohIiAXISMgGSEkIBMgFEEBa0EBdGohFSAVLwEAIRYCQANAICIgJFQEfyAhICJ9ICNaBUEACwR/ICIgI3wgJFQEf0EBBSAkICJ9ICIgI3wgJH1WCwVBAAsEQCAWQQFrIRYgIiAjfCEiDAELCwsgFSAWOwEACyAKDwsMAQsLAAsAC7EEARR/IAJFBEAgACABQQF0akEuQTBBEHRyNgIAIAFBAmoPCyABIAJqIQMgASADTAR/IANBFUwFQQALBEAgASEEA0AgBCADSARAIAAgBEEBdGpBMDsBACAEQQFqIQQMAQsLIAAgA0EBdGpBLkEwQRB0cjYCACADQQJqDwUgA0EASgR/IANBFUwFQQALBEAgACADQQF0aiEFIAVBAmogBUEAIAJrQQF0/AoAACAAIANBAXRqQS47AQAgAUEBag8FQXogA0gEfyADQQBMBUEACwRAQQIgA2shBiAAIAZBAXRqIAAgAUEBdPwKAAAgAEEwQS5BEHRyNgIAQQIhBwNAIAcgBkgEQCAAIAdBAXRqQTA7AQAgB0EBaiEHDAELCyABIAZqDwUgAUEBRgRAIABB5QA7AQICfyAAQQRqIQggA0EBayEJIAlBAEghCiAKBEBBACAJayEJCyAJEF5BAWohCwJAIAghDCAJIQ0gCyEOQQBBAU4aIAwgDSAOEF8LIAhBLUErIAobOwEAIAsMAAshASABQQJqDwUgAUEBdCEPIABBBGogAEECaiAPQQJr/AoAACAAQS47AQIgACAPakHlADsBAiABAn8gACAPakEEaiEQIANBAWshESARQQBIIRIgEgRAQQAgEWshEQsgERBeQQFqIRMCQCAQIRQgESEVIBMhFkEAQQFOGiAUIBUgFhBfCyAQQS1BKyASGzsBACATDAALaiEBIAFBAmoPCwALAAsACwALvgYDFH8CfCV+IAFEAAAAAAAAAABjIQIgAgRAIAGaIQEgAEEtOwEACwJ/IAEhFiAAIQMgAiEEIBa9IRggGEKAgICAgICA+P8Ag0I0iKchBSAYQv////////8HgyEZIAVBAEetQjSGIBl8IRogBUEBIAUbQf8HQTRqayEFAkAgGiEbIAUhBiAbQgGGQgF8IRwgBkEBayEHIBx5pyEIIBwgCKyGIRwgByAIayEHQQEgG0KAgICAgICACFFqIQkgHCQXIBsgCayGQgF9IAYgCWsgB2ushiQYIAckGQsCQCMZIQpBQyAKa7dE/nmfUBNE0z+iRAAAAAAAsHVAoCEXIBf8AiELIAsgC7cgF2JqIQsgC0EDdUEBaiEMQdwCIAxBA3RrJBpB+MbiBCAMQQN0aikDACQbQbDM4gQgDEEBdGouAQAkHAsgGnmnIQ0gGiANrIYhGiAFIA1rIQUjGyEdIxwhDgJ+IBohHiAdIR8gHkL/////D4MhICAfQv////8PgyEhIB5CIIghIiAfQiCIISMgICAhfiEkICIgIX4gJEIgiHwhJSAgICN+ICVC/////w+DfCEmICZC/////wd8ISYgJUIgiCElICZCIIghJiAiICN+ICV8ICZ8DAALIScCfyAFIQ8gDiEQIA8gEGpBwABqDAALIRECfiMXISggHSEpIChC/////w+DISogKUL/////D4MhKyAoQiCIISwgKUIgiCEtICogK34hLiAsICt+IC5CIIh8IS8gKiAtfiAvQv////8Pg3whMCAwQv////8HfCEwIC9CIIghLyAwQiCIITAgLCAtfiAvfCAwfAwAC0IBfSExAn8jGSESIA4hEyASIBNqQcAAagwACyEUAn4jGCEyIB0hMyAyQv////8PgyE0IDNC/////w+DITUgMkIgiCE2IDNCIIghNyA0IDV+ITggNiA1fiA4QiCIfCE5IDQgN34gOUL/////D4N8ITogOkL/////B3whOiA5QiCIITkgOkIgiCE6IDYgN34gOXwgOnwMAAtCAXwhOyAxIDt9ITwgAyAnIBEgMSAUIDwgBBBtDAALIRUgACACQQF0aiAVIAJrIxoQbiEVIBUgAmoPCwgAIAAQ8wEPC60BAQV/IAAgAUEBdGohBSACIANBAXRqIQZBAEECSBogBEEETwR/IAVBB3EgBkEHcXJFBUEACwRAAkADQCAFKQMAIAYpAwBSBEAMAgsgBUEIaiEFIAZBCGohBiAEQQRrIQQgBEEETw0ACwsLAkADQCAEIgdBAWshBCAHBEAgBS8BACEIIAYvAQAhCSAIIAlHBEAgCCAJaw8LIAVBAmohBSAGQQJqIQYMAQsLC0EADwsuAQF8QQBBAEoaIACbIQEgASABRAAAAAAAAPA/oSABRAAAAAAAAOA/oSAAZRsPCwcAIAAoAgwLBwAgACgCBAsHACAAKAIMCwcAIAAoAgQLEQAgACABNgIAIAAgAUEAEDQLEQAgACABNgIEIAAgAUEAEDQLBwAgACgCAAsHACAAKAIECxEAIAAgATYCACAAIAFBABA0CwkAIAAgATYCBAsRACAAIAE2AgggACABQQAQNAsJACAAIAE2AgwLCQAgACABNgIQCwkAIAAgATYCFAunAQIBfgF/QQAaQQAaQQEaQQhBBEYaQQhBCEYaAn8gAL0hAUEAQbHP2bIBakEIaiECIAIgAadBvdzKlXxsaiECIAJBEXdBr9bTvgJsIQIgAiABQiCIp0G93MqVfGxqIQIgAkERd0Gv1tO+AmwhAiACIAJBD3ZzIQIgAkH3lK+veGwhAiACIAJBDXZzIQIgAkG93MqVfGwhAiACIAJBEHZzIQIgAgwACw8LBwAgACgCAAsHACAAKAIECwcAIAAoAhALBwAgACsDAAsJACAAIAE5AwgLBwAgACgCEAsHACAAKAIMCwcAIAAoAhQLBwAgACgCCAsJACAAIAE5AwALBwAgACsDCAsJACAAIAE2AhALSgIDfgN/IAEgAGtBAWqtIQUgAyAAQQF0ayEIIAIgCGohCSAEIAhqQQFqIQogCa1CHoYgBYAhBiAKrUIehiAFgCEHIAYgB4WnZw8LHQEBfCACIAChIAEgAKGjIQUgBCADoSAFoiADoA8LBwAgACgCAAsHACAAKAIEC0wBAX9B4K7iBCAAEBNB8LDiBCAAEBNBwLXiBCAAEBNBsNDiBCAAEBNBoK3iBCAAEBNBgLXiBCAAEBNB4LviBCAAEBNBgMTiBCAAEBMLGwEBfyAAIAEQlAEgACgCACICBEAgAiABEBMLCwMAAQsrAQF/IAAgARCUASAAKAIAIgIEQCACIAEQEwsgACgCBCICBEAgAiABEBMLCwcAIAAoAgALEAAgACABEJQBIAAgARDoAQsHACAAKAIACxAAIAAgARCUASAAIAEQ6QELCQAgACABEJwBCwcAIAAoAgALEAAgACABEJQBIAAgARDqAQtLAQF/IAAgARCUASAAKAIAIgIEQCACIAEQEwsgACgCBCICBEAgAiABEBMLIAAoAggiAgRAIAIgARATCyAAKAIMIgIEQCACIAEQEwsLGwEBfyAAIAEQlAEgACgCACICBEAgAiABEBMLC0ABA39BARogACECIAIgAEEUaxBKaiEDAkADQCACIANJBEAgAigCACEEIAQEQCAEIAEQEwsgAkEEaiECDAELCwsLEAAgACABEJQBIAAgARCfAQsrAQF/IAAgARCUASAAKAIAIgIEQCACIAEQEwsgACgCBCICBEAgAiABEBMLCwcAIAAoAgALEAAgACABEJQBIAAgARDrAQsQACAAIAEQlAEgACABEOwBCwcAIAAoAgQLEAAgACABEJQBIAAgARDtAQvGAQACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQAJAAkACQCAAQQhrKAIADhIAAQIDBAUGBwgJCgsMDQ4PEBESCw8LDwsPCyAAIAEQkwEPCyAAIAEQlQEPCyAAIAEQlwEPCyAAIAEQmQEPCw8LIAAgARCaAQ8LIAAgARCdAQ8LDwsgACABEJwBDwsgACABEJ4BDwsgACABEKABDwsgACABEKEBDwsgACABEKMBDwsgACABEKQBDwsgACABEKYBDwsACyoAPwBBEHQjIWtBAXYkB0GQruIEEAQkCkGwruIEEAQkDEHAr+IEEAQkEQsbACMgIx9IBEBBwNTkBEHw1OQEQQFBARAAAAsLowEBBX8jIEEMayQgEKkBIyBCADcDACMgQQA2AgggAEUEQCMgQQhBBBAyIgA2AgALIyAgACEFIyAgBTYCBCAFEO4BIgA2AgAgACEFIyAgBTYCBCAFQQBBA0EFQbCw4gQQ7wEhBSMgIAU2AgggBRA1IAAhBSMgIAU2AgQgBUEAQQNBBUHQsOIEEO8BIQUjICAFNgIIIAUQNiAAIQUjIEEMaiQgIAULmwEBAX8jIEEIayQgEKkBIyBCADcDACAARQRAIyBBDEEHEDIiADYCAAsgACECIyAgAjYCBCACQQAQNyAAIQIjICACNgIEIAJBABA4IAAhAiMgIAI2AgQgAkEAEDkgACECIyAgAjYCBCACIAEQNyAAIQIjICACNgIEIAJBABA4IAAhAiMgIAI2AgQgAkEAEDkgACECIyBBCGokICACC5YCAQV/IyBBEGskIBCpASMgQgA3AwAjIEIANwMIIABFBEAjIEEQQQsQMiIANgIACyAAIQYjICAGNgIEIAZBABA6IAAhBiMgIAY2AgQgBkEAEDsgACEGIyAgBjYCBCAGQQAQPCAAIQYjICAGNgIEIAZBABA9IAFB/P///wNBAnZLBEBB8LDiBEGgseIEQcYAQTwQAAALIAEiAkEIIgMgAiADSxtBAnQhBCMgIARBARAyIgU2AghBAiMQRxogACEGIyAgBjYCBCAGIAUhBiMgIAY2AgwgBhA6IAAhBiMgIAY2AgQgBiAFEDsgACEGIyAgBjYCBCAGIAQQPCAAIQYjICAGNgIEIAYgARA9IAAhBiMgQRBqJCAgBgtOAQF/IyBBCGskIBCpASMgQgA3AwAgAEUEQCMgQRBBCBAyIgA2AgALIyAgACECIyAgAjYCBCACIAEQrAEiADYCACAAIQIjIEEIaiQgIAIL1wEBC38jIEEEayQgEKkBIyBBADYCACAAIQ4jICAONgIAIA4QPiEEIAEgBCACdksEQCABQfz///8DIAJ2SwRAQfCw4gRBoLHiBEETQTAQAAALIAAhDiMgIA42AgAgDhA/IQUgASIGQQgiByAGIAdLGyACdCEIIAMEQCAEQQF0IglB/P///wMiCiAJIApJGyILIAgiDCALIAxLGyEICyAFIAgQQSENQQIjEEcaIA0gBUcEQCAAIA02AgAgACANNgIEIAAgDUEAEDQLIAAgCDYCCAsjIEEEaiQgCzgBAX8jIEEEayQgEKkBIyBBADYCACAAIAFBAkEAEK4BIAAhAiMgIAI2AgAgAiABED0jIEEEaiQgC0ABAX8jIEEEayQgEKkBIyBBADYCACAAIQEjICABNgIAIAEQQiAAIQEjICABNgIAIAEQQ2ohASMgQQRqJCAgAQ8LWwICfAF/IyBBCGskIBCpASMgQgA3AwAgACEDIyAgAzYCACADELABKwMAIQEgACEDIyAgAzYCACADIAAhAyMgIAM2AgQgAxBDQQhqEDggASECIyBBCGokICACDwuHAQEBfyMgQQhrJCAQqQEjIEIANwMAIABFBEAjIEEQQQoQMiIANgIACyAAIQMjICADNgIEIANEAAAAAAAAAAAQRSAAIQMjICADNgIEIANEAAAAAAAAAAAQRiAAIQMjICADNgIEIAMgARBFIAAhAyMgIAM2AgQgAyACEEYgACEDIyBBCGokICADC4UCAQF/IyBBDGskIBCpASMgQgA3AwAjIEEANgIIIABFBEAjIEEQQQkQMiIANgIACyMgIAAhASMgIAE2AgQgARDuASIANgIAIAAhASMgIAE2AgQgAUHQseIEIQEjICABNgIIIAEQRCAAIQEjICABNgIEIAFBAEQAAAAAAAAAAEQAAAAAAAAAABCyASEBIyAgATYCCCABEEcgACEBIyAgATYCBCABQQBEAAAAAAAAAABEAAAAAAAAAAAQsgEhASMgIAE2AgggARBIIAAhASMgIAE2AgQgAUEARAAAAAAAAAAARAAAAAAAAAAAELIBIQEjICABNgIIIAEQSSAAIQEjIEEMaiQgIAEL5wEBAn8jIEEMayQgEKkBIyBCADcDACMgQQA2AgggAEUEQCMgQQxBDBAyIgA2AgALIAAhBSMgIAU2AgQgBUEAEEwgACEFIyAgBTYCBCAFQQAQTSAAIQUjICAFNgIEIAVBABBOIANB/P///wNLIAIgA2ogASEFIyAgBTYCBCAFEEtLcgRAQfCw4gRBsLLiBEEZQQcQAAALIAAhBSMgIAU2AgQgBSABIQUjICAFNgIIIAUQTCABIAJqIQQgACEFIyAgBTYCBCAFIAQQTSAAIQUjICAFNgIEIAUgAxBOIAAhBSMgQQxqJCAgBQtuAQF/IyBBCGskIBCpASMgQgA3AwACQAJAAkACQCMVQQFrDgMBAgMACwALQQAhAgsgASEEIyAgBDYCACAEEEshAwsgACEEIyAgBDYCACAEIAEhBCMgIAQ2AgQgBCACIAMQtAEhBCMgQQhqJCAgBAtaAQF/IyBBBGskIBCpASMgQQA2AgAgASAAIQMjICADNgIAIAMQT08EQEHgruIEQbCy4gRBgAFBMhAAAAsgACEDIyAgAzYCACADEFAgAWogAjoAACMgQQRqJCALNwEBfyMgQQRrJCAQqQEjIEEANgIAIAAgACECIyAgAjYCACACEEsgARDxASECIyBBBGokICACDwv9AQEFfyMgQRBrJCAQqQEjIEIANwMAIyBCADcDCCAAIQUjICAFNgIAIAUQsAEoAgAhASAAIQUjICAFNgIAIAUgACEFIyAgBTYCBCAFEENBBGoQOCMgQQAgARDwASICNgIIIyBBACACIQUjICAFNgIAIAVBAEEBJBVBABC1ASIDNgIMQQAhBANAIAQgAUkEQCADIQUjICAFNgIAIAUgBCAAIQUjICAFNgIEIAUQsAEtAAAQtgEgACEFIyAgBTYCACAFIAAhBSMgIAU2AgQgBRBDQQFqEDggBEEBaiEEDAELCyACIQUjICAFNgIAIAVBABC3ASEFIyBBEGokICAFDwt8AQN/IyBBBGskIBCpASMgQQA2AgAgACEEIyAgBDYCACAEEFQhAiACQQFqIQMgACADQQJBARCuAUEBGiAAIQQjICAENgIAIAQQVSACQQJ0aiABNgIAIAAgAUEBEDQgACEEIyAgBDYCACAEIAMQPSADIQQjIEEEaiQgIAQPC74DAgF8A38jIEEQayQgEKkBIyBCADcDACMgQgA3AwggACEFIyAgBTYCACAFQQAQrwEgASEFIyAgBTYCACAFELEBIQJBACEDA0AgA7cgAmMEQCMgQQAQswEiBDYCBCAEIQUjICAFNgIAIAUgASEFIyAgBTYCDCAFELgBIQUjICAFNgIIIAUQRCAEIQUjICAFNgIIIAUQUSEFIyAgBTYCACAFIAEhBSMgIAU2AgggBRCxARBFIAQhBSMgIAU2AgggBRBRIQUjICAFNgIAIAUgASEFIyAgBTYCCCAFELEBEEYgBCEFIyAgBTYCCCAFEFIhBSMgIAU2AgAgBSABIQUjICAFNgIIIAUQsQEQRSAEIQUjICAFNgIIIAUQUiEFIyAgBTYCACAFIAEhBSMgIAU2AgggBRCxARBGIAQhBSMgIAU2AgggBRBTIQUjICAFNgIAIAUgASEFIyAgBTYCCCAFELEBEEUgBCEFIyAgBTYCCCAFEFMhBSMgIAU2AgAgBSABIQUjICAFNgIIIAUQsQEQRiAAIQUjICAFNgIAIAUgBCEFIyAgBTYCCCAFELkBGiADQQFqIQMMAQsLIyBBEGokIAugAwELfyMgQRBrJCAQqQEjIEIANwMAIyBCADcDCCABQQFrIQMgA0EASARAQeC04gQhDSMgQRBqJCAgDQ8LIANFBEAjICAAKAIAIgQ2AgAgBAR/IAQFQeC04gQLIQ0jIEEQaiQgIA0PC0EAIQVBACEHA0AgByABSARAIyAgACAHQQJ0aigCACIGNgIEIAZBAEcEQCAFIAYhDSMgIA02AgggDRBYaiEFCyAHQQFqIQcMAQsLQQAhCCACIQ0jICANNgIIIA0QWCEJIyAgBSAJIANsakEBdEECEDIiCjYCDEEAIQsDQCALIANIBEAjICAAIAtBAnRqKAIAIgY2AgQgBkEARwRAIAYhDSMgIA02AgggDRBYIQwgCiAIQQF0aiAGIAxBAXT8CgAAIAggDGohCAsgCQRAIAogCEEBdGogAiAJQQF0/AoAACAIIAlqIQgLIAtBAWohCwwBCwsjICAAIANBAnRqKAIAIgY2AgQgBkEARwRAIAogCEEBdGogBiAGIQ0jICANNgIIIA0QWEEBdPwKAAALIAohDSMgQRBqJCAgDQ8LXwEBfyMgQQhrJCAQqQEjIEIANwMAQQAaQQAaQQAaQQBBAUgaQQEaIAAgACECIyAgAjYCBCACEFcgASECIyAgAjYCACACELsBIQIjIEEIaiQgIAIPIQIjIEEIaiQgIAILWQECfyMgQQhrJCAQqQEjIEIANwMAIyAgACEEIyAgBDYCACAEIAEQWUEBEDIiAzYCBCAAIAAhBCMgIAQ2AgAgBBBYIAMgASACEFoaIAMhBCMgQQhqJCAgBA8LVAEBfyMgQQRrJCAQqQEjIEEANgIAAkACQAJAAkAjFUEBaw4DAQIDAAsAC0EAIQELQQAhAgsgACEDIyAgAzYCACADIAEgAhC9ASEDIyBBBGokICADC10BAX8jIEEEayQgEKkBIyBBADYCACABIAAhAiMgIAI2AgAgAhBPTwRAQeCu4gRBsLLiBEHIAEEyEAAACyAAIQIjICACNgIAIAIQUCABai0AACECIyBBBGokICACDwvCAgEEfyMgQRBrJCAQqQEjIEIANwMAIyBCADcDCCMgIAEhBSMgIAU2AgAgBUEAQQEkFUEAEL4BIgI2AgQjIEEAIAIhBSMgIAU2AgAgBUEAQQEkFUEAELUBIgM2AgggACEFIyAgBTYCACAFELABIAIhBSMgIAU2AgAgBRBLNgIAIAAhBSMgIAU2AgAgBSAAIQUjICAFNgIMIAUQQ0EEahA4QQAhBANAIAQgAiEFIyAgBTYCACAFEEtIBEAgACEFIyAgBTYCACAFELABIAMhBSMgIAU2AgAgBSAEEL8BOgAAIAAhBSMgIAU2AgAgBSAAIQUjICAFNgIMIAUQQ0EBahA4IARBAWohBAwBCwsgACEFIyAgBTYCACAFIAAhBSMgIAU2AgwgBRBbIAIhBSMgIAU2AgwgBRBLQQRqahA5IyBBEGokIAuYAQEDfyMgQRhrJCAQqQEjIEEAQRj8CwAjIEEAQQAQqwEiATYCACABIQMjICADNgIEIAMjICAAIgI2AgxBwLTiBCEDIyAgAzYCECADQQEgAiEDIyAgAzYCFCADEFZBwLTiBCEDIyAgAzYCECADQeC04gQhAyMgIAM2AhQgAxC8ASEDIyAgAzYCCCADEMABQQAQASMgQRhqJCALMAEBfyMgQQRrJCAQqQEjIEEANgIAIAAhASMgIAE2AgAgARBUIQEjIEEEaiQgIAEPC4gBAQJ/IyBBCGskIBCpASMgQgA3AwAgASAAIQMjICADNgIAIAMQVE8EQEHgruIEQaCx4gRB8gBBKhAAAAsjICAAIQMjICADNgIAIAMQVSABQQJ0aigCACICNgIEQQEaQQBFGiACRQRAQcC14gRBoLHiBEH2AEEoEAAACyACIQMjIEEIaiQgIAMPC48BAQV/IyBBCGskIBCpASMgQgA3AwAgACEGIyAgBjYCACAGEFhBAXQhAiABIQYjICAGNgIAIAYQWEEBdCEDIAIgA2ohBCAEQQBGBEBB4LTiBCEGIyBBCGokICAGDwsjICAEQQIQMiIFNgIEIAUgACAC/AoAACAFIAJqIAEgA/wKAAAgBSEGIyBBCGokICAGDws+AQF/IyBBCGskIBCpASMgQgA3AwAgACECIyAgAjYCACACIAEhAiMgIAI2AgQgAhDEASECIyBBCGokICACDwuWAgEFfyMgQRBrJCAQqQEjIEIANwMAIyBCADcDCCAARQRAIyBBEEEPEDIiADYCAAsgACEGIyAgBjYCBCAGQQAQZCAAIQYjICAGNgIEIAZBABBlIAAhBiMgIAY2AgQgBkEAEGYgACEGIyAgBjYCBCAGQQAQZyABQfz///8DQQJ2SwRAQfCw4gRBoLHiBEHGAEE8EAAACyABIgJBCCIDIAIgA0sbQQJ0IQQjICAEQQEQMiIFNgIIQQIjEEcaIAAhBiMgIAY2AgQgBiAFIQYjICAGNgIMIAYQZCAAIQYjICAGNgIEIAYgBRBlIAAhBiMgIAY2AgQgBiAEEGYgACEGIyAgBjYCBCAGIAEQZyAAIQYjIEEQaiQgIAYLlgIBBX8jIEEQayQgEKkBIyBCADcDACMgQgA3AwggAEUEQCMgQRBBBRAyIgA2AgALIAAhBiMgIAY2AgQgBkEAEGggACEGIyAgBjYCBCAGQQAQaSAAIQYjICAGNgIEIAZBABBqIAAhBiMgIAY2AgQgBkEAEGsgAUH8////A0EDdksEQEHwsOIEQaCx4gRBxgBBPBAAAAsgASICQQgiAyACIANLG0EDdCEEIyAgBEEBEDIiBTYCCEECIxBHGiAAIQYjICAGNgIEIAYgBSEGIyAgBjYCDCAGEGggACEGIyAgBjYCBCAGIAUQaSAAIQYjICAGNgIEIAYgBBBqIAAhBiMgIAY2AgQgBiABEGsgACEGIyBBEGokICAGC68BAQJ/IyBBCGskIBCpASMgQgA3AwAgACABRgRAQQEhAyMgQQhqJCAgAw8LIABBAEYEf0EBBSABQQBGCwRAQQAhAyMgQQhqJCAgAw8LIAAhAyMgIAM2AgAgAxBYIQIgAiABIQMjICADNgIAIAMQWEcEQEEAIQMjIEEIaiQgIAMPCyAAIQMjICADNgIAIANBACABIQMjICADNgIEIANBACACEHFFIQMjIEEIaiQgIAMPC3wBA38jIEEEayQgEKkBIyBBADYCACAAIQQjICAENgIAIAQQcyECIAJBAWohAyAAIANBAkEBEK4BQQEaIAAhBCMgIAQ2AgAgBBB0IAJBAnRqIAE2AgAgACABQQEQNCAAIQQjICAENgIAIAQgAxBnIAMhBCMgQQRqJCAgBA8LOAEBfyMgQQRrJCAQqQEjIEEANgIAIAAgAUECQQAQrgEgACECIyAgAjYCACACIAEQZyMgQQRqJCALOAEBfyMgQQRrJCAQqQEjIEEANgIAIAAgAUEDQQAQrgEgACECIyAgAjYCACACIAEQayMgQQRqJCALigEBAX8jIEEEayQgEKkBIyBBADYCAEEAIAAhAyMgIAM2AgAgAxBcIAEhAyMgIAM2AgAgAxBcIAAhAyMgIAM2AgAgAxBcoSACoqAgACEDIyAgAzYCACADEF0gASEDIyAgAzYCACADEF0gACEDIyAgAzYCACADEF2hIAKioBCyASEDIyBBBGokICADDwt0AQN/IyBBBGskIBCpASMgQQA2AgAgACEEIyAgBDYCACAEEHUhAiACQQFqIQMgACADQQNBARCuAUEAGiAAIQQjICAENgIAIAQQdiACQQN0aiABOQMAIAAhBCMgIAQ2AgAgBCADEGsgAyEEIyBBBGokICAEDwuaBAIIfAR/IyBBFGskIBCpASMgQQBBFPwLAAJ8IAAhECMgIBA2AgAgEBBcIAEhECMgIBA2AgAgEBBcoSEFIAWZDAALEHIhBiAGAnwgACEQIyAgEDYCACAQEF0gASEQIyAgEDYCACAQEF2hIQcgB5kMAAsQcqAhBiAGIASiIQZBAbcgBqMhCCACIRAjICAQNgIAIBBBABDKASACIRAjICAQNgIAIBBBACAAIRAjICAQNgIIIBAQXBByIAAhECMgIBA2AgggEBBdEHIQsgEhECMgIBA2AgQgEBDJARogACEQIyAgEDYCACAQEFwQciEJIyAgACINNgIMQQEhDgNAIA63IAZlBEAjICAAIRAjICAQNgIAIBAgASEQIyAgEDYCBCAQIA63IAiiEMwBIg82AhAgDyEQIyAgEDYCACAQEFwQciEKIA8hECMgIBA2AgAgEBBdEHIhCyAKIA0hECMgIBA2AgAgEBBcEHJiBH9BAQUgCyANIRAjICAQNgIAIBAQXRByYgsEQAJ8IAkgCqEhDCAMmQwAC0QAAAAAAADwP2QEQCADIRAjICAQNgIAIBAgChDNARoLIA8hECMgIBA2AgAgEBBcEHIhCiACIRAjICAQNgIAIBBBACAKIA8hECMgIBA2AgggEBBdEHIQsgEhECMgIBA2AgQgEBDJARogCiEJCyMgIA8iDTYCDCAOQQFqIQ4MAQsLIyBBFGokIAswAQF/IyBBBGskIBCpASMgQQA2AgAgACEBIyAgATYCACABEHUhASMgQQRqJCAgAQ8LaQICfAF/IyBBBGskIBCpASMgQQA2AgAgASAAIQQjICAENgIAIAQQdU8EQEHgruIEQaCx4gRB8gBBKhAAAAsgACEEIyAgBDYCACAEEHYgAUEDdGorAwAhAkEAGiACIQMjIEEEaiQgIAMPCzABAX8jIEEEayQgEKkBIyBBADYCACAAIQEjICABNgIAIAEQcyEBIyBBBGokICABDwuIAQECfyMgQQhrJCAQqQEjIEIANwMAIAEgACEDIyAgAzYCACADEHNPBEBB4K7iBEGgseIEQfIAQSoQAAALIyAgACEDIyAgAzYCACADEHQgAUECdGooAgAiAjYCBEEBGkEARRogAkUEQEHAteIEQaCx4gRB9gBBKBAAAAsgAiEDIyBBCGokICADDwv4AQINfAF/IyBBBGskIBCpASMgQQA2AgACfCAAIQ8jICAPNgIAIA8QXCECIAEhDyMgIA82AgAgDxBcIQMgAiADpQwACwJ8IAAhDyMgIA82AgAgDxBcIQQgASEPIyAgDzYCACAPEFwhBSAEIAWkDAALoSEGAnwgACEPIyAgDzYCACAPEF0hByABIQ8jICAPNgIAIA8QXSEIIAcgCKUMAAsCfCAAIQ8jICAPNgIAIA8QXSEJIAEhDyMgIA82AgAgDxBdIQogCSAKpAwAC6EhCwJ8AnwgBiAGoiALIAuioCEMIAyfDAALIQ0gDZkMAAshDiMgQQRqJCAgDg8LgAIBBn8jIEEcayQgEKkBIyBBAEEc/AsAIyAgACEKIyAgCjYCACAKIAEhCiMgIAo2AgQgCiAEEMwBIgU2AggjICABIQojICAKNgIAIAogAiEKIyAgCjYCBCAKIAQQzAEiBjYCDCMgIAIhCiMgIAo2AgAgCiADIQojICAKNgIEIAogBBDMASIHNgIQIyAgBSEKIyAgCjYCACAKIAYhCiMgIAo2AgQgCiAEEMwBIgg2AhQjICAGIQojICAKNgIAIAogByEKIyAgCjYCBCAKIAQQzAEiCTYCGCAIIQojICAKNgIAIAogCSEKIyAgCjYCBCAKIAQQzAEhCiMgQRxqJCAgCg8LngQCBnwEfyMgQRhrJCAQqQEjIEEAQRj8CwAgACEQIyAgEDYCACAQIAEhECMgIBA2AgQgEBDTARByIQcgByABIRAjICAQNgIAIBAgAiEQIyAgEDYCBCAQENMBEHKgIQcgByACIRAjICAQNgIAIBAgAyEQIyAgEDYCBCAQENMBEHKgIQcgByAGoiEHQQG3IAejIQggBCEQIyAgEDYCACAQQQAQygEgACEQIyAgEDYCACAQEFwQciEJIAAhECMgIBA2AgAgEBBdEHIhCiAEIRAjICAQNgIAIBBBACAJIAoQsgEhECMgIBA2AgQgEBDJARogCSELIyBBACAJIAoQsgEiDTYCCEEBIQ4DQCAOtyAHZQRAIyAgACEQIyAgEDYCACAQIAEhECMgIBA2AgQgECACIRAjICAQNgIMIBAgAyEQIyAgEDYCECAQIA63IAiiENQBIg82AhQgDyEQIyAgEDYCACAQEFwQciEJIA8hECMgIBA2AgAgEBBdEHIhCiAJIA0hECMgIBA2AgAgEBBcEHJiBH9BAQUgCiANIRAjICAQNgIAIBAQXRByYgsEQAJ8IAkgC6EhDCAMmQwAC0QAAAAAAADwP2QEQCAFIRAjICAQNgIAIBAgCRDNARoLIAkhCyAEIRAjICAQNgIAIBBBACAJIAoQsgEhECMgIBA2AgQgEBDJARojICAPIg02AggLIA5BAWohDgwBCwsjIEEYaiQgC6MBAQV/IyBBDGskIBCpASMgQgA3AwAjIEEANgIIIABFBEAjIEEIQQ4QMiIANgIACyMgIAAhBSMgIAU2AgQgBRDuASIANgIAIAAhBSMgIAU2AgQgBUEAQQJBD0HAz+IEEO8BIQUjICAFNgIIIAUQdyAAIQUjICAFNgIEIAVBAEEDQQVB4M/iBBDvASEFIyAgBTYCCCAFEHggACEFIyBBDGokICAFC5kNAQx/IyBBzABrJCAQqQEjIEEAQcwA/AsAIyBBAEEAEMYBIgI2AgAjIEEAQQAQxwEiAzYCBCMgQQBBABDGASIENgIIIyBBAEEAEMcBIgU2AgwjIEEARAAAAAAAAAAARAAAAAAAAAAAELIBIgY2AhBBACEHA0AgByAAIQ0jICANNgIUIA0QwgFIBEAgB0EKEGMhDSMgIA02AkAgDUHgxOIEIQ0jICANNgJEIA0QxQEhDSMgIA02AjggDSAAIQ0jICANNgJEIA0gBxDDASENIyAgDTYCQCANEGwhDSMgIA02AjwgDRDFASENIyAgDTYCMCANQZDF4gQhDSMgIA02AjQgDRDFASENIyAgDTYCKCANIAAhDSMgIA02AjggDSAHEMMBIQ0jICANNgI0IA0QUSENIyAgDTYCMCANEFxBABBwIQ0jICANNgIsIA0QxQEhDSMgIA02AiAgDUGgzuIEIQ0jICANNgIkIA0QxQEhDSMgIA02AhggDSAAIQ0jICANNgIoIA0gBxDDASENIyAgDTYCJCANEFEhDSMgIA02AiAgDRBdQQAQcCENIyAgDTYCHCANEMUBIQ0jICANNgIUIA0QwQEgACENIyAgDTYCICANIAcQwwEhDSMgIA02AhwgDRBsIQ0jICANNgIUIA1B0LHiBCENIyAgDTYCGCANEMgBBEAgAiENIyAgDTYCFCANQQAgACENIyAgDTYCJCANIAcQwwEhDSMgIA02AiAgDRBRIQ0jICANNgIcIA0QXBByIAAhDSMgIA02AiQgDSAHEMMBIQ0jICANNgIgIA0QUSENIyAgDTYCHCANEF0QchCyASENIyAgDTYCGCANEMkBGgsgACENIyAgDTYCICANIAcQwwEhDSMgIA02AhwgDRBsIQ0jICANNgIUIA1BwM7iBCENIyAgDTYCGCANEMgBBEAgBCENIyAgDTYCFCANQQAQygEgBSENIyAgDTYCFCANQQAQywEgBiENIyAgDTYCFCANIAAhDSMgIA02AiggDSAHEMMBIQ0jICANNgIkIA0QUSENIyAgDTYCGCANIAQhDSMgIA02AhwgDSAFIQ0jICANNgIgIA0gARDOAUEAIQgDQCAIIAUhDSMgIA02AhQgDRDPAUgEQCADIQ0jICANNgIUIA0gBSENIyAgDTYCGCANIAgQ0AEQzQEaIAhBAWohCAwBCwtBASEJA0AgCSAEIQ0jICANNgIUIA0Q0QFIBEAgAiENIyAgDTYCFCANQQAgBCENIyAgDTYCICANIAkQ0gEhDSMgIA02AhwgDRBcIAQhDSMgIA02AiAgDSAJENIBIQ0jICANNgIcIA0QXRCyASENIyAgDTYCGCANEMkBGiAJQQFqIQkMAQsLCyAAIQ0jICANNgIgIA0gBxDDASENIyAgDTYCHCANEGwhDSMgIA02AhQgDUHgzuIEIQ0jICANNgIYIA0QyAEEQCAEIQ0jICANNgIUIA1BABDKASAFIQ0jICANNgIUIA1BABDLASAGIQ0jICANNgIUIA0gACENIyAgDTYCMCANIAcQwwEhDSMgIA02AiwgDRBSIQ0jICANNgIYIA0gACENIyAgDTYCMCANIAcQwwEhDSMgIA02AiwgDRBTIQ0jICANNgIcIA0gACENIyAgDTYCMCANIAcQwwEhDSMgIA02AiwgDRBRIQ0jICANNgIgIA0gBCENIyAgDTYCJCANIAUhDSMgIA02AiggDSABENUBQQAhCgNAIAogBSENIyAgDTYCFCANEM8BSARAIAMhDSMgIA02AhQgDSAFIQ0jICANNgIYIA0gChDQARDNARogCkEBaiEKDAELC0EBIQsDQCALIAQhDSMgIA02AhQgDRDRAUgEQCACIQ0jICANNgIUIA1BACAEIQ0jICANNgIgIA0gCxDSASENIyAgDTYCHCANEFwgBCENIyAgDTYCICANIAsQ0gEhDSMgIA02AhwgDRBdELIBIQ0jICANNgIYIA0QyQEaIAtBAWohCwwBCwsLIyAgACENIyAgDTYCGCANIAcQwwEhDSMgIA02AhQgDRBRIgY2AhAgB0EKEGMhDSMgIA02AhggDUGQz+IEIQ0jICANNgIcIA0QxQEhDSMgIA02AhQgDRDBASAHQQFqIQcMAQsLIyBBABDWASIMNgJIIAwhDSMgIA02AhQgDSACIQ0jICANNgIYIA0QdyAMIQ0jICANNgIUIA0gAyENIyAgDTYCGCANEHggDCENIyBBzABqJCAgDQ8L0QEBAX8jIEEMayQgEKkBIyBCADcDACMgQQA2AgggAEUEQCMgQRhBEBAyIgA2AgALIAAhASMgIAE2AgQgAUEAQQRBBGwQ8AEhASMgIAE2AgggARB7IAAhASMgIAE2AgQgAUEEQQFrEHwgACEBIyAgATYCBCABQQBBBAJ/QRgMAAtsEPABIQEjICABNgIIIAEQfSAAIQEjICABNgIEIAFBBBB+IAAhASMgIAE2AgQgAUEAEH8gACEBIyAgATYCBCABQQAQgAEgACEBIyBBDGokICABC5IBAQN/IyBBBGskIBCpASMgQQA2AgAgACEFIyAgBTYCACAFEIIBIAIgACEFIyAgBTYCACAFEIMBcUEEbGooAgAhAwJAA0AgAwRAIAMQhAEhBCAEQQFxRQR/IAMQhQEgAWEFQQALBEAgAyEFIyBBBGokICAFDwsgBEEBQX9zcSEDDAELCwtBACEFIyBBBGokICAFDwuCAwIMfwF8IyBBEGskIBCpASMgQgA3AwAjIEIANwMIIAFBAWohAiMgQQAgAkEEbBDwASIDNgIAIAJBCGxBA20hBCMgQQAgBAJ/QRgMAAtsEPABIgU2AgQgACENIyAgDTYCCCANEIoBIQYgBiAAIQ0jICANNgIIIA0QhwECf0EYDAALbGohByAFIQgCQANAIAYgB0cEQCAGIQkgCRCEAUEBcUUEQCAIIQogCRCFASEOIAogDhCLASAKIAkQjAEQhgEgDhCBASABcSELIAMgC0EEbGohDCAKIAwoAgAQjQEgDCAINgIAIAgCf0EYDAALaiEICyAGAn9BGAwAC2ohBgwBCwsLIAAhDSMgIA02AgggDSADIQ0jICANNgIMIA0QeyAAIQ0jICANNgIIIA0gARB8IAAhDSMgIA02AgggDSAFIQ0jICANNgIMIA0QfSAAIQ0jICANNgIIIA0gBBB+IAAhDSMgIA02AgggDSAAIQ0jICANNgIMIA0QiQEQfyMgQRBqJCALlwMBBn8jIEEMayQgEKkBIyBCADcDACMgQQA2AgggARCBASEDIAAhCCMgIAg2AgAgCCABIAMQ2QEhBCAEBEAgBCACEIYBQQAaBSAAIQgjICAINgIAIAgQhwEgACEIIyAgCDYCACAIEIgBRgRAIAAhCCMgIAg2AgAgCCAAIQgjICAINgIEIAgQiQEgACEIIyAgCDYCBCAIEIgBQQNsQQRtSAR/IAAhCCMgIAg2AgQgCBCDAQUgACEIIyAgCDYCBCAIEIMBQQF0QQFyCxDaAQsjICAAIQgjICAINgIAIAgQigEiBTYCCCAFIAAhCCMgIAg2AgAgCCAAIQgjICAINgIEIAgQhwEiBkEBahB/IAYCf0EYDAALbGohBCAEIAEQiwFBABogBCACEIYBQQAaIAAhCCMgIAg2AgAgCCAAIQgjICAINgIEIAgQiQFBAWoQgAEgACEIIyAgCDYCACAIEIIBIAMgACEIIyAgCDYCACAIEIMBcUEEbGohByAEIAcoAgAQjQEgByAENgIACyAAIQgjIEEMaiQgIAgPCzsBAX8jIEEEayQgEKkBIyBBADYCACAAIQIjICACNgIAIAIgASABEIEBENkBQQBHIQIjIEEEaiQgIAIPC1kCAn8BfCMgQQRrJCAQqQEjIEEANgIAIAAhAyMgIAM2AgAgAyABIAEQgQEQ2QEhAiACRQRAQbDQ4gRB8NDiBEHpAEEREAAACyACEIwBIQQjIEEEaiQgIAQPC4oBAQF/IyBBBGskIBCpASMgQQA2AgAgASAAIQMjICADNgIAIAMQdU8EQCABQQBIBEBB4K7iBEGgseIEQYIBQRYQAAALIAAgAUEBakEDQQEQrgEgACEDIyAgAzYCACADIAFBAWoQawsgACEDIyAgAzYCACADEHYgAUEDdGogAjkDAEEAGiMgQQRqJCALvgEBCH8jIEEIayQgEKkBIyBCADcDACAAIQgjICAINgIAIAgQigEhASAAIQgjICAINgIAIAgQhwEhAiMgQQAgAhDHASIDNgIEQQAhBEEAIQUDQCAFIAJIBEAgASAFAn9BGAwAC2xqIQYgBhCEAUEBcUUEQCADIQgjICAINgIAIAggBCIHQQFqIQQgByAGEIUBEN4BCyAFQQFqIQUMAQsLIAMhCCMgIAg2AgAgCCAEEMsBIAMhCCMgQQhqJCAgCA8LcwECfyMgQQRrJCAQqQEjIEEANgIAQQAhAiABIQMjICADNgIAIAMQXCAAIQMjICADNgIAIAMQXGQEQEF/IQILIAEhAyMgIAM2AgAgAxBcIAAhAyMgIAM2AgAgAxBcYwRAQQEhAgsgAiEDIyBBBGokICADDwu/AwEIfyMgQRhrJCAQqQEjIEEAQRj8CwBBAEEBThogAiABa0EBaiEFIAEgBUEBcSADIAUgA2tBAXFrIANBAEYbaiEGAkADQCAGIAJMBEAjICAAIAZBAnRqKAIAIgc2AgAjICAAIAZBAnRqKAIEIgg2AgQjICAIIgk2AggjICAHIgo2AgwgByEMIyAgDDYCECAMIAghDCMgIAw2AhQgDEECJBUgBCgCABECAEEATARAIyAgByIJNgIIIyAgCCIKNgIMCyAGQQFrIQsCQANAIAsgAU4EQCMgIAAgC0ECdGooAgAiBzYCACAHIQwjICAMNgIQIAwgCiEMIyAgDDYCFCAMQQIkFSAEKAIAEQIAQQBKBEAgACALQQJ0aiAHNgIIIAtBAWshCwUMAwsMAQsLCyAAIAtBAnRqIAo2AggCQANAIAsgAU4EQCMgIAAgC0ECdGooAgAiBzYCACAHIQwjICAMNgIQIAwgCSEMIyAgDDYCFCAMQQIkFSAEKAIAEQIAQQBKBEAgACALQQJ0aiAHNgIEIAtBAWshCwUMAwsMAQsLCyAAIAtBAnRqIAk2AgQgBkECaiEGDAELCwsjIEEYaiQgC4wDAQR/IyBBDGskIBCpASMgQgA3AwAjIEEANgIIIAEgAkYEQCABIQcjIEEMaiQgIAcPCyABIQQgACAEQQJ0aigCACEHIyAgBzYCACAHIAAgBEEBaiIEQQJ0aigCACEHIyAgBzYCBCAHQQIkFSADKAIAEQIAQQBKBEACQANAIAQgAkgEfyAAIARBAnRqKAIEIQcjICAHNgIAIAcgACAEQQJ0aigCACEHIyAgBzYCBCAHQQIkFSADKAIAEQIAQR92BUEACwRAIARBAWohBAwBCwsLIAQhBQJAA0AgASAFSARAIyAgACABQQJ0aigCACIGNgIIIAAgAUECdGogACAFQQJ0aigCADYCACABQQFqIQEgACAFQQJ0aiAGNgIAIAVBAWshBQwBCwsLBQNAIAQgAkgEfyAAIARBAnRqKAIEIQcjICAHNgIAIAcgACAEQQJ0aigCACEHIyAgBzYCBCAHQQIkFSADKAIAEQIAQQBOBUEACwRAIARBAWohBAwBCwsLIAQhByMgQQxqJCAgBw8LqgIBB38jIEEQayQgEKkBIyBCADcDACMgQgA3AwggAkEBayECIAMgAmohCCACQQFqIQYDQCAGIAFKBEAgBCAGQQFrQQJ0aiAAIAZBAWtBAnRqKAIANgIAIAZBAWshBgwBCwsgAiEHA0AgByADSARAIAQgCCAHa0ECdGogACAHQQJ0aigCBDYCACAHQQFqIQcMAQsLIAEhCQNAIAkgA0wEQCMgIAQgB0ECdGooAgAiCjYCACMgIAQgBkECdGooAgAiCzYCBCAKIQwjICAMNgIIIAwgCyEMIyAgDDYCDCAMQQIkFSAFKAIAEQIAQQBIBEAgACAJQQJ0aiAKNgIAIAdBAWshBwUgACAJQQJ0aiALNgIAIAZBAWohBgsgCUEBaiEJDAELCyMgQRBqJCALqAcBIH8jIEEYayQgEKkBIyBBAEEY/AsAIAFBMEwEQCABQQFMBEAjIEEYaiQgDwtBAEEBSBoCQAJAAkAgASEDIANBA0YNACADQQJGDQEMAgsjICAAKAIAIgQ2AgAjICAAKAIEIgU2AgQgBCEiIyAgIjYCCCAiIAUhIiMgICI2AgwgIkECJBUgAigCABECAEEASiEGIAAgBSAEIAYbNgIAIyAgBCAFIAYbIgQ2AgAjICAAKAIIIgU2AgQgBCEiIyAgIjYCCCAiIAUhIiMgICI2AgwgIkECJBUgAigCABECAEEASiEGIAAgBSAEIAYbNgIEIAAgBCAFIAYbNgIICyMgIAAoAgAiBzYCECMgIAAoAgQiCDYCFCAHISIjICAiNgIIICIgCCEiIyAgIjYCDCAiQQIkFSACKAIAEQIAQQBKIQkgACAIIAcgCRs2AgAgACAHIAggCRs2AgQjIEEYaiQgDwsgAEEAIAFBAWtBACACISIjICAiNgIIICIQ4QEjIEEYaiQgDwsCfyABIQpBHyAKZ2sMAAtBAmohCyALQQJ0IQwgDEEBdBAvIQ0gDSAMaiEOQQAhDwNAIA8gC0kEQCANIA9BAnRqQX82AgAgD0EBaiEPDAELCyABQQJ0EC8hECABQQFrIREgAEEAIBEgAiEiIyAgIjYCCCAiEOIBIRIgEkEBaiETIBNBIEgEQCARIhRBIEEBayIVIBQgFUgbIRIgAEEAIBIgEyACISIjICAiNgIIICIQ4QELQQAhFkEAIRcCQANAIBIgEUgEQCASQQFqIRggACAYIBEgAiEiIyAgIjYCCCAiEOIBIRkgGSAYa0EBaiEaIBpBIEgEQCARIhsgGEEgakEBayIcIBsgHEgbIRkgACAYIBkgGiACISIjICAiNgIIICIQ4QELQQAgESAXIBggGRCOASEdIBYhHgNAIB4gHUsEQCANIB5BAnRqKAIAIR8gH0F/RwRAIAAgHyAOIB5BAnRqKAIAQQFqIBIgECACISIjICAiNgIIICIQ4wEgHyEXIA0gHkECdGpBfzYCAAsgHkEBayEeDAELCyANIB1BAnRqIBc2AgAgDiAdQQJ0aiASNgIAIBghFyAZIRIgHSEWDAELCwsgFiEgA0AgIEEARwRAIA0gIEECdGooAgAhISAhQX9HBEAgACAhIA4gIEECdGooAgBBAWogESAQIAIhIiMgICI2AgggIhDjAQsgIEEBayEgDAELCyAQECQgDRAkIyBBGGokIAtRAQF/IyBBCGskIBCpASMgQgA3AwAgACECIyAgAjYCBCACEHQgACECIyAgAjYCBCACEHMgASECIyAgAjYCACACEOQBIAAhAiMgQQhqJCAgAg8LcwEBfyMgQQhrJCAQqQEjIEIANwMAIAAhAiMgIAI2AgAgAhCwASABOQMAIAAhAiMgIAI2AgAgAiAAIQIjICACNgIEIAIQQ0EIahA4IAAhAiMgIAI2AgAgAiAAIQIjICACNgIEIAIQW0EIahA5IyBBCGokIAutEwIRfw18IyBBPGskIBCpASMgQQBBPPwLACMgQQAQqgEiADYCACMgQQBBABCrASIBNgIEIyBBAEEAEK0BIgI2AgggAiEQIyAgEDYCDCAQIAEhECMgIBA2AhAgEBC6ASABIRAjICAQNgIMIBAQsQEhESABIRAjICAQNgIMIBAQsQEhEiABIRAjICAQNgIMIBAQsQEhEyABIRAjICAQNgIMIBAQsQEhFCABIRAjICAQNgIMIBAQsQEhFSABIRAjICAQNgIMIBAQsQEhFiABIRAjICAQNgIMIBAQsQEhFyABIRAjICAQNgIMIBAQsQEhGEGgs+IEIRAjICAQNgIMIBAQwQFBACEDA0AgAyACIRAjICAQNgIMIBAQwgFIBEAgAiEQIyAgEDYCFCAQIAMQwwEhECMgIBA2AhAgEBBRIRAjICAQNgIMIBAgAiEQIyAgEDYCGCAQIAMQwwEhECMgIBA2AhQgEBBRIRAjICAQNgIQIBAQXCARohBFIAIhECMgIBA2AhQgECADEMMBIRAjICAQNgIQIBAQUSEQIyAgEDYCDCAQIBUgEqIgAiEQIyAgEDYCGCAQIAMQwwEhECMgIBA2AhQgEBBRIRAjICAQNgIQIBAQXSASoqEQRiACIRAjICAQNgIUIBAgAxDDASEQIyAgEDYCECAQEFIhECMgIBA2AgwgECACIRAjICAQNgIYIBAgAxDDASEQIyAgEDYCFCAQEFIhECMgIBA2AhAgEBBcIBGiEEUgAiEQIyAgEDYCFCAQIAMQwwEhECMgIBA2AhAgEBBSIRAjICAQNgIMIBAgFSASoiACIRAjICAQNgIYIBAgAxDDASEQIyAgEDYCFCAQEFIhECMgIBA2AhAgEBBdIBKioRBGIAIhECMgIBA2AhQgECADEMMBIRAjICAQNgIQIBAQUyEQIyAgEDYCDCAQIAIhECMgIBA2AhggECADEMMBIRAjICAQNgIUIBAQUyEQIyAgEDYCECAQEFwgEaIQRSACIRAjICAQNgIUIBAgAxDDASEQIyAgEDYCECAQEFMhECMgIBA2AgwgECAVIBKiIAIhECMgIBA2AhggECADEMMBIRAjICAQNgIUIBAQUyEQIyAgEDYCECAQEF0gEqKhEEYgA0EBaiEDDAELC0HAtuIEIRAjICAQNgIQIBAgAiEQIyAgEDYCGCAQEMIBQQoQYyEQIyAgEDYCFCAQEMUBIRAjICAQNgIMIBAQwQEjICACIRAjICAQNgIMIBAgFhDXASIENgIcQYDQ4gQhECMgIBA2AhAgECAEIRAjICAQNgIgIBAQeSEQIyAgEDYCGCAQENEBQQoQYyEQIyAgEDYCFCAQEMUBIRAjICAQNgIMIBAQwQEjICAEIRAjICAQNgIMIBAQeSIFNgIkIAAhECMgIBA2AgwgECAEIRAjICAQNgIUIBAQeiEQIyAgEDYCECAQEDYjIEEAENgBIgY2AiggBSEQIyAgEDYCECAQQQAQ0gEhECMgIBA2AgwgEBBcIRkgBSEQIyAgEDYCECAQIAUhECMgIBA2AhQgEBDRAUEBaxDSASEQIyAgEDYCDCAQEF0hGiAGIRAjICAQNgIMIBAgBSEQIyAgEDYCFCAQQQAQ0gEhECMgIBA2AhAgEBBcIAUhECMgIBA2AhQgEEEAENIBIRAjICAQNgIQIBAQXRDbARogBiEQIyAgEDYCDCAQIAUhECMgIBA2AhQgECAFIRAjICAQNgIYIBAQ0QFBAWsQ0gEhECMgIBA2AhAgEBBcIAUhECMgIBA2AhQgECAFIRAjICAQNgIYIBAQ0QFBAWsQ0gEhECMgIBA2AhAgEBBdENsBGkEAIQcDQCAHIAUhECMgIBA2AgwgEBDRAUgEQCMgIAUhECMgIBA2AgwgECAHENIBIgg2AiwgBiEQIyAgEDYCDCAQIAghECMgIBA2AhAgEBBcENwBBEAgCCEQIyAgEDYCDCAQEFwgGWIEfyAIIRAjICAQNgIMIBAQXCAaYgVBAAsEQCAGIRAjICAQNgIMIBAgCCEQIyAgEDYCECAQEFwQ3AEEQCAGIRAjICAQNgIMIBAgCCEQIyAgEDYCECAQEFwQ3QEhGyAbIAghECMgIBA2AgwgEBBdYwRAIAYhECMgIBA2AgwgECAIIRAjICAQNgIQIBAQXCAIIRAjICAQNgIQIBAQXRDbARoLCwsFIAYhECMgIBA2AgwgECAIIRAjICAQNgIQIBAQXCAIIRAjICAQNgIQIBAQXRDbARoLIAdBAWohBwwBCwtBoNHiBCEQIyAgEDYCDCAQEMEBIyBBAEEAEMYBIgk2AjAjICAGIRAjICAQNgIMIBAQ3wEiCjYCNEEAIQsDQCALIAohECMgIBA2AgwgEBDPAUgEQCAJIRAjICAQNgIMIBBBACAKIRAjICAQNgIUIBAgCxDQASAGIRAjICAQNgIUIBAgCiEQIyAgEDYCGCAQIAsQ0AEQ3QEQsgEhECMgIBA2AhAgEBDJARogC0EBaiELDAELC0HQ0eIEIRAjICAQNgIMIBAQwQEgCSEQIyAgEDYCDCAQQYDS4gQhECMgIBA2AhAgEBDlARpBoNLiBCEQIyAgEDYCDCAQEMEBAnwgF0QAAAAAAECPQKMgGKIhHCAcmwwACyEdQQAhDANAIAy3IB1jBEBEAAAAAAAAAAAgHUQAAAAAAADwP6EgDLdEAAAAAAAAAAAgCSEQIyAgEDYCDCAQENEBQQFrtxCPARBy/AIhDSAAIRAjICAQNgIQIBAQkAEhECMgIBA2AgwgECATIBKiIBQgEqIgCSEQIyAgEDYCFCAQIA0Q0gEhECMgIBA2AhAgEBBdRAAAAAAAAAAARAAAAAAAAPA/EI8BEM0BGiAMQQFqIQwMAQsLQcDS4gQhECMgIBA2AgwgEBDBASMgQQBBABCrASIONgI4IAAhECMgIBA2AhAgEBCRASEQIyAgEDYCDCAQEM8BQQBKBEAgDiEQIyAgEDYCDCAQQfDS4gQhECMgIBA2AhAgEBDAASAOIRAjICAQNgIMIBBBkNPiBCEQIyAgEDYCECAQEMABBSAOIRAjICAQNgIMIBBBwNPiBCEQIyAgEDYCECAQEMABIA4hECMgIBA2AgwgECAAIRAjICAQNgIUIBAQkAEhECMgIBA2AhAgEBDPAbcQ5gFBACEPA0AgDyAAIRAjICAQNgIQIBAQkAEhECMgIBA2AgwgEBDPAUgEQCAOIRAjICAQNgIMIBAgACEQIyAgEDYCFCAQEJABIRAjICAQNgIQIBAgDxDQARDmASAPQQFqIQ8MAQsLCyMgQTxqJCALMwEBfyMgQQRrJCAQqQEjIEEANgIAQQAaIAAhAiMgIAI2AgAgAhCWASABEBMjIEEEaiQgCzMBAX8jIEEEayQgEKkBIyBBADYCAEEAGiAAIQIjICACNgIAIAIQmAEgARATIyBBBGokIAuEAQEEfyMgQQRrJCAQqQEjIEEANgIAQQEaIAAhBSMgIAU2AgAgBRBVIQIgAiAAIQUjICAFNgIAIAUQVEECdGohAwJAA0AgAiADSQRAIAIoAgAhBCAEBEAgBCABEBMLIAJBBGohAgwBCwsLIAAhBSMgIAU2AgAgBRCbASABEBMjIEEEaiQgC4QBAQR/IyBBBGskIBCpASMgQQA2AgBBARogACEFIyAgBTYCACAFEHQhAiACIAAhBSMgIAU2AgAgBRBzQQJ0aiEDAkADQCACIANJBEAgAigCACEEIAQEQCAEIAEQEwsgAkEEaiECDAELCwsgACEFIyAgBTYCACAFEKIBIAEQEyMgQQRqJCALSwECfyMgQQRrJCAQqQEjIEEANgIAIAAhAyMgIAM2AgAgAxCCASABEBMgACEDIyAgAzYCACADEIoBIQJBABogAiABEBMjIEEEaiQgCzABAX8jIEEEayQgEKkBIyBBADYCACAAIQIjICACNgIAIAIQpQEgARATIyBBBGokIAs1AQF/IyBBBGskIBCpASMgQQA2AgAgAEUEQCMgQQBBABAyIgA2AgALIAAhASMgQQRqJCAgAQtlAQR/IyBBBGskIBCpASMgQQA2AgAgACABdCEEIyAgBEEBIAMQMyIFNgIAQRAgAhAyIQYgBiAFNgIAIAYgBUEAEDQgBiAFNgIEIAYgBDYCCCAGIAA2AgwgBiEHIyBBBGokICAHDwtTAQJ/IyBBBGskIBCpASMgQQA2AgAgAUH8////A0sEQEHwsOIEQfCx4gRBNEErEAAACyMgIAFBARAyIgI2AgBBAiMQRxogAiEDIyBBBGokICADDwuQAwEKfyMgQQRrJCAQqQEjIEEANgIAIAAhAyAAIAFqIQQgBCADT0UEQEEAQfCy4gRBggZBBxAAAAsjICABQQF0QQIQMiIFNgIAIAUhBgJAA0AgAyAESQRAIAMtAAAhByADQQFqIQMgB0GAAXFFBEAgAiAHRXEEQAwECyAGIAc7AQAFIAQgA0YEQAwECyADLQAAQT9xIQggA0EBaiEDIAdB4AFxQcABRgRAIAYgB0EfcUEGdCAIcjsBAAUgBCADRgRADAULIAMtAABBP3EhCSADQQFqIQMgB0HwAXFB4AFGBEAgB0EPcUEMdCAIQQZ0ciAJciEHBSAEIANGBEAMBgsgB0EHcUESdCAIQQx0ciAJQQZ0ciADLQAAQT9xciEHIANBAWohAwsgB0GAgARJBEAgBiAHOwEABSAHQYCABGshByAHQQp2QYCwA3IhCiAHQf8HcUGAuANyIQsgBiAKIAtBEHRyNgIAIAZBAmohBgsLCyAGQQJqIQYMAQsLCyAFIAYgBWsQQSEMIyBBBGokICAMDwu8AgENfyMgQQRrJCAQqQEjIEEANgIAIAFBAkgEf0EBBSABQSRKCwRAQfC24gRB8LfiBEH1AkEFEAAACyAARQRAQbC44gQhDiMgQQRqJCAgDg8LIABBH3ZBAXQhAiACBEBBACAAayEACyABQQpGBEAgABBeIQQjICAEQQF0IAJqQQIQMiIDNgIAAkAgAyACaiEFIAAhBiAEIQdBAEEBThogBSAGIAcQXwsFIAFBEEYEQEEfIABna0ECdUEBaiEIIyAgCEEBdCACakECEDIiAzYCAAJAIAMgAmohCSAAIQogCCELQQBBAU4aIAkgCq0gCxBgCwUgACEMIAytIAEQYSENIyAgDUEBdCACakECEDIiAzYCACADIAJqIAytIA0gARBiCwsgAgRAIANBLTsBAAsgAyEOIyBBBGokICAODwu6AQEDfyMgQQRrJCAQqQEjIEEANgIAIABEAAAAAAAAAABhBEBBsMXiBCEDIyBBBGokICADDwsgACAAoUQAAAAAAAAAAGFFBEAgACAAYgRAQdDF4gQhAyMgQQRqJCAgAw8LQfDF4gRBoMbiBCAARAAAAAAAAAAAYxshAyMgQQRqJCAgAw8LQcDG4gQgABBvQQF0IQEjICABQQIQMiICNgIAIAJBwMbiBCAB/AoAACACIQMjIEEEaiQgIAMPCwvFKjoAQYyt4gQLQDwAAAAAAAAAAAAAAAIAAAAoAAAAQQBsAGwAbwBjAGEAdABpAG8AbgAgAHQAbwBvACAAbABhAHIAZwBlAAAAAAAAQcyt4gQLQDwAAAAAAAAAAAAAAAIAAAAgAAAAfgBsAGkAYgAvAHIAdAAvAGkAdABjAG0AcwAuAHQAcwAAAAAAAAAAAAAAAAAAQZCu4gQLFAAAAAAAAAAAAAAAAAAAAAAAAAAAAEGwruIECxQAAAAAAAAAAAAAAAAAAAAAAAAAAABBzK7iBAtAPAAAAAAAAAAAAAAAAgAAACQAAABJAG4AZABlAHgAIABvAHUAdAAgAG8AZgAgAHIAYQBuAGcAZQAAAAAAAAAAAABBjK/iBAswLAAAAAAAAAAAAAAAAgAAABQAAAB+AGwAaQBiAC8AcgB0AC4AdABzAAAAAAAAAAAAAEHAr+IECxQAAAAAAAAAAAAAAAAAAAAAAAAAAABB3K/iBAtAPAAAAAAAAAAAAAAAAgAAAB4AAAB+AGwAaQBiAC8AcgB0AC8AdABsAHMAZgAuAHQAcwAAAAAAAAAAAAAAAAAAAABBnLDiBAsgHAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAQbyw4gQLIBwAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAEHcsOIECzAsAAAAAAAAAAAAAAACAAAAHAAAAEkAbgB2AGEAbABpAGQAIABsAGUAbgBnAHQAaAAAQYyx4gQLMCwAAAAAAAAAAAAAAAIAAAAaAAAAfgBsAGkAYgAvAGEAcgByAGEAeQAuAHQAcwAAAABBvLHiBAsgHAAAAAAAAAAAAAAAAgAAAAwAAABtAG8AdgBlAHQAbwAAQdyx4gQLQDwAAAAAAAAAAAAAAAIAAAAmAAAAfgBsAGkAYgAvAGEAcgByAGEAeQBiAHUAZgBmAGUAcgAuAHQAcwAAAAAAAAAAQZyy4gQLQDwAAAAAAAAAAAAAAAIAAAAgAAAAfgBsAGkAYgAvAGQAYQB0AGEAdgBpAGUAdwAuAHQAcwAAAAAAAAAAAAAAAAAAQdyy4gQLMCwAAAAAAAAAAAAAAAIAAAAcAAAAfgBsAGkAYgAvAHMAdAByAGkAbgBnAC4AdABzAABBjLPiBAswLAAAAAAAAAAAAAAAAgAAABQAAABsAG8AYQBkAGkAbgBnACAARMbMuAAAAAAAAAAAAEG8s+IEC1BMAAAAAAAAAAAAAAACAAAANgAAAGMAbwBuAHMAbwBsAGUALgBsAG8AZwAoACIAQQBzAHMAZQBtAGIAbAB5AEwAbwBnACAAOgAgAAAAAAAAAABBjLTiBAsgHAAAAAAAAAAAAAAAAgAAAAQAAAAiACkAAAAAAAAAAAAAQay04gQLIBwAAAADAAAAAAAAAA0AAAAMAAAA0JmYAAAAAAAgmpgAAEHMtOIECyAcAAAAAAAAAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAABB7LTiBAtAPAAAAAAAAAAAAAAAAgAAACQAAABVAG4AcABhAGkAcgBlAGQAIABzAHUAcgByAG8AZwBhAHQAZQAAAAAAAAAAAABBrLXiBAuAAXwAAAAAAAAAAAAAAAIAAABeAAAARQBsAGUAbQBlAG4AdAAgAHQAeQBwAGUAIABtAHUAcwB0ACAAYgBlACAAbgB1AGwAbABhAGIAbABlACAAaQBmACAAYQByAHIAYQB5ACAAaQBzACAAaABvAGwAZQB5AAAAAAAAAAAAAAAAAAAAAEGstuIECzAsAAAAAAAAAAAAAAACAAAAEgAAAOzTeMe40iAA9LwVyCAARMbMuAAAAAAAAAAAAAAAQdy24gQLgAF8AAAAAAAAAAAAAAACAAAAZAAAAHQAbwBTAHQAcgBpAG4AZwAoACkAIAByAGEAZABpAHgAIABhAHIAZwB1AG0AZQBuAHQAIABtAHUAcwB0ACAAYgBlACAAYgBlAHQAdwBlAGUAbgAgADIAIABhAG4AZAAgADMANgAAAAAAAAAAAABB3LfiBAtAPAAAAAAAAAAAAAAAAgAAACYAAAB+AGwAaQBiAC8AdQB0AGkAbAAvAG4AdQBtAGIAZQByAC4AdABzAAAAAAAAAABBnLjiBAsgHAAAAAAAAAAAAAAAAgAAAAIAAAAwAAAAAAAAAAAAAAAAQby44gQLkAMwADAAMAAxADAAMgAwADMAMAA0ADAANQAwADYAMAA3ADAAOAAwADkAMQAwADEAMQAxADIAMQAzADEANAAxADUAMQA2ADEANwAxADgAMQA5ADIAMAAyADEAMgAyADIAMwAyADQAMgA1ADIANgAyADcAMgA4ADIAOQAzADAAMwAxADMAMgAzADMAMwA0ADMANQAzADYAMwA3ADMAOAAzADkANAAwADQAMQA0ADIANAAzADQANAA0ADUANAA2ADQANwA0ADgANAA5ADUAMAA1ADEANQAyADUAMwA1ADQANQA1ADUANgA1ADcANQA4ADUAOQA2ADAANgAxADYAMgA2ADMANgA0ADYANQA2ADYANgA3ADYAOAA2ADkANwAwADcAMQA3ADIANwAzADcANAA3ADUANwA2ADcANwA3ADgANwA5ADgAMAA4ADEAOAAyADgAMwA4ADQAOAA1ADgANgA4ADcAOAA4ADgAOQA5ADAAOQAxADkAMgA5ADMAOQA0ADkANQA5ADYAOQA3ADkAOAA5ADkAAEHMu+IEC6AIHAQAAAAAAAAAAAAAAgAAAAAEAAAwADAAMAAxADAAMgAwADMAMAA0ADAANQAwADYAMAA3ADAAOAAwADkAMABhADAAYgAwAGMAMABkADAAZQAwAGYAMQAwADEAMQAxADIAMQAzADEANAAxADUAMQA2ADEANwAxADgAMQA5ADEAYQAxAGIAMQBjADEAZAAxAGUAMQBmADIAMAAyADEAMgAyADIAMwAyADQAMgA1ADIANgAyADcAMgA4ADIAOQAyAGEAMgBiADIAYwAyAGQAMgBlADIAZgAzADAAMwAxADMAMgAzADMAMwA0ADMANQAzADYAMwA3ADMAOAAzADkAMwBhADMAYgAzAGMAMwBkADMAZQAzAGYANAAwADQAMQA0ADIANAAzADQANAA0ADUANAA2ADQANwA0ADgANAA5ADQAYQA0AGIANABjADQAZAA0AGUANABmADUAMAA1ADEANQAyADUAMwA1ADQANQA1ADUANgA1ADcANQA4ADUAOQA1AGEANQBiADUAYwA1AGQANQBlADUAZgA2ADAANgAxADYAMgA2ADMANgA0ADYANQA2ADYANgA3ADYAOAA2ADkANgBhADYAYgA2AGMANgBkADYAZQA2AGYANwAwADcAMQA3ADIANwAzADcANAA3ADUANwA2ADcANwA3ADgANwA5ADcAYQA3AGIANwBjADcAZAA3AGUANwBmADgAMAA4ADEAOAAyADgAMwA4ADQAOAA1ADgANgA4ADcAOAA4ADgAOQA4AGEAOABiADgAYwA4AGQAOABlADgAZgA5ADAAOQAxADkAMgA5ADMAOQA0ADkANQA5ADYAOQA3ADkAOAA5ADkAOQBhADkAYgA5AGMAOQBkADkAZQA5AGYAYQAwAGEAMQBhADIAYQAzAGEANABhADUAYQA2AGEANwBhADgAYQA5AGEAYQBhAGIAYQBjAGEAZABhAGUAYQBmAGIAMABiADEAYgAyAGIAMwBiADQAYgA1AGIANgBiADcAYgA4AGIAOQBiAGEAYgBiAGIAYwBiAGQAYgBlAGIAZgBjADAAYwAxAGMAMgBjADMAYwA0AGMANQBjADYAYwA3AGMAOABjADkAYwBhAGMAYgBjAGMAYwBkAGMAZQBjAGYAZAAwAGQAMQBkADIAZAAzAGQANABkADUAZAA2AGQANwBkADgAZAA5AGQAYQBkAGIAZABjAGQAZABkAGUAZABmAGUAMABlADEAZQAyAGUAMwBlADQAZQA1AGUANgBlADcAZQA4AGUAOQBlAGEAZQBiAGUAYwBlAGQAZQBlAGUAZgBmADAAZgAxAGYAMgBmADMAZgA0AGYANQBmADYAZgA3AGYAOABmADkAZgBhAGYAYgBmAGMAZgBkAGYAZQBmAGYAAAAAAAAAAAAAAAAAAEHsw+IEC2BcAAAAAAAAAAAAAAACAAAASAAAADAAMQAyADMANAA1ADYANwA4ADkAYQBiAGMAZABlAGYAZwBoAGkAagBrAGwAbQBuAG8AcABxAHIAcwB0AHUAdgB3AHgAeQB6AAAAAAAAQczE4gQLMCwAAAAAAAAAAAAAAAIAAAAYAAAAiLz4ySAA7NN4x7jSmMysuSAA3MKRxyAAAAAAAABB/MTiBAsgHAAAAAAAAAAAAAAAAgAAAAIAAAAgAAAAAAAAAAAAAAAAQZzF4gQLIBwAAAAAAAAAAAAAAAIAAAAGAAAAMAAuADAAAAAAAAAAAEG8xeIECyAcAAAAAAAAAAAAAAACAAAABgAAAE4AYQBOAAAAAAAAAABB3MXiBAswLAAAAAAAAAAAAAAAAgAAABIAAAAtAEkAbgBmAGkAbgBpAHQAeQAAAAAAAAAAAAAAAEGMxuIECzAsAAAAAAAAAAAAAAACAAAAEAAAAEkAbgBmAGkAbgBpAHQAeQAAAAAAAAAAAAAAAAAAQcDG4gQLOAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEH4xuIEC7gFiAIcCKDVj/p2vz6if+GuunasVTAg+xaL6jXOXUqJQs8tO2VVqrBrmt9FGj0Dzxrmysaaxxf+cKtP3Ly+/LF3/wzWa0HvkVa+PPx/kK0f0I2DmlUxKFxR07XJpq2PrHGdy4vuI3cinOptU3hAkUnMrlfOtl15EjyCN1b7TTaUEMJPmEg4b+qWkMc6giXLhXTX9Je/l83PhqDlrCoXmAo0746yNSr7ZziyOz/G0t/UyIS6zdMaJ0TdxZbJJbvOn2uThKVifSRsrNv22l8NWGaroybxw96T+OLzuID/qqittbWLSnxsBV9ih1MwwTRg/7zJVSa6kYyFTpa9filwJHf534+45bifvd+mlH10iM9fqfjPm6iPk3BEuWsVD7/48AiKtjExZVUlsM2sf3vQxuI/mQY7KyrEEFzk05JzaZkkJKoOygCD8rWH/esaEZJkCOW8zIhQbwnMvIwsZRniWBe30QAAAAAAAECcAAAAABCl1OgAAGKsxet4rYQJlPh4OT+BsxUHyXvOl8BwXOp7zjJ+j2iA6aukONLVRSKaFyYnT58n+8TUMaJj7aityIw4Zd6w22WrGo4Ix4OaHXFC+R1dxFjnG6YsaU2S6o1wGmTuAdpKd++amaNtooVrfbR7eAnydxjdeaHkVLTCxZtbkoZbhj1dlsjFUzXIs6CX+ly0KpXjX6CZvZ9G3iWMOds0wpulXJ+Yo3KaxvbOvulUU7/ct+JBIvIX8/yIpXhc05vOIMzfUyF781oWmDowH5fctaDilrPjXFPR2ag8RKek2Xyb+xBEpKdMTHa7GpxAtu+Oq4sshFemEO8f0CkxkenlpBCbnQycofubEOcp9Dti2SAorIXPp3peS0SALd2sA0DkIb+P/0ReL5xnjkG4jJydFzPUqRvjtJLbGZ7Zd9+6br+W62vu8Js7AoevAEGwzOIEC64BPPtX+3L7jPun+8H73Pv2+xH8LPxG/GH8e/yW/LH8y/zm/AD9G/01/VD9a/2F/aD9uv3V/e/9Cv4l/j/+Wv50/o/+qf7E/t/++f4U/y7/Sf9j/37/mf+z/87/6P8DAB4AOABTAG0AiACiAL0A2ADyAA0BJwFCAVwBdwGSAawBxwHhAfwBFgIxAkwCZgKBApsCtgLQAusCBgMgAzsDVQNwA4sDpQPAA9oD9QMPBCoEAEHgzeIECygBAAAACgAAAGQAAADoAwAAECcAAKCGAQBAQg8AgJaYAADh9QUAypo7AEGMzuIECyAcAAAAAAAAAAAAAAACAAAAAgAAACwAAAAAAAAAAAAAAABBrM7iBAsgHAAAAAAAAAAAAAAAAgAAAAwAAABsAGkAbgBlAHQAbwAAQczO4gQLMCwAAAAAAAAAAAAAAAIAAAAOAAAAYwB1AHIAdgBlAHQAbwAAAAAAAAAAAAAAAAAAAABB/M7iBAswLAAAAAAAAAAAAAAAAgAAABAAAACIvPjJIADs03jHuNKYzKy5AAAAAAAAAAAAAAAAAEGsz+IECyAcAAAAAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAABBzM/iBAsgHAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAQezP4gQLMCwAAAAAAAAAAAAAAAIAAAAWAAAA7NN4x7jSIAAArDjIJMYwriAARMbMuAAAAAAAAABBnNDiBAtAPAAAAAAAAAAAAAAAAgAAACQAAABLAGUAeQAgAGQAbwBlAHMAIABuAG8AdAAgAGUAeABpAHMAdAAAAAAAAAAAAABB3NDiBAswLAAAAAAAAAAAAAAAAgAAABYAAAB+AGwAaQBiAC8AbQBhAHAALgB0AHMAAAAAAAAAAEGM0eIECzAsAAAAAAAAAAAAAAACAAAAGgAAAG4AbwB0AEUAeABpAHMAdABzAFgAIABExsy4AAAAQbzR4gQLMCwAAAAAAAAAAAAAAAIAAAAWAAAAbABzAHQAIABwAHUAcwBoACAARMbMuAAAAAAAAABB7NHiBAsgHAAAAAAAAAAAAAAAEQAAAAgAAAABAAAAAAAAAAAAAAAAQYzS4gQLIBwAAAAAAAAAAAAAAAIAAAAKAAAAFcgsuCAARMbMuAAAAEGs0uIECzAsAAAAAAAAAAAAAAACAAAAHAAAAHYAYQBsAHUAZQBzACAAcAB1AHMAaAAgAETGzLgAQdzS4gQLIBwAAAAAAAAAAAAAAAIAAAAKAAAAZQByAHIAbwByAAAAAEH80uIECzAsAAAAAAAAAAAAAAACAAAAFAAAAG4AbwB0AEUAeABpAHMAdABzAFgAAAAAAAAAAAAAQazT4gQLMCwAAAAAAAAAAAAAAAIAAAAOAAAAcwB1AGMAYwBlAHMAcwAAAAAAAAAAAAAAAAAAAABB4NPiBAtMEgAAACAAAAAgAAAAIAAAAAAAAAAAAAAAAhoAAAIJAAAgAAAAAkEAAAAAAAAgAAAAAkEAAAAAAAAEQQAAAAAAAAJBAAAQGjQAAAAAAA=="),{asm:{js:t=>{let e=new CAsmStream(CAssembly.asm,t).getString();new Function(e)()}},env:{abort(t,e,i,s){console.error("abort called "+i+":"+s)}}}).then((e=>{CAssembly.asm=e.instance.exports,console.log("Load assembly",t.stopChecker())})).catch(console.error)}class CAssembly{static async getBezierGraphValue(t,e,i,s,o,a,n,r,l){let h=new CAsmStream(CAssembly.asm,0);t.putStream(h),h.putNumber(e),h.putNumber(i),h.putNumber(s),h.putNumber(o),h.putNumber(a),h.putNumber(n),h.putNumber(r),h.putNumber(l),CAssembly.asm.getBezierGraphValue();let d=new CAsmStream(CAssembly.asm,0);if("error"==d.getString())return d.getString();{let t=d.getNumber(),e=new Array;for(let i=0;i<t;i++)e.push(d.getNumber());return e}}}loadAnimationAssembly();const CON_ELLIPSE_CURVE_LENGTH=.552284749831;class CPoint extends CDataClass{constructor(t,e){super(),this.x=0,this.y=0,null!=t&&(this.x=t),null!=e&&(this.y=e)}doToData(t){CDataClass.putData(t,"x",this.x,0),CDataClass.putData(t,"y",this.y,0)}doFromData(t){this.x=CDataClass.getData(t,"x",0),this.y=CDataClass.getData(t,"y",0)}toNotifyPoint(){return new CNotifyPoint(this.x,this.y)}toString(){return this.x+","+this.y}copyFrom(t){this.x=t.x,this.y=t.y}fromStream(t){}static getAngleToPoint(t,e,i,s,o=0){function a(t){return t/180*Math.PI}return new CPoint(e*Math.cos(a(s+o))+t.x,i*Math.sin(a(s+o))+t.y)}static getAngleDistance(t,e){return{angle:CPoint.getAngleFromTwoPoint(t,e),distance:CPoint.getDistancePoints(t,e)}}static getAngleFromTwoPoint(t,e){if(t.x==e.x&&t.y==e.y)return 0;if(t.x==e.x)return t.y<e.y?90:270;if(t.y==e.y)return t.x<e.x?0:180;let i=180*Math.atan((e.y-t.y)/(e.x-t.x))/Math.PI;return e.x<t.x&&e.y<t.y||e.x<t.x&&e.y>=t.y?i=90+(90+i):e.x>=t.x&&e.y<t.y&&(i=270+(90+i)),i}static getTransAnglePoint(t,e,i){let s=e.x-t.x,o=e.y-t.y;if(0==s&&0==o)return t;{let a=Math.sqrt(s*s+o*o);return this.getAngleToPoint(e,a,a,this.getAngleFromTwoPoint(e,t)+i)}}static getDistancePoints(t,e){let i=CCalc.max(t.x,e.x)-CCalc.min(t.x,e.x),s=CCalc.max(t.y,e.y)-CCalc.min(t.y,e.y);return Math.abs(Math.sqrt(i*i+s*s))}static getLineMiddlePoint(t,e,i){return new CPoint(t.x+(e.x-t.x)*i,t.y+(e.y-t.y)*i)}static getPointer(t,e){let i=new CPoint(0,0);return null==e||"offset"==e?(i.x=t.offsetX,i.y=t.offsetY):"page"==e?(i.x=t.pageX,i.y=t.pageY):"screen"==e&&(i.x=t.screenX,i.y=t.screenY),i}static getCrossPoint(t,e,i,s){let o,a=(t.x-e.x)*(i.y-s.y)-(t.y-e.y)*(i.x-s.x);if(0!=a){let n=t.x*e.y-t.y*e.x,r=i.x*s.y-i.y*s.x,l=(n*(i.x-s.x)-(t.x-e.x)*r)/a,h=(n*(i.y-s.y)-(t.y-e.y)*r)/a;o=new CPoint(l,h)}return o}static isInLine(t,e,i){return CPoint.getAngleFromTwoPoint(t,i)==CPoint.getAngleFromTwoPoint(t,e)}static isInCross(t,e,i,s){let o=CPoint.getCrossPoint(t,e,i,s);return null!=o&&(CPoint.isInLine(t,e,o)&&CPoint.isInLine(i,s,o))}static isCrossLineAndPoligon(t,e,i){let s=!1;for(let o=0;o<t.length-1;o++)if(CPoint.isInCross(t[o],t[o+1],e,i)){s=!0;break}return s}static isCrossPoligon(t,e){let i=!1;for(let s=0;s<t.length-1;s++)for(let o=0;o<e.length-1;o++)if(CPoint.isInCross(t[s],t[s+1],e[o],e[o+1])){i=!0;break}return i}static getArrowPoint(t,e,i,s){let o=this.getAngleFromTwoPoint(t,e)-180;return{arrow1:this.getAngleToPoint(e,s,s,i,o),arrow2:this.getAngleToPoint(e,s,s,-i,o)}}static getBezierMiddlePoint(t,e,i,s,o){let a=this.getLineMiddlePoint(t,e,o),n=this.getLineMiddlePoint(e,i,o),r=this.getLineMiddlePoint(i,s,o),l=this.getLineMiddlePoint(a,n,o),h=this.getLineMiddlePoint(n,r,o);return this.getLineMiddlePoint(l,h,o)}static getBezier2MiddlePoint(t,e,i,s){let o=this.getLineMiddlePoint(t,e,s),a=this.getLineMiddlePoint(e,i,s);return this.getLineMiddlePoint(o,a,s)}static getBezierMiddlePointFromPoints(t,e){function i(t){let e=new Array;for(let i=0;i<t.length;i++)e.push(new CPoint(t[i].x,t[i].y));return e}let s,o;for(s=i(t);;){o=[];for(let t=0;t<s.length-1;t++)o.push(this.getLineMiddlePoint(s[t],s[t+1],e));if(o.length<=2)break;s=i(o)}return this.getLineMiddlePoint(o[0],o[1],e)}static getLineCenterAngleToPoint(t,e,i,s,o){let a=180*Math.atan((e.y-t.y)/(e.x-t.x))/Math.PI;e.x<t.x&&e.y<t.y||e.x<t.x&&e.y>=t.y?a=90+(90+a):e.x>=t.x&&e.y<t.y&&(a=270+(90+a));let n=(CCalc.max(t.x,e.x)-CCalc.min(t.x,e.x))/2+CCalc.min(t.x,e.x),r=(CCalc.max(t.y,e.y)-CCalc.min(t.y,e.y))/2+CCalc.min(t.y,e.y);return this.getAngleToPoint(new CPoint(n,r),i,s,o+a)}static getLineMiddleAngleToPoint(t,e,i,s,o,a){let n=180*Math.atan((e.y-t.y)/(e.x-t.x))/Math.PI;e.x<t.x&&e.y<t.y||e.x<t.x&&e.y>=t.y?n=90+(90+n):e.x>=t.x&&e.y<t.y&&(n=270+(90+n));let r=(CCalc.max(t.x,e.x)-CCalc.min(t.x,e.x))*(1-a)+CCalc.min(t.x,e.x),l=(CCalc.max(t.y,e.y)-CCalc.min(t.y,e.y))*(1-a)+CCalc.min(t.y,e.y);return this.getAngleToPoint(new CPoint(r,l),i,s,o+n)}static getPoligonPoints(t,e=!1,i){let s=new CList,o=360/t;for(let e=0;e<t;e++)s.add(CPoint.getAngleToPoint(new CPoint(.5,.5),.5,.5,e*o,i));return e&&s.add(CPoint.getAngleToPoint(new CPoint(.5,.5),.5,.5,0,i)),s}static getHornPoints(t,e,i=!1,s){let o=new CList,a=360/(2*t);for(let i=0;i<2*t;i++)i%2==0?o.add(CPoint.getAngleToPoint(new CPoint(.5,.5),.5,.5,i*a,s)):o.add(CPoint.getAngleToPoint(new CPoint(.5,.5),.5*e,.5*e,i*a,s));return i&&o.add(CPoint.getAngleToPoint(new CPoint(.5,.5),.5,.5,0,s)),o}static create(t=0,e=0){return new CPoint(t,e)}static getDefaultData(){return{x:0,y:0}}static getTransformPoint(t,e,i,s,o,a){let n=new CPoint,r=(e.x-t.left)/t.width,l=(e.y-t.top)/t.height,h=CPoint.getLineMiddlePoint(i,o,l).x,d=CPoint.getLineMiddlePoint(s,a,l).x,g=CPoint.getLineMiddlePoint(i,s,r).y,C=CPoint.getLineMiddlePoint(o,a,r).y;return n.x=CCalc.crRange2Value(t.left,t.right,e.x,h,d),n.y=CCalc.crRange2Value(t.top,t.bottom,e.y,g,C),n}static getTransformCurvePoint(t,e,i,s,o,a,n,r,l,h,d,g,C,c){let u=new CPoint,p=(e.x-t.left)/t.width,A=(e.y-t.top)/t.height,m=CPoint.xTransformLine(i,s,o,a,n,r,l,h,d,g,C,c,p),f=CPoint.yTransformLine(i,s,o,a,n,r,l,h,d,g,C,c,A);return u.x=CPoint.getBezierMiddlePoint(m.startPoint,m.curve1,m.curve2,m.stopPoint,A).x,u.y=CPoint.getBezierMiddlePoint(f.startPoint,f.curve1,f.curve2,f.stopPoint,p).y,u}static getMiddleCurveLineFromTwoLine(t,e,i,s,o,a,n,r,l){let h=CPoint.getLineMiddlePoint(t,o,l),d=CPoint.getLineMiddlePoint(s,r,l);return{startPoint:h,curve1:CPoint.getLineMiddlePoint(e,a,l),curve2:CPoint.getLineMiddlePoint(i,n,l),stopPoint:d}}static xTransformLine(t,e,i,s,o,a,n,r,l,h,d,g,C){let c=CPoint.getLineMiddlePoint(t,e,C),u=CPoint.getLineMiddlePoint(i,s,C),p=CPoint.getDistancePoints(c,u),A=CPoint.getBezierMiddlePoint(t,n,r,e,C),m=CPoint.getBezierMiddlePoint(i,d,g,s,C),f=CPoint.getDistancePoints(A,m)/p,D=CPoint.getMiddleCurveLineFromTwoLine(t,o,a,i,e,l,h,s,C);D.startPoint.x*=f,D.stopPoint.x*=f,D.curve1.x*=f,D.curve2.x*=f,D.startPoint.y*=f,D.stopPoint.y*=f,D.curve1.y*=f,D.curve2.y*=f;let _=A.x-D.startPoint.x;D.startPoint.x+=_,D.stopPoint.x+=_,D.curve1.x+=_,D.curve2.x+=_;let I=A.y-D.startPoint.y;D.startPoint.y+=I,D.stopPoint.y+=I,D.curve1.y+=I,D.curve2.y+=I;let E=CPoint.getAngleFromTwoPoint(c,u),y=CPoint.getAngleFromTwoPoint(A,m);return D.curve1=CPoint.getTransAnglePoint(D.curve1,D.startPoint,y-E),D.curve2=CPoint.getTransAnglePoint(D.curve2,D.startPoint,y-E),D.stopPoint=CPoint.getTransAnglePoint(D.stopPoint,D.startPoint,y-E),{startPoint:D.startPoint,curve1:D.curve1,curve2:D.curve2,stopPoint:D.stopPoint}}static yTransformLine(t,e,i,s,o,a,n,r,l,h,d,g,C){let c=CPoint.getLineMiddlePoint(t,i,C),u=CPoint.getLineMiddlePoint(e,s,C),p=CPoint.getDistancePoints(c,u),A=CPoint.getBezierMiddlePoint(t,o,a,i,C),m=CPoint.getBezierMiddlePoint(e,l,h,s,C),f=CPoint.getDistancePoints(A,m)/p,D=CPoint.getMiddleCurveLineFromTwoLine(t,n,r,e,i,d,g,s,C);D.startPoint.x*=f,D.stopPoint.x*=f,D.curve1.x*=f,D.curve2.x*=f,D.startPoint.y*=f,D.stopPoint.y*=f,D.curve1.y*=f,D.curve2.y*=f;let _=A.x-D.startPoint.x;D.startPoint.x+=_,D.stopPoint.x+=_,D.curve1.x+=_,D.curve2.x+=_;let I=A.y-D.startPoint.y;D.startPoint.y+=I,D.stopPoint.y+=I,D.curve1.y+=I,D.curve2.y+=I;let E=CPoint.getAngleFromTwoPoint(c,u),y=CPoint.getAngleFromTwoPoint(A,m);return D.curve1=CPoint.getTransAnglePoint(D.curve1,D.startPoint,y-E),D.curve2=CPoint.getTransAnglePoint(D.curve2,D.startPoint,y-E),D.stopPoint=CPoint.getTransAnglePoint(D.stopPoint,D.startPoint,y-E),{startPoint:D.startPoint,curve1:D.curve1,curve2:D.curve2,stopPoint:D.stopPoint}}static splitLinePoints(t,e,i){let s=new Array;for(let o=1;o<=i;o++){let a=1/i*o;s.push(CPoint.getLineMiddlePoint(t,e,a))}return s}static splitCurveLinePoints(t,e,i,s,o){let a=new Array;for(let n=1;n<=o;n++){let r=1/o*n;a.push(CPoint.getBezierMiddlePoint(t,e,i,s,r))}return a}static splitCurve2LinePoints(t,e,i,s){let o=new Array;for(let a=1;a<=s;a++){let n=1/s*a;o.push(CPoint.getBezier2MiddlePoint(t,e,i,n))}return o}static lineToFace(t,e,i=10){let s=CPoint.getAngleFromTwoPoint(t,e);return{pt1:CPoint.getAngleToPoint(t,i/2,i/2,-90,s),pt2:CPoint.getAngleToPoint(t,i/2,i/2,90,s),pt3:CPoint.getAngleToPoint(e,i/2,i/2,90,s),pt4:CPoint.getAngleToPoint(e,i/2,i/2,-90,s)}}}class CPoint3D extends CDataClass{get x(){return this._x}set x(t){this._x!=t&&(this._x=t,this.doChange())}get y(){return this._y}set y(t){this._y!=t&&(this._y=t,this.doChange())}get z(){return this._z}set z(t){this._z!=t&&(this._z=t,this.doChange())}constructor(t=0,e=0,i=0){super(),this._x=0,this._y=0,this._z=0,this.onChange=new Array,this.x=t,this.y=e,this.z=i}doToData(t){CDataClass.putData(t,"x",this.x,0),CDataClass.putData(t,"y",this.y,0),CDataClass.putData(t,"z",this.z,0)}doFromData(t){this.x=CDataClass.getData(t,"x",0),this.y=CDataClass.getData(t,"y",0),this.z=CDataClass.getData(t,"z",0)}doChange(){for(let t=0;t<this.onChange.length;t++)this.onChange[t](this)}position3DTo2D(t,e,i,s=0,o=0){let a=.8*i,n=a/(a-this.z);return{x:this.x*n+t,y:this.y*n+e,objectWidth:s*n,objectHeight:o*n}}getRotatePoint(t,e,i,s){return CPoint3D.getRotatePoint(this,t,e,i,s)}distance(t){return CPoint3D.distance(this,t)}static getAngleToPoint3D(t,e,i,s){let o=i*(Math.PI/180),a=e*(Math.PI/180);const n=s*Math.sin(o)*Math.cos(a)+t.x,r=s*Math.sin(o)*Math.sin(a)+t.y,l=s*Math.cos(o)+t.z;return new CPoint3D(n,r,l)}static getAngleToPoint3DEllipse(t,e,i,s,o,a){let n=i*(Math.PI/180),r=e*(Math.PI/180);const l=s*Math.sin(n)*Math.cos(r)+t.x,h=o*Math.sin(n)*Math.sin(r)+t.y,d=a*Math.cos(n)+t.z;return new CPoint3D(l,h,d)}static getRotatePoint(t,e,i,s,o){const a=e*(Math.PI/180),n=i*(Math.PI/180),r=s*(Math.PI/180);let l=t.x+o,h=t.y,d=t.z,g=h*Math.cos(a)-d*Math.sin(a),C=h*Math.sin(a)+d*Math.cos(a);h=g,d=C;let c=l*Math.cos(n)+d*Math.sin(n);return C=d*Math.cos(n)-l*Math.sin(n),l=c,d=C,c=l*Math.cos(r)-h*Math.sin(r),g=l*Math.sin(r)+h*Math.cos(r),l=c,h=g,new CPoint3D(l,h,d)}static distance(t,e){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2)+Math.pow(t.z-e.z,2))}}class CRect extends CDataClass{constructor(t=0,e=0,i=0,s=0){super(),this.left=t,this.top=e,this.right=i,this.bottom=s}get width(){return this.right-this.left}set width(t){this.right=this.left+t}get height(){return this.bottom-this.top}set height(t){this.bottom=this.top+t}set all(t){this.left=t,this.top=t,this.right=t,this.bottom=t}get leftTop(){return new CPoint(this.left,this.top)}get leftBottom(){return new CPoint(this.left,this.bottom)}get rightTop(){return new CPoint(this.right,this.top)}get rightBottom(){return new CPoint(this.right,this.bottom)}get center(){return new CPoint(this.left+this.width/2,this.top+this.height/2)}doToData(t){CDataClass.putData(t,"left",this.left,0),CDataClass.putData(t,"top",this.top,0),CDataClass.putData(t,"right",this.right,0),CDataClass.putData(t,"bottom",this.bottom,0)}doFromData(t){this.left=CDataClass.getData(t,"left",0),this.top=CDataClass.getData(t,"top",0),this.right=CDataClass.getData(t,"right",0),this.bottom=CDataClass.getData(t,"bottom",0)}isIn(t,e){return this.left<=t&&this.right>=t&&this.top<=e&&this.bottom>=e}isInPoint(t){return this.isIn(t.x,t.y)}isInRect(t){let e=!1;return this.isInPoint(t.leftTop)&&this.isInPoint(t.leftBottom)&&this.isInPoint(t.rightTop)&&this.isInPoint(t.rightBottom)&&(e=!0),e}isIntersection(t){let e=!1;return(this.isInPoint(t.leftTop)||this.isInPoint(t.leftBottom)||this.isInPoint(t.rightTop)||this.isInPoint(t.rightBottom))&&(e=!0),(t.isInPoint(this.leftTop)||t.isInPoint(this.leftBottom)||t.isInPoint(this.rightTop)||t.isInPoint(this.rightBottom))&&(e=!0),this.isInRect(t)&&(e=!0),t.isInRect(this)&&(e=!0),t.left<this.left&&t.right>this.right&&t.top>this.top&&t.bottom<this.bottom&&(e=!0),t.left>this.left&&t.right<this.right&&t.top<this.top&&t.bottom>this.bottom&&(e=!0),this.left<t.left&&this.right>t.right&&this.top>t.top&&this.bottom<t.bottom&&(e=!0),this.left>t.left&&this.right<t.right&&this.top<t.top&&this.bottom>t.bottom&&(e=!0),e}isMinusSize(){return this.right<this.left||this.top>this.bottom}getIntersection(t){return new CRect(CCalc.max(this.left,t.left),CCalc.max(this.top,t.top),CCalc.min(this.right,t.right),CCalc.min(this.bottom,t.bottom))}copyFrom(t){this.left=t.left,this.top=t.top,this.right=t.right,this.bottom=t.bottom}inflate(t,e){this.left=this.left-t,this.top=this.top-e,this.right=this.right+t,this.bottom=this.bottom+e}inflateTo(t,e){let i=CRect.create(this.left,this.top,this.right,this.bottom);return i.inflate(t,e),i}offset(t,e){this.left=this.left+t,this.top=this.top+e,this.right=this.right+t,this.bottom=this.bottom+e}set(t,e,i,s){this.left=t,this.top=e,this.right=i,this.bottom=s}getFitRect(t,e){let i=0,s=0,o=0,a=0,n=0,r=0;return o=t.right-t.left,a=this.right-this.left,n=t.bottom-t.top,r=this.bottom-this.top,CCalc.cr(o,n,100,0,4)>CCalc.cr(a,r,100,0,4)?(s=r,i=CCalc.cr(o,n,0,s,3),1==e?new CRect((a-i)/2,0,i+(a-i)/2,s):new CRect(0,0,i,s)):(i=a,s=CCalc.cr(o,n,i,0,4),1==e?new CRect(0,(r-s)/2,i,s+(r-s)/2):new CRect(0,0,i,s))}isEmpty(){return 0==this.left&&0==this.top&&0==this.right&&0==this.bottom}equal(t){return this.left==t.left&&this.top==t.top&&this.right==t.right&&this.bottom==t.bottom}toString(){return this.left+","+this.top+","+this.right+","+this.bottom}fromString(t){let e=t.split(",");(e.length=4)&&(this.left=parseInt(e[0]),this.top=parseInt(e[1]),this.right=parseInt(e[2]),this.bottom=parseInt(e[3]))}static create(t,e,i,s){return new CRect(t,e,i,s)}static getDefaultData(){return{left:0,top:0,right:0,bottom:0}}static newEmpty(){return CRect.create(0,0,0,0)}static copyFrom(t){return new CRect(t.left,t.top,t.right,t.bottom)}}class CNotifyPoint extends CNotifyChangeKindObject{static get CON_CHANGE_X(){return"x"}static get CON_CHANGE_Y(){return"y"}get x(){return this._x}set x(t){this._x!=t&&(this._x=t,this.doChange(CNotifyPoint.CON_CHANGE_X))}get y(){return this._y}set y(t){this._y!=t&&(this._y=t,this.doChange(CNotifyPoint.CON_CHANGE_Y))}constructor(t=0,e=0){super(),this._x=t,this._y=e}doToData(t){super.doToData(t),CDataClass.putData(t,"x",this.x,0),CDataClass.putData(t,"y",this.y,0)}doFromData(t){super.doFromData(t),this.x=CDataClass.getData(t,"x",0),this.y=CDataClass.getData(t,"y",0)}toPoint(){return new CPoint(this.x,this.y)}toString(){return this.x+","+this.y}copyTo(){return new CNotifyPoint(this.x,this.y)}isZero(){return 0==this.x&&0==this.y}static create(t,e){return new CNotifyPoint(t,e)}}class CNotifyRect extends CNotifyChangeKindObject{static get CON_CHANGE_LEFT(){return"l"}static get CON_CHANGE_TOP(){return"t"}static get CON_CHANGE_RIGHT(){return"r"}static get CON_CHANGE_BOTTOM(){return"b"}static get CON_CHANGE_ALL(){return"a"}constructor(t=0,e=0,i=0,s=0){super(),this._left=t,this._top=e,this._right=i,this._bottom=s}get left(){return this._left}set left(t){this._left!=t&&(this._left=t,this.doChange(CNotifyRect.CON_CHANGE_LEFT))}get top(){return this._top}set top(t){this._top!=t&&(this._top=t,this.doChange(CNotifyRect.CON_CHANGE_TOP))}get right(){return this._right}set right(t){this._right!=t&&(this._right=t,this.doChange(CNotifyRect.CON_CHANGE_RIGHT))}get bottom(){return this._bottom}set bottom(t){this._bottom!=t&&(this._bottom=t,this.doChange(CNotifyRect.CON_CHANGE_BOTTOM))}get width(){return this._right-this._left}set width(t){this.width!=t&&(this._right=this._left+t,this.doChange(CNotifyRect.CON_CHANGE_RIGHT))}get height(){return this._bottom-this._top}set height(t){this.height!=t&&(this._bottom=this._top+t,this.doChange(CNotifyRect.CON_CHANGE_BOTTOM))}set all(t){this._left=t,this._top=t,this._right=t,this._bottom=t,this.doChange(CNotifyRect.CON_CHANGE_ALL)}get leftTop(){return new CPoint(this.left,this.top)}get leftBottom(){return new CPoint(this.left,this.bottom)}get rightTop(){return new CPoint(this.right,this.top)}get rightBottom(){return new CPoint(this.right,this.bottom)}get rect(){return new CRect(this._left,this._top,this._right,this._bottom)}equalRect(t){return t.left==this.left&&t.top==this.top&&t.right==this.right&&t.bottom==this.bottom}doToData(t){super.doToData(t),CDataClass.putData(t,"left",this.left,0),CDataClass.putData(t,"top",this.top,0),CDataClass.putData(t,"right",this.right,0),CDataClass.putData(t,"bottom",this.bottom,0)}doFromData(t){super.doFromData(t),this.left=CDataClass.getData(t,"left",0),this.top=CDataClass.getData(t,"top",0),this.right=CDataClass.getData(t,"right",0),this.bottom=CDataClass.getData(t,"bottom",0)}}var EPathPointKind,ETextAlign,EGradientKind,EStyleKind,EStrokeLineCap,EStrokeLineJoin,ECanvasItemAlign,ECanvasItemKind,EPatternKind,EPaintKind,EGraphAnimationValueKind,EPointsValueKind,EControlMoveKind,EPickupAlignKind,EPickupShowKind,EScrollBarKind,EScrollPressKind,EPointerAreaKind,ECellControlAlign,EEditorShowKind,ETabButtonKind,ECalendarDateKind,ESlideDirection,EArrowKind,EDiagramDragKind,EDiagramMode;!function(t){t[t.BEGIN=0]="BEGIN",t[t.MOVETO=1]="MOVETO",t[t.LINETO=2]="LINETO",t[t.CURVETO2=3]="CURVETO2",t[t.CURVETO3=4]="CURVETO3",t[t.CLOSE=5]="CLOSE"}(EPathPointKind||(EPathPointKind={}));class CPathPoint extends CNotifyChangeNotifyObject{constructor(t,e,i){super(),this.pointKind=EPathPointKind.BEGIN;let s=this;this.pointKind=t,this.point=new CNotifyPoint(e,i),this.point.onChange=function(){s.doChange()},this.cPoint1=new CNotifyPoint(0,0),this.cPoint1.onChange=function(){s.doChange()},this.cPoint2=new CNotifyPoint(0,0),this.cPoint2.onChange=function(){s.doChange()}}copyTo(){let t=new CPathPoint(this.pointKind,this.point.x,this.point.y);return t.cPoint1.x=this.cPoint1.x,t.cPoint1.y=this.cPoint1.y,t.cPoint2.x=this.cPoint2.x,t.cPoint2.y=this.cPoint2.y,t}copyFrom(t){this.pointKind=t.pointKind,this.point.copyFrom(t.point),this.cPoint1.copyFrom(t.cPoint1),this.cPoint2.copyFrom(t.cPoint2)}toData(){let t={};return CDataClass.putData(t,"pointKind",this.pointKind,EPathPointKind.LINETO),CDataClass.putData(t,"point",this.point.toData(),{},!0),CDataClass.putData(t,"cPoint1",this.cPoint1.toData(),{},!0),CDataClass.putData(t,"cPoint2",this.cPoint2.toData(),{},!0),t}fromData(t){this.pointKind=CDataClass.getData(t,"pointKind",EPathPointKind.LINETO),this.point.fromData(CDataClass.getData(t,"point",{},!0)),this.cPoint1.fromData(CDataClass.getData(t,"cPoint1",{},!0)),this.cPoint2.fromData(CDataClass.getData(t,"cPoint2",{},!0))}static create(t,e,i,s){let o=new CPathPoint(t,e.x,e.y);return o.cPoint1=i.toNotifyPoint(),o.cPoint2=s.toNotifyPoint(),o}static lineTocurve(t,e,i,s){let o=new CPathPoint(EPathPointKind.CURVETO3,i,s),a=new CPoint(t,e),n=new CPoint(i,s),r=CPoint.getLineMiddlePoint(a,n,1/3);o.cPoint1.x=r.x,o.cPoint1.y=r.y;let l=CPoint.getLineMiddlePoint(a,n,1/3*2);return o.cPoint2.x=l.x,o.cPoint2.y=l.y,o}}class CPathTransformer extends CNotifyChangeNotifyObject{get leftTop(){return this._leftTop}get rightTop(){return this._rightTop}get leftBottom(){return this._leftBottom}get rightBottom(){return this._rightBottom}get leftCurve1(){return this._leftCurve1}get leftCurve2(){return this._leftCurve2}get rightCurve1(){return this._rightCurve1}get rightCurve2(){return this._rightCurve2}get topCurve1(){return this._topCurve1}get topCurve2(){return this._topCurve2}get bottomCurve1(){return this._bottomCurve1}get bottomCurve2(){return this._bottomCurve2}constructor(){super(),this._leftTop=new CNotifyPoint,this._rightTop=new CNotifyPoint,this._leftBottom=new CNotifyPoint,this._rightBottom=new CNotifyPoint,this._leftCurve1=new CNotifyPoint,this._leftCurve2=new CNotifyPoint,this._topCurve1=new CNotifyPoint,this._topCurve2=new CNotifyPoint,this._rightCurve1=new CNotifyPoint,this._rightCurve2=new CNotifyPoint,this._bottomCurve1=new CNotifyPoint,this._bottomCurve2=new CNotifyPoint;let t=this;this.leftTop.onChange=function(){t.doChange()},this.rightTop.onChange=function(){t.doChange()},this.leftBottom.onChange=function(){t.doChange()},this.rightBottom.onChange=function(){t.doChange()},this.leftCurve1.onChange=function(){t.doChange()},this.leftCurve2.onChange=function(){t.doChange()},this.topCurve1.onChange=function(){t.doChange()},this.topCurve2.onChange=function(){t.doChange()},this.rightCurve1.onChange=function(){t.doChange()},this.rightCurve2.onChange=function(){t.doChange()},this.bottomCurve1.onChange=function(){t.doChange()},this.bottomCurve2.onChange=function(){t.doChange()}}getTransformData(t,e){let i=e.copyTo();for(let s=0;s<e.length;s++)if(e.get(s).pointKind==EPathPointKind.MOVETO||e.get(s).pointKind==EPathPointKind.LINETO||e.get(s).pointKind==EPathPointKind.CURVETO2||e.get(s).pointKind==EPathPointKind.CURVETO3){let o=e.get(s).point,a=CPoint.getTransformCurvePoint(t,o.toPoint(),this.leftTop.toPoint(),this.rightTop.toPoint(),this.leftBottom.toPoint(),this.rightBottom.toPoint(),this.leftCurve1.toPoint(),this.leftCurve2.toPoint(),this.topCurve1.toPoint(),this.topCurve2.toPoint(),this.rightCurve1.toPoint(),this.rightCurve2.toPoint(),this.bottomCurve1.toPoint(),this.bottomCurve2.toPoint());i.get(s).point.x=a.x,i.get(s).point.y=a.y,o=e.get(s).cPoint1,a=CPoint.getTransformCurvePoint(t,o.toPoint(),this.leftTop.toPoint(),this.rightTop.toPoint(),this.leftBottom.toPoint(),this.rightBottom.toPoint(),this.leftCurve1.toPoint(),this.leftCurve2.toPoint(),this.topCurve1.toPoint(),this.topCurve2.toPoint(),this.rightCurve1.toPoint(),this.rightCurve2.toPoint(),this.bottomCurve1.toPoint(),this.bottomCurve2.toPoint()),i.get(s).cPoint1.x=a.x,i.get(s).cPoint1.y=a.y,o=e.get(s).cPoint2,a=CPoint.getTransformCurvePoint(t,o.toPoint(),this.leftTop.toPoint(),this.rightTop.toPoint(),this.leftBottom.toPoint(),this.rightBottom.toPoint(),this.leftCurve1.toPoint(),this.leftCurve2.toPoint(),this.topCurve1.toPoint(),this.topCurve2.toPoint(),this.rightCurve1.toPoint(),this.rightCurve2.toPoint(),this.bottomCurve1.toPoint(),this.bottomCurve2.toPoint()),i.get(s).cPoint2.x=a.x,i.get(s).cPoint2.y=a.y}return i}isEmpty(){return 0==this.leftTop.x&&0==this.leftTop.y&&0==this.rightTop.x&&0==this.rightTop.y&&0==this.leftBottom.x&&0==this.leftBottom.y&&0==this.rightBottom.x&&0==this.rightBottom.y&&0==this.leftCurve1.x&&0==this.leftCurve1.y&&0==this.leftCurve2.x&&0==this.leftCurve2.y&&0==this.topCurve1.x&&0==this.topCurve1.y&&0==this.topCurve2.x&&0==this.topCurve2.y&&0==this.rightCurve1.x&&0==this.rightCurve1.y&&0==this.rightCurve2.x&&0==this.rightCurve2.y&&0==this.bottomCurve1.x&&0==this.bottomCurve1.y&&0==this.bottomCurve2.x&&0==this.bottomCurve2.y}}class CPathPointList extends CList{constructor(){super(...arguments),this._width=0,this._height=0,this._transformer=new CPathTransformer}get width(){return this._width}set width(t){this._width!=t&&(this._width=t)}get height(){return this._height}set height(t){this._height!=t&&(this._height=t)}get transformer(){return this._transformer}set transformer(t){if(this._transformer!=t&&(this._transformer=t,this.doChange("transformer"),null!=t)){let e=this;t.onChange=function(){e.doChange("transformer")}}}doToData(t){super.doToData(t);let e=[];for(let t=0;t<this.length;t++){let i=this.get(t).toData();e.push(i)}CDataClass.putData(t,"width",this.width,0),CDataClass.putData(t,"height",this.height,0),CDataClass.putData(t,"data",e,[],!0)}doFromData(t){super.doFromData(t),this.clear(),this.width=CDataClass.getData(t,"width",0),this.height=CDataClass.getData(t,"height",0);let e=CDataClass.getData(t,"data",[],!0);for(let t=0;t<e.length;t++){let i=new CPathPoint(EPathPointKind.BEGIN,0,0);i.fromData(e[t]),this.add(i)}}toData(){let t={};return this.doToData(t),t}add(t){super.add(t);let e=this;t.onChange=function(){e.doChange("point")}}insert(t,e){super.insert(t,e);let i=this;e.onChange=function(){i.doChange("point")}}addPoint(t,e,i,s){this.add(CPathPoint.create(t,e,i,s))}addPointBegin(){this.add(CPathPoint.create(EPathPointKind.BEGIN,CPoint.create(0,0),CPoint.create(0,0),CPoint.create(0,0)))}addPointMoveTo(t){let e=CPathPoint.create(EPathPointKind.MOVETO,t,CPoint.create(0,0),CPoint.create(0,0));return this.add(e),e}addPointLineTo(t){let e=CPathPoint.create(EPathPointKind.LINETO,t,CPoint.create(0,0),CPoint.create(0,0));return this.add(e),e}addPointCurveTo2(t,e){let i=CPathPoint.create(EPathPointKind.CURVETO2,t,e,CPoint.create(0,0));return this.add(i),i}addPointCurveTo3(t,e,i){let s=CPathPoint.create(EPathPointKind.CURVETO3,t,e,i);return this.add(s),s}addArc(t,e,i,s){let o=CPoint.getAngleFromTwoPoint(t,this.get(this.length-1).point.toPoint()),a=e,n=CPoint.getAngleToPoint(t,i,s,o);if(e>0){for(;a>90;){let e=CPoint.getAngleToPoint(t,i,s,o+90),r=.552284749831,l=CPoint.getAngleToPoint(n,i*r,s*r,90,CPoint.getAngleFromTwoPoint(t,n)),h=CPoint.getAngleToPoint(e,i*r,s*r,-90,CPoint.getAngleFromTwoPoint(t,e));this.addPointCurveTo3(e,l,h),n.copyFrom(e),o+=90,a-=90}let e=CPoint.getAngleToPoint(t,i,s,o+a),r=CCalc.cr(.552284749831,0,90,a,2),l=CPoint.getAngleToPoint(n,i*r,s*r,90,CPoint.getAngleFromTwoPoint(t,n)),h=CPoint.getAngleToPoint(e,i*r,s*r,-90,CPoint.getAngleFromTwoPoint(t,e));this.addPointCurveTo3(e,l,h)}else{for(;a<-90;){let e=CPoint.getAngleToPoint(t,i,s,o-90),r=.552284749831,l=CPoint.getAngleToPoint(n,i*r,s*r,-90,CPoint.getAngleFromTwoPoint(t,n)),h=CPoint.getAngleToPoint(e,i*r,s*r,90,CPoint.getAngleFromTwoPoint(t,e));this.addPointCurveTo3(e,l,h),n.copyFrom(e),o-=90,a+=90}let e=CPoint.getAngleToPoint(t,i,s,o+a),r=CCalc.cr(.552284749831,0,90,Math.abs(a),2),l=CPoint.getAngleToPoint(n,i*r,s*r,-90,CPoint.getAngleFromTwoPoint(t,n)),h=CPoint.getAngleToPoint(e,i*r,s*r,90,CPoint.getAngleFromTwoPoint(t,e));this.addPointCurveTo3(e,l,h)}}addDecalcomanieXReverse(t,e=!0,i=!1){function s(e){let i=t-e.x;return new CPoint(t+i,e.y)}let o=new CPathPointList;o.copyFrom(this);for(let t=o.length-1;t>=0;t--){if(t==o.length-1){let i=s(new CPoint(o.get(t).point.x,o.get(t).point.y));e?this.addPointLineTo(i):this.addPointMoveTo(i)}if(t-1>=0){let e=new CPoint(o.get(t-1).point.x,o.get(t-1).point.y),i=new CPoint(o.get(t).cPoint1.x,o.get(t).cPoint1.y),a=new CPoint(o.get(t).cPoint2.x,o.get(t).cPoint2.y);switch(o.get(t).pointKind){case EPathPointKind.MOVETO:this.addPointMoveTo(s(e));break;case EPathPointKind.LINETO:this.addPointLineTo(s(e));break;case EPathPointKind.CURVETO2:this.addPointCurveTo2(s(e),s(i));break;case EPathPointKind.CURVETO3:this.addPointCurveTo3(s(e),s(a),s(i));break;case EPathPointKind.CLOSE:return}}}i&&this.addPointClose()}addDecalcomanieX(t){function e(e){let i=t-e.x;return new CPoint(t+i,e.y)}let i=new CPathPointList;i.copyFrom(this);for(let t=0;t<i.length;t++)switch(i.get(t).pointKind){case EPathPointKind.MOVETO:this.addPointMoveTo(e(i.get(t).point.toPoint()));break;case EPathPointKind.LINETO:this.addPointLineTo(e(i.get(t).point.toPoint()));break;case EPathPointKind.CURVETO2:this.addPointCurveTo2(e(i.get(t).point.toPoint()),e(i.get(t).cPoint1.toPoint()));break;case EPathPointKind.CURVETO3:this.addPointCurveTo3(e(i.get(t).point.toPoint()),e(i.get(t).cPoint1.toPoint()),e(i.get(t).cPoint2.toPoint()));break;case EPathPointKind.CLOSE:this.addPointClose()}}addDecalcomanieYReverse(t,e=!0,i=!1){function s(e){let i=t-e.y;return new CPoint(e.x,t+i)}let o=new CPathPointList;o.copyFrom(this);for(let t=o.length-1;t>=0;t--){if(t==o.length-1){let i=s(o.get(t).point.toPoint());e?this.addPointLineTo(i):this.addPointMoveTo(i)}if(t-1>=0)switch(o.get(t).pointKind){case EPathPointKind.MOVETO:this.addPointMoveTo(s(o.get(t-1).point.toPoint()));break;case EPathPointKind.LINETO:this.addPointLineTo(s(o.get(t-1).point.toPoint()));break;case EPathPointKind.CURVETO2:this.addPointCurveTo2(s(o.get(t-1).point.toPoint()),s(o.get(t).cPoint1.toPoint()));break;case EPathPointKind.CURVETO3:this.addPointCurveTo3(s(o.get(t-1).point.toPoint()),s(o.get(t).cPoint2.toPoint()),s(o.get(t).cPoint1.toPoint()));break;case EPathPointKind.CLOSE:return}}i&&this.addPointClose()}addDecalcomanieY(t){function e(e){let i=t-e.y;return new CPoint(e.x,t+i)}let i=new CPathPointList;i.copyFrom(this);for(let t=0;t<i.length;t++)switch(i.get(t).pointKind){case EPathPointKind.MOVETO:this.addPointMoveTo(e(i.get(t).point.toPoint()));break;case EPathPointKind.LINETO:this.addPointLineTo(e(i.get(t).point.toPoint()));break;case EPathPointKind.CURVETO2:this.addPointCurveTo2(e(i.get(t).point.toPoint()),e(i.get(t).cPoint1.toPoint()));break;case EPathPointKind.CURVETO3:this.addPointCurveTo3(e(i.get(t).point.toPoint()),e(i.get(t).cPoint1.toPoint()),e(i.get(t).cPoint2.toPoint()));break;case EPathPointKind.CLOSE:this.addPointClose()}}addPointClose(){if(this.length>0&&this.get(this.length-1).pointKind==EPathPointKind.CLOSE)return;let t=CPathPoint.create(EPathPointKind.CLOSE,CPoint.create(0,0),CPoint.create(0,0),CPoint.create(0,0));return this.add(t),t}deletePoint(t){if("number"==typeof t)this.length-1>t?(this.get(t+1).pointKind==EPathPointKind.CLOSE&&this.delete(t+1),this.delete(t)):this.length-1==t&&this.delete(t);else{let e=-1;for(let i=0;i<this.length;i++)if(this.get(i)==t){e=i;break}-1!=e&&(this.length-1>e?(this.get(e+1).pointKind==EPathPointKind.CLOSE&&this.delete(e+1),this.delete(e)):this.length-1==e&&this.delete(e))}}setPathData(t){let e=this;this._transformer.isEmpty()||(e=this._transformer.getTransformData(this.getBounds(),this));for(let i=0;i<e.length;i++)switch(e.get(i).pointKind){case EPathPointKind.BEGIN:t.beginPath();break;case EPathPointKind.MOVETO:t.moveTo(e.get(i).point.x,e.get(i).point.y);break;case EPathPointKind.LINETO:t.lineTo(e.get(i).point.x,e.get(i).point.y);break;case EPathPointKind.CURVETO2:t.quadraticCurveTo(e.get(i).cPoint1.x,e.get(i).cPoint1.y,e.get(i).point.x,e.get(i).point.y);break;case EPathPointKind.CURVETO3:t.bezierCurveTo(e.get(i).cPoint1.x,e.get(i).cPoint1.y,e.get(i).cPoint2.x,e.get(i).cPoint2.y,e.get(i).point.x,e.get(i).point.y);break;case EPathPointKind.CLOSE:t.closePath()}}movePoint(t,e){for(var i=0;i<this.length;i++)this.get(i).pointKind!=EPathPointKind.BEGIN&&this.get(i).pointKind!=EPathPointKind.CLOSE&&(this.get(i).point.x=this.get(i).point.x+t,this.get(i).point.y=this.get(i).point.y+e,this.get(i).cPoint1.x=this.get(i).cPoint1.x+t,this.get(i).cPoint1.y=this.get(i).cPoint1.y+e,this.get(i).cPoint2.x=this.get(i).cPoint2.x+t,this.get(i).cPoint2.y=this.get(i).cPoint2.y+e)}scale(t,e){for(var i=0;i<this.length;i++)this.get(i).pointKind!=EPathPointKind.BEGIN&&this.get(i).pointKind!=EPathPointKind.CLOSE&&(this.get(i).point.x=this.get(i).point.x*t,this.get(i).point.y=this.get(i).point.y*e,this.get(i).cPoint1.x=this.get(i).cPoint1.x*t,this.get(i).cPoint1.y=this.get(i).cPoint1.y*e,this.get(i).cPoint2.x=this.get(i).cPoint2.x*t,this.get(i).cPoint2.y=this.get(i).cPoint2.y*e)}getBounds(){if(0==this.length)return new CRect;{let e=Number.MAX_VALUE,i=Number.MAX_VALUE,s=Number.MIN_VALUE,o=Number.MIN_VALUE;for(var t=0;t<this.length;t++)this.get(t).pointKind!=EPathPointKind.BEGIN&&this.get(t).pointKind!=EPathPointKind.CLOSE&&(0==t?(e=this.get(t).point.x,i=this.get(t).point.y,s=this.get(t).point.x,o=this.get(t).point.y):(this.get(t).point.x<e&&(e=this.get(t).point.x),this.get(t).point.y<i&&(i=this.get(t).point.y),this.get(t).point.x>s&&(s=this.get(t).point.x),this.get(t).point.y>o&&(o=this.get(t).point.y)),this.get(t).pointKind!=EPathPointKind.CURVETO2&&this.get(t).pointKind!=EPathPointKind.CURVETO3||(this.get(t).cPoint1.x<e&&(e=this.get(t).cPoint1.x),this.get(t).cPoint1.y<i&&(i=this.get(t).cPoint1.y),this.get(t).cPoint1.x>s&&(s=this.get(t).cPoint1.x),this.get(t).cPoint1.y>o&&(o=this.get(t).cPoint1.y)),this.get(t).pointKind==EPathPointKind.CURVETO3&&(this.get(t).cPoint2.x<e&&(e=this.get(t).cPoint2.x),this.get(t).cPoint2.y<i&&(i=this.get(t).cPoint2.y),this.get(t).cPoint2.x>s&&(s=this.get(t).cPoint2.x),this.get(t).cPoint2.y>o&&(o=this.get(t).cPoint2.y)));return new CRect(e,i,s,o)}}stretch(t){let e;e=this.width>0&&this.height>0?new CRect(0,0,this.width,this.height):this.getBounds();let i=t.width/e.width,s=t.height/e.height;this.width>0&&this.height>0||this.movePoint(-e.left,-e.top),this.scale(i,s),this.movePoint(t.left,t.top),this.doChange("set")}stretchIgnoreSize(t){let e=this.getBounds(),i=t.width/e.width,s=t.height/e.height;this.movePoint(-e.left,-e.top),this.scale(i,s),this.movePoint(t.left,t.top),this.doChange("set")}fit(t){let e;e=this.width>0&&this.height>0?new CRect(0,0,this.width,this.height):this.getBounds();let i=t.getFitRect(e,!0);i.left=i.left+t.left,i.right=i.right+t.left,i.top=i.top+t.top,i.bottom=i.bottom+t.top,this.stretch(i),this.doChange("set")}fitIgnoreSize(t){let e=this.getBounds(),i=t.getFitRect(e,!0);i.left=i.left+t.left,i.right=i.right+t.left,i.top=i.top+t.top,i.bottom=i.bottom+t.top,this.stretchIgnoreSize(i),this.doChange("set")}copyTo(){let t=new CPathPointList;for(var e=0;e<this.length;e++)t.add(this.get(e).copyTo());return t.width=this.width,t.height=this.height,t}referenceCopyTo(){let t=new CPathPointList;for(var e=0;e<this.length;e++)t.add(this.get(e));return t.width=this.width,t.height=this.height,t}stretchTo(t){let e=this.copyTo();return e.stretch(t),e}fitTo(t){let e=this.copyTo();return e.fit(t),e}copyFrom(t){this.clear();for(var e=0;e<t.length;e++){let i=new CPathPoint(EPathPointKind.BEGIN,0,0);i.copyFrom(t.get(e)),this.set(e,i);let s=this;i.onChange=function(){s.doChange("point")}}this.width=t.width,this.height=t.height}rotate(t,e){for(let i=0;i<this.length;i++){let s=this.get(i),o=CPoint.getDistancePoints(t,s.point.toPoint()),a=CPoint.getAngleFromTwoPoint(t,s.point.toPoint()),n=CPoint.getAngleToPoint(t,o,o,a+e);s.point.x=n.x,s.point.y=n.y,o=CPoint.getDistancePoints(t,s.cPoint1.toPoint()),a=CPoint.getAngleFromTwoPoint(t,s.cPoint1.toPoint()),n=CPoint.getAngleToPoint(t,o,o,a+e),s.cPoint1.x=n.x,s.cPoint1.y=n.y,o=CPoint.getDistancePoints(t,s.cPoint2.toPoint()),a=CPoint.getAngleFromTwoPoint(t,s.cPoint2.toPoint()),n=CPoint.getAngleToPoint(t,o,o,a+e),s.cPoint2.x=n.x,s.cPoint2.y=n.y}}toString(){let t="";for(let e=0;e<this.length;e++){let i=this.get(e);switch(0!=e&&(t+="\n"),i.pointKind){case EPathPointKind.BEGIN:t+="b";break;case EPathPointKind.CLOSE:t+="z";break;case EPathPointKind.CURVETO2:case EPathPointKind.CURVETO3:t+="c";break;case EPathPointKind.LINETO:t+="l";break;case EPathPointKind.MOVETO:t+="m"}t+=i.cPoint1.x+","+i.cPoint1.y,t+=" "+i.cPoint2.x+","+i.cPoint2.y,t+=" "+i.point.x+","+i.point.y}return t}fromFontPathData(t){this.clear();let e=t.split("\n");for(let t=0;t<e.length;t++)if(""!=e[t]){let i=e[t].substring(0,1);if("M"==i){let i=e[t].substring(1).split(","),s=new CPathPoint(EPathPointKind.MOVETO,parseFloat(i[0]),parseFloat(i[1]));this.add(s)}else if("L"==i){let i=e[t].substring(1).split(","),s=new CPathPoint(EPathPointKind.LINETO,parseFloat(i[0]),parseFloat(i[1]));this.add(s)}else if("C"==i){let i=e[t].split(" "),s=i[0].substring(1).split(","),o=i[1].split(","),a=i[2].split(","),n=new CPathPoint(EPathPointKind.CURVETO3,parseFloat(a[0]),parseFloat(a[1]));n.cPoint1.x=parseFloat(s[0]),n.cPoint1.y=parseFloat(s[1]),n.cPoint2.x=parseFloat(o[0]),n.cPoint2.y=parseFloat(o[1]),this.add(n)}else if("Q"==i){let i=e[t].split(" "),s=i[0].substring(1).split(","),o=i[1].split(","),a=new CPathPoint(EPathPointKind.CURVETO2,parseFloat(o[0]),parseFloat(o[1]));a.cPoint1.x=parseFloat(s[0]),a.cPoint1.y=parseFloat(s[1]),this.add(a)}else"Z"==i&&this.addPointClose()}}fromFontOpentypePathData(t){this.clear();let e=t.split("\n");for(let t=0;t<e.length;t++)if(""!=e[t]){let i=e[t].substring(0,1);if("M"==i){let i=e[t].substring(1).split(","),s=new CPathPoint(EPathPointKind.MOVETO,parseFloat(i[0]),parseFloat(i[1]));this.add(s)}else if("L"==i){let i=e[t].substring(1).split(","),s=new CPathPoint(EPathPointKind.LINETO,parseFloat(i[0]),parseFloat(i[1]));this.add(s)}else if("C"==i){let i=e[t].split(" "),s=i[0].substring(1).split(","),o=i[1].split(","),a=i[2].split(","),n=new CPathPoint(EPathPointKind.CURVETO3,parseFloat(a[0]),parseFloat(a[1]));n.cPoint1.x=parseFloat(s[0]),n.cPoint1.y=parseFloat(s[1]),n.cPoint2.x=parseFloat(o[0]),n.cPoint2.y=parseFloat(o[1]),this.add(n)}else if("Q"==i){let i=e[t].split(" "),s=i[0].substring(1).split(","),o=i[1].split(","),a=new CPathPoint(EPathPointKind.CURVETO2,parseFloat(o[0]),parseFloat(o[1]));a.cPoint1.x=parseFloat(s[0]),a.cPoint1.y=parseFloat(s[1]),this.add(a)}else"Z"==i&&this.addPointClose()}}makeRectData(t=!1){return this.clear(),this.addPointMoveTo(CPoint.create(0,0)),this.addPointLineTo(CPoint.create(1,0)),this.addPointLineTo(CPoint.create(1,1)),this.addPointLineTo(CPoint.create(0,1)),this.addPointLineTo(CPoint.create(0,0)),t&&this.addPointClose,this}makeRoundRectData(t,e,i,s,o,a,n,r,l){let h;h=null==n?new CStringSet:n,l&&(this.clear(),this.add(CPathPoint.create(EPathPointKind.BEGIN,CPoint.create(t,e),CPoint.create(t,e),CPoint.create(t,e)))),h.has("leftTop")||0==o||0==a?this.add(CPathPoint.create(EPathPointKind.MOVETO,CPoint.create(t,e),CPoint.create(t,e),CPoint.create(t,e))):(this.add(CPathPoint.create(EPathPointKind.MOVETO,CPoint.create(t,e+a),CPoint.create(t,e),CPoint.create(t,e))),this.add(CPathPoint.create(EPathPointKind.CURVETO3,CPoint.create(t+o,e),CPoint.create(t,e+(1-.552284749831)*a),CPoint.create(t+(1-.552284749831)*o,e)))),h.has("rightTop")||0==o||0==a?r.has("top")?this.add(CPathPoint.create(EPathPointKind.MOVETO,CPoint.create(t+i,e),CPoint.create(t,e),CPoint.create(t,e))):this.add(CPathPoint.create(EPathPointKind.LINETO,CPoint.create(t+i,e),CPoint.create(t,e),CPoint.create(t,e))):r.has("top")?(this.add(CPathPoint.create(EPathPointKind.MOVETO,CPoint.create(t+i-o,e),CPoint.create(t,e),CPoint.create(t,e))),this.add(CPathPoint.create(EPathPointKind.CURVETO3,CPoint.create(t+i,e+a),CPoint.create(t+i-(1-.552284749831)*o,e),CPoint.create(t+i,e+(1-.552284749831)*a)))):(this.add(CPathPoint.create(EPathPointKind.LINETO,CPoint.create(t+i-o,e),CPoint.create(t,e),CPoint.create(t,e))),this.add(CPathPoint.create(EPathPointKind.CURVETO3,CPoint.create(t+i,e+a),CPoint.create(t+i-(1-.552284749831)*o,e),CPoint.create(t+i,e+(1-.552284749831)*a)))),h.has("rightBottom")||0==o||0==a?r.has("right")?this.add(CPathPoint.create(EPathPointKind.MOVETO,CPoint.create(t+i,e+s),CPoint.create(t,e),CPoint.create(t,e))):this.add(CPathPoint.create(EPathPointKind.LINETO,CPoint.create(t+i,e+s),CPoint.create(t,e),CPoint.create(t,e))):r.has("right")?(this.add(CPathPoint.create(EPathPointKind.MOVETO,CPoint.create(t+i,e+s-a),CPoint.create(t,e),CPoint.create(t,e))),this.add(CPathPoint.create(EPathPointKind.CURVETO3,CPoint.create(t+i-o,e+s),CPoint.create(t+i,e+s-(1-.552284749831)*a),CPoint.create(t+i-(1-.552284749831)*o,e+s)))):(this.add(CPathPoint.create(EPathPointKind.LINETO,CPoint.create(t+i,e+s-a),CPoint.create(t,e),CPoint.create(t,e))),this.add(CPathPoint.create(EPathPointKind.CURVETO3,CPoint.create(t+i-o,e+s),CPoint.create(t+i,e+s-(1-.552284749831)*a),CPoint.create(t+i-(1-.552284749831)*o,e+s)))),h.has("leftBottom")||0==o||0==a?r.has("bottom")?this.add(CPathPoint.create(EPathPointKind.MOVETO,CPoint.create(t,e+s),CPoint.create(t,e),CPoint.create(t,e))):this.add(CPathPoint.create(EPathPointKind.LINETO,CPoint.create(t,e+s),CPoint.create(t,e),CPoint.create(t,e))):r.has("bottom")?(this.add(CPathPoint.create(EPathPointKind.MOVETO,CPoint.create(t+o,e+s),CPoint.create(t,e),CPoint.create(t,e))),this.add(CPathPoint.create(EPathPointKind.CURVETO3,CPoint.create(t,e+s-a),CPoint.create(t+(1-.552284749831)*o,e+s),CPoint.create(t,e+s-(1-.552284749831)*a)))):(this.add(CPathPoint.create(EPathPointKind.LINETO,CPoint.create(t+o,e+s),CPoint.create(t,e),CPoint.create(t,e))),this.add(CPathPoint.create(EPathPointKind.CURVETO3,CPoint.create(t,e+s-a),CPoint.create(t+(1-.552284749831)*o,e+s),CPoint.create(t,e+s-(1-.552284749831)*a)))),r.has("left")||(h.has("leftTop")||0==o||0==a?this.add(CPathPoint.create(EPathPointKind.LINETO,CPoint.create(t,e),CPoint.create(t,e),CPoint.create(t,e))):this.add(CPathPoint.create(EPathPointKind.LINETO,CPoint.create(t,e+a),CPoint.create(t,e),CPoint.create(t,e))),this.add(CPathPoint.create(EPathPointKind.CLOSE,CPoint.create(t,e),CPoint.create(t,e),CPoint.create(t,e))))}makeEllipseData(t,e,i,s,o=!0){function a(t,e){return CPoint.create(t,e)}o&&(this.clear(),this.add(CPathPoint.create(EPathPointKind.BEGIN,a(t,e),a(t,e),a(t,e)))),this.add(CPathPoint.create(EPathPointKind.MOVETO,a(t,e+s/2),a(t,e),a(t,e))),this.add(CPathPoint.create(EPathPointKind.CURVETO3,a(t+i/2,e),a(t,e+s/2*(1-.552284749831)),a(t+i/2*(1-.552284749831),e))),this.add(CPathPoint.create(EPathPointKind.CURVETO3,a(t+i,e+s/2),a(t+i/2+i/2*.552284749831,e),a(t+i,e+s/2*(1-.552284749831)))),this.add(CPathPoint.create(EPathPointKind.CURVETO3,a(t+i/2,e+s),a(t+i,e+s/2+s/2*.552284749831),a(t+i/2+i/2*.552284749831,e+s))),this.add(CPathPoint.create(EPathPointKind.CURVETO3,a(t,e+s/2),a(t+i/2*(1-.552284749831),e+s),a(t,e+s/2+s/2*.552284749831))),this.add(CPathPoint.create(EPathPointKind.CLOSE,a(t,e),a(t,e),a(t,e)))}makePoligonData(t,e=!1,i){this.clear();let s=CPoint.getPoligonPoints(t,!0,i);for(let t=0;t<s.length;t++)0==t?this.addPointMoveTo(s.get(t)):this.addPointLineTo(s.get(t));return e&&this.addPointClose(),this}makePoligonRoundData(t,e,i=!1,s){this.clear();let o=CPoint.getPoligonPoints(t,!0,s);for(let t=0;t<o.length;t++)if(0==t){let i=CPoint.getLineMiddlePoint(o.get(o.length-2),o.get(o.length-1),e);this.addPointMoveTo(i);let s=new CPoint(0,0);if(t+1<o.length){s=CPoint.getLineMiddlePoint(o.get(0),o.get(1),1-e);let t=this.getCurvePoint(i,o.get(0),s);this.addPointCurveTo3(s,t.ptCurve1,t.ptCurve2)}}else{let i=o[t],s=new CPoint(0,0),a=CPoint.getLineMiddlePoint(o.get(t-1),i,e);if(this.addPointLineTo(a),t+1<o.length){s=CPoint.getLineMiddlePoint(i,o.get(t+1),1-e);let n=this.getCurvePoint(a,i,s);this.addPointCurveTo3(s,n.ptCurve1,n.ptCurve2)}}return i&&this.addPointClose(),this}makeHornData(t,e,i=!1,s){this.clear();let o=CPoint.getHornPoints(t,e,!0,s);for(let t=0;t<o.length;t++)0==t?this.addPointMoveTo(o.get(t)):this.addPointLineTo(o.get(t));return i&&this.addPointClose(),this}makeHornRoundData(t,e,i,s=!0,o=!1,a){this.clear();let n=CPoint.getHornPoints(t,e,!0,a);for(let t=0;t<n.length;t++)if(0==t){let e=CPoint.getLineMiddlePoint(n[n.length-2],n[n.length-1],i);this.addPointMoveTo(e);let s=new CPoint(0,0);if(t+1<n.length){s=CPoint.getLineMiddlePoint(n[0],n[1],1-i);let t=this.getCurvePoint(e,n[0],s);this.addPointCurveTo3(s,t.ptCurve1,t.ptCurve2)}}else if(s)if(t%2==0){let e=n[t],s=new CPoint(0,0),o=CPoint.getLineMiddlePoint(n[t-1],e,i);if(this.addPointLineTo(o),t+1<n.length){s=CPoint.getLineMiddlePoint(e,n[t+1],1-i);let a=this.getCurvePoint(o,e,s);this.addPointCurveTo3(s,a.ptCurve1,a.ptCurve2)}}else this.addPointLineTo(n[t]);else{let e=n[t],s=new CPoint(0,0),o=CPoint.getLineMiddlePoint(n[t-1],e,i);if(this.addPointLineTo(o),t+1<n.length){s=CPoint.getLineMiddlePoint(e,n[t+1],1-i);let a=this.getCurvePoint(o,e,s);this.addPointCurveTo3(s,a.ptCurve1,a.ptCurve2)}}return o&&this.addPointClose(),this}makeArcData(t,e,i){this.clear();let s=e,o=i,a=CPoint.getAngleToPoint(t,.5,.5,s);if(this.addPointMoveTo(a),i>0){for(;o>90;){let e=CPoint.getAngleToPoint(t,.5,.5,s+90),i=.552284749831,n=CPoint.getAngleToPoint(a,.5*i,.5*i,90,CPoint.getAngleFromTwoPoint(t,a)),r=CPoint.getAngleToPoint(e,.5*i,.5*i,-90,CPoint.getAngleFromTwoPoint(t,e));this.addPointCurveTo3(e,n,r),a.copyFrom(e),s+=90,o-=90}let e=CPoint.getAngleToPoint(t,.5,.5,s+o),i=CCalc.cr(.552284749831,0,90,o,2),n=CPoint.getAngleToPoint(a,.5*i,.5*i,90,CPoint.getAngleFromTwoPoint(t,a)),r=CPoint.getAngleToPoint(e,.5*i,.5*i,-90,CPoint.getAngleFromTwoPoint(t,e));this.addPointCurveTo3(e,n,r)}else{for(;o<-90;){let e=CPoint.getAngleToPoint(t,.5,.5,s-90),i=.552284749831,n=CPoint.getAngleToPoint(a,.5*i,.5*i,-90,CPoint.getAngleFromTwoPoint(t,a)),r=CPoint.getAngleToPoint(e,.5*i,.5*i,90,CPoint.getAngleFromTwoPoint(t,e));this.addPointCurveTo3(e,n,r),a.copyFrom(e),s-=90,o+=90}let e=CPoint.getAngleToPoint(t,.5,.5,s+o),i=CCalc.cr(.552284749831,0,90,Math.abs(o),2),n=CPoint.getAngleToPoint(a,.5*i,.5*i,-90,CPoint.getAngleFromTwoPoint(t,a)),r=CPoint.getAngleToPoint(e,.5*i,.5*i,90,CPoint.getAngleFromTwoPoint(t,e));this.addPointCurveTo3(e,n,r)}return this}twoLineToCurve(t,e){if(t-1<0||t+1>this.length-1||this[t].pointKind!=EPathPointKind.LINETO||this[t+1].pointKind!=EPathPointKind.LINETO)return;let i=this.getTwoLineCurvePoint(this[t-1].point,this[t].point,this[t+1].point,e);this[t].point.copyFrom(i.pt1Stop),this.insert(t+1,CPathPoint.create(EPathPointKind.CURVETO3,CPoint.create(i.pt2Start.x,i.pt2Start.y),CPoint.create(i.ptCurve1.x,i.ptCurve1.y),CPoint.create(i.ptCurve2.x,i.ptCurve2.y)))}getTwoLineCurvePoint(t,e,i,s){let o=CPoint.getLineMiddlePoint(t,e,s),a=CPoint.getLineMiddlePoint(e,i,1-s);return{pt1Start:t,pt1Stop:o,ptCurve1:CPoint.getLineMiddlePoint(o,e,.552284749831),ptCurve2:CPoint.getLineMiddlePoint(e,a,1-.552284749831),pt2Start:a,pt2Stop:i}}getCurvePoint(t,e,i){return{ptStart:t,ptCurve1:CPoint.getLineMiddlePoint(t,e,.552284749831),ptCurve2:CPoint.getLineMiddlePoint(e,i,1-.552284749831),ptStop:i}}addPointList(t){for(let e=0;e<t.length;e++){let i=t.get(e).copyTo();this.add(i)}}invertX(){let t=this.getBounds(),e=t.left+t.width/2;for(let t=0;t<this.length;t++)this.get(t).point.x+=2*(e-this.get(t).point.x),this.get(t).cPoint1.x+=2*(e-this.get(t).cPoint1.x),this.get(t).cPoint2.x+=2*(e-this.get(t).cPoint2.x)}invertY(){let t=this.getBounds(),e=t.top+t.height/2;for(let t=0;t<this.length;t++)this.get(t).point.y+=2*(e-this.get(t).point.y),this.get(t).cPoint1.y+=2*(e-this.get(t).cPoint1.y),this.get(t).cPoint2.y+=2*(e-this.get(t).cPoint2.y)}invert(){this.invertX(),this.invertY()}lineToCurve(){for(let t=0;t<this.length;t++)if(this.get(t).pointKind==EPathPointKind.LINETO&&t>0&&(this.get(t-1).pointKind==EPathPointKind.MOVETO||this.get(t-1).pointKind==EPathPointKind.LINETO||this.get(t-1).pointKind==EPathPointKind.CURVETO2||this.get(t-1).pointKind==EPathPointKind.CURVETO3)){let e=this.get(t-1).point;this.get(t).pointKind=EPathPointKind.CURVETO3;let i=CPoint.getLineMiddlePoint(e.toPoint(),this.get(t).point.toPoint(),1/3);this.get(t).cPoint1.x=i.x,this.get(t).cPoint1.y=i.y,i=CPoint.getLineMiddlePoint(e.toPoint(),this.get(t).point.toPoint(),1/3*2),this.get(t).cPoint2.x=i.x,this.get(t).cPoint2.y=i.y}}getSplitLine(t){let e=new CPathPointList;for(let i=0;i<this.length;i++)if(this.get(i).pointKind==EPathPointKind.LINETO||this.get(i).pointKind==EPathPointKind.CURVETO2||this.get(i).pointKind==EPathPointKind.CURVETO3&&i>0){if(this.get(i-1).pointKind==EPathPointKind.MOVETO||this.get(i-1).pointKind==EPathPointKind.LINETO||this.get(i-1).pointKind==EPathPointKind.CURVETO2||this.get(i-1).pointKind==EPathPointKind.CURVETO3){if(this.get(i).pointKind==EPathPointKind.LINETO){let s=CPoint.splitLinePoints(this.get(i-1).point.toPoint(),this.get(i).point.toPoint(),t);for(let t=0;t<s.length;t++)e.addPointLineTo(s[t])}if(this.get(i).pointKind==EPathPointKind.CURVETO2){let s=CPoint.splitCurve2LinePoints(this.get(i-1).point.toPoint(),this.get(i).cPoint1.toPoint(),this.get(i).point.toPoint(),t);for(let t=0;t<s.length;t++)e.addPointLineTo(s[t])}if(this.get(i).pointKind==EPathPointKind.CURVETO3){let s=CPoint.splitCurveLinePoints(this.get(i-1).point.toPoint(),this.get(i).cPoint1.toPoint(),this.get(i).cPoint2.toPoint(),this.get(i).point.toPoint(),t);for(let t=0;t<s.length;t++)e.addPointLineTo(s[t])}}}else e.add(this.get(i).copyTo());return e}splitLine(t){let e=this.getSplitLine(t);this.copyFrom(e)}putStream(t){let e=0,i=new Array;for(let t=0;t<this.length;t++)this.get(t).pointKind!=EPathPointKind.MOVETO&&this.get(t).pointKind!=EPathPointKind.LINETO&&this.get(t).pointKind!=EPathPointKind.CURVETO2&&this.get(t).pointKind!=EPathPointKind.CURVETO3||(e++,i.push(this.get(t)));t.putNumber(e);for(let e=0;e<i.length;e++)i[e].pointKind==EPathPointKind.MOVETO?t.putString("moveto"):i[e].pointKind==EPathPointKind.LINETO?t.putString("lineto"):i[e].pointKind==EPathPointKind.CURVETO2||i[e].pointKind==EPathPointKind.CURVETO3?t.putString("curveto"):t.putString("error"),t.putNumber(i[e].point.x),t.putNumber(i[e].point.y),t.putNumber(i[e].cPoint1.x),t.putNumber(i[e].cPoint1.y),i[e].pointKind==EPathPointKind.CURVETO2?(t.putNumber(i[e].cPoint1.x),t.putNumber(i[e].cPoint1.y)):(t.putNumber(i[e].cPoint2.x),t.putNumber(i[e].cPoint2.y))}}class CFont extends CNotifyChangeKindObject{constructor(){super(...arguments),this._fontStyle="normal",this._fontVariant="normal",this._fontWeight="normal",this._fontSize=12,this._fontFamily="Arial"}static get CON_CHANGE_STYLE(){return"s"}static get CON_CHANGE_VARIANT(){return"v"}static get CON_CHANGE_WEIGHT(){return"w"}static get CON_CHANGE_SIZE(){return"si"}static get CON_CHANGE_FAMILY(){return"f"}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!=t&&(this._fontStyle=t,this.doChange(CFont.CON_CHANGE_STYLE))}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!=t&&(this._fontVariant=t,this.doChange(CFont.CON_CHANGE_VARIANT))}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!=t&&(this._fontWeight=t,this.doChange(CFont.CON_CHANGE_WEIGHT))}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!=t&&(this._fontSize=t,this.doChange(CFont.CON_CHANGE_SIZE))}get fontFamily(){return this._fontFamily}set fontFamily(t){this._fontFamily!=t&&(this._fontFamily=t,this.doChange(CFont.CON_CHANGE_FAMILY))}doToData(t){super.doToData(t),CDataClass.putData(t,"fontStyle",this.fontStyle,"normal"),CDataClass.putData(t,"fontVariant",this.fontVariant,"normal"),CDataClass.putData(t,"fontWeight",this.fontWeight,"normal"),CDataClass.putData(t,"fontSize",this.fontSize,12),CDataClass.putData(t,"fontFamily",this.fontFamily,"Arial")}doFromData(t){super.doFromData(t),this.fontStyle=CDataClass.getData(t,"fontStyle","normal"),this.fontVariant=CDataClass.getData(t,"fontVariant","normal"),this.fontWeight=CDataClass.getData(t,"fontWeight","normal"),this.fontSize=CDataClass.getData(t,"fontSize",12),this.fontFamily=CDataClass.getData(t,"fontFamily","Arial")}setFont(t){t.font=this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+this.fontSize+"px "+this.fontFamily}}!function(t){t[t.HEAD=0]="HEAD",t[t.CENTER=1]="CENTER",t[t.TAIL=2]="TAIL"}(ETextAlign||(ETextAlign={}));class CCustomTextSet extends CFont{static get CON_CHANGE_H_ALIGN(){return"h"}static get CON_CHANGE_V_ALIGN(){return"v"}static get CON_CHANGE_MARGINS(){return"m"}constructor(){super(),this._hAlign=ETextAlign.CENTER,this._vAlign=ETextAlign.CENTER,this._margins=new CNotifyRect(0,0,0,0);let t=this;this._margins.onChange=function(){t.doChange(CCustomTextSet.CON_CHANGE_MARGINS)}}get margins(){return this._margins}get hAlign(){return this._hAlign}set hAlign(t){this._hAlign!=t&&(this._hAlign=t,this.doChange(CCustomTextSet.CON_CHANGE_H_ALIGN))}get vAlign(){return this._vAlign}set vAlign(t){this._vAlign!=t&&(this._vAlign=t,this.doChange(CCustomTextSet.CON_CHANGE_V_ALIGN))}doToData(t){super.doToData(t),CDataClass.putData(t,"hAlign",this.hAlign,ETextAlign.CENTER),CDataClass.putData(t,"vAlign",this.vAlign,ETextAlign.CENTER),CDataClass.putData(t,"margins",this.margins.toData(),{},!0)}doFromData(t){super.doFromData(t),this.hAlign=CDataClass.getData(t,"hAlign",ETextAlign.CENTER),this.vAlign=CDataClass.getData(t,"vAlign",ETextAlign.CENTER),this.margins.fromData(CDataClass.getData(t,"margins",{},!0))}getTextPoint(t,e){let i=0,s=0;switch(this.hAlign){case ETextAlign.HEAD:t.textAlign="left",i=e.left+this._margins.left;break;case ETextAlign.CENTER:t.textAlign="center",i=e.left+e.width/2;break;case ETextAlign.TAIL:t.textAlign="right",i=e.right-this._margins.right}switch(this.vAlign){case ETextAlign.HEAD:s=e.top+this._margins.top+this._fontSize;break;case ETextAlign.CENTER:s=e.top+e.height/2+this._fontSize/3;break;case ETextAlign.TAIL:s=e.bottom-this._margins.bottom}return new CPoint(i,s)}}class CTextSet extends CCustomTextSet{static get CON_CHANGE_ENABLED(){return"e"}static get CON_CHANGE_FILL(){return"fill"}static get CON_CHANGE_STROKE(){return"stroke"}static get CON_CHANGE_LANGUAGE_KEY(){return"lk"}constructor(){super(),this._enabled=!0,this._fill=new CFillSet,this._stroke=new CStrokeSet,this._languageKey="",this._lineSpacing=0;let t=this;this._fill.styleKind=EStyleKind.SOLID,this._fill.solidColor="#000000",this._fill.onChange=function(){t.doChange(CTextSet.CON_CHANGE_FILL)},this._stroke.onChange=function(){t.doChange(CTextSet.CON_CHANGE_STROKE)}}get fill(){return this._fill}get stroke(){return this._stroke}get enabled(){return this._enabled}set enabled(t){this._enabled=t}get languageKey(){return this._languageKey}set languageKey(t){this._languageKey!=t&&(this._languageKey=t,this.doChange(CTextSet.CON_CHANGE_LANGUAGE_KEY))}get lineSpacing(){return this._lineSpacing}set lineSpacing(t){this._lineSpacing!=t&&(this._lineSpacing=t,this.doChange("lineSpacing"))}doToData(t){super.doToData(t),CDataClass.putData(t,"enabled",this.enabled,!0),CDataClass.putData(t,"fill",this.fill.toData(),{styleKind:1,solidColor:"#000000"},!0),CDataClass.putData(t,"stroke",this.stroke.toData(),{},!0),CDataClass.putData(t,"languageKey",this.languageKey,""),CDataClass.putData(t,"lineSpacing",this.lineSpacing,0)}doFromData(t){super.doFromData(t),this.enabled=CDataClass.getData(t,"enabled",!0),this.fill.fromData(CDataClass.getData(t,"fill",{styleKind:1,solidColor:"#000000"},!0)),this.stroke.fromData(CDataClass.getData(t,"stroke",{},!0)),this.languageKey=CDataClass.getData(t,"languageKey",""),this.lineSpacing=CDataClass.getData(t,"lineSpacing",0)}drawText(t,e,i,s){if(!this._enabled||0==e.width||0==e.height)return;let o=s;if(null!=o){o.canvas.width=e.width,o.canvas.height=e.height,o.font=this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.fill.setContext(o,e),this.stroke.setContext(o,e);let s=this.getTextPoint(o,new CRect(0,0,e.width,e.height));if(i.indexOf("\n")>=0){let t=i.split("\n"),e=0;e=this.vAlign==ETextAlign.HEAD?s.y-this.fontSize/2+.5*this.fontSize:this.vAlign==ETextAlign.CENTER?s.y-t.length*this.fontSize/2+.5*this.fontSize-(t.length-1)*this.lineSpacing/2:s.y-t.length*this.fontSize+.5*this.fontSize-(t.length-1)*this.lineSpacing;for(let i=0;i<t.length;i++)this.fill.styleKind!=EStyleKind.EMPTY&&o.fillText(t[i],s.x,e),this.stroke.styleKind!=EStyleKind.EMPTY&&o.strokeText(t[i],s.x,e),e+=this.fontSize+this.lineSpacing}else this.fill.styleKind!=EStyleKind.EMPTY&&o.fillText(i,s.x,s.y),this.stroke.styleKind!=EStyleKind.EMPTY&&o.strokeText(i,s.x,s.y);t.drawImage(o.canvas,e.left,e.top,e.width,e.height)}else{t.font=this.fontStyle+" "+this.fontVariant+" "+this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.fill.setContext(t,e),this.stroke.setContext(t,e);let s=this.getTextPoint(t,e);if(i.indexOf("\n")>=0){let e=i.split("\n"),o=0;o=this.vAlign==ETextAlign.HEAD?s.y-this.fontSize/2+.5*this.fontSize:this.vAlign==ETextAlign.CENTER?s.y-e.length*this.fontSize/2+.5*this.fontSize-(e.length-1)*this.lineSpacing/2:s.y-e.length*this.fontSize+.5*this.fontSize-(e.length-1)*this.lineSpacing;for(let i=0;i<e.length;i++)this.fill.styleKind!=EStyleKind.EMPTY&&t.fillText(e[i],s.x,o),this.stroke.styleKind!=EStyleKind.EMPTY&&t.strokeText(e[i],s.x,o),o+=this.fontSize+this.lineSpacing}else this.fill.styleKind!=EStyleKind.EMPTY&&t.fillText(i,s.x,s.y),this.stroke.styleKind!=EStyleKind.EMPTY&&t.strokeText(i,s.x,s.y)}}static create(t,e=ETextAlign.CENTER,i=ETextAlign.CENTER,s=12){let o=new CTextSet;return o.fill.solidColor=t,o.hAlign=e,o.vAlign=i,o.fontSize=s,o.margins.all=5,o}addProperties(){let t=new Array;return t.push({instance:this.hAlign,propertyName:"hAlign",readOnly:!1,enum:["HEAD","CENTER","TAIL"]}),t.push({instance:this.vAlign,propertyName:"vAlign",readOnly:!1,enum:["HEAD","CENTER","TAIL"]}),t}}class CGradientPoint extends CNotifyChangeKindObject{static get CON_CHANGE_OFFSET(){return"o"}static get CON_CHANGE_COLOR(){return"c"}constructor(t,e){super(),this._offset=0,this._color="rgba(255,255,255,1)",this._offset=t,this._color=e}get offset(){return this._offset}set offset(t){this._offset!=t&&(this._offset=t,this.doChange(CGradientPoint.CON_CHANGE_OFFSET))}get color(){return this._color}set color(t){this._color!=t&&(this._color=t,this.doChange(CGradientPoint.CON_CHANGE_COLOR))}doToData(t){super.doToData(t),CDataClass.putData(t,"offset",this.offset,0),CDataClass.putData(t,"color",this.color,"rgba(255,255,255,1)")}doFromData(t){super.doFromData(t),this.offset=CDataClass.getData(t,"offset",0),this.color=CDataClass.getData(t,"color","rgba(255,255,255,1)")}static create(t,e){return new CGradientPoint(t,e)}}class CGradientPointList extends CList{addPoint(t,e){let i=CGradientPoint.create(t,e),s=this;i.onChange=function(){s.doChange("point")},this.add(i)}insertPoint(t,e,i){let s=CGradientPoint.create(e,i),o=this;s.onChange=function(){o.doChange("point")},this.insert(t,s)}doToData(t){super.doToData(t);for(let e=0;e<this.length;e++)t.push(this.get(e).toData())}doFromData(t){this.clear();let e=this;for(let i=0;i<t.length;i++){let s=new CGradientPoint(0,"");s.fromData(t[i]),s.onChange=function(){e.doChange("point")},this.add(s)}}}!function(t){t[t.LINEAR=0]="LINEAR",t[t.RADIAL=1]="RADIAL"}(EGradientKind||(EGradientKind={}));class CGradient extends CNotifyChangeKindObject{static get CON_CHANGE_GRADIENT_KIND(){return"g"}static get CON_CHANGE_START_POINT(){return"sp"}static get CON_CHANGE_STOP_POINT(){return"stp"}static get CON_CHANGE_POINT_LIST(){return"pl"}static get CON_CHANGE_START_RADIUS(){return"sr"}static get CON_CHANGE_STOP_RADIUS(){return"str"}constructor(){super(),this._gradientKind=EGradientKind.LINEAR,this._startPoint=new CNotifyPoint(0,0),this._stopPoint=new CNotifyPoint(0,1),this._pointList=new CGradientPointList,this._startRadius=0,this._stopRadius=360;let t=this;this._pointList.onChange=function(e,i){t.doChange(CGradient.CON_CHANGE_POINT_LIST)},this._startPoint.onChange=function(e,i){t.doChange(CGradient.CON_CHANGE_START_POINT)},this._stopPoint.onChange=function(e,i){t.doChange(CGradient.CON_CHANGE_STOP_POINT)}}get pointList(){return this._pointList}get gradientKind(){return this._gradientKind}set gradientKind(t){this._gradientKind!=t&&(this._gradientKind=t,this.doChange(CGradient.CON_CHANGE_GRADIENT_KIND))}get startPoint(){return this._startPoint}set startPoint(t){if(this._startPoint!=t){let e=this;this._startPoint=t,this._startPoint.onChange=function(t,i){e.doChange(CGradient.CON_CHANGE_START_POINT)},this.doChange(CGradient.CON_CHANGE_START_POINT)}}get stopPoint(){return this._stopPoint}set stopPoint(t){if(this._stopPoint!=t){let e=this;this._stopPoint=t,this._stopPoint.onChange=function(t,i){e.doChange(CGradient.CON_CHANGE_STOP_POINT)},this.doChange(CGradient.CON_CHANGE_STOP_POINT)}}get startRadius(){return this._startRadius}set startRadius(t){this._startRadius!=t&&(this._startRadius=t,this.doChange(CGradient.CON_CHANGE_START_RADIUS))}get stopRadius(){return this._stopRadius}set stopRadius(t){this._stopRadius!=t&&(this._stopRadius=t,this.doChange(CGradient.CON_CHANGE_STOP_RADIUS))}doToData(t){super.doToData(t),CDataClass.putData(t,"gradientKind",this.gradientKind,EGradientKind.LINEAR),CDataClass.putData(t,"startPoint",this.startPoint.toData(),{},!0),CDataClass.putData(t,"stopPoint",this.stopPoint.toData(),{y:1},!0),CDataClass.putData(t,"pointList",this.pointList.toData(),[],!0),CDataClass.putData(t,"startRadius",this.startRadius,0),CDataClass.putData(t,"stopRadius",this.stopRadius,360)}doFromData(t){super.doFromData(t),this.gradientKind=CDataClass.getData(t,"gradientKind",EGradientKind.LINEAR),this.startPoint.fromData(CDataClass.getData(t,"startPoint",{},!0)),this.stopPoint.fromData(CDataClass.getData(t,"stopPoint",{y:1},!0)),this.pointList.fromData(CDataClass.getData(t,"pointList",[],!0)),this.startRadius=CDataClass.getData(t,"startRadius",0),this.stopRadius=CDataClass.getData(t,"stopRadius",360)}getGradient(t,e){let i,s=e.left+this._startPoint.x*e.width,o=e.top+this._startPoint.y*e.height,a=e.left+this._stopPoint.x*e.width,n=e.top+this._stopPoint.y*e.height;if(!(isNaN(s)||isNaN(o)||isNaN(a)||isNaN(n))){i=this._gradientKind==EGradientKind.LINEAR?t.createLinearGradient(e.left+this._startPoint.x*e.width,e.top+this._startPoint.y*e.height,e.left+this._stopPoint.x*e.width,e.top+this._stopPoint.y*e.height):t.createRadialGradient(e.left+this._startPoint.x*e.width,e.top+this._startPoint.y*e.height,this._startRadius,e.left+this._stopPoint.x*e.width,e.top+this._stopPoint.y*e.height,this._stopRadius);for(var r=0;r<this._pointList.length;r++)i.addColorStop(this._pointList.get(r).offset,this._pointList.get(r).color);return i}}}!function(t){t[t.EMPTY=0]="EMPTY",t[t.SOLID=1]="SOLID",t[t.GRADIENT=2]="GRADIENT"}(EStyleKind||(EStyleKind={}));class CFillSet extends CGradient{constructor(){super(...arguments),this._styleKind=EStyleKind.EMPTY,this._solidColor="rgba(255,255,255,1)"}static get CON_CHANGE_STYLE_KIND(){return"styleKind"}static get CON_CHANGE_SOLID_COLOR(){return"solidColor"}get styleKind(){return this._styleKind}set styleKind(t){t!=this._styleKind&&(this._styleKind=t,this.doChange(CFillSet.CON_CHANGE_STYLE_KIND))}get solidColor(){return this._solidColor}set solidColor(t){t!=this._solidColor&&(this._solidColor=t,this.doChange(CFillSet.CON_CHANGE_SOLID_COLOR))}doToData(t){super.doToData(t),CDataClass.putData(t,"styleKind",this.styleKind,EStyleKind.EMPTY),CDataClass.putData(t,"solidColor",this.solidColor,"rgba(255,255,255,1)")}doFromData(t){super.doFromData(t),this.styleKind=CDataClass.getData(t,"styleKind",EStyleKind.EMPTY),this.solidColor=CDataClass.getData(t,"solidColor","rgba(255,255,255,1)")}setContext(t,e){switch(this.styleKind){case EStyleKind.SOLID:t.fillStyle=this.solidColor;break;case EStyleKind.GRADIENT:let i=this.getGradient(t,e);null!=i&&(t.fillStyle=i)}}}!function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE"}(EStrokeLineCap||(EStrokeLineCap={})),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER"}(EStrokeLineJoin||(EStrokeLineJoin={}));class CStrokeSet extends CFillSet{constructor(){super(...arguments),this.__lineDash=[],this._lineWidth=0,this._lineCap=EStrokeLineCap.ROUND,this._lineJoin=EStrokeLineJoin.ROUND,this._lineDash=""}static get CON_CHANGE_LINE_WIDTH(){return"lineWidth"}static get CON_CHANGE_LINE_CAP(){return"lineCap"}static get CON_CHANGE_LINE_JOIN(){return"lineJoin"}static get CON_CHANGE_LINE_DASH(){return"lineDash"}get lineWidth(){return this._lineWidth}set lineWidth(t){t!=this._lineWidth&&(this._lineWidth=t,this.doChange(CStrokeSet.CON_CHANGE_LINE_WIDTH))}get lineCap(){return this._lineCap}set lineCap(t){t!=this._lineCap&&(this._lineCap=t,this.doChange(CStrokeSet.CON_CHANGE_LINE_CAP))}get lineJoin(){return this._lineJoin}set lineJoin(t){t!=this._lineJoin&&(this._lineJoin=t,this.doChange(CStrokeSet.CON_CHANGE_LINE_JOIN))}get lineDash(){return this._lineDash}set lineDash(t){if(t!=this._lineDash){if(this._lineDash=t,""!=t){let t=this._lineDash.split(",");this.__lineDash=[];for(let e=0;e<t.length;e++)this.__lineDash.push(parseFloat(t[e]))}this.doChange(CStrokeSet.CON_CHANGE_LINE_DASH)}}doToData(t){super.doToData(t),CDataClass.putData(t,"lineWidth",this.lineWidth,0),CDataClass.putData(t,"lineCap",this.lineCap,EStrokeLineCap.ROUND),CDataClass.putData(t,"lineJoin",this.lineJoin,EStrokeLineJoin.ROUND),CDataClass.putData(t,"lineDash",this.lineDash,"")}doFromData(t){super.doFromData(t),this.lineWidth=CDataClass.getData(t,"lineWidth",0),this.lineCap=CDataClass.getData(t,"lineCap",EStrokeLineCap.ROUND),this.lineJoin=CDataClass.getData(t,"lineJoin",EStrokeLineJoin.ROUND),this.lineDash=CDataClass.getData(t,"lineDash","")}setContext(t,e){switch(this.styleKind){case EStyleKind.SOLID:t.strokeStyle=this.solidColor;break;case EStyleKind.GRADIENT:let i=this.getGradient(t,e);null!=i&&(t.strokeStyle=i)}switch(t.lineWidth=this.lineWidth,this.lineCap){case EStrokeLineCap.BUTT:t.lineCap="butt";break;case EStrokeLineCap.ROUND:t.lineCap="round";break;case EStrokeLineCap.SQUARE:t.lineCap="square"}switch(this.lineJoin){case EStrokeLineJoin.BEVEL:t.lineJoin="bevel";break;case EStrokeLineJoin.MITER:t.lineJoin="miter";break;case EStrokeLineJoin.ROUND:t.lineJoin="round"}t.setLineDash(this.__lineDash)}}!function(t){t[t.NONE=0]="NONE",t[t.LEFT=1]="LEFT",t[t.TOP=2]="TOP",t[t.RIGHT=3]="RIGHT",t[t.BOTTOM=4]="BOTTOM",t[t.CLIENT=5]="CLIENT",t[t.CENTER=6]="CENTER",t[t.LEFTTOP=7]="LEFTTOP",t[t.RIGHTTOP=8]="RIGHTTOP",t[t.LEFTBOTTOM=9]="LEFTBOTTOM",t[t.RIGHTBOTTOM=10]="RIGHTBOTTOM",t[t.MIDDLELEFT=11]="MIDDLELEFT",t[t.MIDDLETOP=12]="MIDDLETOP",t[t.MIDDLERIGHT=13]="MIDDLERIGHT",t[t.MIDDLEBOTTOM=14]="MIDDLEBOTTOM",t[t.HCENTER=15]="HCENTER",t[t.VCENTER=16]="VCENTER"}(ECanvasItemAlign||(ECanvasItemAlign={})),function(t){t[t.RECTANGLE=0]="RECTANGLE",t[t.ROUNDRECTANGLE=1]="ROUNDRECTANGLE",t[t.ELLIPSE=2]="ELLIPSE",t[t.ARC=3]="ARC",t[t.PATH=4]="PATH",t[t.TEXT=5]="TEXT",t[t.IMAGE=6]="IMAGE"}(ECanvasItemKind||(ECanvasItemKind={})),function(t){t[t.ALL=0]="ALL",t[t.CHECK_HEAD=1]="CHECK_HEAD",t[t.CHECK_TAIL=2]="CHECK_TAIL",t[t.COLUMN=3]="COLUMN",t[t.ROW=4]="ROW"}(EPatternKind||(EPatternKind={})),function(t){t[t.NORMAL=0]="NORMAL",t[t.PATTERN=1]="PATTERN",t[t.ROTATE=2]="ROTATE",t[t.RANDOM=3]="RANDOM"}(EPaintKind||(EPaintKind={}));class CCanvasItem extends CNotifyChangeKindObject{static get CON_CHANGE_ALIGN(){return"a"}static get CON_CHANGE_KIND(){return"k"}static get CON_CHANGE_NAME(){return"i"}static get CON_CHANGE_POSITION(){return"p"}static get CON_CHANGE_POSITION_UNIT(){return"pu"}static get CON_CHANGE_ROTATION_ANGLE(){return"ra"}static get CON_CHANGE_ROTATION_CENTER_X(){return"rx"}static get CON_CHANGE_ROTATION_CENTER_Y(){return"ry"}static get CON_CHANGE_MARGINS(){return"m"}static get CON_CHANGE_FILL(){return"f"}static get CON_CHANGE_STROKE(){return"s"}static get CON_CHANGE_OPACITY(){return"o"}static get CON_CHANGE_VISIBLE(){return"v"}static get CON_CHANGE_PATH_DATA(){return"pd"}static get CON_CHANGE_RADIUS_X(){return"rax"}static get CON_CHANGE_RADIUS_Y(){return"ray"}static get CON_CHANGE_DISABLE_ROUND_SET(){return"dr"}static get CON_CHANGE_DISABLE_LINE_SET(){return"dl"}static get CON_CHANGE_TEXTSET(){return"tx"}static get CON_CHANGE_TEXT(){return"t"}static get CON_CHANGE_FILTER(){return"fi"}static get CON_CHANGE_SHADOW_COLOR(){return"sc"}static get CON_CHANGE_SHADOW_BLUR(){return"sb"}static get CON_CHANGE_SHADOW_OFFSET_X(){return"sx"}static get CON_CHANGE_SHADOW_OFFSET_Y(){return"sy"}constructor(){super(),this._align=ECanvasItemAlign.NONE,this._kind=ECanvasItemKind.RECTANGLE,this._name="",this._position=new CNotifyRect(0,0,0,0),this._positionUnit=EPositionUnit.PIXEL,this._rotationAngle=0,this._rotationCenterX=.5,this._rotationCenterY=.5,this._margins=new CNotifyRect(0,0,0,0),this._fill=new CFillSet,this._stroke=new CStrokeSet,this._opacity=1,this._composite="source-over",this._visible=!0,this._pathData=new CPathPointList,this._pathFitMode=EFitMode.STRETCH,this._radiusX=0,this._radiusY=0,this._disableRoundSet=new CStringSet,this._disableLineSet=new CStringSet,this._textSet=new CTextSet,this._text="",this._imageSrc="",this._imageFitMode=EFitMode.FIT,this._paintKind=EPaintKind.NORMAL,this._paintWidth=50,this._paintHeight=50,this._patternIgnoreCount=0,this._patternMargin=0,this._patternKind=EPatternKind.ALL,this._paintRotateCount=5,this._paintRotateStartAngle=-90,this._paintRotateStopAngle=270,this._paintRotateRadiusX=.5,this._paintRotateRadiusY=.5,this._paintRotateApplyAngle=!0,this._randomCount=10,this._randomWidthMin=10,this._randomWidthMax=100,this._randomHeightMin=10,this._randomHeightMax=100,this._filter="",this._shadowColor="",this._shadowBlur=0,this._shadowOffsetX=0,this._shadowOffsetY=0;let t=this;this._position.onChange=function(){t.doChange(CCanvasItem.CON_CHANGE_POSITION)},this._pathData.onChange=function(){t.doChange(CCanvasItem.CON_CHANGE_PATH_DATA)},this._fill.onChange=function(){t.doChange(CCanvasItem.CON_CHANGE_FILL)},this._stroke.onChange=function(){t.doChange(CCanvasItem.CON_CHANGE_STROKE)},this._disableRoundSet.onChange=function(){t.doChange(CCanvasItem.CON_CHANGE_DISABLE_ROUND_SET)},this._disableLineSet.onChange=function(){t.doChange(CCanvasItem.CON_CHANGE_DISABLE_LINE_SET)},this._textSet.onChange=function(){t.doChange(CCanvasItem.CON_CHANGE_TEXTSET)},this._margins.onChange=function(){t.doChange(CCanvasItem.CON_CHANGE_MARGINS)}}get align(){return this._align}set align(t){this._align!=t&&(this._align=t,this.doChange(CCanvasItem.CON_CHANGE_ALIGN))}get rotationAngle(){return this._rotationAngle}set rotationAngle(t){this._rotationAngle!=t&&(this._rotationAngle=t,this.doChange(CCanvasItem.CON_CHANGE_ROTATION_ANGLE))}get rotationCenterX(){return this._rotationCenterX}set rotationCenterX(t){this._rotationCenterX!=t&&(this._rotationCenterX=t,this.doChange(CCanvasItem.CON_CHANGE_ROTATION_CENTER_X))}get rotationCenterY(){return this._rotationCenterY}set rotationCenterY(t){this._rotationCenterY!=t&&(this._rotationCenterY=t,this.doChange(CCanvasItem.CON_CHANGE_ROTATION_CENTER_Y))}get positionUnit(){return this._positionUnit}set positionUnit(t){this._positionUnit!=t&&(this._positionUnit=t,this.doChange(CCanvasItem.CON_CHANGE_POSITION_UNIT))}get kind(){return this._kind}set kind(t){this._kind!=t&&(this._kind=t,this.doChange(CCanvasItem.CON_CHANGE_KIND))}get name(){return this._name}set name(t){this._name!=t&&(this._name=t,this.doChange(CCanvasItem.CON_CHANGE_NAME))}get position(){return this._position}set position(t){if(this._position!=t){this._position=t;let e=this;this._position.onChange=function(){e.doChange(CCanvasItem.CON_CHANGE_POSITION)},this.doChange(CCanvasItem.CON_CHANGE_POSITION)}}get margins(){return this._margins}get fill(){return this._fill}get stroke(){return this._stroke}get pathData(){return this._pathData}get textSet(){return this._textSet}get opacity(){return this._opacity}set opacity(t){this._opacity!=t&&(this._opacity=t,this.doChange(CCanvasItem.CON_CHANGE_OPACITY))}get visible(){return this._visible}set visible(t){this._visible!=t&&(this._visible=t,this.doChange(CCanvasItem.CON_CHANGE_VISIBLE))}get radiusX(){return this._radiusX}set radiusX(t){this._radiusX!=t&&(this._radiusX=t,this.doChange(CCanvasItem.CON_CHANGE_RADIUS_X))}get radiusY(){return this._radiusY}set radiusY(t){this._radiusY!=t&&(this._radiusY=t,this.doChange(CCanvasItem.CON_CHANGE_RADIUS_Y))}get disableRoundSet(){return this._disableRoundSet}get disableLineSet(){return this._disableLineSet}get text(){return this._text}set text(t){this._text!=t&&(this._text=t,this.doChange(CCanvasItem.CON_CHANGE_TEXT))}get imageSrc(){return this._imageSrc}set imageSrc(t){if(this._imageSrc!=t){this._imageSrc=t,this._image=new Image;let e=this;this._image.onload=function(){e.doChange("imageSrc")},this._image.src=this._imageSrc}}get imageFitMode(){return this._imageFitMode}set imageFitMode(t){this._imageFitMode!=t&&(this._imageFitMode=t,this.doChange("imageFitMode"))}get pathFitMode(){return this._pathFitMode}set pathFitMode(t){this._pathFitMode!=t&&(this._pathFitMode=t,this.doChange("fitmode"))}get paintKind(){return this._paintKind}set paintKind(t){this._paintKind!=t&&(this._paintKind=t,this.doChange("paintkind"))}get paintWidth(){return this._paintWidth}set paintWidth(t){this._paintWidth!=t&&(this._paintWidth=t,this.doChange("paintw"))}get paintHeight(){return this._paintHeight}set paintHeight(t){this._paintHeight!=t&&(this._paintHeight=t,this.doChange("painth"))}get patternIgnoreCount(){return this._patternIgnoreCount}set patternIgnoreCount(t){this._patternIgnoreCount!=t&&(this._patternIgnoreCount=t,this.doChange("patterni"))}get patternMargin(){return this._patternMargin}set patternMargin(t){this._patternMargin!=t&&(this._patternMargin=t,this.doChange("patternm"))}get patternKind(){return this._patternKind}set patternKind(t){this._patternKind!=t&&(this._patternKind=t,this.doChange("patternk"))}get paintRotateCount(){return this._paintRotateCount}set paintRotateCount(t){this._paintRotateCount!=t&&(this._paintRotateCount=t,this.doChange("paintRotateCount"))}get paintRotateStartAngle(){return this._paintRotateStartAngle}set paintRotateStartAngle(t){this._paintRotateStartAngle!=t&&(this._paintRotateStartAngle=t,this.doChange("paintRotateStartAngle"))}get paintRotateStopAngle(){return this._paintRotateStopAngle}set paintRotateStopAngle(t){this._paintRotateStopAngle!=t&&(this._paintRotateStopAngle=t,this.doChange("paintRotateStopAngle"))}get paintRotateRadiusX(){return this._paintRotateRadiusX}set paintRotateRadiusX(t){this._paintRotateRadiusX!=t&&(this._paintRotateRadiusX=t,this.doChange("paintRotateRadiusX"))}get paintRotateRadiusY(){return this._paintRotateRadiusY}set paintRotateRadiusY(t){this._paintRotateRadiusY!=t&&(this._paintRotateRadiusY=t,this.doChange("paintRotateRadiusY"))}get paintRotateApplyAngle(){return this._paintRotateApplyAngle}set paintRotateApplyAngle(t){this._paintRotateApplyAngle!=t&&(this._paintRotateApplyAngle=t,this.doChange("paintRotateApplyAngle"))}get randomCount(){return this._randomCount}set randomCount(t){this._randomCount!=t&&(this._randomCount=t,this.doChange("randomCount"))}get randomWidthMin(){return this._randomWidthMin}set randomWidthMin(t){this._randomWidthMin!=t&&(this._randomWidthMin=t,this.doChange("randomWidthMin"))}get randomWidthMax(){return this._randomWidthMax}set randomWidthMax(t){this._randomWidthMax!=t&&(this._randomWidthMax=t,this.doChange("randomWidthMax"))}get randomHeightMin(){return this._randomHeightMin}set randomHeightMin(t){this._randomHeightMin!=t&&(this._randomHeightMin=t,this.doChange("_randomHeightMin"))}get randomHeightMax(){return this._randomHeightMax}set randomHeightMax(t){this._randomHeightMax!=t&&(this._randomHeightMax=t,this.doChange("randomHeightMax"))}get filter(){return this._filter}set filter(t){this._filter!=t&&(this._filter=t,this.doChange(CCanvasItem.CON_CHANGE_FILTER))}get shadowColor(){return this._shadowColor}set shadowColor(t){this._shadowColor!=t&&(this._shadowColor=t,this.doChange(CCanvasItem.CON_CHANGE_SHADOW_COLOR))}get shadowBlur(){return this._shadowBlur}set shadowBlur(t){this._shadowBlur!=t&&(this._shadowBlur=t,this.doChange(CCanvasItem.CON_CHANGE_SHADOW_BLUR))}get shadowOffsetX(){return this._shadowOffsetX}set shadowOffsetX(t){this._shadowOffsetX!=t&&(this._shadowOffsetX=t,this.doChange(CCanvasItem.CON_CHANGE_SHADOW_OFFSET_X))}get shadowOffsetY(){return this._shadowOffsetY}set shadowOffsetY(t){this._shadowOffsetY!=t&&(this._shadowOffsetY=t,this.doChange(CCanvasItem.CON_CHANGE_SHADOW_OFFSET_Y))}get composite(){return this._composite}set composite(t){this._composite!=t&&(this._composite=t,this.doChange("composite"))}doToData(t){super.doToData(t),CDataClass.putData(t,"align",this.align,ECanvasItemAlign.NONE),CDataClass.putData(t,"kind",this.kind,ECanvasItemKind.RECTANGLE),CDataClass.putData(t,"name",this.name,""),CDataClass.putData(t,"position",this.position.toData(),{},!0),CDataClass.putData(t,"positionUnit",this.positionUnit,EPositionUnit.PIXEL),CDataClass.putData(t,"rotationAngle",this.rotationAngle,0),CDataClass.putData(t,"rotationCenterX",this.rotationCenterX,.5),CDataClass.putData(t,"rotationCenterY",this.rotationCenterY,.5),CDataClass.putData(t,"margins",this.margins.toData(),{},!0),CDataClass.putData(t,"fill",this.fill.toData(),{},!0),CDataClass.putData(t,"stroke",this.stroke.toData(),{},!0),CDataClass.putData(t,"opacity",this.opacity,1),CDataClass.putData(t,"visible",this.visible,!0),CDataClass.putData(t,"pathData",this.pathData.toData(),{},!0),CDataClass.putData(t,"radiusX",this.radiusX,0),CDataClass.putData(t,"radiusY",this.radiusY,0),CDataClass.putData(t,"disableRoundSet",this.disableRoundSet.toData(),[],!0),CDataClass.putData(t,"disableLineSet",this.disableLineSet.toData(),[],!0),CDataClass.putData(t,"textSet",this.textSet.toData(),{},!0),CDataClass.putData(t,"text",this.text,""),CDataClass.putData(t,"paintKind",this.paintKind,EPaintKind.NORMAL),CDataClass.putData(t,"paintWidth",this.paintWidth,50),CDataClass.putData(t,"paintHeight",this.paintHeight,50),CDataClass.putData(t,"patternIgnoreCount",this.patternIgnoreCount,0),CDataClass.putData(t,"patternMargin",this.patternMargin,0),CDataClass.putData(t,"patternKind",this.patternKind,EPatternKind.ALL),CDataClass.putData(t,"paintRotateCount",this.paintRotateCount,5),CDataClass.putData(t,"paintRotateStartAngle",this.paintRotateStartAngle,-90),CDataClass.putData(t,"paintRotateStopAngle",this.paintRotateStopAngle,270),CDataClass.putData(t,"paintRotateRadiusX",this.paintRotateRadiusX,.5),CDataClass.putData(t,"paintRotateRadiusY",this.paintRotateRadiusY,.5),CDataClass.putData(t,"paintRotateApplyAngle",this.paintRotateApplyAngle,!0),CDataClass.putData(t,"randomCount",this.randomCount,10),CDataClass.putData(t,"randomWidthMin",this.randomWidthMin,10),CDataClass.putData(t,"randomWidthMax",this.randomWidthMax,100),CDataClass.putData(t,"randomHeightMin",this.randomHeightMin,10),CDataClass.putData(t,"randomHeightMax",this.randomHeightMax,100),CDataClass.putData(t,"filter",this.filter,""),CDataClass.putData(t,"shadowColor",this.shadowColor,""),CDataClass.putData(t,"shadowBlur",this.shadowBlur,0),CDataClass.putData(t,"shadowOffsetX",this.shadowOffsetX,0),CDataClass.putData(t,"shadowOffsetY",this.shadowOffsetY,0),CDataClass.putData(t,"pathFitMode",this.pathFitMode,EFitMode.STRETCH),CDataClass.putData(t,"imageSrc",this.imageSrc,""),CDataClass.putData(t,"imageFitMode",this.imageFitMode,EFitMode.FIT),CDataClass.putData(t,"composite",this.composite,"source-over")}doFromData(t){super.doFromData(t),this.align=CDataClass.getData(t,"align",ECanvasItemAlign.NONE),this.kind=CDataClass.getData(t,"kind",ECanvasItemKind.RECTANGLE),this.name=CDataClass.getData(t,"name",""),this.position.fromData(CDataClass.getData(t,"position",{},!0)),this.positionUnit=CDataClass.getData(t,"positionUnit",EPositionUnit.PIXEL),this.rotationAngle=CDataClass.getData(t,"rotationAngle",0),this.rotationCenterX=CDataClass.getData(t,"rotationCenterX",.5),this.rotationCenterY=CDataClass.getData(t,"rotationCenterY",.5),this.margins.fromData(CDataClass.getData(t,"margins",{},!0)),this.fill.fromData(CDataClass.getData(t,"fill",{},!0)),this.stroke.fromData(CDataClass.getData(t,"stroke",{},!0)),this.opacity=CDataClass.getData(t,"opacity",1),this.visible=CDataClass.getData(t,"visible",!0),this.pathData.fromData(CDataClass.getData(t,"pathData",{},!0)),this.radiusX=CDataClass.getData(t,"radiusX",0),this.radiusY=CDataClass.getData(t,"radiusY",0),this.disableRoundSet.fromData(CDataClass.getData(t,"disableRoundSet",[],!0)),this.disableLineSet.fromData(CDataClass.getData(t,"disableLineSet",[],!0)),this.textSet.fromData(CDataClass.getData(t,"textSet",{},!0)),this.text=CDataClass.getData(t,"text",""),this.paintKind=CDataClass.getData(t,"paintKind",EPaintKind.NORMAL),this.paintWidth=CDataClass.getData(t,"paintWidth",50),this.paintHeight=CDataClass.getData(t,"paintHeight",50),this.patternIgnoreCount=CDataClass.getData(t,"patternIgnoreCount",0),this.patternMargin=CDataClass.getData(t,"patternMargin",0),this.patternKind=CDataClass.getData(t,"patternKind",EPatternKind.ALL),this.paintRotateCount=CDataClass.getData(t,"paintRotateCount",5),this.paintRotateStartAngle=CDataClass.getData(t,"paintRotateStartAngle",-90),this.paintRotateStopAngle=CDataClass.getData(t,"paintRotateStopAngle",270),this.paintRotateRadiusX=CDataClass.getData(t,"paintRotateRadiusX",.5),this.paintRotateRadiusY=CDataClass.getData(t,"paintRotateRadiusY",.5),this.paintRotateApplyAngle=CDataClass.getData(t,"paintRotateApplyAngle",!0),this.randomCount=CDataClass.getData(t,"randomCount",10),this.randomWidthMin=CDataClass.getData(t,"randomWidthMin",10),this.randomWidthMax=CDataClass.getData(t,"randomWidthMax",100),this.randomHeightMin=CDataClass.getData(t,"randomHeightMin",10),this.randomHeightMax=CDataClass.getData(t,"randomHeightMax",100),this.filter=CDataClass.getData(t,"filter",""),this.shadowColor=CDataClass.getData(t,"shadowColor",""),this.shadowBlur=CDataClass.getData(t,"shadowBlur",0),this.shadowOffsetX=CDataClass.getData(t,"shadowOffsetX",0),this.shadowOffsetY=CDataClass.getData(t,"shadowOffsetY",0),this.pathFitMode=CDataClass.getData(t,"pathFitMode",EFitMode.STRETCH),this.imageSrc=CDataClass.getData(t,"imageSrc",""),this.imageFitMode=CDataClass.getData(t,"imageFitMode",EFitMode.FIT),this.composite=CDataClass.getData(t,"composite","source-over")}setAlign(t,e){let i=this.position,s=0,o=0;switch(this._align){case ECanvasItemAlign.NONE:t.copyFrom(i.rect),t.offset(e.left,e.top);break;case ECanvasItemAlign.LEFT:t.set(e.left+this.margins.left,e.top+this.margins.top,e.left+this.margins.left+i.width,e.bottom-this.margins.bottom);break;case ECanvasItemAlign.TOP:t.set(e.left+this.margins.left,e.top+this.margins.top,e.right-this.margins.right,e.top+this.margins.top+i.height);break;case ECanvasItemAlign.RIGHT:t.set(e.right-this.margins.right-i.width,e.top+this.margins.top,e.right-this.margins.right,e.bottom-this.margins.bottom);break;case ECanvasItemAlign.BOTTOM:t.set(e.left+this.margins.left,e.bottom-this.margins.bottom-i.height,e.right-this.margins.right,e.bottom-this.margins.bottom);break;case ECanvasItemAlign.CENTER:s=(e.width-i.width)/2+e.left,o=(e.height-i.height)/2+e.top,t.set(s,o,s+i.width,o+i.height);break;case ECanvasItemAlign.LEFTTOP:t.set(e.left+this.margins.left,e.top+this.margins.top,e.left+this.margins.left+i.width,e.top+this.margins.top+i.height);break;case ECanvasItemAlign.LEFTBOTTOM:t.set(e.left+this.margins.left,e.bottom-this.margins.bottom-i.height,e.left+this.margins.left+i.width,e.bottom-this.margins.bottom);break;case ECanvasItemAlign.RIGHTTOP:t.set(e.right-this.margins.right-i.width,e.top+this.margins.top,e.right-this.margins.right,e.top+this.margins.top+i.height);break;case ECanvasItemAlign.RIGHTBOTTOM:t.set(e.right-this.margins.right-i.width,e.bottom-this.margins.bottom-i.height,e.right-this.margins.right,e.bottom-this.margins.bottom);break;case ECanvasItemAlign.MIDDLELEFT:o=(e.height-i.height)/2+e.top,t.set(e.left+this.margins.left,o,e.left+this.margins.left+i.width,o+i.height);break;case ECanvasItemAlign.MIDDLETOP:s=(e.width-i.width)/2+e.left,t.set(s,e.top+this.margins.top,s+i.width,e.top+this.margins.top+i.height);break;case ECanvasItemAlign.MIDDLERIGHT:o=(e.height-i.height)/2+e.top,t.set(e.right-this.margins.right-i.width,o,e.right-this.margins.right,o+i.height);break;case ECanvasItemAlign.MIDDLEBOTTOM:s=(e.width-i.width)/2+e.left,t.set(s,e.bottom-this.margins.bottom-i.height,s+i.width,e.bottom-this.margins.bottom);break;case ECanvasItemAlign.HCENTER:s=(e.width-i.width)/2+e.left,t.set(s,e.top+this.margins.top,s+i.width,e.bottom-this.margins.bottom);break;case ECanvasItemAlign.VCENTER:o=(e.height-i.height)/2+e.top,t.set(e.left+this.margins.left,o,e.right-this.margins.right,o+i.height)}}draw(t,e,i,s=1,o=1){if(!this._visible||0==this._opacity)return;let a=new CRect(0,0,0,0);this.position.rect.isEmpty()?a=new CRect(e.left+this._margins.left,e.top+this._margins.top,e.right-this._margins.right,e.bottom-this._margins.bottom):this._positionUnit==EPositionUnit.PERCENT?(a.left=CCalc.cr(e.width,0,100,this.position.left,2),a.top=CCalc.cr(e.height,0,100,this.position.top,2),a.right=CCalc.cr(e.width,0,100,this.position.right,2),a.bottom=CCalc.cr(e.height,0,100,this.position.bottom,2),a.offset(e.left,e.top)):this.setAlign(a,e),t.save(),t.scale(s,o),t.globalAlpha=this.opacity,""!=this._filter&&(t.filter=this.filter),""!=this._shadowColor&&(t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY),t.globalCompositeOperation=this.composite;let n=a.left+a.width*this.rotationCenterX,r=a.top+a.height*this.rotationCenterY;t.translate(n,r),t.rotate(CCalc.cr(Math.PI,0,180,this.rotationAngle,2)),t.translate(-n,-r);let l=this;function h(e){l._fill.styleKind!=EStyleKind.EMPTY&&(l._fill.setContext(t,e),t.fill())}function d(e){l._stroke.styleKind!=EStyleKind.EMPTY&&l._stroke.lineWidth>0&&(l._stroke.setContext(t,e),t.stroke())}function g(t){let e=0,i=0,s=0,o=0;switch(l.patternKind){case EPatternKind.ALL:for(;;){if(i=0,s=0,0==l._patternIgnoreCount||e%(l._patternIgnoreCount+1)==0)for(;0!=l._patternIgnoreCount&&i%(l._patternIgnoreCount+1)!=0||t(a.left+i*l._paintWidth+i*l._patternMargin,a.top+e*l._paintHeight+e*l._patternMargin,l._paintWidth,l._paintHeight),i++,s+=l._paintWidth+l._patternMargin,!(s>a.width););if(e++,o+=l._paintHeight+l._patternMargin,o>a.height)break}break;case EPatternKind.CHECK_HEAD:for(;;){for(i=0,s=0;(e%2==0&&i%2==0||e%2==1&&i%2==1)&&t(a.left+i*l._paintWidth+i*l._patternMargin,a.top+e*l._paintHeight+e*l._patternMargin,l._paintWidth,l._paintHeight),i++,s+=l._paintWidth+l._patternMargin,!(s>a.width););if(e++,o+=l._paintHeight+l._patternMargin,o>a.height)break}break;case EPatternKind.CHECK_TAIL:for(;;){for(i=0,s=0;(e%2==0&&i%2==1||e%2==1&&i%2==0)&&t(a.left+i*l._paintWidth+i*l._patternMargin,a.top+e*l._paintHeight+e*l._patternMargin,l._paintWidth,l._paintHeight),i++,s+=l._paintWidth+l._patternMargin,!(s>a.width););if(e++,o+=l._paintHeight+l._patternMargin,o>a.height)break}break;case EPatternKind.COLUMN:for(;0!=l._patternIgnoreCount&&i%(l._patternIgnoreCount+1)!=0||t(a.left+i*l._paintWidth+i*l._patternMargin,a.top+e*l._paintHeight+e*l._patternMargin,l._paintWidth,a.height),i++,s+=l._paintWidth+l._patternMargin,!(s>a.width););break;case EPatternKind.ROW:for(;0!=l._patternIgnoreCount&&e%(l._patternIgnoreCount+1)!=0||t(a.left+i*l._paintWidth+i*l._patternMargin,a.top+e*l._paintHeight+e*l._patternMargin,a.width,l._paintHeight),e++,o+=l._paintHeight+l._patternMargin,!(o>a.height););}}function C(t){let e=(l._paintRotateStopAngle-l._paintRotateStartAngle)/l._paintRotateCount,i=a.left+a.width*l.rotationCenterX,s=a.top+a.height*l.rotationCenterY,o=a.width*l._paintRotateRadiusX,n=a.height*l._paintRotateRadiusY,r=new CPoint(i,s);for(let i=0;i<l._paintRotateCount;i++){let s=i*e+l._paintRotateStartAngle,a=CPoint.getAngleToPoint(r,o,n,s);t(a.x,a.y,s,a.x-l._paintWidth/2,a.y-l._paintHeight/2,l._paintWidth,l._paintHeight)}}function c(t){for(let e=0;e<l._randomCount;e++){let e=360*Math.random(),i=a.width*l._paintRotateRadiusX,s=a.height*l._paintRotateRadiusY;-1!=l.randomWidthMin&&(i=(l.randomWidthMax-l.randomWidthMin)*Math.random()+l.randomWidthMin),-1!=l.randomHeightMin&&(s=(l.randomHeightMax-l.randomHeightMin)*Math.random()+l.randomHeightMin),t(e,a.left+Math.random()*(a.width-i),a.top+Math.random()*(a.height-s),i,s),CCalc.crRange2Value}}if(this._kind==ECanvasItemKind.RECTANGLE||this._kind==ECanvasItemKind.ROUNDRECTANGLE||this._kind==ECanvasItemKind.ELLIPSE||this._kind==ECanvasItemKind.ARC||this._kind==ECanvasItemKind.PATH)switch(this._stroke.lineWidth>0&&this._stroke.styleKind!=EStyleKind.EMPTY&&a.inflate(-this._stroke.lineWidth/2,-this._stroke.lineWidth/2),t.beginPath(),this._kind){case ECanvasItemKind.RECTANGLE:this.paintKind==EPaintKind.PATTERN?(g((function(e,i,s,o){l._pathData.clear(),l._pathData.makeRoundRectData(e,i,s,o,l._radiusX,l._radiusY,l._disableRoundSet,l._disableLineSet,!1),l._pathData.setPathData(t)})),h(a),d(a)):this.paintKind==EPaintKind.ROTATE?(C((function(e,i,s,o,a,n,r){l._pathData.clear(),l._pathData.makeRoundRectData(o,a,n,r,l._radiusX,l._radiusY,l._disableRoundSet,l._disableLineSet,!1),l._paintRotateApplyAngle&&l._pathData.rotate(new CPoint(e,i),s),l._pathData.setPathData(t)})),h(a),d(a)):this.paintKind==EPaintKind.RANDOM?(c((function(e,i,s,o,a){l._pathData.clear(),l._pathData.makeRoundRectData(i,s,o,a,l._radiusX,l._radiusY,l._disableRoundSet,l._disableLineSet,!1),l._pathData.setPathData(t)})),h(a),d(a)):(this._pathData.makeRoundRectData(a.left,a.top,a.width,a.height,this._radiusX,this._radiusY,this._disableRoundSet,this._disableLineSet,!0),this._pathData.setPathData(t),h(a),d(a));break;case ECanvasItemKind.ROUNDRECTANGLE:if(this.paintKind==EPaintKind.PATTERN){let p=0;p=(l.paintWidth,l.paintHeight,l.paintWidth/2),g((function(e,i,s,o){l._pathData.clear(),l._pathData.makeRoundRectData(e,i,s,o,p,p,new CStringSet,new CStringSet,!1),l._pathData.setPathData(t)})),h(a),d(a)}else if(this.paintKind==EPaintKind.ROTATE){let A=0;A=(l.paintWidth,l.paintHeight,l.paintWidth/2),C((function(e,i,s,o,a,n,r){l._pathData.clear(),l._pathData.makeRoundRectData(o,a,n,r,A,A,new CStringSet,new CStringSet,!1),l._paintRotateApplyAngle&&l._pathData.rotate(new CPoint(e,i),s),l._pathData.setPathData(t)})),h(a),d(a)}else if(this.paintKind==EPaintKind.RANDOM){let m=0;m=(l.paintWidth,l.paintHeight,l.paintWidth/2),c((function(e,i,s,o,a){l._pathData.clear(),l._pathData.makeRoundRectData(i,s,o,a,m,m,new CStringSet,new CStringSet,!1),l._pathData.setPathData(t)})),h(a),d(a)}else{let f=0;f=a.width>a.height?a.height/2:a.width/2,this._pathData.makeRoundRectData(a.left,a.top,a.width,a.height,f,f,new CStringSet,new CStringSet,!0),this._pathData.setPathData(t),h(a),d(a)}break;case ECanvasItemKind.ELLIPSE:if(this.paintKind==EPaintKind.PATTERN)g((function(e,i,s,o){l._pathData.clear(),l._pathData.makeEllipseData(e,i,s,o,!1),l._pathData.setPathData(t)})),h(a),d(a);else if(this.paintKind==EPaintKind.ROTATE){let D=0;D=(l.paintWidth,l.paintHeight,l.paintWidth/2),C((function(e,i,s,o,a,n,r){l._pathData.clear(),l._pathData.makeEllipseData(o,a,n,r,!1),l._paintRotateApplyAngle&&l._pathData.rotate(new CPoint(e,i),s),l._pathData.setPathData(t)})),h(a),d(a)}else this.paintKind==EPaintKind.RANDOM?(c((function(e,i,s,o,a){l._pathData.clear(),l._pathData.makeEllipseData(i,s,o,a,!1),l._pathData.setPathData(t)})),h(a),d(a)):(this._pathData.makeEllipseData(a.left,a.top,a.width,a.height),this._pathData.setPathData(t),h(a),d(a));break;case ECanvasItemKind.PATH:function u(t,e,i,s){let o;return o=l._pathFitMode==EFitMode.ORIGINAL?l._pathData.copyTo():l._pathFitMode==EFitMode.FIT?l._pathData.fitTo(new CRect(t,e,t+i,e+s)):l._pathData.stretchTo(new CRect(t,e,t+i,e+s)),o}if(this.paintKind==EPaintKind.PATTERN)g((function(e,i,s,o){let a;a=l._pathFitMode==EFitMode.ORIGINAL?l._pathData.copyTo():l._pathFitMode==EFitMode.FIT?l._pathData.fitTo(new CRect(e,i,e+s,i+o)):l._pathData.stretchTo(new CRect(e,i,e+s,i+o)),a.setPathData(t)})),h(a),d(a);else if(this.paintKind==EPaintKind.ROTATE)C((function(e,i,s,o,a,n,r){let h;h=l._pathFitMode==EFitMode.ORIGINAL?l._pathData.copyTo():l._pathFitMode==EFitMode.FIT?l._pathData.fitTo(new CRect(o,a,o+n,a+r)):l._pathData.stretchTo(new CRect(o,a,o+n,a+r)),l._paintRotateApplyAngle&&h.rotate(new CPoint(e,i),s+90),h.setPathData(t)})),h(a),d(a);else if(this.paintKind==EPaintKind.RANDOM)c((function(e,i,s,o,a){let n;n=l._pathFitMode==EFitMode.ORIGINAL?l._pathData.copyTo():l._pathFitMode==EFitMode.FIT?l._pathData.fitTo(new CRect(i,s,i+o,s+a)):l._pathData.stretchTo(new CRect(i,s,i+o,s+a)),n.rotate(new CPoint(i+o/2,s+a/2),e),n.setPathData(t)})),h(a),d(a);else{let _=u(a.left,a.top,a.width,a.height);_.setPathData(t),h(_.getBounds()),d(_.getBounds())}}else if(this._kind==ECanvasItemKind.IMAGE&&null!=this._image){let I=this;if(t.globalAlpha=I.opacity,I.paintKind==EPaintKind.PATTERN)g((function(e,i,s,o){let a=new CRect(e,i,e+s,i+o),n=new CRect(0,0,I._image.width,I._image.height);a=a.getFitRect(n,!0),t.drawImage(I._image,a.left+e,a.top+i,a.width,a.height)}));else if(I.imageFitMode==EFitMode.ORIGINAL)t.drawImage(I._image,a.left,a.top);else if(I.imageFitMode==EFitMode.FIT){let E=new CRect(0,0,I._image.width,I._image.height),y=a.getFitRect(E,!0);t.drawImage(I._image,a.left+y.left,a.top+y.top,y.width,y.height)}else t.drawImage(I._image,a.left,a.top,a.width,a.height)}this.paintKind==EPaintKind.NORMAL&&function(e){let s=l._text;"string"!=typeof s&&(s+=""),null!=s&&""!=s.trim()&&l._textSet.drawText(t,e,s,i)}(a),t.restore()}enumProperties(){let t=new Map;return t.set("align",CEnum.toArray(ECanvasItemAlign)),t.set("kind",CEnum.toArray(ECanvasItemKind)),t.set("patternKind",CEnum.toArray(EPatternKind)),t.set("positionUnit",CEnum.toArray(EPositionUnit)),t.set("pathFitMode",CEnum.toArray(EFitMode)),t.set("paintKind",CEnum.toArray(EPaintKind)),t.set("imageFitMode",CEnum.toArray(EFitMode)),t}addProperties(){let t=super.addProperties();return t.push({instance:this.pathData.transformer,propertyName:"pathDataTransfomer",readOnly:!1,enum:[]}),t}}class CCanvasItems extends CList{doToData(t){super.doToData(t);for(let e=0;e<this.length;e++)t.push(this.get(e).toData())}doFromData(t){super.doFromData(t),this.clear();for(let e=0;e<t.length;e++){this.addItem().fromData(t[e])}}addItem(){let t=new CCanvasItem,e=this;return t.onChange=function(t,i){e.doChange(i)},this.add(t),t}deleteItem(t){if(t instanceof CCanvasItem){for(let e=0;e<this.length;e++)if(this.get(e)==t){this.delete(e,1);break}}else for(let e=0;e<this.length;e++)if(this.get(e).name==t){this.delete(e,1);break}}getItem(t){let e=new Array;for(let i=0;i<this.length;i++)this.get(i).name==t&&e.push(this.get(i));return e}setText(t,e){for(let i=0;i<this.length;i++)this.get(i).name==t&&(this.get(i).text=e)}setObject(t){let e=Object.keys(t);for(let i=0;i<e.length;i++)this.setText(e[i],t[e[i]])}draw(t,e,i,s,o=1,a=1){if(null!=s){e.offset(i.x,i.y);for(let i=0;i<this.length;i++)this.get(i).visible&&this.get(i).draw(t,e,s,o,a)}}}class CCanvasLayer extends CNotifyChangeKindObject{static get CON_CHANGE_ITEMS(){return"i"}static get CON_CHANGE_OFFSET(){return"o"}static get CON_CHANGE_VISIBLE(){return"v"}static get CON_CHANGE_SCALE_X(){return"sx"}static get CON_CHANGE_SCALE_Y(){return"sy"}get id(){return this._id}get items(){return this._items}get name(){return this._name}set name(t){this._name!=t&&(this._name=t,this.doChange("name"))}get scaleX(){return this._scaleX}set scaleX(t){this._scaleX!=t&&(this._scaleX=t,this.doChange(CCanvasLayer.CON_CHANGE_SCALE_X))}get scaleY(){return this._scaleY}set scaleY(t){this._scaleY!=t&&(this._scaleY=t,this.doChange(CCanvasLayer.CON_CHANGE_SCALE_Y))}set scale(t){this.scaleX=t,this.scaleY=t}get transform(){return this._transform}get canvas(){return this._canvas}get context(){return this._context}get offset(){return this._offset}get visible(){return this._visible}set visible(t){this._visible!=t&&(this._visible=t,this.doChange(CCanvasLayer.CON_CHANGE_VISIBLE))}constructor(t=void 0){super(),this._name="",this._items=new CCanvasItems,this._scaleX=1,this._scaleY=1,this._transform=new CTransform,this._visible=!0,this._offset=new CNotifyPoint(0,0),this._canvas=document.createElement("canvas"),this.isDraw=!0,this._parent=t,this._id=CSequence.getSequence("layer");let e=this;this._offset.onChange=function(){e.doChange(CCanvasLayer.CON_CHANGE_OFFSET)},this._items.onChange=function(){e.doChange(CCanvasLayer.CON_CHANGE_ITEMS)},this._canvas=document.createElement("canvas"),this._canvas.style.outline="none",this._canvas.style.position="absolute",this._canvas.style.margin="0px 0px 0px 0px",this._canvas.style.padding="0px 0px 0px 0px",this._canvas.style.pointerEvents="none",this._canvas.setAttribute("ondragstart","return false"),this._canvas.setAttribute("onselectstart","return false"),this._canvas.setAttribute("oncontextmenu","return false");let i=this._canvas.getContext("2d");null!=i&&(this._context=i),null!=this._parent&&(this._parent instanceof HTMLElement?this._parent.appendChild(this._canvas):null!=this._parent.parent&&this._parent.parent.controlElement.appendChild(this._canvas)),this._transform.onChange=function(t,i){e.transform.setTransform(e.canvas)},this.transform.setTransform(this.canvas)}doToData(t){super.doToData(t),CDataClass.putData(t,"name",this.name,""),CDataClass.putData(t,"items",this.items.toData(),[],!0),CDataClass.putData(t,"transform",this.transform.toData(),{},!0),CDataClass.putData(t,"visible",this.visible,!0),CDataClass.putData(t,"offset",this.offset.toData(),{},!0),CDataClass.putData(t,"width",this.canvas.width,0),CDataClass.putData(t,"height",this.canvas.height,0)}doFromData(t){super.doFromData(t),this.name=CDataClass.getData(t,"name",""),this.items.fromData(CDataClass.getData(t,"items",[],!0)),this.transform.fromData(CDataClass.getData(t,"transform",{},!0)),this.visible=CDataClass.getData(t,"visible",!0),this.offset.fromData(CDataClass.getData(t,"offset",{},!0)),this.canvas.width=CDataClass.getData(t,"width",0),this.canvas.height=CDataClass.getData(t,"height",0)}doChange(t){super.doChange(t),t==CCanvasLayer.CON_CHANGE_VISIBLE&&(this.visible?(null!=this.canvas&&(this.canvas.style.visibility="visible"),this.draw()):(null!=this.canvas&&(this.canvas.style.visibility="hidden"),CSystem.requestDraw.delete(this))),t!=CCanvasLayer.CON_CHANGE_OFFSET&&t!=CCanvasLayer.CON_CHANGE_ITEMS||this.draw(),t!=CCanvasLayer.CON_CHANGE_SCALE_X&&t!=CCanvasLayer.CON_CHANGE_SCALE_Y||this.doChangeScale()}doRemove(){this.canvas.remove(),super.doRemove()}doChangeScale(){this._parent instanceof CCanvasLayers&&null!=this._parent.parent&&this.doSetCanvasElementPosition(0,0,this._parent.parent.position.width,this._parent.parent.position.height),this.draw()}doSetCanvasElementPosition(t,e,i,s){this._canvas.width=i*this.scaleX,this._canvas.height=s*this.scaleY,this._canvas.style.left=(i-this._canvas.width)/2+"px",this._canvas.style.top=(s-this._canvas.height)/2+"px",this.draw()}setCanvasElementPosition(t,e,i,s){this.doSetCanvasElementPosition(t,e,i,s)}addItem(){return this._items.addItem()}doDraw(){if(null!=this._context&&this.canvas.width>0&&this.canvas.height>0&&this.visible){if(this._context.clearRect(0,0,this.canvas.width,this.canvas.height),null!=CSystem.bufferingContext){let t=new CRect(0,0,this.canvas.width/this.scaleX,this.canvas.height/this.scaleY);this.items.draw(this._context,t,this.offset,CSystem.bufferingContext,this.scaleX,this.scaleY)}null!=this.onDraw&&this.onDraw(this,this._context)}}draw(){this.visible&&this.isDraw&&CSystem.requestDraw.add(this)}getCanvasItems(t){let e=new Array,i=this.items.getItem(t);for(let t=0;t<i.length;t++)e.push(i[t]);return e}itemUp(t){for(let e=0;e<this.items.length;e++)if(this.items.get(e)==t&&e>0){let t=this.items.get(e);this.items.set(e,this.items.get(e-1)),this.items.set(e-1,t);break}}itemDown(t){for(let e=0;e<this.items.length;e++)if(this.items.get(e)==t&&e<this.items.length-1){let t=this.items.get(e);this.items.set(e,this.items.get(e+1)),this.items.set(e+1,t);break}}}class CCanvasLayers extends CList{static get CON_CHANGE_ADD_LAYER(){return"addlayer"}static get CON_CHANGE_LAYER(){return"layer"}get parent(){return this._parent}set scaleX(t){for(let e=0;e<this.length;e++)this.get(e).scaleX=t}set scaleY(t){for(let e=0;e<this.length;e++)this.get(e).scaleY=t}set scale(t){for(let e=0;e<this.length;e++)this.get(e).scale=t}constructor(t){super(),this._parent=t}doChangeLayer(t,e){this.useChangeEvent&&null!=this.onChangeLayer&&this.onChangeLayer(this,t,e)}doResource(){super.doResource(),null!=this._parent&&this._parent.setLayers()}doToData(t){super.doToData(t);for(let e=0;e<this.length;e++)t.push(this.get(e).toData())}doFromData(t){super.doFromData(t),this.clear();for(let e=0;e<t.length;e++){this.addLayer().fromData(t[e])}null!=this.parent&&this.parent.doSetLayers()}doRemove(){for(let t=this.length-1;t>=0;t--)this.get(t).remove();this.clear(),super.doRemove()}addLayer(){let t=new CCanvasLayer(this),e=this;return t.onChange=function(i){e.doChangeLayer(CCanvasLayers.CON_CHANGE_LAYER,t)},t.onDraw=function(t,i){if(null!=e.parent){let s=-1;for(let i=0;i<e.length;i++)if(t==e.get(i)){s=i;break}e.parent.doLayerDraw(s,t,i)}},e.doChangeLayer(CCanvasLayers.CON_CHANGE_ADD_LAYER,t),this.add(t),t}deleteLayer(t){if(t instanceof CCanvasLayer){for(let e=0;e<this.length;e++)if(this.get(e)==t){this.get(e).remove(),this.delete(e,1);break}}else for(let e=0;e<this.length;e++)if(this.get(e).id==t){this.get(e).remove(),this.delete(e,1);break}}deleteLayerFromName(t){for(let e=0;e<this.length;e++)if(this.get(e).name==t){this.get(e).remove(),this.delete(e,1);break}}clear(){for(let t=0;t<this.length;t++)this.get(t).remove();super.clear()}getLayer(t){let e;for(let i=0;i<this.length;i++)if(this.get(i).id==t){e=this.get(i);break}return e}getLayerFromName(t){let e;for(let i=0;i<this.length;i++)if(this.get(i).name==t){e=this.get(i);break}return e}setLayersPosition(t,e,i,s){for(let o=0;o<this.length;o++)this.get(o).setCanvasElementPosition(t,e,i,s)}draw(){for(let t=0;t<this.length;t++)this.get(t).draw()}getCanvasItems(t){let e=new Array;for(let i=0;i<this.length;i++){let s=this.get(i).getCanvasItems(t);for(let t=0;t<s.length;t++)e.push(s[t])}return e}getPathDataOrgSize(){let t={width:0,height:0};for(let e=0;e<this.length;e++)this.get(e).items.length>0&&(t.width=this.get(e).items.get(0).pathData.width,t.height=this.get(e).items.get(0).pathData.height);return t}layerUp(t){for(let e=0;e<this.length;e++)if(this.get(e)==t&&e>0){CSystem.elementUp(this.get(e).canvas);let t=this.get(e);this.set(e,this.get(e-1)),this.set(e-1,t);break}}layerDown(t){for(let e=0;e<this.length;e++)if(this.get(e)==t&&e<this.length-1){CSystem.elementDown(this.get(e).canvas);let t=this.get(e);this.set(e,this.get(e+1)),this.set(e+1,t);break}}static setLayersMiddlePathData(t,e,i,s){for(let o=0;o<i.length;o++)for(let a=0;a<i.get(o).items.length;a++)if(t.get(o).items.length>a&&e.get(o).items.length>a){let n=t.get(o).items.get(a).pathData,r=e.get(o).items.get(a).pathData,l=i.get(o).items.get(a).pathData;for(let t=0;t<l.length;t++)l.get(t).point.x=CCalc.crRange2Value(0,1,s,n.get(t).point.x,r.get(t).point.x),l.get(t).point.y=CCalc.crRange2Value(0,1,s,n.get(t).point.y,r.get(t).point.y),l.get(t).cPoint1.x=CCalc.crRange2Value(0,1,s,n.get(t).cPoint1.x,r.get(t).cPoint1.x),l.get(t).cPoint1.y=CCalc.crRange2Value(0,1,s,n.get(t).cPoint1.y,r.get(t).cPoint1.y),l.get(t).cPoint2.x=CCalc.crRange2Value(0,1,s,n.get(t).cPoint2.x,r.get(t).cPoint2.x),l.get(t).cPoint2.y=CCalc.crRange2Value(0,1,s,n.get(t).cPoint2.y,r.get(t).cPoint2.y);l.width=CCalc.crRange2Value(0,1,s,n.width,r.width),l.height=CCalc.crRange2Value(0,1,s,n.height,r.height)}}}class CTimes extends CDataClass{constructor(){super(...arguments),this._times=new CTableData(["name","object"],["name","object"])}doToData(t){}doFromData(t){}get times(){return this._times}get length(){return this.times.length}add(t,e){this._times.add([t,e])}delete(t){if("string"==typeof t){let e=this._times.findIndexRow("name",t);this._times.delete(e)}else{let e=this._times.findIndexRow("object",t);this._times.delete(e)}}clear(){this._times.clear()}loopTime(t){for(let e=0;e<this._times.length;e++)t(this._times.getRow(e).get(1).asObject)}}class CTime extends CDataClass{get preTime(){return this._preTime}get changeTime(){return this._changeTime}get time(){return this._time}set time(t){t!=this._time&&(this._time=t,this.doChangeTime())}get timeString(){let t=new Date(this._time);return CDatetime.toTimeString(t,!0,!0)}get speed(){return this._speed}set speed(t){this._speed=t}get isPause(){return this._isPause}set isPause(t){this._isPause!=t&&(this._isPause=t,this.doChangePause())}get isReverse(){return this._isReverse}set isReverse(t){this._isReverse!=t&&(this._isReverse=t,this.doChangeReverse())}get times(){return this._times}get timePoints(){return this._timePoints}get timeSections(){return this._timeSections}set timeSections(t){this._timeSections=t}constructor(t,e=1){super(),this._time=0,this._speed=1,this._isPause=!1,this._isReverse=!1,this._times=new CTimes,this._timePoints=new Array,this._timeSections=new Array,this._time=null==t?(new Date).getTime():t,this.speed=e}doToData(t){}doFromData(t){}doChangeTime(){null!=this.onChangeTime&&this.onChangeTime(this)}doChangePause(){null!=this.onChangePause&&this.onChangePause(this)}doChangeReverse(){null!=this.onChangeReverse&&this.onChangeReverse(this)}doRemove(){CTime.times.delete(this),this._times.loopTime((function(t){t.doRemove()})),this._times.clear(),super.doRemove()}setTime(t,e){let i=(e-t)*this.speed;if(!this.isPause){this._preTime=this.time,this._changeTime=i,this.isReverse?this.time-=i:this.time+=i;let t=this;if(this.times.loopTime((function(e){null!=t.preTime&&e.setTime(t.preTime,t.time)})),null!=this.preTime){for(let t=0;t<this._timePoints.length;t++)this._timePoints[t].checkTime(this.preTime,this.time);for(let t=0;t<this._timeSections.length;t++)if(this._timeSections[t].isLoop){if(this.time>=this._timeSections[t].startTime){let e=this._timeSections[t].stopTime-this._timeSections[t].startTime,i=this._timeSections[t].startTime+e*Math.floor((this.time-this._timeSections[t].startTime)/e),s=i+e;this._timeSections[t].doTick(this.preTime,this.time,CCalc.crRange2Value(i,s,this.time,0,1))}}else this.isReverse?this.preTime>=this._timeSections[t].startTime&&this.time<=this._timeSections[t].startTime?this._timeSections[t].doTick(this.preTime,this.time,0):this.time<=this._timeSections[t].stopTime&&this.preTime>=this._timeSections[t].stopTime?this._timeSections[t].doTick(this.preTime,this.time,1):this.time>this._timeSections[t].startTime&&this.time<this._timeSections[t].stopTime&&this._timeSections[t].doTick(this.preTime,this.time,CCalc.crRange2Value(this._timeSections[t].startTime,this._timeSections[t].stopTime,this.time,0,1)):this.preTime<=this._timeSections[t].startTime&&this.time>=this._timeSections[t].startTime?this._timeSections[t].doTick(this.preTime,this.time,0):this.time>=this._timeSections[t].stopTime&&this.preTime<=this._timeSections[t].stopTime?this._timeSections[t].doTick(this.preTime,this.time,1):this.time>this._timeSections[t].startTime&&this.time<this._timeSections[t].stopTime&&this._timeSections[t].doTick(this.preTime,this.time,CCalc.crRange2Value(this._timeSections[t].startTime,this._timeSections[t].stopTime,this.time,0,1))}}}hasTimePoint(t){let e=!1;for(let i=0;i<this.timePoints.length;i++)if(this.timePoints[i]==t){e=!0;break}return e}deleteTimePoint(t){for(let e=0;e<this._timePoints.length;e++)if(this._timePoints[e]==t){this._timePoints.splice(e,1);break}}clearTimePoint(){for(let t=this._timePoints.length-1;t>=0;t--)this._timePoints[t].remove(),this._timePoints.splice(t,1)}clearTimeSection(){for(let t=this._timeSections.length-1;t>=0;t--)this._timeSections[t].remove(),this._timeSections.splice(t,1)}timeMove(t){if(t!=this.time){let e=t-this.time;this._preTime=void 0,this._changeTime=void 0,this.time=t,this.times.loopTime((function(t){t.timeMove(t.time+e*t.speed)}))}}pause(){this.isPause=!this.isPause}reverse(){this.isReverse=!this.isReverse}static get now(){return(new Date).getTime()}static doAnimationFrame(t,e){this.systemTime=e,this.isPause||CTime.times.loopTime((function(i){i.setTime(t,e)}))}static pause(){CTime.isPause=!CTime.isPause}static execAfterTimework(t){let e=setInterval((function(){0==CTime.times.length&&(clearInterval(e),t())}),50)}}CTime.isPause=!1,CTime.times=new CTimes,CTime.systemTime=0;class CTimePoint extends CDataClass{get parent(){return this._parent}get afterRemove(){return this._afterRemove}set afterRemove(t){this._afterRemove=t}get time(){return this._time}set time(t){this._time=t}get timePointCount(){return this._timePointCount}set timePointCount(t){this._timePointCount=t}get notifyDirection(){return this._notifyDirection}set notifyDirection(t){this._notifyDirection=t}constructor(t,e,i){super(),this._afterRemove=!1,this._timePointCount=0,this._notifyDirection="both",this._parent=t,this._time=null==e?(new Date).getTime():e,null!=i&&(this._afterRemove=i)}doToData(t){}doFromData(t){}doRemove(){null!=this._parent&&(this._parent.deleteTimePoint(this),this._parent=void 0),super.doRemove()}doBeforeTime(){null!=this.onBeforeTime&&this.onBeforeTime(this,this.parent,this.timePointCount)}doTime(t){this._timePointCount++,null!=this.onTime&&this.onTime(this,this.parent,this.timePointCount),this._afterRemove&&this.doRemove()}checkTime(t,e){let i=CCalc.min(t,e),s=CCalc.max(t,e);if("both"==this.notifyDirection&&i<this.time&&s>=this.time){let i=0;i=t<e?this.time-t:t-this.time,this.doBeforeTime(),this.doTime(i)}else if("go"==this.notifyDirection&&t<this.time&&e>=this.time){let e=this.time-t;this.doBeforeTime(),this.doTime(e)}else if("back"==this.notifyDirection&&e<this.time&&t>=this.time){let e=t-this.time;this.doBeforeTime(),this.doTime(e)}}}class CTimeSection extends CDataClass{get parent(){return this._parent}constructor(t){super(),this.startTime=0,this.stopTime=0,this.isLoop=!1,null!=t&&t.timeSections.push(this)}doToData(t){}doFromData(t){}doRemove(){this._parent=void 0,super.doRemove()}doTick(t,e,i){null!=this.onTick&&this.onTick(this,t,e,i)}}class CTimePointReserve extends CTimePoint{doTime(t){0==this.timePointCount&&null!=this._parent&&(this._parent.isReverse?this._parent.timeMove(this._parent.time+t):this._parent.timeMove(this._parent.time-t),this._parent.reverse()),super.doTime(t)}}class CTimePointPause extends CTimePoint{doTime(t){0==this.timePointCount&&null!=this._parent&&this._parent.pause(),super.doTime(t)}}class CTimePointMoveTime extends CTimePoint{get moveTime(){return this._moveTime}set moveTime(t){this._moveTime=t}constructor(t,e,i,s){super(t,i,s),this._moveTime=e}doTime(t){0==this.timePointCount&&null!=this._parent&&this._parent.timeMove(this._moveTime+t),super.doTime(t)}}class CTimePointRemoveTimeFromTimes extends CTimePoint{doTime(t){null!=this._parent&&CTime.times.delete(this._parent),super.doTime(t)}}{let t;function e(i){let s=(new Date).getTime();if(null!=t)try{CTime.doAnimationFrame(t,s)}catch(t){console.log(t)}t=s,window.requestAnimationFrame(e)}window.requestAnimationFrame(e)}class CAnimation extends CResourceClass{constructor(t,e,i){super(),this._animate=!1,this._value=0,this._invertValue=!1,this.duration=200,this.cancelDuration=100,this.delay=0,this.isLoop=!1,null!=t&&(this.duration=t),null!=e&&(this.delay=e),null!=i&&(this.isLoop=i)}doToData(t){super.doToData(t),CDataClass.putData(t,"duration",this.duration,200),CDataClass.putData(t,"cancelDuration",this.cancelDuration,100),CDataClass.putData(t,"delay",this.delay,0),CDataClass.putData(t,"isLoop",this.isLoop,!1)}doFromData(t){super.doFromData(t),this.duration=CDataClass.getData(t,"duration",200),this.cancelDuration=CDataClass.getData(t,"cancelDuration",100),this.delay=CDataClass.getData(t,"delay",0),this.isLoop=CDataClass.getData(t,"isLoop",!1)}doAnimate(t,e,i){null!=this.onAnimate&&this.onAnimate(this,t,e,i)}doBeforeAnimation(){null!=this.onBeforeAnimation&&this.onBeforeAnimation(this)}doAfterAnimation(){this._animate=!1,null!=this._time&&this._time.doRemove(),this._time=void 0,null!=this.onAfterAnimation&&this.onAfterAnimation(this)}doStart(t){let e=this;this._time=new CTime,this._invertValue=t,this._animate=!0,null!=this.onStart&&this.onStart(this,this._time),CAnimation.animate(this.duration,(function(t,i,s){null!=e&&e._animate&&(e._value=i,e.doAnimate(t,i,s))}),this.delay,this._invertValue,this.isLoop,(function(){null!=e&&e.doBeforeAnimation()}),(function(){null!=e&&e.doAfterAnimation(),e=void 0}),this._time)}doCancel(){if(null!=this._time){null!=this.onCancel&&this.onCancel(this,this._time),this._time.doRemove(),this._time=void 0,this._animate=!1;let t=this;CAnimation.animate(this.cancelDuration,(function(e,i,s){t.doAnimate(e,t._value-CCalc.crRange2Value(0,1,i,0,t._value),s)}),0,this._invertValue,!1,void 0,(function(){t.doAfterAnimation()}),this._time)}}doPause(){null!=this._time&&(this._time.pause(),null!=this.onPause&&this.onPause(this,this._time))}start(){this.doStart(!1)}invert(){this.doStart(!0)}startOnce(t,e,i){CAnimation.animate(this.duration,t,this.delay,!1,this.isLoop,e,i,this._time)}reverse(){null!=this._time&&this._time.reverse()}cancel(){this.doCancel()}pause(){this.doPause()}isAnimate(){return this._animate}static animateResource(t,e,i,s,o){let a=CSystem.resources.get(t);CAnimation.graphAnimate(a.duration,a.graphNames,e,a.pointsNames,i,a.delay,!1,a.isLoop,s,o)}static animate(t,e,i,s,o,a,n,r){let l=null==i?0:"number"==typeof i?i:Math.random()*(i.randomRangeStop-i.randomRangeStart)+i.randomRangeStart,h=null==t?0:"number"==typeof t?t:Math.random()*(t.randomRangeStop-t.randomRangeStart)+t.randomRangeStart,d=(new Date).getTime()+l,g=d+h;function C(t){if(null!=a&&a(),e(t,s?1:0,0),o){let e=new CTimePointMoveTime(t,d,g);e.notifyDirection="go";let i=new CTimePointMoveTime(t,g,d);i.notifyDirection="back",e.onTime=function(t,e){t.timePointCount=0},i.onTime=function(t,e){t.timePointCount=0},t.timePoints.push(e),t.timePoints.push(i)}else{let e=new CTimePointRemoveTimeFromTimes(t,g);e.notifyDirection="go";let i=new CTimePointRemoveTimeFromTimes(t,d);i.notifyDirection="back",e.onTime=function(){e.remove(),i.remove(),null!=n&&n()},i.onTime=function(){e.remove(),i.remove(),null!=n&&n()},t.timePoints.push(e),t.timePoints.push(i)}t.onChangeTime=function(i){if(null!=t.changeTime){let i=CCalc.crRange2Value(d,g,t.time,0,1);i<0&&(i=0),i>1&&(i=1),s&&(i=1-i),e(t,i,t.changeTime)}}}if(0==l)if(null!=r)CTime.times.add(CSequence.getSequence("tempAnimation"),r),C(r);else{let t=new CTime;CTime.times.add(CSequence.getSequence("tempAnimation"),t),C(t)}else null!=r&&CTime.times.add(CSequence.getSequence("tempAnimation"),r),setTimeout((()=>{if(null!=r)C(r);else{let t=new CTime;CTime.times.add(CSequence.getSequence("tempAnimation"),t),C(t)}}),l);return{duration:h,delay:l,startTime:d,stopTime:g}}static graphAnimate(t,e,i,s,o,a,n,r,l,h,d){let g=new Array,C=new Array;for(let t=0;t<e.length;t++){let i=CSystem.resources.get(e[t]);null!=i&&g.push({name:e[t],values:i})}if(null!=s)for(let t=0;t<s.length;t++){let e=CSystem.resources.get("pathpoints"+s[t]);if(null!=e){let i=CSystem.resources.get(e.graphName);null!=i&&C.push({graphName:e.graphName,graphValues:i,pointsName:s[t],points:e.points})}}CAnimation.animate(t,(function(t,e,a){for(let s=0;s<g.length;s++)i(t,e,a,g[s].name,g[s].values[Math.round(CCalc.cr(g[s].values.length-1,0,1,e,2))]);if(null!=s&&null!=o)for(let i=0;i<C.length;i++){let s=C[i].graphValues[Math.round(CCalc.cr(C[i].graphValues.length-1,0,1,e,2))];s<0&&(s=0),s>1&&(s=1),o(t,e,a,C[i].pointsName,C[i].points[Math.round(CCalc.cr(C[i].points.length-1,0,1,s,2))])}}),a,n,r,l,h,d)}}class CGraphAnimationInfo extends CResourceClass{constructor(t,e,i,s,o,a,n,r,l,h){super(),this.duration=200,this.graphNames=new Array,this.duration=t,this.graphNames=e,this.graphProc=i,this.pointsNames=s,this.pointsProc=o,this.delay=a,this.invertValue=n,this.isLoop=r,this.beforeAnimation=l,this.afterAnimation=h}doStartAnimation(){let t=this.getAnimation();return null!=this.onStartAnimation&&this.onStartAnimation(this,t),null!=this.invertValue&&this.invertValue?t.invert():t.start(),t}getAnimation(){let t=new CGraphAnimation(this.graphNames,this.pointsNames,this.duration,this.delay,this.isLoop);return null!=this.graphProc&&(t.onGraphAnimate=this.graphProc),null!=this.pointsProc&&(t.onPointsAnimate=this.pointsProc),null!=this.beforeAnimation&&(t.onBeforeAnimation=this.beforeAnimation),null!=this.afterAnimation&&(t.onAfterAnimation=this.afterAnimation),t}startAnimation(){return this.doStartAnimation()}}class CGraphAnimation extends CAnimation{constructor(t,e,i,s,o){super(i,s,o),this._arr=new Array,this._arrPoints=new Array,this.graphNames=t,this.pointsNames=e}doToData(t){super.doToData(t),CDataClass.putData(t,"graphNames",this.graphNames,[],!0),CDataClass.putData(t,"pointsNames",this.pointsNames,void 0)}doFromData(t){super.doFromData(t),this.graphNames=CDataClass.getData(t,"graphNames",[],!0),this.pointsNames=CDataClass.getData(t,"pointsNames",void 0)}doStart(t){this._arr=[],this._arrPoints=[];for(let t=0;t<this.graphNames.length;t++){let e=CSystem.resources.get(this.graphNames[t]);if(null==e)throw new Error("Not exists graph : "+this.graphNames[t]);this._arr.push({name:this.graphNames[t],values:e})}if(null!=this.pointsNames)for(let t=0;t<this.pointsNames.length;t++){let e=CSystem.resources.get(this.pointsNames[t]);if(null==e)throw new Error("Not exists graph : "+this.pointsNames[t]);{let i=CSystem.resources.get(e.graphName);null!=i&&this._arrPoints.push({graphName:e.graphName,graphValues:i,pointsName:this.pointsNames[t],points:e.points})}}super.doStart(t)}doAnimate(t,e,i){super.doAnimate(t,e,i);for(let s=0;s<this._arr.length;s++)this.doGraphAnimate(t,e,i,this._arr[s].name,this._arr[s].values[Math.round(CCalc.cr(this._arr[s].values.length-1,0,1,e,2))]);if(null!=this.pointsNames)for(let s=0;s<this._arrPoints.length;s++){let o=this._arrPoints[s].graphValues[Math.round(CCalc.cr(this._arrPoints[s].graphValues.length-1,0,1,e,2))];o<0&&(o=0),o>1&&(o=1),this.doPointsAnimate(t,e,i,this._arrPoints[s].pointsName,this._arrPoints[s].points[Math.round(CCalc.cr(this._arrPoints[s].points.length-1,0,1,o,2))])}}doGraphAnimate(t,e,i,s,o){null!=this.onGraphAnimate&&this.onGraphAnimate(this,t,e,i,s,o)}doPointsAnimate(t,e,i,s,o){null!=this.onPointsAnimate&&this.onPointsAnimate(this,t,e,i,s,o)}}class CColorInfo extends CDataClass{constructor(t,e,i,s){super(),this.r=255,this.g=255,this.b=255,this.a=1,null!=t&&(this.r=t),null!=e&&(this.g=e),null!=i&&(this.b=i),null!=s&&(this.a=s)}doToData(t){CDataClass.putData(t,"r",this.r,255),CDataClass.putData(t,"g",this.g,255),CDataClass.putData(t,"b",this.b,255),CDataClass.putData(t,"a",this.a,1)}doFromData(t){this.r=CDataClass.getData(t,"r",255),this.g=CDataClass.getData(t,"g",255),this.b=CDataClass.getData(t,"b",255),this.a=CDataClass.getData(t,"a",1)}toColor(){return"rgba("+this.r+","+this.g+","+this.b+","+this.a+")"}}!function(t){t[t.GRAPH=0]="GRAPH",t[t.POINTS=1]="POINTS"}(EGraphAnimationValueKind||(EGraphAnimationValueKind={})),function(t){t[t.POINT=0]="POINT",t[t.RECT=1]="RECT",t[t.NOTIFYRECT=2]="NOTIFYRECT"}(EPointsValueKind||(EPointsValueKind={}));class CGraphAnimationValue extends CDataClass{get startValueString(){let t="";return"number"==typeof this.startValue?t=this.startValue+"":this.startValue instanceof CColorInfo?t="new CColorInfo("+this.startValue.r+","+this.startValue.g+","+this.startValue.b+","+this.startValue.a+")":this.startValue instanceof CPoint&&(t="new CPoint("+this.startValue.x+","+this.startValue.y+")"),t}get stopValueString(){let t="";return"number"==typeof this.stopValue?t=this.stopValue+"":this.stopValue instanceof CColorInfo?t="new CColorInfo("+this.stopValue.r+","+this.stopValue.g+","+this.stopValue.b+","+this.stopValue.a+")":this.startValue instanceof CPoint&&(t="new CPoint("+this.startValue.x+","+this.startValue.y+")"),t}constructor(t,e,i){super(),this.name=t,this.startValue=e,this.stopValue=i}doToData(t){CDataClass.putData(t,"name",this.name,""),"number"==typeof this.startValue?(CDataClass.putData(t,"startKind","number"),CDataClass.putData(t,"startValue",this.startValue,0)):this.startValue instanceof CPoint?(CDataClass.putData(t,"startKind","CPoint"),CDataClass.putData(t,"startValue",this.startValue.toData(),{x:0,y:0},!0)):this.startValue instanceof CRect?(CDataClass.putData(t,"startKind","CRect"),CDataClass.putData(t,"startValue",this.startValue.toData(),{left:0,top:0,right:0,bottom:0},!0)):this.startValue instanceof CNotifyPoint?(CDataClass.putData(t,"startKind","CNotifyPoint"),CDataClass.putData(t,"startValue",this.startValue.toData(),{x:0,y:0},!0)):this.startValue instanceof CNotifyRect?(CDataClass.putData(t,"startKind","CNotifyRect"),CDataClass.putData(t,"startValue",this.startValue.toData(),{left:0,top:0,right:0,bottom:0},!0)):this.startValue instanceof CColorInfo&&(CDataClass.putData(t,"startKind","CColorInfo"),CDataClass.putData(t,"startValue",this.startValue.toData(),{r:255,g:255,b:255,a:1},!0)),"number"==typeof this.stopValue?(CDataClass.putData(t,"stopKind","number"),CDataClass.putData(t,"stopValue",this.stopValue,0)):this.stopValue instanceof CPoint?(CDataClass.putData(t,"stopKind","CPoint"),CDataClass.putData(t,"stopValue",this.stopValue.toData(),{x:0,y:0},!0)):this.stopValue instanceof CRect?(CDataClass.putData(t,"stopKind","CRect"),CDataClass.putData(t,"stopValue",this.stopValue.toData(),{left:0,top:0,right:0,bottom:0},!0)):this.stopValue instanceof CNotifyPoint?(CDataClass.putData(t,"stopKind","CNotifyPoint"),CDataClass.putData(t,"stopValue",this.stopValue.toData(),{x:0,y:0},!0)):this.stopValue instanceof CNotifyRect?(CDataClass.putData(t,"stopKind","CNotifyRect"),CDataClass.putData(t,"stopValue",this.stopValue.toData(),{left:0,top:0,right:0,bottom:0},!0)):this.stopValue instanceof CColorInfo&&(CDataClass.putData(t,"stopKind","CColorInfo"),CDataClass.putData(t,"stopValue",this.stopValue.toData(),{r:255,g:255,b:255,a:1},!0))}doFromData(t){this.name=CDataClass.getData(t,"name","");let e=CDataClass.getData(t,"startKind"),i=CDataClass.getData(t,"stopKind");"number"==e&&(this.startValue=CDataClass.getData(t,"startValue",0)),"CPoint"==e&&(this.startValue=new CPoint,this.startValue.fromData(CDataClass.getData(t,"startValue",{x:0,y:0},!0))),"CRect"==e&&(this.startValue=new CRect,this.startValue.fromData(CDataClass.getData(t,"startValue",{left:0,top:0,right:0,bottom:0},!0))),"CNotifyPoint"==e&&(this.startValue=new CNotifyPoint,this.startValue.fromData(CDataClass.getData(t,"startValue",{x:0,y:0},!0))),"CNotifyRect"==e&&(this.startValue=new CNotifyRect,this.startValue.fromData(CDataClass.getData(t,"startValue",{left:0,top:0,right:0,bottom:0},!0))),"CColorInfo"==e&&(this.startValue=new CColorInfo,this.startValue.fromData(CDataClass.getData(t,"startValue",{r:255,g:255,b:255,a:1},!0))),"number"==i&&(this.stopValue=CDataClass.getData(t,"stopValue",0)),"CPoint"==i&&(this.stopValue=new CPoint,this.stopValue.fromData(CDataClass.getData(t,"stopValue",{x:0,y:0},!0))),"CRect"==i&&(this.stopValue=new CRect,this.stopValue.fromData(CDataClass.getData(t,"stopValue",{left:0,top:0,right:0,bottom:0},!0))),"CNotifyPoint"==i&&(this.stopValue=new CNotifyPoint,this.stopValue.fromData(CDataClass.getData(t,"stopValue",{x:0,y:0},!0))),"CNotifyRect"==i&&(this.stopValue=new CNotifyRect,this.stopValue.fromData(CDataClass.getData(t,"stopValue",{left:0,top:0,right:0,bottom:0},!0))),"CColorInfo"==i&&(this.stopValue=new CColorInfo,this.stopValue.fromData(CDataClass.getData(t,"stopValue",{r:255,g:255,b:255,a:1},!0)))}getValue(t){if("number"==typeof this.startValue&&"number"==typeof this.stopValue)return CCalc.crRange2Value(0,1,t,this.startValue,this.stopValue);if(this.startValue instanceof CPoint&&this.stopValue instanceof CPoint){let e=CCalc.crRange2Value(0,1,t,this.startValue.x,this.stopValue.x),i=CCalc.crRange2Value(0,1,t,this.startValue.y,this.stopValue.y);return CPoint.create(e,i)}if(this.startValue instanceof CNotifyPoint&&this.stopValue instanceof CNotifyPoint){let e=CCalc.crRange2Value(0,1,t,this.startValue.x,this.stopValue.x),i=CCalc.crRange2Value(0,1,t,this.startValue.y,this.stopValue.y);return CNotifyPoint.create(e,i)}if(this.startValue instanceof CRect&&this.stopValue instanceof CRect){let e=CCalc.crRange2Value(0,1,t,this.startValue.left,this.stopValue.left),i=CCalc.crRange2Value(0,1,t,this.startValue.top,this.stopValue.top),s=CCalc.crRange2Value(0,1,t,this.startValue.right,this.stopValue.right),o=CCalc.crRange2Value(0,1,t,this.startValue.bottom,this.stopValue.bottom);return CRect.create(e,i,s,o)}if(this.startValue instanceof CNotifyRect&&this.stopValue instanceof CNotifyRect){let e=CCalc.crRange2Value(0,1,t,this.startValue.left,this.stopValue.left),i=CCalc.crRange2Value(0,1,t,this.startValue.top,this.stopValue.top),s=CCalc.crRange2Value(0,1,t,this.startValue.right,this.stopValue.right),o=CCalc.crRange2Value(0,1,t,this.startValue.bottom,this.stopValue.bottom);return new CNotifyRect(e,i,s,o)}if(this.startValue instanceof CColorInfo&&this.stopValue instanceof CColorInfo){let e=CCalc.crRange2Value(0,1,t,this.startValue.r,this.stopValue.r),i=CCalc.crRange2Value(0,1,t,this.startValue.g,this.stopValue.g),s=CCalc.crRange2Value(0,1,t,this.startValue.b,this.stopValue.b),o=CCalc.crRange2Value(0,1,t,this.startValue.a,this.stopValue.a);return new CColorInfo(e,i,s,o)}}static graphValueToData(t){return"number"==typeof t?{kind:"number",value:t}:t instanceof CPoint?{kind:"CPoint",value:t.toData()}:t instanceof CRect?{kind:"CRect",value:t.toData()}:t instanceof CNotifyPoint?{kind:"CNotifyPoint",value:t.toData()}:t instanceof CNotifyRect?{kind:"CNotifyRect",value:t.toData()}:t instanceof CColorInfo?{kind:"CColorInfo",value:t.toData()}:void 0}static graphValueFromData(t){if("number"==t.kind)return t.value;if("CPoint"==t.kind){let e=new CPoint;return e.fromData(t.value),e}if("CRect"==t.kind){let e=new CRect;return e.fromData(t.value),e}if("CNotifyPoint"==t.kind){let e=new CNotifyPoint;return e.fromData(t.value),e}if("CNotifyRect"==t.kind){let e=new CNotifyRect;return e.fromData(t.value),e}{let e=new CColorInfo;return e.fromData(t.valeu),e}}}class CPointsAnimationValue extends CDataClass{constructor(t,e,i,s){super(),this.name=t,this.pointsArea=e,this.rectWidth=i,this.rectHeight=s}doToData(t){CDataClass.putData(t,"name",this.name,""),CDataClass.putData(t,"pointsArea",this.pointsArea.toData(),{left:0,top:0,right:0,bottom:0},!0),CDataClass.putData(t,"rectWidth",this.rectWidth,void 0),CDataClass.putData(t,"rectHeight",this.rectHeight,void 0)}doFromData(t){this.name=CDataClass.getData(t,"name",""),this.pointsArea.fromData(CDataClass.getData(t,"pointsArea",{left:0,top:0,right:0,bottom:0},!0)),this.rectWidth=CDataClass.getData(t,"rectWidth",void 0),this.rectHeight=CDataClass.getData(t,"rectHeight",void 0)}getPointValue(t,e){if(e==EPointsValueKind.POINT){let e=CCalc.crRange2Value(0,1,t.x,this.pointsArea.left,this.pointsArea.right),i=CCalc.crRange2Value(0,1,t.y,this.pointsArea.top,this.pointsArea.bottom);return CPoint.create(e,i)}if(e==EPointsValueKind.RECT&&null!=this.rectWidth&&null!=this.rectHeight){let e=new CRect;return e.left=CCalc.crRange2Value(0,1,t.x,this.pointsArea.left,this.pointsArea.right),e.top=CCalc.crRange2Value(0,1,t.y,this.pointsArea.top,this.pointsArea.bottom),e.width=this.rectWidth,e.height=this.rectHeight,e}if(e==EPointsValueKind.NOTIFYRECT&&null!=this.rectWidth&&null!=this.rectHeight){let e=new CNotifyRect;return e.left=CCalc.crRange2Value(0,1,t.x,this.pointsArea.left,this.pointsArea.right),e.top=CCalc.crRange2Value(0,1,t.y,this.pointsArea.top,this.pointsArea.bottom),e.width=this.rectWidth,e.height=this.rectHeight,e}}}class CProperty extends CDataClass{get property(){return new Function("obj","return obj."+this.properties)(this.obj)}set property(t){let e=this.properties.split("."),i="";for(let t=0;t<e.length;t++){if(i+="."+e[t],new Function("obj","return obj"+i+" == undefined")(this.obj))return}new Function("obj","v","if(obj."+this.properties+" != undefined) obj."+this.properties+" = v")(this.obj,t)}constructor(t,e){super(),this.properties="",this.obj=t,this.properties=e}doToData(t){CDataClass.putData(t,"properties",this.properties,"")}doFromData(t){this.properties=CDataClass.getData(t,"properties","")}static getProperty(t,e){return new Function("obj","return obj."+e)(t)}static setProperty(t,e,i){new Function("obj","v","obj."+e+" = v")(t,i)}}class CAnimatorSetProperty extends CProperty{constructor(t,e,i){super(t,e),this.value=i}doToData(t){super.doToData(t),CDataClass.putData(t,"value",this.value)}doFromData(t){super.doFromData(t),this.value=CDataClass.getData(t,"changeValue")}}class CAnimatorGraphProperty extends CProperty{constructor(t,e,i,s,o){super(t,e),this.changeValue=new CGraphAnimationValue(i,s,o)}doToData(t){super.doToData(t),CDataClass.putData(t,"changeValue",this.changeValue.toData())}doFromData(t){super.doFromData(t),this.changeValue.fromData(CDataClass.getData(t,"changeValue"))}}class CAnimatorPointsProperty extends CProperty{constructor(t,e,i,s,o,a){super(t,e),this.changeValue=new CPointsAnimationValue(i,s,o,a)}doToData(t){super.doToData(t),CDataClass.putData(t,"changeValue",this.changeValue)}doFromData(t){super.doFromData(t),this.changeValue.fromData(CDataClass.getData(t,"changeValue"))}}class CAnimator extends CGraphAnimation{get parent(){return this._parent}set parent(t){this._parent=t;for(let e=0;e<this._graphProperties.length;e++)this._graphProperties[e].obj=t;for(let e=0;e<this._pointsProperties.length;e++)this._pointsProperties[e].obj=t}get beforeProperties(){return this._beforeProperties}set beforeProperties(t){this._beforeProperties=t}get graphProperties(){return this._graphProperties}get pointsProperties(){return this._pointsProperties}get afterProperties(){return this._afterProperties}set afterProperties(t){this._afterProperties=t}constructor(t,e=[],i,s,o,a){super(e,i,s,o,a),this._beforeProperties=new Array,this._graphProperties=new Array,this._pointsProperties=new Array,this._afterProperties=new Array,this.beforeScript="//parameter : animator, params",this.animationScript="//parameter : animator, params, graphName, graphValue",this.afterScript="//parameter : animator, params",this._parent=t}doToData(t){super.doToData(t);let e=new Array;for(let t=0;t<this._graphProperties.length;t++)e.push(this._graphProperties[t].toData());let i=new Array;for(let t=0;t<this._pointsProperties.length;t++)i.push(this._pointsProperties[t].toData());CDataClass.putData(t,"className",this.className),CDataClass.putData(t,"beforeProperties",this.beforeProperties,[],!0),CDataClass.putData(t,"graphProperties",e,[],!0),CDataClass.putData(t,"pointsProperties",i,[],!0),CDataClass.putData(t,"afterProperties",this.afterProperties,[],!0),CDataClass.putData(t,"beforeScript",this.beforeScript,"//parameter : animator, params"),CDataClass.putData(t,"animationScript",this.animationScript,"//parameter : animator, params, graphName, graphValue"),CDataClass.putData(t,"afterScript",this.afterScript,"//parameter : animator, params")}doFromData(t){super.doFromData(t),this.beforeProperties=CDataClass.getData(t,"beforeProperties",[],!0),this._graphProperties=[];let e=CDataClass.getData(t,"graphProperties",[],!0);for(let t=0;t<e.length;t++){let i=new CAnimatorGraphProperty(this._parent,"","",0,0);i.fromData(e[t]),this._graphProperties.push(i)}this._pointsProperties=[],e=CDataClass.getData(t,"pointsProperties",[],!0);for(let t=0;t<e.length;t++){let i=new CAnimatorPointsProperty(this._parent,"","",new CRect);i.fromData(e[t]),this._pointsProperties.push(i)}this.afterProperties=CDataClass.getData(t,"afterProperties",[],!0),this.beforeScript=CDataClass.getData(t,"beforeScript","//parameter : animator, params"),this.animationScript=CDataClass.getData(t,"animationScript","//parameter : animator, params, graphName, graphValue"),this.afterScript=CDataClass.getData(t,"afterScript","//parameter : animator, params")}doRemove(){this.parent=void 0,this._beforeProperties=[],this._afterProperties=[],this._pointsProperties=[],this._graphProperties=[],this.__obj={},super.doRemove()}doBeforeAnimation(){super.doBeforeAnimation();for(let t=0;t<this._beforeProperties.length;t++)this._beforeProperties[t].property=this._beforeProperties[t].value;if("//parameter : animator, params"!=this.animationScript){this.__obj={};let t=new Function("animator","params",this.beforeScript);try{t(this,this.__obj)}catch(t){console.log("[Animator] Before script error : "+this.beforeScript,t,this.parent)}}}doAfterAnimation(){super.doAfterAnimation();for(let t=0;t<this._afterProperties.length;t++)this._afterProperties[t].property=this._afterProperties[t].value;if("//parameter : animator, params"!=this.animationScript){let t=new Function("animator","params",this.afterScript);try{t(this,this.__obj)}catch(t){console.log("[Animator] After script error : "+this.afterScript,t,this.parent)}}this.__obj={}}doGraphAnimate(t,e,i,s,o){super.doGraphAnimate(t,e,i,s,o);for(let t=0;t<this._graphProperties.length;t++){let e=this._graphProperties[t].changeValue;if(e.name==s){let i=e.getValue(o);null!=i&&(this._graphProperties[t].property=i instanceof CColorInfo?i.toColor():i)}}if("//parameter : animator, params, graphName, graphValue"!=this.animationScript){let t=new Function("animator","params","graphName","graphValue",this.animationScript);try{t(this,this.__obj,s,o)}catch(t){console.log("[Animator] script error : "+this.animationScript,t,this.parent,s,o)}}}doPointsAnimate(t,e,i,s,o){super.doPointsAnimate(t,e,i,s,o);for(let t=0;t<this._pointsProperties.length;t++){let e=this._pointsProperties[t].changeValue;if(e.name==s){if(this._pointsProperties[t].property instanceof CRect){let i=e.getPointValue(o,EPointsValueKind.RECT);null!=i&&(this._pointsProperties[t].property=i)}if(this._pointsProperties[t].property instanceof CPoint){let i=e.getPointValue(o,EPointsValueKind.POINT);null!=i&&(this._pointsProperties[t].property=i)}if(this._pointsProperties[t].property instanceof CNotifyRect){let i=e.getPointValue(o,EPointsValueKind.NOTIFYRECT);null!=i&&(this._pointsProperties[t].property=i)}}}}addBeforeSetProperty(t,e){let i=new CAnimatorSetProperty(this._parent,t,e);this._beforeProperties.push(i)}addAnimationGraphProperty(t,e,i,s){let o=new CAnimatorGraphProperty(this._parent,t,e,i,s);this._graphProperties.push(o)}addAnimationPointsProperty(t,e,i,s,o){let a=new CAnimatorPointsProperty(this._parent,t,e,i,s,o);this._pointsProperties.push(a)}addAfterSetProperty(t,e){let i=new CAnimatorSetProperty(this._parent,t,e);this._afterProperties.push(i)}static fromAnimatorData(t,e,i){let s=CDataClass.getData(t,i,void 0);null!=s&&(null==e[i]&&(null==s.className||"CAnimator"==s.className?e[i]=new CAnimator(e):"CResourceAnimator"==s.className?e[i]=new CResourceAnimator(e):"CCopyCanvasAnimator"==s.className&&(e[i]=new CCopyCanvasAnimator(e))),e[i].fromData(s))}static animatorFromResource(t,e){let i=CSystem.resources.get(e);if(null!=i&&null!=i.className){let s=new Function("return new "+i.className+"()")();return s.resource=e,s.parent=t,s}}}class CResourceAnimator extends CAnimator{constructor(t,e,i,s,o,a,n){super(void 0,i,s,o,a,n),this.controlResource=t,this.parentControlName=e}doToData(t){super.doToData(t),CDataClass.putData(t,"controlResource",this.controlResource,""),CDataClass.putData(t,"parentControlName",this.parentControlName,void 0)}doFromData(t){super.doFromData(t),this.controlResource=CDataClass.getData(t,"controlResource",""),this.parentControlName=CDataClass.getData(t,"parentControlName",void 0)}doAfterAnimation(){super.doAfterAnimation(),this.parent.remove(),this.parent=void 0}start(){let t=CControl.controlFromResource(this.controlResource);if(t.hasPointerEvent=!1,null==this.parentControlName)t.parent=document.body;else{let e=CControl.getControl(this.parentControlName);e.length>0&&(t.parent=e[0])}t.position.left=0,t.position.top=0,t.position.width=t.parent.position.width,t.position.height=t.parent.position.height;let e=new CAnimator(void 0);e.fromData(this.toData()),e.parent=t,e.onAfterAnimation=function(){t.remove(),e.remove()},e.start()}}class CCopyCanvasAnimator extends CAnimator{start(){let t=new CCanvasLayerControl(this.parent);t.hasPointerEvent=!1,t.layers.fromData(this.parent.layers.toData());let e=this.parent.controlElement.getBoundingClientRect();t.position.width=this.parent.position.width,t.position.height=this.parent.position.height,t.parentElement(document.body),t.position.left=e.left,t.position.top=e.top;let i=new CAnimator(void 0);i.fromData(this.toData()),i.parent=t;let s=this;i.onAfterAnimation=function(){t.remove(),i.remove(),null!=s.onAfterAnimation&&s.onAfterAnimation(s)},i.start()}}class CControl extends CNotifyChangeKindObject{static get CON_CHANGE_NAME(){return"name"}static get CON_CHANGE_STOP_PROPAGATION(){return"changeStopPropagation"}static get CON_CHANGE_POSITION_PARENT(){return"changePositionParent"}static get CON_CHANGE_POSITION(){return"changePosition"}static get CON_CHANGE_HAS_POINTER(){return"changeHasPointer"}static get CON_CHANGE_TAB_INDEX(){return"changeTabIndex"}static get CON_CHANGE_OVER_FLOW(){return"changeOverFlow"}static get CON_CHANGE_OPACITY(){return"changeOpacity"}static get CON_CHANGE_ENABLED(){return"changeEnabled"}static get CON_CHANGE_VISIBLE(){return"changeVisible"}static get CON_CHANGE_FOCUS(){return"changeFocus"}static get CON_CHANGE_SELECTED(){return"changeSelect"}static get CON_CHANGE_CHECKED(){return"changeCheck"}static get CON_CHANGE_USE_DRAG(){return"changeUseDrag"}get isDesignMode(){return this._isDesignMode}set isDesignMode(t){this._isDesignMode!=t&&(this._isDesignMode=t,this.doChangeDesignMode())}get focusedAnimatorResource(){return this._focusedAnimatorResource}set focusedAnimatorResource(t){this._focusedAnimatorResource=t,""!=t&&(this.focusedAnimationTrigger=CAnimator.animatorFromResource(this,t))}get enabledAnimatorResource(){return this._enabledAnimatorResource}set enabledAnimatorResource(t){this._enabledAnimatorResource=t,""!=t&&(this.enabledAnimationTrigger=CAnimator.animatorFromResource(this,t))}get visibleAnimatorResource(){return this._visibleAnimatorResource}set visibleAnimatorResource(t){this._visibleAnimatorResource=t,""!=t&&(this.visibleAnimationTrigger=CAnimator.animatorFromResource(this,t))}get resourceAnimatorResource(){return this._resourceAnimatorResource}set resourceAnimatorResource(t){this._resourceAnimatorResource=t,""!=t&&(this.resourceAnimationTrigger=CAnimator.animatorFromResource(this,t))}get selectAnimatorResource(){return this._selectAnimatorResource}set selectAnimatorResource(t){this._selectAnimatorResource=t,""!=t&&(this.selectAnimationTrigger=CAnimator.animatorFromResource(this,t))}get checkAnimatorResource(){return this._checkAnimatorResource}set checkAnimatorResource(t){this._checkAnimatorResource=t,""!=t&&(this.checkAnimationTrigger=CAnimator.animatorFromResource(this,t))}get removeAnimatorResource(){return this._removeAnimatorResource}set removeAnimatorResource(t){this._removeAnimatorResource=t,""!=t&&(this.removeAnimationTrigger=CAnimator.animatorFromResource(this,t))}get initResource(){return this._initResource}set initResource(t){this._initResource=t;let e=CSystem.resources.get(t);if(null!=e.init){new Function("control",e.init)(this)}}get propertyName(){return this._propertyName}set propertyName(t){this._propertyName!=t&&(this._propertyName=t,this.doChangePropertyName())}get propertyDataKind(){return this._propertyDataKind}set propertyDataKind(t){this._propertyDataKind!=t&&(this._propertyDataKind=t,this.doChangePropertyDataKind())}get parent(){return this._parent}set parent(t){null==t?(this._parent=t,null!=this.controlElement.parentElement&&this.controlElement.parentElement.removeChild(this.controlElement)):(t instanceof HTMLElement?t.appendChild(this.controlElement):(this._parent=t,null!=this.controlElement.parentElement&&this.controlElement.parentElement.removeChild(this.controlElement),t.controlElement.appendChild(this.controlElement)),this.doSetPosition())}get id(){return this._id}get name(){return this._name}get childControls(){return CSystem.getChildControls(this)}get parents(){let t=new Array,e=this._parent;for(;null!=e;)t.unshift(e),e=e.parent;return t}get parentPositions(){let t=new Array,e=this._parent;for(;null!=e;)t.unshift(e._position),e=e.parent;return t}get brotherPositions(){let t=new Array,e=CSystem.getBroControls(this);for(let i=0;i<e.length;i++)e[i].visible&&t.push(e[i]._position);return t}get controlElement(){return this._controlElement}get elementBounds(){let t=new CRect,e=this._controlElement.getBoundingClientRect();return t.left=e.x,t.top=e.y,t.width=e.width,t.height=e.height,t}get position(){return this._position}set position(t){this._position=t;let e=this;this._position.onChange=function(t,i){e.doChangePosition(i)}}get transform(){return this._transform}get hasPointerEvent(){return this._hasPointerEvent}set hasPointerEvent(t){this._hasPointerEvent!=t&&(this._hasPointerEvent=t,this.doChange(CControl.CON_CHANGE_HAS_POINTER))}get cursor(){return this._cursor}set cursor(t){this._cursor!=t&&(this._cursor=t,this.controlElement.style.cursor=t)}get stopPropagation(){return this._stopPropagation}get tabIndex(){return this._tabIndex}set tabIndex(t){this._tabIndex!=t&&(this._tabIndex=t,this.doChange(CControl.CON_CHANGE_TAB_INDEX))}get overflow(){return this._overflow}set overflow(t){this._overflow!=t&&(this._overflow=t,this.doChange(CControl.CON_CHANGE_OVER_FLOW))}get opacity(){return this._opacity}set opacity(t){this._opacity!=t&&(this._opacity=t,this.doChange(CControl.CON_CHANGE_OPACITY))}get enabled(){return this._enabled}set enabled(t){this._enabled!=t&&(this._enabled=t,this.doChange(CControl.CON_CHANGE_ENABLED))}get visible(){return this._visible}set visible(t){this._visible!=t&&(this._visible=t,this.doChange(CControl.CON_CHANGE_VISIBLE,t))}get focused(){return this._focused}set focused(t){this._focused!=t&&(this._focused=t,t?this.controlElement.focus():this.controlElement.blur(),this.doChange(CControl.CON_CHANGE_FOCUS))}get hasFocus(){return""!=this.tabIndex}set hasFocus(t){t?this.hasFocus||(this.tabIndex=CSequence.getSequence("tabindex_").split("_")[1]):this.tabIndex=""}get selected(){return this._selected}set selected(t){this._selected!=t&&(this._selected=t,this.doChange(CControl.CON_CHANGE_SELECTED))}get checked(){return this._checked}set checked(t){this._checked!=t&&(this._checked=t,this.doChange(CControl.CON_CHANGE_CHECKED))}get filter(){return this._filter}constructor(t,e){super(),this.__designOrgData={},this._hasPointerEvent=!0,this._stopPropagation=new CStopPropagationInfo,this._tabIndex="",this._overflow="",this._opacity=1,this._enabled=!0,this._visible=!0,this._focused=!1,this._selected=!1,this._checked=!1,this._cursor="auto",this._initResource="",this._propertyName="",this._propertyDataKind="",this._isDesignMode=!1,this._focusedAnimatorResource="",this._enabledAnimatorResource="",this._visibleAnimatorResource="",this._resourceAnimatorResource="",this._selectAnimatorResource="",this._checkAnimatorResource="",this._removeAnimatorResource="",this.onChildDataMapHandle=new Array;let i=this;this._id=CSequence.getSequence("control"),this._name=null!=e?e:CSequence.getSequence("unnamed");let s=!1;if(0!=CSystem.getControlsFromName(this.getNamPath()).length&&(s=!0),this._controlElement=document.createElement("control"),this._controlElement.setAttribute("className",this.className),this._controlElement.setAttribute("control-id",this.id),this._controlElement.setAttribute("control-name",this.name),this._controlElement.style.outline="none",this._controlElement.style.position="absolute",this._controlElement.style.margin="0px 0px 0px 0px",this._controlElement.style.padding="0px 0px 0px 0px",this._controlElement.style.border="none",this._controlElement.style.zIndex=CSystem.getZPlus()+"",this._controlElement.setAttribute("ondragstart","return false"),this._controlElement.setAttribute("onselectstart","return false"),this._controlElement.setAttribute("oncontextmenu","return false"),this._controlElement.setAttribute("class","scrollno"),this._controlElement.style.touchAction="auto",this._controlElement.style.userSelect="text",this._controlElement.style.pointerEvents="auto",this._controlElement.style.opacity=this._opacity+"",this._position=new CPosition,this._position.onChange=function(t,e){i.doChangePosition(e)},this._transform=new CTransform,this._transform.onChange=function(t,e){i.doChangeTrasform(e)},this._stopPropagation.onChange=function(){i.doChange(CControl.CON_CHANGE_STOP_PROPAGATION)},this._controlElement.addEventListener("focus",(function(t){i.enabled&&(i.focused=!0)})),this._controlElement.addEventListener("blur",(function(t){i.enabled&&(i.focused=!1)})),t instanceof CControl&&(this._parent=t,this._parent.controlElement.appendChild(this._controlElement)),t instanceof HTMLElement&&this.parentElement(t),this._filter=new CFilter(this._controlElement),s)throw this.remove(),new Error("invalid name : "+e);CSystem.controls.addControl(this),this.transform.setTransform(this._controlElement)}doToData(t){super.doToData(t),CDataClass.putData(t,"className",this.className),CDataClass.putData(t,"position",this.position.toData(),{},!0),CDataClass.putData(t,"transform",this.transform.toData(),{},!0),CDataClass.putData(t,"hasPointerEvent",this.hasPointerEvent,!0),CDataClass.putData(t,"stopPropagation",this.stopPropagation.toData(),{},!0),CDataClass.putData(t,"tabIndex",this.tabIndex,""),CDataClass.putData(t,"overflow",this.overflow,""),CDataClass.putData(t,"opacity",this.opacity,1),CDataClass.putData(t,"filter",this.filter.toData(),{},!0),CDataClass.putData(t,"enabled",this.enabled,!0),CDataClass.putData(t,"visible",this.visible,!0),CDataClass.putData(t,"selected",this.selected,!1),CDataClass.putData(t,"checked",this.checked,!1),CDataClass.putData(t,"focusedAnimatorResource",this.focusedAnimatorResource,""),CDataClass.putData(t,"enabledAnimatorResource",this.enabledAnimatorResource,""),CDataClass.putData(t,"visibleAnimatorResource",this.visibleAnimatorResource,""),CDataClass.putData(t,"resourceAnimatorResource",this.resourceAnimatorResource,""),CDataClass.putData(t,"selectAnimatorResource",this.selectAnimatorResource,""),CDataClass.putData(t,"checkAnimatorResource",this.checkAnimatorResource,""),CDataClass.putData(t,"removeAnimatorResource",this.removeAnimatorResource,""),CDataClass.putData(t,"propertyName",this.propertyName,""),CDataClass.putData(t,"propertyDataKind",this.propertyDataKind,""),CDataClass.putData(t,"data",this.data,void 0),CDataClass.putData(t,"cursor",this.cursor,"auto"),null!=this.focusedAnimationTrigger&&CDataClass.putData(t,"focusedAnimationTrigger",this.focusedAnimationTrigger.toData(),{},!0),null!=this.enabledAnimationTrigger&&CDataClass.putData(t,"enabledAnimationTrigger",this.enabledAnimationTrigger.toData(),{},!0),null!=this.visibleAnimationTrigger&&CDataClass.putData(t,"visibleAnimationTrigger",this.visibleAnimationTrigger.toData(),{},!0),null!=this.resourceAnimationTrigger&&CDataClass.putData(t,"resourceAnimationTrigger",this.resourceAnimationTrigger.toData(),{},!0),null!=this.selectAnimationTrigger&&CDataClass.putData(t,"selectAnimationTrigger",this.selectAnimationTrigger.toData(),{},!0),null!=this.checkAnimationTrigger&&CDataClass.putData(t,"checkAnimationTrigger",this.checkAnimationTrigger.toData(),{},!0),null!=this.removeAnimationTrigger&&CDataClass.putData(t,"removeAnimationTrigger",this.removeAnimationTrigger.toData(),{},!0)}doFromData(t){super.doFromData(t);let e=""!=this.propertyName,i=this.propertyName,s=this.propertyDataKind;this.position.fromData(CDataClass.getData(t,"position",{},!0)),this.transform.fromData(CDataClass.getData(t,"transform",{},!0)),this.hasPointerEvent=CDataClass.getData(t,"hasPointerEvent",!0),this.stopPropagation.fromData(CDataClass.getData(t,"stopPropagation",{},!0)),this.tabIndex=CDataClass.getData(t,"tabIndex",""),this.overflow=CDataClass.getData(t,"overflow",""),this.opacity=CDataClass.getData(t,"opacity",1),this.filter.fromData(CDataClass.getData(t,"filter",{},!0)),this.enabled=CDataClass.getData(t,"enabled",!0),this.visible=CDataClass.getData(t,"visible",!0),this.selected=CDataClass.getData(t,"selected",!1),this.checked=CDataClass.getData(t,"checked",!1),CAnimator.fromAnimatorData(t,this,"focusedAnimationTrigger"),CAnimator.fromAnimatorData(t,this,"enabledAnimationTrigger"),CAnimator.fromAnimatorData(t,this,"visibleAnimationTrigger"),CAnimator.fromAnimatorData(t,this,"resourceAnimationTrigger"),CAnimator.fromAnimatorData(t,this,"selectAnimationTrigger"),CAnimator.fromAnimatorData(t,this,"checkAnimationTrigger"),CAnimator.fromAnimatorData(t,this,"removeAnimationTrigger"),this.focusedAnimatorResource=CDataClass.getData(t,"focusedAnimatorResource",""),this.enabledAnimatorResource=CDataClass.getData(t,"enabledAnimatorResource",""),this.visibleAnimatorResource=CDataClass.getData(t,"visibleAnimatorResource",""),this.resourceAnimatorResource=CDataClass.getData(t,"resourceAnimatorResource",""),this.selectAnimatorResource=CDataClass.getData(t,"selectAnimatorResource",""),this.checkAnimatorResource=CDataClass.getData(t,"checkAnimatorResource",""),this.removeAnimatorResource=CDataClass.getData(t,"removeAnimatorResource",""),this.propertyName=CDataClass.getData(t,"propertyName",""),this.propertyDataKind=CDataClass.getData(t,"propertyDataKind",""),this.data=CDataClass.getData(t,"data",void 0),this.cursor=CDataClass.getData(t,"cursor","auto"),e&&(this.propertyName=i,this.propertyDataKind=s)}doChangeDesignMode(){}childDataToMap(){let t=new Map,e=CSystem.getChildControls(this);for(let i=0;i<e.length;i++)t.set(e[i],{kind:"child",data:e[i].toData()});return t}doChildDataMapHandle(t){for(let e=0;e<this.onChildDataMapHandle.length;e++)this.onChildDataMapHandle[e](this,t)}doChildData(t){this.doChildDataMapHandle(t);let e=new Array;return t.forEach((function(t,i){e.push({kind:t.kind,control:i,data:t.data})})),e}doContainerList(){let t=new CTreeData;return t.add({name:this.propertyName,control:this,isMainContainer:!0}),t}doFromChildData(t,e){let i=[];for(let s=0;s<t.length;s++)try{let o={kind:t[s].kind,data:t[s].data,control:void 0};if(i.push(o),"child"==t[s].kind)if(e){let i=e[t[s].data.propertyName];i?(i.fromData(t[s].data),o.control=i):(o.control=CControl.controlFromData(t[s].data,this),o.control&&(o.control.parent=this))}else{let e=this[t[s].data.propertyName];e?(e.fromData(t[s].data),o.control=e):(o.control=CControl.controlFromData(t[s].data,this),o.control&&(o.control.parent=this))}}catch(e){console.log("Error",s,t[s])}return i}doResource(){let t=CSystem.resources.get(this._resource);if(null==t)throw new Error("Not exists resource : "+this._resource);try{t.kind&&"root"==t.kind?this.fromAllChildData(t):this.fromData(t)}catch(e){console.error("Resource load error : class name["+this.className+"] resource name["+this._resource+"]",t,e)}if(null!=t.init){new Function("control",t.init)(this)}if(null!=this.resourceAnimationTrigger){let t=this;this.resourceAnimationTrigger.onAfterAnimation=function(){null!=t.onResource&&t.onResource(this)},this.resourceAnimationTrigger.start()}else null!=this.onResource&&this.onResource(this)}doSetPosition(){if(null!=this.parent){let t=CSystem.getBroVisiblePositions(this),e=CPosition.getAlignPixelBounds(this.parent.position,t,this.position);e.left==this.position.left&&e.top==this.position.top||(e.left!=this.position.left&&(this.position.leftNotNofity=e.left),e.top!=this.position.top&&(this.position.topNotNofity=e.top),this.doChangeOffset()),e.width==this.position.width&&e.height==this.position.height||(e.width!=this.position.width&&(this.position.widthNotNofity=e.width),e.height!=this.position.height&&(this.position.heightNotNofity=e.height),this.doChangeSize())}else this.doSetElementOffset(),this.doSetElementSize();null!=this.onSetPosition&&this.onSetPosition(this)}doSetElementOffset(){this.controlElement.style.left=this.position.left+"px",this.controlElement.style.top=this.position.top+"px",null!=this.onSetElementOffset&&this.onSetElementOffset(this)}doSetElementSize(){this.controlElement.style.width=this.position.width+"px",this.controlElement.style.height=this.position.height+"px",null!=this.onSetElementSize&&this.onSetElementSize(this)}doSetElementRotationCenter(){null!=this.onSetElementRotationCenter&&this.onSetElementRotationCenter(this)}doSetElementScale(){null!=this.onSetElementScale&&this.onSetElementScale(this)}doRemove(){null!=this.onBeforeRemove&&this.onBeforeRemove(this),this.controlElement.blur();let t=CSystem.getChildControls(this);for(let e=0;e<t.length;e++)t[e].remove();CSystem.controls.deleteControl(this),this.controlElement.remove(),null!=this.focusedAnimationTrigger&&this.focusedAnimationTrigger.remove(),this.focusedAnimationTrigger=void 0,null!=this.enabledAnimationTrigger&&this.enabledAnimationTrigger.remove(),this.enabledAnimationTrigger=void 0,null!=this.visibleAnimationTrigger&&this.visibleAnimationTrigger.remove(),this.visibleAnimationTrigger=void 0,null!=this.resourceAnimationTrigger&&this.resourceAnimationTrigger.remove(),this.resourceAnimationTrigger=void 0,null!=this.selectAnimationTrigger&&this.selectAnimationTrigger.remove(),this.selectAnimationTrigger=void 0,null!=this.checkAnimationTrigger&&this.checkAnimationTrigger.remove(),this.checkAnimationTrigger=void 0,null!=this.removeAnimationTrigger&&this.removeAnimationTrigger.remove(),this.removeAnimationTrigger=void 0,super.doRemove()}doChange(t,e){t==CControl.CON_CHANGE_POSITION&&this.doChangePosition(e),t==CControl.CON_CHANGE_HAS_POINTER&&this.doChangeHasPointer(),t==CControl.CON_CHANGE_TAB_INDEX&&this.controlElement.setAttribute("tabindex",this._tabIndex),t==CControl.CON_CHANGE_OVER_FLOW&&(this.controlElement.style.overflow=this._overflow),t==CControl.CON_CHANGE_OPACITY&&this.doChangeOpacity(),t==CControl.CON_CHANGE_ENABLED&&this.doChangeEnabled(),t==CControl.CON_CHANGE_VISIBLE&&this.doChangeVisible(e),t==CControl.CON_CHANGE_FOCUS&&this.doChangeFocus(),t==CControl.CON_CHANGE_CHECKED&&this.doChangeChecked(),t==CControl.CON_CHANGE_SELECTED&&this.doChangeSelected(),super.doChange(t)}doChangePosition(t,e){this.doChange(t,e);let i=!1,s=!1;if(null!=this.parent&&this.position.align!=EPositionAlign.NONE){let t=CSystem.getBroVisiblePositions(this),e=CPosition.getAlignPixelBounds(this.parent.position,t,this.position);e.left==this.position.left&&e.top==this.position.top||(e.left!=this.position.left&&(this.position.leftNotNofity=e.left,i=!0),e.top!=this.position.top&&(this.position.topNotNofity=e.top,i=!0),this.doChangeOffset()),e.width==this.position.width&&e.height==this.position.height||(e.width!=this.position.width&&(this.position.widthNotNofity=e.width,s=!0),e.height!=this.position.height&&(this.position.heightNotNofity=e.height,s=!0),this.doChangeSize())}t!=CPosition.CON_CHANGE_LEFT&&t!=CPosition.CON_CHANGE_TOP||i||this.doChangeOffset(),t!=CPosition.CON_CHANGE_WIDTH&&t!=CPosition.CON_CHANGE_HEIGHT||s||this.doChangeSize(),t==CPosition.CON_CHANGE_ALIGN&&this.doChangeAilgn(),t==CPosition.CON_CHANGE_ALIGN_INFO&&this.doChangeAlignInfo(t),t==CPosition.CON_CHANGE_PARENT_ALIGN_INFO&&this.doChangeParentAlignInfo(t),t==CPosition.CON_CHANGE_MARGINS&&this.doChangeMargins(),t==CPosition.CON_CHANGE_PADDING&&this.doChangePadding()}doChangeTrasform(t){this._transform.setTransform(this.controlElement),t!=CTransform.CON_CHANGE_PERSPECTIVE&&t!=CTransform.CON_CHANGE_PERSPECTIVE_Y&&t!=CTransform.CON_CHANGE_PERSPECTIVE_X||this.doChangePerspective(),t!=CTransform.CON_CHANGE_ROTATION_POINT_X&&t!=CTransform.CON_CHANGE_ROTATION_POINT_Y&&t!=CTransform.CON_CHANGE_ROTATION_POINT_Z||this.doChangeRotationCenter(),t!=CTransform.CON_CHANGE_SCALE_X&&t!=CTransform.CON_CHANGE_SCALE_Y&&t!=CTransform.CON_CHANGE_SCALE_Z||this.doChangeScale(),t!=CTransform.CON_CHANGE_ROTATE_X&&t!=CTransform.CON_CHANGE_ROTATE_Y&&t!=CTransform.CON_CHANGE_ROTATE_Z||this.doChangeRotate(),t!=CTransform.CON_CHANGE_TRANSLATE_X&&t!=CTransform.CON_CHANGE_TRANSLATE_Y&&t!=CTransform.CON_CHANGE_TRANSLATE_Z||this.doChangeTraslate(),null!=this.onChangeTrasform&&this.onChangeTrasform(this)}doChangeAilgn(){this.doSetElementOffset(),this.doSetElementSize(),this.childControlsPositionSet(),this.brothersPositionSet(),null!=this.onChangeAlign&&this.onChangeAlign(this)}doChangeAlignInfo(t,e){this.doSetElementOffset(),this.doSetElementSize(),this.childControlsPositionSet(),this.brothersPositionSet(),null!=this.onChangeAlignInfo&&this.onChangeAlignInfo(this)}doChangeParentAlignInfo(t){this.childControlsPositionSet(),null!=this.onChangeParentAlignInfo&&this.onChangeParentAlignInfo(this)}doChangeOpacity(){this._controlElement.style.opacity=this._opacity+"",null!=this.onChangeOpacity&&this.onChangeOpacity(this)}doChangeVisible(t){if(null!=this.visibleAnimationTrigger)if(t){let t=this;this.visibleAnimationTrigger.onAfterAnimation=function(){t.visible||(t._controlElement.style.display="none"),t.doShow(),t.brothersPositionSet()},this._controlElement.style.display="inline-block",this.triggerTrue(this.visibleAnimationTrigger)}else{let t=this;this.visibleAnimationTrigger.onAfterAnimation=function(){t.visible||(t._controlElement.style.display="none"),t.doHide(),t.brothersPositionSet()},this.triggerFalse(this.visibleAnimationTrigger)}else t?(this._controlElement.style.display="inline-block",this.doShow(),this.brothersPositionSet()):(this._controlElement.style.display="none",this.doHide(),this.brothersPositionSet());null!=this.onChangeVisible&&this.onChangeVisible(this)}doChangeEnabled(){this.enabled||this.focused&&(this.controlElement.blur(),this.focused=!1),null!=this.enabledAnimationTrigger&&(this.enabled?this.triggerTrue(this.enabledAnimationTrigger):this.triggerFalse(this.enabledAnimationTrigger)),null!=this.onChangeEnabled&&this.onChangeEnabled(this)}doChangeFocus(){null!=this.focusedAnimationTrigger&&(this.focused?this.triggerTrue(this.focusedAnimationTrigger):this.triggerFalse(this.focusedAnimationTrigger)),null!=this.onChangeFocus&&this.onChangeFocus(this)}doChangeSelected(){null!=this.selectAnimationTrigger&&(this.selected?this.triggerTrue(this.selectAnimationTrigger):this.triggerFalse(this.selectAnimationTrigger)),null!=this.onChangeSelected&&this.onChangeSelected(this)}doChangeChecked(){null!=this.checkAnimationTrigger&&(this.checked?this.triggerTrue(this.checkAnimationTrigger):this.triggerFalse(this.checkAnimationTrigger)),null!=this.onChangeChecked&&this.onChangeChecked(this)}doChangeOffset(){this.doSetElementOffset(),null!=this.onChangeOffset&&this.onChangeOffset(this)}doChangeSize(){if(this.doSetElementSize(),this.childControlsPositionSet(),this.brothersPositionSet(),this.position.align==EPositionAlign.RIGHT||this.position.align==EPositionAlign.BOTTOM){if(null!=this.parent){let t=CSystem.getBroVisiblePositions(this),e=CPosition.getAlignPixelBounds(this.parent.position,t,this.position);e.left==this.position.left&&e.top==this.position.top||(e.left!=this.position.left&&(this.position.leftNotNofity=e.left),e.top!=this.position.top&&(this.position.topNotNofity=e.top)),e.width==this.position.width&&e.height==this.position.height||(e.width!=this.position.width&&(this.position.widthNotNofity=e.width),e.height!=this.position.height&&(this.position.heightNotNofity=e.height))}this.doSetElementOffset(),this.doSetElementSize()}null!=this.onChangeSize&&this.onChangeSize(this)}doChangeRotationCenter(){this.doSetElementRotationCenter(),null!=this.onChangeRotationCenter&&this.onChangeRotationCenter(this)}doChangeRotate(){null!=this.onChangeRotate&&this.onChangeRotate(this)}doChangeScale(){null!=this.onChangeScale&&this.onChangeScale(this)}doChangeTraslate(){null!=this.onChangeTranslate&&this.onChangeTranslate(this)}doChangePerspective(){null!=this.onChangePerspective&&this.onChangePerspective(this)}doChangeMargins(){this.doSetElementOffset(),this.doSetElementSize(),this.brothersPositionSet(),this.childControlsPositionSet(),null!=this.onChangeMargins&&this.onChangeMargins(this)}doChangePadding(){this.childControlsPositionSet(),null!=this.onChangePadding&&this.onChangePadding(this)}doChangeHasPointer(){this._hasPointerEvent?this._controlElement.style.pointerEvents="auto":this._controlElement.style.pointerEvents="none",null!=this.onChangeHasPointer&&this.onChangeHasPointer(this)}doChangeCountry(t){null!=this.onChangeCountry&&this.onChangeCountry(this,t)}doChangePropertyName(){null!=this.onChangePropertyName&&this.onChangePropertyName(this)}doChangePropertyDataKind(){null!=this.onChangePropertyDataKind&&this.onChangePropertyDataKind(this)}doHide(){null!=this.onHide&&this.onHide(this)}doShow(){null!=this.onShow&&this.onShow(this)}triggerTrue(t){t.isAnimate()?t.reverse():t.start()}triggerFalse(t){t.isAnimate()?t.isLoop?t.cancel():t.reverse():t.invert()}childControlsPositionSet(){let t=CSystem.getChildControls(this);for(let e=0;e<t.length;e++)t[e].position.align!=EPositionAlign.NONE&&t[e].doSetPosition()}childControlsPositionSetAll(){let t=CSystem.getAllChildControls(this);for(let e=0;e<t.length;e++)t[e].doSetPosition()}brothersPositionSet(){let t=CSystem.getBroControls(this);for(let e=0;e<t.length;e++)t[e].position.align!=EPositionAlign.NONE&&t[e].doSetPosition()}remove(){if(null!=this.removeAnimationTrigger){let t=this;this.removeAnimationTrigger.onAfterAnimation=function(){t.doRemove()},this.removeAnimationTrigger.start()}else this.doRemove()}parentElement(t){t.appendChild(this._controlElement)}getParents(){let t=new Array,e=this.parent;for(;null!=e;)t.unshift(e),e=e.parent;return t}getNamPath(){let t=this.getParents(),e="";for(let i=0;i<t.length;i++)e+=0==i?t[i].name:"."+t[i].name;return e+=""==e?this.name:"."+this.name,this.name}getElementBounds(){return this._controlElement.getBoundingClientRect()}bringToFront(){this.controlElement.style.zIndex=CSystem.getZPlus()+""}sendToBack(){this.controlElement.style.zIndex=CSystem.getZMinus()+""}childData(){let t=this.childDataToMap();return this.doChildData(t)}childAllData(){let t={kind:"",data:{},childList:[]};return function t(e,i,s){s.kind=i,s.data=e.toData();let o=e.childData();for(let e=0;e<o.length;e++){let i={kind:o[e].kind,data:o[e].data,childList:[]};s.childList.push(i),t(o[e].control,o[e].kind,i)}}(this,"root",t),t}childAllControls(){let t={kind:"root",control:this,childList:[]};return function t(e,i,s){s.kind=i,s.control=e;let o=e.childData();for(let e=0;e<o.length;e++){let i={kind:o[e].kind,control:o[e].control,childList:[]};s.childList.push(i),t(o[e].control,o[e].kind,i)}}(this,"root",t),t}fromAllChildData(t){let e=this;try{this.fromData(t.data)}catch(i){console.log("root fromData error",e,t.data,i)}!function t(i,s){let o,a=[];for(let t=0;t<s.childList.length;t++)a.push({kind:s.childList[t].kind,data:s.childList[t].data});try{o=i.doFromChildData(a,e)}catch(t){console.log("doFromChildData error",e,a)}for(let e=0;e<s.childList.length;e++){let i=o[e].control;i?t(i,s.childList[e]):(console.log("undefinde",s.childList[e]),console.log("undefinde",a))}}(this,t),this.childControlsPositionSetAll()}addProperties(){let t=super.addProperties();return t.push({instance:this.focusedAnimationTrigger,propertyName:"focusedAnimationTrigger",readOnly:!1,enum:[]}),t.push({instance:this.enabledAnimationTrigger,propertyName:"enabledAnimationTrigger",readOnly:!1,enum:[]}),t.push({instance:this.visibleAnimationTrigger,propertyName:"visibleAnimationTrigger",readOnly:!1,enum:[]}),t.push({instance:this.resourceAnimationTrigger,propertyName:"resourceAnimationTrigger",readOnly:!1,enum:[]}),t.push({instance:this.selectAnimationTrigger,propertyName:"selectAnimationTrigger",readOnly:!1,enum:[]}),t.push({instance:this.checkAnimationTrigger,propertyName:"checkAnimationTrigger",readOnly:!1,enum:[]}),t.push({instance:this.removeAnimationTrigger,propertyName:"removeAnimationTrigger",readOnly:!1,enum:[]}),t}containerList(){return this.doContainerList()}containerListWithChild(){function t(e){for(let i=0;i<e.childItems.length;i++)t(e.childItems.getItem(i));let i=e.value.control.childData();for(let s=0;s<i.length;s++)if("child"==i[s].kind){let o=i[s].control.containerList();e.childItems.addItem(o.getItem(0)),t(o.getItem(0))}}return function(e){let i=e.containerList();return t(i.getItem(0)),i}(this)}toData(){let t=!1;this.isDesignMode&&(t=!0,this.isDesignMode=!1);let e=super.toData();return t&&(this.isDesignMode=!0),e}static createControl(t,e="",i=0,s=0,o=50,a=50){let n=new CControl(t,e);return n.position.left=i,n.position.top=s,n.position.width=o,n.position.height=a,n}static getControl(t,e=""){let i,s=new Array;i=""==e?CSystem.controls.findControls([{columnName:"name",value:t}]):CSystem.controls.findControls([{columnName:"name",value:t},{columnName:"className",value:e}]);for(let t=0;t<i.length;t++)s.push(i[t].control);return s}static controlFromResource(t,e){let i=CSystem.resources.get(t);if(null!=i&&null!=i.className){let s=new Function("return new "+i.className+"()")();return s.resource=t,s.parent=e,s}}static controlFromData(t,e){if(null!=t.className){let i=new Function("return new "+t.className+"()")();return i.fromData(t),i.parent=e,i}throw new Error("Not exists classname : "+JSON.stringify(t))}}class CLayout extends CControl{constructor(t,e){super(t,e),this.hasPointerEvent=!1}doResource(){super.doResource(),this.hasPointerEvent=!1}}!function(t){t[t.NONE=0]="NONE",t[t.MOVE=1]="MOVE",t[t.RESIZE_LT=2]="RESIZE_LT",t[t.RESIZE_T=3]="RESIZE_T",t[t.RESIZE_RT=4]="RESIZE_RT",t[t.RESIZE_L=5]="RESIZE_L",t[t.RESIZE_R=6]="RESIZE_R",t[t.RESIZE_LB=7]="RESIZE_LB",t[t.RESIZE_B=8]="RESIZE_B",t[t.RESIZE_RB=9]="RESIZE_RB"}(EControlMoveKind||(EControlMoveKind={}));class CPointerEventControl extends CControl{static get CON_CHANGE_THIS_PRESSED_POINTS(){return"changeThisPressedPoints"}static get CON_CHANGE_BUBBLE_PRESSED_POINTS(){return"changeButtlePressedPoints"}static get CON_STOP_PROPAGATION_POINTER_DOWN(){return"stopPropagationPointerDown"}static get CON_STOP_PROPAGATION_POINTER_MOVE(){return"stopPropagationPointerMove"}static get CON_STOP_PROPAGATION_POINTER_UP(){return"stopPropagationPointerUp"}static get CON_STOP_PROPAGATION_POINTER_CANCEL(){return"stopPropagationPointerCancel"}static get CON_CHANGE_DRAG_ICON(){return"changeDragIcon"}static get CON_CHANGE_DRAG_CATCH_ICON(){return"changeDragCatchIcon"}static get CON_CHANGE_USE_HINT(){return"changeUseHint"}static get CON_CHANGE_HINT(){return"changeHint"}static get CON_CHANGE_HINT_RESOURCE(){return"changeHint"}static get CON_CHANGE_USE_MOVE(){return"changeUseMove"}static get CON_CHANGE_USE_RESIZE(){return"changeUseResize"}static get CON_CHANGE_MOVE_AREA_LENGTH(){return"changeMoveAreaLength"}static get CON_CHANGE_RESIZE_AREA_LENGTH(){return"changeResizeAreaLength"}static get CON_CHANGE_USE_POINTER_CAPTURE(){return"changeUsePointerCapture"}get magneticLength(){return this._magneticLength}set magneticLength(t){this._magneticLength=t}get moveKind(){return this.__moveKind}get thisPointerDownAnimatorResource(){return this._thisPointerDownAnimatorResource}set thisPointerDownAnimatorResource(t){this._thisPointerDownAnimatorResource=t,""!=t&&(this.thisPointerDownAnimationTrigger=CAnimator.animatorFromResource(this,t))}get thisPointerUpAnimatorResource(){return this._thisPointerUpAnimatorResource}set thisPointerUpAnimatorResource(t){this._thisPointerUpAnimatorResource=t,""!=t&&(this.thisPointerUpAnimationTrigger=CAnimator.animatorFromResource(this,t))}get overAnimatorResource(){return this._overAnimatorResource}set overAnimatorResource(t){this._overAnimatorResource=t,""!=t&&(this.overAnimationTrigger=CAnimator.animatorFromResource(this,t))}get enterAnimatorResource(){return this._enterAnimatorResource}set enterAnimatorResource(t){this._enterAnimatorResource=t,""!=t&&(this.enterAnimationTrigger=CAnimator.animatorFromResource(this,t))}get clickAnimatorResource(){return this._clickAnimatorResource}set clickAnimatorResource(t){this._clickAnimatorResource=t,""!=t&&(this.clickAnimationTrigger=CAnimator.animatorFromResource(this,t))}get doubleClickAnimatorResource(){return this._doubleClickAnimatorResource}set doubleClickAnimatorResource(t){this._doubleClickAnimatorResource=t,""!=t&&(this.doubleClickAnimationTrigger=CAnimator.animatorFromResource(this,t))}get dragStartAnimatorResource(){return this._dragStartAnimatorResource}set dragStartAnimatorResource(t){this._dragStartAnimatorResource=t,""!=t&&(this.dragStartAnimationTrigger=CAnimator.animatorFromResource(this,t))}get dragCancelAnimatorResource(){return this._dragCancelAnimatorResource}set dragCancelAnimatorResource(t){this._dragCancelAnimatorResource=t,""!=t&&(this.dragCancelAnimationTrigger=CAnimator.animatorFromResource(this,t))}get dragCatchAnimatorResource(){return this._dragCatchAnimatorResource}set dragCatchAnimatorResource(t){this._dragCatchAnimatorResource=t,""!=t&&(this.dragCatchAnimationTrigger=CAnimator.animatorFromResource(this,t))}get keyDownAnimatorResource(){return this._keyDownAnimatorResource}set keyDownAnimatorResource(t){this._keyDownAnimatorResource=t,""!=t&&(this.keyDownAnimationTrigger=CAnimator.animatorFromResource(this,t))}get pressedThisPoints(){return this.__pressedThisPoints}get pressedBubblePoints(){return this.__pressedBubblePoints}get repeatClickTime(){return this._repeatClickTime}set repeatClickTime(t){this._repeatClickTime=t}get isEnter(){return this._isEnter}get isOver(){return this._isOver}get isDrag(){return CSystem.dragControls.has(this)}get isPress(){return this.__pressedThisPoints.length>0}get dragCatchControlNames(){return this._dragCatchControlNames}get dragCatchControlPropertyNames(){return this._dragCatchControlPropertyNames}get useDragAndDrop(){return this._useDragAndDrop}set useDragAndDrop(t){this._useDragAndDrop!=t&&(this._useDragAndDrop=t,this.doChange(CControl.CON_CHANGE_USE_DRAG))}get useDragAndDropCancel(){return this._useDragAndDropCancel}set useDragAndDropCancel(t){this._useDragAndDropCancel!=t&&(this._useDragAndDropCancel=t,this.doChange("useDragAndDropCancel"))}get useDragAndDropBubble(){return this._useDragAndDropBubble}set useDragAndDropBubble(t){this._useDragAndDropBubble!=t&&(this._useDragAndDropBubble=t,this.doChange("useDragAndDropBubble"))}get dragIconResource(){return this._dragIconResource}set dragIconResource(t){this._dragIconResource!=t&&(this._dragIconResource=t,this.doChange(CPointerEventControl.CON_CHANGE_DRAG_ICON))}get hintResource(){return this._hintResource}set hintResource(t){this._hintResource!=t&&(this._hintResource=t,this.doChange(CPointerEventControl.CON_CHANGE_HINT_RESOURCE))}get hint(){return this._hint}set hint(t){this._hint!=t&&(this._hint=t,this.doChange(CPointerEventControl.CON_CHANGE_HINT))}get useHint(){return this._useHint}set useHint(t){this._useHint!=t&&(this._useHint=t,this.doChange(CPointerEventControl.CON_CHANGE_USE_HINT))}get hintPosition(){return this._hintPosition}set hintPosition(t){this._hintPosition=t}get hintFixOffset(){return this._hintFixOffset}get useMove(){return this._useMove}set useMove(t){this._useMove!=t&&(this._useMove=t,this.doChange(CPointerEventControl.CON_CHANGE_USE_MOVE))}get useResize(){return this._useResize}set useResize(t){this._useResize!=t&&(this._useResize=t,this.doChange(CPointerEventControl.CON_CHANGE_USE_RESIZE))}get moveAreaLength(){return this._moveAreaLength}set moveAreaLength(t){this._moveAreaLength!=t&&(this._moveAreaLength=t,this.doChange(CPointerEventControl.CON_CHANGE_MOVE_AREA_LENGTH))}get resizeAreaLength(){return this._resizeAreaLength}set resizeAreaLength(t){this._resizeAreaLength!=t&&(this._resizeAreaLength=t,this.doChange(CPointerEventControl.CON_CHANGE_RESIZE_AREA_LENGTH))}get ignoreResizeKind(){return this._ignoreResizeKind}get usePointerCapture(){return this._usePointerCapture}set usePointerCapture(t){this._usePointerCapture!=t&&(this._usePointerCapture=t,this.doChange(CPointerEventControl.CON_CHANGE_USE_POINTER_CAPTURE))}get useFingerCursor(){return this._useFingerCursor}set useFingerCursor(t){this._useFingerCursor!=t&&(this._useFingerCursor=t)}get fingerCursorLength(){return this._fingerCursorLength}set fingerCursorLength(t){this._fingerCursorLength!=t&&(this._fingerCursorLength=t)}get fingerCursorResource(){return this._fingerCursorResource}set fingerCursorResource(t){this._fingerCursorResource!=t&&(this._fingerCursorResource=t)}constructor(t,e){super(t,e),this.__pressedThisPoints=new CList,this.__pressedBubblePoints=new CList,this.__thisDownPoint=new CPoint(0,0),this.__preMovePoint=new CPoint(0,0),this.__downMovePoint=new CPoint(0,0),this.__pressedThisDown=!1,this.__preClick={time:CTime.now,count:0},this.__maxCount=0,this.__moveKind=EControlMoveKind.NONE,this.__moveResizeDown={offsetx:0,offsety:0,pagex:0,pagey:0,left:0,top:0,width:0,height:0},this._isEnter=!1,this._isOver=!1,this._repeatClickTime=300,this._usePointerCapture=!1,this._useDragAndDrop=!1,this._useDragAndDropCancel=!1,this._useDragAndDropBubble=!1,this._dragCatchControlNames=new CStringSet,this._dragCatchControlPropertyNames=new CStringSet,this._dragIconResource="",this._hintResource="",this._hint="",this._useHint=!1,this._hintPosition="auto",this._hintFixOffset=new CPoint(0,0),this._useMove=!1,this.lockMoveX=!1,this.lockMoveY=!1,this.magneticPoints=new Array,this._magneticLength=0,this._useResize=!1,this._moveAreaLength=-1,this._resizeAreaLength=5,this._ignoreResizeKind=new Set,this.resizeMinWidth=50,this.resizeMinHeight=50,this._useFingerCursor=!1,this._fingerCursorLength=30,this._fingerCursors=new Array,this._fingerCursorResource="",this._thisPointerDownAnimatorResource="",this._thisPointerUpAnimatorResource="",this._overAnimatorResource="",this._enterAnimatorResource="",this._clickAnimatorResource="",this._doubleClickAnimatorResource="",this._dragStartAnimatorResource="",this._dragCancelAnimatorResource="",this._dragCatchAnimatorResource="",this._keyDownAnimatorResource="",this.useMoveClick=!1;let i=this;this._stopPropagation.onChange=function(){i.doChange(CControl.CON_CHANGE_STOP_PROPAGATION)},this._controlElement.addEventListener("keydown",(function(t){i.enabled&&i.doKeyDown(t),i._stopPropagation.keyboard&&t.stopPropagation()})),this._controlElement.addEventListener("keypress",(function(t){i.enabled&&i.doKeyPress(t),i._stopPropagation.keyboard&&t.stopPropagation()})),this._controlElement.addEventListener("keyup",(function(t){i.enabled&&i.doKeyUp(t),i._stopPropagation.keyboard&&t.stopPropagation()})),this._controlElement.addEventListener("pointerdown",(function(t){i.enabled&&(i.doPointerDown(t),i._stopPropagation.down&&t.stopPropagation())})),this._controlElement.addEventListener("pointermove",(function(t){i.enabled&&(i.doPointerMove(t),i._stopPropagation.move&&t.stopPropagation())})),this._controlElement.addEventListener("pointerup",(function(t){i.enabled&&(i.doPointerUp(t),i._stopPropagation.up&&t.stopPropagation())})),this._controlElement.addEventListener("pointercancel",(function(t){i.enabled&&(i.doPointerCancel(t),i._stopPropagation.cancel&&t.stopPropagation())})),this._controlElement.addEventListener("pointerover",(function(t){i.enabled&&(i._isOver=!0,i.doPointerOver(t),i._stopPropagation.over&&t.stopPropagation())})),this._controlElement.addEventListener("pointerout",(function(t){i.enabled&&(i._isOver=!1,i.doPointerOut(t),i._stopPropagation.out&&t.stopPropagation())})),this._controlElement.addEventListener("pointerenter",(function(t){i.enabled&&(i._isEnter=!0,i.doPointerEnter(t),i._stopPropagation.enter&&t.stopPropagation())})),this._controlElement.addEventListener("pointerleave",(function(t){i.enabled&&(i._isEnter=!1,i.doPointerLeave(t),i._stopPropagation.leave&&t.stopPropagation())})),this._controlElement.addEventListener("wheel",(function(t){i.enabled&&i.doWheel(t),i._stopPropagation.wheel&&t.stopPropagation()}),{passive:!0}),this.__pressedThisPoints.onChange=function(){i.enabled&&i.doChangeThisPressedPoints()},this.__pressedBubblePoints.onChange=function(){i.enabled&&i.doChangeBubblePressedPoints()}}doToData(t){super.doToData(t),CDataClass.putData(t,"repeatClickTime",this.repeatClickTime,300),CDataClass.putData(t,"useDragAndDrop",this.useDragAndDrop,!1),CDataClass.putData(t,"useDragAndDropCancel",this.useDragAndDropCancel,!1),CDataClass.putData(t,"useDragAndDropBubble",this.useDragAndDropBubble,!1),CDataClass.putData(t,"dragCatchControlNames",this.dragCatchControlNames.toData(),[],!0),CDataClass.putData(t,"dragCatchControlPropertyNames",this.dragCatchControlPropertyNames.toData(),[],!0),CDataClass.putData(t,"dragIconResource",this.dragIconResource,""),CDataClass.putData(t,"hintResource",this.hintResource,""),CDataClass.putData(t,"hint",this.hint,""),CDataClass.putData(t,"useHint",this.useHint,!1),CDataClass.putData(t,"hintPosition",this.hintPosition,"auto"),CDataClass.putData(t,"hintFixOffset",this.hintFixOffset.toData(),{},!0),CDataClass.putData(t,"usePointerCapture",this.usePointerCapture,!1),CDataClass.putData(t,"useMove",this.useMove,!1),CDataClass.putData(t,"useResize",this.useResize,!1),CDataClass.putData(t,"moveAreaLength",this.moveAreaLength,-1),CDataClass.putData(t,"resizeAreaLength",this.resizeAreaLength,5),CDataClass.putData(t,"resizeMinWidth",this.resizeMinWidth,50),CDataClass.putData(t,"resizeMinHeight",this.resizeMinHeight,50),CDataClass.putData(t,"lockMoveX",this.lockMoveX,!1),CDataClass.putData(t,"lockMoveY",this.lockMoveY,!1),CDataClass.putData(t,"lockMaxX",this.lockMaxX,void 0),CDataClass.putData(t,"lockMinX",this.lockMinX,void 0),CDataClass.putData(t,"lockMaxY",this.lockMaxY,void 0),CDataClass.putData(t,"lockMinY",this.lockMinY,void 0),CDataClass.putData(t,"thisPointerDownAnimatorResource",this.thisPointerDownAnimatorResource,""),CDataClass.putData(t,"thisPointerUpAnimatorResource",this.thisPointerUpAnimatorResource,""),CDataClass.putData(t,"overAnimatorResource",this.overAnimatorResource,""),CDataClass.putData(t,"enterAnimatorResource",this.enterAnimatorResource,""),CDataClass.putData(t,"clickAnimatorResource",this.clickAnimatorResource,""),CDataClass.putData(t,"doubleClickAnimatorResource",this.doubleClickAnimatorResource,""),CDataClass.putData(t,"dragStartAnimatorResource",this.dragStartAnimatorResource,""),CDataClass.putData(t,"dragCancelAnimatorResource",this.dragCancelAnimatorResource,""),CDataClass.putData(t,"dragCatchAnimatorResource",this.dragCatchAnimatorResource,""),CDataClass.putData(t,"keyDownAnimatorResource",this.keyDownAnimatorResource,""),CDataClass.putData(t,"useMoveClick",this.useMoveClick,!1),CDataClass.putData(t,"magneticLength",this.magneticLength,0),CDataClass.putData(t,"magneticPoints",this.magneticPoints,[],!0),null!=this.thisPointerDownAnimationTrigger&&CDataClass.putData(t,"thisPointerDownAnimationTrigger",this.thisPointerDownAnimationTrigger.toData(),{},!0),null!=this.thisPointerUpAnimationTrigger&&CDataClass.putData(t,"thisPointerUpAnimationTrigger",this.thisPointerUpAnimationTrigger.toData(),{},!0),null!=this.overAnimationTrigger&&CDataClass.putData(t,"overAnimationTrigger",this.overAnimationTrigger.toData(),{},!0),null!=this.enterAnimationTrigger&&CDataClass.putData(t,"enterAnimationTrigger",this.enterAnimationTrigger.toData(),{},!0),null!=this.clickAnimationTrigger&&CDataClass.putData(t,"clickAnimationTrigger",this.clickAnimationTrigger.toData(),{},!0),null!=this.doubleClickAnimationTrigger&&CDataClass.putData(t,"doubleClickAnimationTrigger",this.doubleClickAnimationTrigger.toData(),{},!0),null!=this.dragStartAnimationTrigger&&CDataClass.putData(t,"dragStartAnimationTrigger",this.dragStartAnimationTrigger.toData(),{},!0),null!=this.dragCancelAnimationTrigger&&CDataClass.putData(t,"dragCancelAnimationTrigger",this.dragCancelAnimationTrigger.toData(),{},!0),null!=this.dragCatchAnimationTrigger&&CDataClass.putData(t,"dragCatchAnimationTrigger",this.dragCatchAnimationTrigger.toData(),{},!0),null!=this.keyDownAnimationTrigger&&CDataClass.putData(t,"keyDownAnimationTrigger",this.keyDownAnimationTrigger.toData(),{},!0)}doFromData(t){super.doFromData(t),this.repeatClickTime=CDataClass.getData(t,"repeatClickTime",300),this.useDragAndDrop=CDataClass.getData(t,"useDragAndDrop",!1),this.useDragAndDropCancel=CDataClass.getData(t,"useDragAndDropCancel",!1),this.useDragAndDropBubble=CDataClass.getData(t,"useDragAndDropBubble",!1),this.dragCatchControlNames.fromData(CDataClass.getData(t,"dragCatchControlNames",[],!0)),this.dragCatchControlPropertyNames.fromData(CDataClass.getData(t,"dragCatchControlPropertyNames",[],!0)),this.dragIconResource=CDataClass.getData(t,"dragIconResource",""),this.hintResource=CDataClass.getData(t,"hintResource",""),this.hint=CDataClass.getData(t,"hint",""),this.useHint=CDataClass.getData(t,"useHint",!1),this.hintPosition=CDataClass.getData(t,"hintPosition","auto"),this.hintFixOffset.fromData(CDataClass.getData(t,"hintFixOffset",{},!0)),this.usePointerCapture=CDataClass.getData(t,"usePointerCapture",!1),this.useMove=CDataClass.getData(t,"useMove",!1),this.useResize=CDataClass.getData(t,"useResize",!1),this.moveAreaLength=CDataClass.getData(t,"moveAreaLength",-1),this.resizeAreaLength=CDataClass.getData(t,"resizeAreaLength",5),this.resizeMinWidth=CDataClass.getData(t,"resizeMinWidth",50),this.resizeMinHeight=CDataClass.getData(t,"resizeMinHeight",50),this.lockMoveX=CDataClass.getData(t,"lockMoveX",!1),this.lockMoveY=CDataClass.getData(t,"lockMoveY",!1),this.lockMaxX=CDataClass.getData(t,"lockMaxX",void 0),this.lockMinX=CDataClass.getData(t,"lockMinX",void 0),this.lockMaxY=CDataClass.getData(t,"lockMaxY",void 0),this.lockMinY=CDataClass.getData(t,"lockMinY",void 0),this.useMoveClick=CDataClass.getData(t,"useMoveClick",!1),this.magneticLength=CDataClass.getData(t,"magneticLength",0),this.magneticPoints=CDataClass.getData(t,"magneticPoints",[],!0),CAnimator.fromAnimatorData(t,this,"thisPointerDownAnimationTrigger"),CAnimator.fromAnimatorData(t,this,"thisPointerUpAnimationTrigger"),CAnimator.fromAnimatorData(t,this,"overAnimationTrigger"),CAnimator.fromAnimatorData(t,this,"enterAnimationTrigger"),CAnimator.fromAnimatorData(t,this,"clickAnimationTrigger"),CAnimator.fromAnimatorData(t,this,"doubleClickAnimationTrigger"),CAnimator.fromAnimatorData(t,this,"dragStartAnimationTrigger"),CAnimator.fromAnimatorData(t,this,"dragCancelAnimationTrigger"),CAnimator.fromAnimatorData(t,this,"dragCatchAnimationTrigger"),CAnimator.fromAnimatorData(t,this,"keyDownAnimationTrigger"),this.thisPointerDownAnimatorResource=CDataClass.getData(t,"thisPointerDownAnimatorResource",""),this.thisPointerUpAnimatorResource=CDataClass.getData(t,"thisPointerUpAnimatorResource",""),this.overAnimatorResource=CDataClass.getData(t,"overAnimatorResource",""),this.enterAnimatorResource=CDataClass.getData(t,"enterAnimatorResource",""),this.clickAnimatorResource=CDataClass.getData(t,"clickAnimatorResource",""),this.doubleClickAnimatorResource=CDataClass.getData(t,"doubleClickAnimatorResource",""),this.dragStartAnimatorResource=CDataClass.getData(t,"dragStartAnimatorResource",""),this.dragCancelAnimatorResource=CDataClass.getData(t,"dragCancelAnimatorResource",""),this.dragCatchAnimatorResource=CDataClass.getData(t,"dragCatchAnimatorResource",""),this.keyDownAnimatorResource=CDataClass.getData(t,"keyDownAnimatorResource","")}doRemove(){null!=this.thisPointerDownAnimationTrigger&&this.thisPointerDownAnimationTrigger.remove(),this.thisPointerDownAnimationTrigger=void 0,null!=this.thisPointerUpAnimationTrigger&&this.thisPointerUpAnimationTrigger.remove(),this.thisPointerUpAnimationTrigger=void 0,null!=this.overAnimationTrigger&&this.overAnimationTrigger.remove(),this.overAnimationTrigger=void 0,null!=this.enterAnimationTrigger&&this.enterAnimationTrigger.remove(),this.enterAnimationTrigger=void 0,null!=this.clickAnimationTrigger&&this.clickAnimationTrigger.remove(),this.clickAnimationTrigger=void 0,null!=this.doubleClickAnimationTrigger&&this.doubleClickAnimationTrigger.remove(),this.doubleClickAnimationTrigger=void 0,null!=this.dragStartAnimationTrigger&&this.dragStartAnimationTrigger.remove(),this.dragStartAnimationTrigger=void 0,null!=this.dragCatchAnimationTrigger&&this.dragCatchAnimationTrigger.remove(),this.dragCatchAnimationTrigger=void 0,null!=this.keyDownAnimationTrigger&&this.keyDownAnimationTrigger.remove(),this.keyDownAnimationTrigger=void 0,super.doRemove()}doChange(t,e){super.doChange(t,e),t==CPointerEventControl.CON_CHANGE_THIS_PRESSED_POINTS&&this.doChangeThisPressedPoints(),t==CPointerEventControl.CON_CHANGE_BUBBLE_PRESSED_POINTS&&this.doChangeBubblePressedPoints(),t==CPointerEventControl.CON_CHANGE_USE_POINTER_CAPTURE&&this.doSetTouchAction(),t==CPointerEventControl.CON_CHANGE_USE_MOVE&&this.doSetTouchAction(),t==CPointerEventControl.CON_CHANGE_USE_RESIZE&&this.doSetTouchAction(),t==CPointerEventControl.CON_CHANGE_USE_DRAG&&this.doSetTouchAction()}doSetTouchAction(){this._usePointerCapture||this._useDragAndDrop||this._useMove||this._useResize?this.controlElement.style.touchAction="none":this.controlElement.style.touchAction="auto"}doChangeThisPressedPoints(){null!=this.onThisPressedPointsChange&&this.onThisPressedPointsChange(this,this.pressedThisPoints)}doChangeBubblePressedPoints(){null!=this.onBubblePressedPointsChange&&this.onBubblePressedPointsChange(this,this.pressedBubblePoints)}doKeyDown(t){this.keyDownAnimationTrigger instanceof CAnimator&&this.keyDownAnimationTrigger.start(),this.keyDownAnimationTrigger instanceof CGraphAnimationInfo&&this.keyDownAnimationTrigger.startAnimation(),null!=this.onKeyDown&&this.onKeyDown(this,t)}doKeyPress(t){null!=this.onKeyPress&&this.onKeyPress(this,t)}doKeyUp(t){null!=this.onKeyUp&&this.onKeyUp(this,t)}doPointerDown(t){if(t.target==this.controlElement)this.__pressedThisPoints.add({downTime:(new Date).getTime(),point:t}),this.isMove(t)&&this.bringToFront(),"none"==this.controlElement.style.touchAction&&this.controlElement.setPointerCapture(t.pointerId),this.doThisPointerDown(t,this.__pressedThisPoints);else{let e=CSystem.getControl(t.target);null!=e&&(this.__pressedBubblePoints.add({downTime:(new Date).getTime(),target:e,point:t}),this.doBubblePointerDown(e,t,this.__pressedBubblePoints))}null!=this.onPointerDown&&this.onPointerDown(this,t)}doPointerMove(t){if(t.target==this._controlElement)this.doThisPointerMove(t,this.__pressedThisPoints);else{let e=CSystem.getControl(t.target);null!=e&&this.doBubblePointerMove(e,t,this.__pressedBubblePoints)}null!=this.onPointerMove&&this.onPointerMove(this,t)}doPointerUp(t){if(t.target==this.controlElement){for(let e=this.__pressedThisPoints.length-1;e>=0;e--)this.__pressedThisPoints.get(e).point.pointerId==t.pointerId&&this.__pressedThisPoints.delete(e);"none"==this.controlElement.style.touchAction&&this._controlElement.releasePointerCapture(t.pointerId),this.doThisPointerUp(t,this.__pressedThisPoints)}else{for(let e=this.__pressedBubblePoints.length-1;e>=0;e--)this.__pressedBubblePoints.get(e).point.pointerId==t.pointerId&&this.__pressedBubblePoints.delete(e);let e=CSystem.getControl(t.target);null!=e&&this.doBubblePointerUp(e,t,this.__pressedBubblePoints)}this.__moveKind=EControlMoveKind.NONE,null!=this.onPointerUp&&this.onPointerUp(this,t)}doPointerCancel(t){if(t.target==this._controlElement){for(let e=this.__pressedThisPoints.length-1;e>=0;e--)this.__pressedThisPoints.get(e).point.pointerId==t.pointerId&&this.__pressedThisPoints.delete(e);this.doThisPointerCancel(t,this.__pressedThisPoints)}else{for(let e=this.__pressedBubblePoints.length-1;e>=0;e--)this.__pressedBubblePoints.get(e).point.pointerId==t.pointerId&&this.__pressedBubblePoints.delete(e);let e=CSystem.getControl(t.target);null!=e&&this.doBubblePointerCancel(e,t,this.__pressedBubblePoints)}this.__moveKind=EControlMoveKind.NONE,null!=this.onPointerCancel&&this.onPointerCancel(this,t)}doPointerEnter(t){if(this._isEnter=!0,null!=this.enterAnimationTrigger&&this.triggerTrue(this.enterAnimationTrigger),t.target==this.controlElement)this.doThisPointerEnter(t,this.__pressedThisPoints);else{let e=CSystem.getControl(t.target);null!=e&&this.doBubblePointerEnter(e,t,this.__pressedBubblePoints)}null!=this.onPointerEnter&&this.onPointerEnter(this,t)}doPointerLeave(t){if(this._isEnter=!1,null!=this.enterAnimationTrigger&&this.triggerFalse(this.enterAnimationTrigger),t.target==this.controlElement){if(!this.usePointerCapture)for(let e=this.__pressedThisPoints.length-1;e>=0;e--)this.__pressedThisPoints.get(e).point.pointerId==t.pointerId&&this.__pressedThisPoints.delete(e);this.doThisPointerLeave(t,this.__pressedThisPoints)}else{if(!this.usePointerCapture)for(let e=this.__pressedBubblePoints.length-1;e>=0;e--)this.__pressedBubblePoints.get(e).point.pointerId==t.pointerId&&this.__pressedBubblePoints.delete(e);let e=CSystem.getControl(t.target);null!=e&&this.doBubblePointerLeave(e,t,this.__pressedBubblePoints)}null!=this.onPointerLeave&&this.onPointerLeave(this,t)}doPointerOver(t){if(this._isOver=!0,null!=this.overAnimationTrigger&&this.triggerTrue(this.overAnimationTrigger),t.target==this.controlElement)this.doThisPointerOver(t,this.__pressedThisPoints);else{let e=CSystem.getControl(t.target);null!=e&&this.doBubblePointerOver(e,t,this.__pressedBubblePoints)}null!=this.onPointerOver&&this.onPointerOver(this,t)}doPointerOut(t){if(this._isOver=!1,null!=this.overAnimationTrigger&&this.triggerFalse(this.overAnimationTrigger),t.target==this.controlElement){if(!this.usePointerCapture)for(let e=this.__pressedThisPoints.length-1;e>=0;e--)this.__pressedThisPoints.get(e).point.pointerId==t.pointerId&&this.__pressedThisPoints.delete(e);this.doThisPointerOut(t,this.__pressedThisPoints)}else{if(!this.usePointerCapture)for(let e=this.__pressedBubblePoints.length-1;e>=0;e--)this.__pressedBubblePoints.get(e).point.pointerId==t.pointerId&&this.__pressedBubblePoints.delete(e);let e=CSystem.getControl(t.target);null!=e&&this.doBubblePointerOut(e,t,this.__pressedBubblePoints)}null!=this.onPointerOut&&this.onPointerOut(this,t)}doWheel(t){if(t.target==this.controlElement)this.doThisWheel(t);else{let e=CSystem.getControl(t.target);null!=e&&this.doBubbleWheel(e,t)}null!=this.onWheel&&this.onWheel(this,t)}isResize(t){return this.useResize?t.offsetX<=this.resizeAreaLength&&t.offsetY<=this.resizeAreaLength&&!this._ignoreResizeKind.has(EControlMoveKind.RESIZE_LT)?{result:!0,kind:EControlMoveKind.RESIZE_LT}:t.offsetX>this.position.width-this.resizeAreaLength&&t.offsetY<=this.resizeAreaLength&&!this._ignoreResizeKind.has(EControlMoveKind.RESIZE_RT)?{result:!0,kind:EControlMoveKind.RESIZE_RT}:t.offsetX<=this.resizeAreaLength&&t.offsetY>this.position.height-this.resizeAreaLength&&!this._ignoreResizeKind.has(EControlMoveKind.RESIZE_LB)?{result:!0,kind:EControlMoveKind.RESIZE_LB}:t.offsetX>this.position.width-this.resizeAreaLength&&t.offsetY>this.position.height-this.resizeAreaLength&&!this._ignoreResizeKind.has(EControlMoveKind.RESIZE_RB)?{result:!0,kind:EControlMoveKind.RESIZE_RB}:t.offsetX<=this.resizeAreaLength&&!this._ignoreResizeKind.has(EControlMoveKind.RESIZE_L)?{result:!0,kind:EControlMoveKind.RESIZE_L}:t.offsetY<=this.resizeAreaLength&&!this._ignoreResizeKind.has(EControlMoveKind.RESIZE_T)?{result:!0,kind:EControlMoveKind.RESIZE_T}:t.offsetX>this.position.width-this.resizeAreaLength&&!this._ignoreResizeKind.has(EControlMoveKind.RESIZE_R)?{result:!0,kind:EControlMoveKind.RESIZE_R}:t.offsetY>this.position.height-this.resizeAreaLength&&!this._ignoreResizeKind.has(EControlMoveKind.RESIZE_B)?{result:!0,kind:EControlMoveKind.RESIZE_B}:{result:!1,kind:EControlMoveKind.NONE}:{result:!1,kind:EControlMoveKind.NONE}}isMove(t){return!!this.useMove&&(this.useResize?this.moveAreaLength>=0?t.offsetX>this.resizeAreaLength&&t.offsetX<=this.position.width-this.resizeAreaLength&&t.offsetY>this.resizeAreaLength&&t.offsetY<=this.resizeAreaLength+this.moveAreaLength:t.offsetX>this.resizeAreaLength&&t.offsetX<=this.position.width-this.resizeAreaLength&&t.offsetY>this.resizeAreaLength&&t.offsetY<=this.position.height-this.resizeAreaLength:!(this.moveAreaLength>=0)||this.moveAreaLength>=t.offsetY&&this.position.align==EPositionAlign.NONE)}setDown(t){this.__moveResizeDown.offsetx=t.offsetX,this.__moveResizeDown.offsety=t.offsetY,this.__moveResizeDown.pagex=t.pageX,this.__moveResizeDown.pagey=t.pageY,this.__moveResizeDown.left=this.position.left,this.__moveResizeDown.top=this.position.top,this.__moveResizeDown.width=this.position.width,this.__moveResizeDown.height=this.position.height}doThisPointerDown(t,e){null!=this.thisPointerDownAnimationTrigger&&this.thisPointerDownAnimationTrigger.start(),this.pressedThisPoints.length>this.__maxCount&&(this.__maxCount=this.pressedThisPoints.length),this.__pressedThisDown=!0,this.__thisDownPoint=new CPoint(t.offsetX,t.offsetY);let i=this.isResize(t);i.result?(this.__moveKind=i.kind,this.setDown(t)):this.isMove(t)?(this.__moveKind=EControlMoveKind.MOVE,this.setDown(t),this.__preMovePoint=new CPoint(this.position.left,this.position.top),this.__downMovePoint=new CPoint(this.position.left,this.position.top)):(this.__moveKind=EControlMoveKind.NONE,this.setDown(t)),null!=this.onThisPointerDown&&this.onThisPointerDown(this,t,e)}doThisPointerMove(t,e){if(null!=this.thisPointerUpAnimationTrigger&&this.thisPointerUpAnimationTrigger.start(),this.__moveKind==EControlMoveKind.MOVE&&(this.doMove(t),this.__preMovePoint=new CPoint(this.position.left,this.position.top)),this.__moveKind!=EControlMoveKind.RESIZE_L&&this.__moveKind!=EControlMoveKind.RESIZE_T&&this.__moveKind!=EControlMoveKind.RESIZE_R&&this.__moveKind!=EControlMoveKind.RESIZE_B&&this.__moveKind!=EControlMoveKind.RESIZE_LT&&this.__moveKind!=EControlMoveKind.RESIZE_LB&&this.__moveKind!=EControlMoveKind.RESIZE_RT&&this.__moveKind!=EControlMoveKind.RESIZE_RB||this.doResize(t,t.pageX,t.pageY,this.__moveKind),this.useDragAndDrop&&!CSystem.dragControls.has(this)&&this.__pressedThisDown&&CPoint.getDistancePoints(this.__thisDownPoint,new CPoint(t.offsetX,t.offsetY))>5&&(CSystem.dragControls.add(this),this.__dragId=t.pointerId,this.doDragStart(t)),CSystem.dragControls.has(this)&&this.__dragId==t.pointerId&&this.__pressedThisDown){let i=CSystem.getOverControls(t,e),s=new Array;for(let t=0;t<i.length;t++)if(this!=i[t].control&&i[t].control instanceof CPointerEventControl){let e=i[t].control;(this.dragCatchControlNames.has(e.name)||this.dragCatchControlPropertyNames.has(e.propertyName))&&s.push(e)}this.doDragging(s,t)}this.useHint&&null!=this.__hint&&this.doMoveHint(t),null!=this.onThisPointerMove&&this.onThisPointerMove(this,t,e)}doThisPointerUp(t,e){if(this.useDragAndDrop&&0==e.length&&CSystem.dragControls.has(this)){CSystem.dragControls.delete(this);let i=CSystem.getOverControls(t,e),s=new Array;for(let t=i.length-1;t>=0;t--)if(this!=i[t].control&&i[t].control instanceof CPointerEventControl){let e=i[t].control;if((this.dragCatchControlNames.has(e.name)||this.dragCatchControlPropertyNames.has(e.propertyName))&&(s.push(e),e.doDropCatch(this,i[t].x,i[t].y,this.dragData),!this._useDragAndDropBubble))break}this.useDragAndDropCancel&&0==s.length?this.doDragCancel():this.doDrop(s,t),this.__dragId=void 0}let i=this.useMoveClick&&this.__moveKind==EControlMoveKind.MOVE&&Math.abs(this.__downMovePoint.x-this.position.left)<5&&Math.abs(this.__downMovePoint.y-this.position.top)<5;(this.__moveKind==EControlMoveKind.NONE||i)&&(t.offsetX<=this.position.width&&t.offsetX>=0&&t.offsetY<=this.position.height&&t.offsetY>=0&&this.__pressedThisDown&&("mouse"==t.pointerType?0==t.button&&this.doClick(t):this.doClick(t)),0==this.__pressedThisPoints.length&&this.__maxCount>1&&(this.doMultiTouchClick(this.__maxCount),this.__maxCount=0),null!=this.onThisPointerUp&&this.onThisPointerUp(this,t,e)),this.__pressedThisDown=!1}doThisPointerCancel(t,e){0==this.__pressedThisPoints.length&&this.__maxCount>1&&(this.doMultiTouchClick(this.__maxCount),this.__maxCount=0),null!=this.onThisPointerCancel&&this.onThisPointerCancel(this,t,e)}doThisPointerEnter(t,e){null!=this.onThisPointerEnter&&this.onThisPointerEnter(this,t,e)}doThisPointerLeave(t,e){null!=this.onThisPointerLeave&&this.onThisPointerLeave(this,t,e)}doThisPointerOver(t,e){this.useHint&&"mouse"==t.pointerType&&this.doShowHint(),null!=this.onThisPointerOver&&this.onThisPointerOver(this,t,e)}doThisPointerOut(t,e){this.useHint&&"mouse"==t.pointerType&&this.doHideHint(),null!=this.onThisPointerOut&&this.onThisPointerOut(this,t,e)}doThisWheel(t){null!=this.onThisWheel&&this.onThisWheel(this,t)}doBubblePointerDown(t,e,i){null!=this.onBubblePointerDown&&this.onBubblePointerDown(this,t,e,i)}doBubblePointerMove(t,e,i){null!=this.onBubblePointerMove&&this.onBubblePointerMove(this,t,e,i)}doBubblePointerUp(t,e,i){e.offsetX<=t.position.width&&e.offsetY<=t.position.height&&e.offsetX>=0&&e.offsetY>=0&&this.doBubbleClick(e),null!=this.onBubblePointerUp&&this.onBubblePointerUp(this,t,e,i)}doBubblePointerCancel(t,e,i){null!=this.onBubblePointerCancel&&this.onBubblePointerCancel(this,t,e,i)}doBubblePointerEnter(t,e,i){null!=this.onBubblePointerEnter&&this.onBubblePointerEnter(this,t,e,i)}doBubblePointerLeave(t,e,i){null!=this.onBubblePointerLeave&&this.onBubblePointerLeave(this,t,e,i)}doBubblePointerOver(t,e,i){null!=this.onBubblePointerOver&&this.onBubblePointerOver(this,t,e,i)}doBubblePointerOut(t,e,i){null!=this.onBubblePointerOut&&this.onBubblePointerOut(this,t,e,i)}doBubbleWheel(t,e){null!=this.onBubbleWheel&&this.onBubbleWheel(this,t,e)}doClick(t){null!=this.clickAnimationTrigger&&this.clickAnimationTrigger.start();let e=CTime.now;e-this.__preClick.time<this._repeatClickTime?this.__preClick.count++:this.__preClick.count=1,this.__preClick.time=e,null!=this.onClick&&this.onClick(this,t),this.__preClick.count>1&&this.doRepeatClick(this.__preClick.count,t)}doBubbleClick(t){null!=this.onBubbleClick&&this.onBubbleClick(this,t)}doDoubleClick(t){null!=this.doubleClickAnimationTrigger&&this.doubleClickAnimationTrigger.start(),null!=this.onDoubleClick&&this.onDoubleClick(this,t)}doPenDraw(t){}doRepeatClick(t,e){null!=this.onRepeatClick&&this.onRepeatClick(this,t,e),2==t&&this.doDoubleClick(e)}doMultiTouchClick(t){3==t&&this._useFingerCursor&&(0==this._fingerCursors.length?this.doShowFingerCursor():this.doHideFingerCursor()),null!=this.onMultiTouchClick&&this.onMultiTouchClick(this,t)}doDragStart(t){""!=this.dragIconResource&&(this.__dragIcon=CControl.controlFromResource(this.dragIconResource,document.body),this.__dragIcon.hasPointerEvent=!1,this.__dragIcon.position.left=t.pageX-this.__dragIcon.position.width/2,this.__dragIcon.position.top=t.pageY-this.__dragIcon.position.height/2,this.__dragIcon.dragStartPosition.x=this.__dragIcon.position.left,this.__dragIcon.dragStartPosition.y=this.__dragIcon.position.top),null!=this.dragStartAnimationTrigger&&this.dragStartAnimationTrigger.start(),null!=this.onDragStart&&this.onDragStart(this,t)}doDragging(t,e){null!=this.__dragIcon&&(this.__dragIcon.isOverCatchControl=t.length>0,this.__dragIcon.position.left=e.pageX-this.__dragIcon.position.width/2,this.__dragIcon.position.top=e.pageY-this.__dragIcon.position.height/2),null!=this.onDragging&&this.onDragging(this,e)}doDrop(t,e){this.dragData=void 0,null!=this.__dragIcon&&this.__dragIcon.doDrop(),null!=this.onDrop&&this.onDrop(this,t,e)}doDragCancel(){null!=this.dragCancelAnimationTrigger&&this.dragCancelAnimationTrigger.start(),this.dragData=void 0,null!=this.__dragIcon&&this.__dragIcon.doCancel(),null!=this.onDragCancel&&this.onDragCancel(this)}doDropCatch(t,e,i,s){null!=this.dragCatchAnimationTrigger&&this.dragCatchAnimationTrigger.start(),null!=this.onDropCatch&&this.onDropCatch(this,t,e,i,s)}doShowHint(){this.__hint=CControl.controlFromResource(this.hintResource,document.body),this.__hint.showHint(this.hint)}doHideHint(){null!=this.__hint&&(this.__hint.hideHint(),this.__hint=void 0)}doMoveHint(t){null!=this.__hint&&("auto"==this.hintPosition?(this.__hint.position.left=t.pageX+this._hintFixOffset.x,this.__hint.position.top=t.pageY+20+this._hintFixOffset.y):(this.__hint.position.left=this.hintFixOffset.x,this.__hint.position.top=this.hintFixOffset.y))}doBeforeMove(t,e,i){let s=new CPoint(e,i);return 0!=this.magneticLength?(s.x=Math.floor(s.x/this.magneticLength)*this.magneticLength,s.y=Math.floor(s.y/this.magneticLength)*this.magneticLength):t.shiftKey&&(s.x=5*Math.floor(s.x/5),s.y=5*Math.floor(s.y/5)),s}doMove(t){let e=this.position.left,i=this.position.top;this.lockMoveX||(e=this.__moveResizeDown.left+(t.pageX-this.__moveResizeDown.pagex),null!=this.lockMinX&&this.lockMinX>e&&(e=this.lockMinX),null!=this.lockMaxX&&this.lockMaxX<e&&(e=this.lockMaxX)),this.lockMoveY||(i=this.__moveResizeDown.top+(t.pageY-this.__moveResizeDown.pagey),null!=this.lockMinY&&this.lockMinY>i&&(i=this.lockMinY),null!=this.lockMaxY&&this.lockMaxY<i&&(i=this.lockMaxY));let s=this.doBeforeMove(t,e,i);this.position.left=s.x,this.position.top=s.y,null!=this.onMove&&this.onMove(this,t)}doResize(t,e,i,s){if(s==EControlMoveKind.RESIZE_L){this.__moveResizeDown.width-(e-this.__moveResizeDown.pagex)>=this.resizeMinWidth?(this.position.left=this.__moveResizeDown.left+(e-this.__moveResizeDown.pagex),this.position.width=this.__moveResizeDown.width-(e-this.__moveResizeDown.pagex)):(this.position.left=this.__moveResizeDown.left+(this.__moveResizeDown.width-this.resizeMinWidth),this.position.width=this.resizeMinWidth)}if(s==EControlMoveKind.RESIZE_T){this.__moveResizeDown.height-(i-this.__moveResizeDown.pagey)>=this.resizeMinHeight?(this.position.top=this.__moveResizeDown.top+(i-this.__moveResizeDown.pagey),this.position.height=this.__moveResizeDown.height-(i-this.__moveResizeDown.pagey)):(this.position.top=this.__moveResizeDown.top+(this.__moveResizeDown.height-this.resizeMinHeight),this.position.height=this.resizeMinHeight)}if(s==EControlMoveKind.RESIZE_R&&(this.__moveResizeDown.width+(e-this.__moveResizeDown.pagex)>=this.resizeMinWidth?this.position.width=this.__moveResizeDown.width+(e-this.__moveResizeDown.pagex):this.position.width=this.resizeMinWidth),s==EControlMoveKind.RESIZE_B&&(this.__moveResizeDown.height+(i-this.__moveResizeDown.pagey)>=this.resizeMinHeight?this.position.height=this.__moveResizeDown.height+(i-this.__moveResizeDown.pagey):this.position.height=this.resizeMinHeight),s==EControlMoveKind.RESIZE_LT){this.__moveResizeDown.width-(e-this.__moveResizeDown.pagex)>=this.resizeMinWidth?(this.position.left=this.__moveResizeDown.left+(e-this.__moveResizeDown.pagex),this.position.width=this.__moveResizeDown.width-(e-this.__moveResizeDown.pagex)):(this.position.left=this.__moveResizeDown.left+(this.__moveResizeDown.width-this.resizeMinWidth),this.position.width=this.resizeMinWidth),this.__moveResizeDown.height-(i-this.__moveResizeDown.pagey)>=this.resizeMinHeight?(this.position.top=this.__moveResizeDown.top+(i-this.__moveResizeDown.pagey),this.position.height=this.__moveResizeDown.height-(i-this.__moveResizeDown.pagey)):(this.position.top=this.__moveResizeDown.top+(this.__moveResizeDown.height-this.resizeMinHeight),this.position.height=this.resizeMinHeight)}if(s==EControlMoveKind.RESIZE_RT){this.__moveResizeDown.width+(e-this.__moveResizeDown.pagex)>=this.resizeMinWidth?this.position.width=this.__moveResizeDown.width+(e-this.__moveResizeDown.pagex):this.position.width=this.resizeMinWidth,this.__moveResizeDown.height-(i-this.__moveResizeDown.pagey)>=this.resizeMinHeight?(this.position.top=this.__moveResizeDown.top+(i-this.__moveResizeDown.pagey),this.position.height=this.__moveResizeDown.height-(i-this.__moveResizeDown.pagey)):(this.position.top=this.__moveResizeDown.top+(this.__moveResizeDown.height-this.resizeMinHeight),this.position.height=this.resizeMinHeight)}if(s==EControlMoveKind.RESIZE_LB){this.__moveResizeDown.width-(e-this.__moveResizeDown.pagex)>=this.resizeMinWidth?(this.position.left=this.__moveResizeDown.left+(e-this.__moveResizeDown.pagex),this.position.width=this.__moveResizeDown.width-(e-this.__moveResizeDown.pagex)):(this.position.left=this.__moveResizeDown.left+(this.__moveResizeDown.width-this.resizeMinWidth),this.position.width=this.resizeMinWidth),this.__moveResizeDown.height+(i-this.__moveResizeDown.pagey)>=this.resizeMinHeight?this.position.height=this.__moveResizeDown.height+(i-this.__moveResizeDown.pagey):this.position.height=this.resizeMinHeight}s==EControlMoveKind.RESIZE_RB&&(this.__moveResizeDown.width+(e-this.__moveResizeDown.pagex)>=this.resizeMinWidth?this.position.width=this.__moveResizeDown.width+(e-this.__moveResizeDown.pagex):this.position.width=this.resizeMinWidth,this.__moveResizeDown.height+(i-this.__moveResizeDown.pagey)>=this.resizeMinHeight?this.position.height=this.__moveResizeDown.height+(i-this.__moveResizeDown.pagey):this.position.height=this.resizeMinHeight),0!=this.magneticLength?(this.position.left=Math.floor(this.position.left/this.magneticLength)*this.magneticLength,this.position.top=Math.floor(this.position.top/this.magneticLength)*this.magneticLength,this.position.width=Math.floor(this.position.width/this.magneticLength)*this.magneticLength,this.position.height=Math.floor(this.position.height/this.magneticLength)*this.magneticLength):t.shiftKey&&(this.position.left=5*Math.floor(this.position.left/5),this.position.top=5*Math.floor(this.position.top/5),this.position.width=5*Math.floor(this.position.width/5),this.position.height=5*Math.floor(this.position.height/5))}doShowFingerCursor(){if(!this.useFingerCursor)return;let t=this,e=new CPanel(this);e.resource=this._fingerCursorResource,this._fingerCursors.push(e),e.text="LT";let i=new CPanel(this);i.resource=this._fingerCursorResource,this._fingerCursors.push(i),i.text="T";let s=new CPanel(this);s.resource=this._fingerCursorResource,this._fingerCursors.push(s),s.text="RT";let o=new CPanel(this);o.resource=this._fingerCursorResource,this._fingerCursors.push(o),o.text="L";let a=new CPanel(this);a.resource=this._fingerCursorResource,this._fingerCursors.push(a),a.text="R";let n=new CPanel(this);n.resource=this._fingerCursorResource,this._fingerCursors.push(n),n.text="LB";let r=new CPanel(this);r.resource=this._fingerCursorResource,this._fingerCursors.push(r),r.text="B";let l=new CPanel(this);l.resource=this._fingerCursorResource,this._fingerCursors.push(l),l.text="RB";let h=new CPanel(this);h.resource=this._fingerCursorResource,this._fingerCursors.push(h);let d=new CPanel(this);d.resource=this._fingerCursorResource,this._fingerCursors.push(d),d.text="RX";let g=new CPanel(this);g.resource=this._fingerCursorResource,this._fingerCursors.push(g),g.text="RY";let C=new CPanel(this);function c(){e.position.width=t._fingerCursorLength,e.position.height=t._fingerCursorLength,e.position.left=-t._fingerCursorLength/2,e.position.top=-t._fingerCursorLength/2,i.position.width=t._fingerCursorLength,i.position.height=t._fingerCursorLength,i.position.left=(t.position.width-t._fingerCursorLength)/2,i.position.top=-t._fingerCursorLength/2,s.position.width=t._fingerCursorLength,s.position.height=t._fingerCursorLength,s.position.left=t.position.width-t._fingerCursorLength/2,s.position.top=-t._fingerCursorLength/2,o.position.width=t._fingerCursorLength,o.position.height=t._fingerCursorLength,o.position.left=-t._fingerCursorLength/2,o.position.top=(t.position.height-t._fingerCursorLength)/2,a.position.width=t._fingerCursorLength,a.position.height=t._fingerCursorLength,a.position.left=t.position.width-t._fingerCursorLength/2,a.position.top=(t.position.height-t._fingerCursorLength)/2,n.position.width=t._fingerCursorLength,n.position.height=t._fingerCursorLength,n.position.left=-t._fingerCursorLength/2,n.position.top=t.position.height-t._fingerCursorLength/2,r.position.width=t._fingerCursorLength,r.position.height=t._fingerCursorLength,r.position.left=(t.position.width-t._fingerCursorLength)/2,r.position.top=t.position.height-t._fingerCursorLength/2,l.position.width=t._fingerCursorLength,l.position.height=t._fingerCursorLength,l.position.left=t.position.width-t._fingerCursorLength/2,l.position.top=t.position.height-t._fingerCursorLength/2,C.position.width=t._fingerCursorLength,C.position.height=t._fingerCursorLength,C.position.left=(t.position.width-t._fingerCursorLength)/2+t._fingerCursorLength+5,C.position.top=(t.position.height-t._fingerCursorLength)/2,d.position.width=t._fingerCursorLength,d.position.height=t._fingerCursorLength,d.position.left=(t.position.width-t._fingerCursorLength)/2-t._fingerCursorLength-5,d.position.top=(t.position.height-t._fingerCursorLength)/2,g.position.width=t._fingerCursorLength,g.position.height=t._fingerCursorLength,g.position.left=(t.position.width-t._fingerCursorLength)/2,g.position.top=(t.position.height-t._fingerCursorLength)/2,h.position.width=t.position.width-t._fingerCursorLength,h.position.height=t.position.height-t._fingerCursorLength,h.position.left=t._fingerCursorLength/2,h.position.top=t._fingerCursorLength/2}C.resource=this._fingerCursorResource,this._fingerCursors.push(C),C.text="RZ",c(),e.onPointerDown=function(e,i){t.setDown(i)},e.onMove=function(e,i){t.doResize(i,i.pageX,i.pageY,EControlMoveKind.RESIZE_LT),c()},i.onPointerDown=function(e,i){t.setDown(i)},i.onMove=function(e,i){t.doResize(i,i.pageX,i.pageY,EControlMoveKind.RESIZE_T),c()},s.onPointerDown=function(e,i){t.setDown(i)},s.onMove=function(e,i){t.doResize(i,i.pageX,i.pageY,EControlMoveKind.RESIZE_RT),c()},o.onPointerDown=function(e,i){t.setDown(i)},o.onMove=function(e,i){t.doResize(i,i.pageX,i.pageY,EControlMoveKind.RESIZE_L),c()},a.onPointerDown=function(e,i){t.setDown(i)},a.onMove=function(e,i){t.doResize(i,i.pageX,i.pageY,EControlMoveKind.RESIZE_R),c()},n.onPointerDown=function(e,i){t.setDown(i)},n.onMove=function(e,i){t.doResize(i,i.pageX,i.pageY,EControlMoveKind.RESIZE_LB),c()},r.onPointerDown=function(e,i){t.setDown(i)},r.onMove=function(e,i){t.doResize(i,i.pageX,i.pageY,EControlMoveKind.RESIZE_B),c()},l.onPointerDown=function(e,i){t.setDown(i)},l.onMove=function(e,i){t.doResize(i,i.pageX,i.pageY,EControlMoveKind.RESIZE_RB),c()};let u=0,p=0;d.onPointerDown=function(t,e){u=e.pageX,p=e.pageY},d.onMove=function(e,i){t.transform.rotateX=CPoint.getAngleFromTwoPoint(new CPoint(u,p),new CPoint(i.pageX,i.pageY)),c()},g.onPointerDown=function(t,e){u=e.pageX,p=e.pageY},g.onMove=function(e,i){t.transform.rotateY=CPoint.getAngleFromTwoPoint(new CPoint(u,p),new CPoint(i.pageX,i.pageY)),c()},C.onPointerDown=function(t,e){u=e.pageX,p=e.pageY},C.onMove=function(e,i){t.transform.rotateZ=CPoint.getAngleFromTwoPoint(new CPoint(u,p),new CPoint(i.pageX,i.pageY)),c()},h.onPointerDown=function(e,i){t.setDown(i)},h.onMove=function(e,i){t.position.left=t.__moveResizeDown.left+(i.pageX-t.__moveResizeDown.pagex),t.position.top=t.__moveResizeDown.top+(i.pageY-t.__moveResizeDown.pagey),c()}}doHideFingerCursor(){for(let t=0;t<this._fingerCursors.length;t++)this._fingerCursors[t].remove();this._fingerCursors=[]}click(){this.doClick(new PointerEvent(""))}deleteProperties(){return(new Set).add("isOver").add("isEnter")}readOnlyProperties(){return(new Set).add("id").add("name")}addProperties(){let t=super.addProperties();return t.push({instance:this.overAnimationTrigger,propertyName:"overAnimationTrigger",readOnly:!1,enum:[]}),t.push({instance:this.thisPointerDownAnimationTrigger,propertyName:"thisPointerDownAnimationTrigger",readOnly:!1,enum:[]}),t.push({instance:this.thisPointerUpAnimationTrigger,propertyName:"thisPointerUpAnimationTrigger",readOnly:!1,enum:[]}),t.push({instance:this.enterAnimationTrigger,propertyName:"enterAnimationTrigger",readOnly:!1,enum:[]}),t.push({instance:this.clickAnimationTrigger,propertyName:"clickAnimationTrigger",readOnly:!1,enum:[]}),t.push({instance:this.doubleClickAnimationTrigger,propertyName:"doubleClickAnimationTrigger",readOnly:!1,enum:[]}),t.push({instance:this.dragStartAnimationTrigger,propertyName:"dragStartAnimationTrigger",readOnly:!1,enum:[]}),t.push({instance:this.dragStartAnimationTrigger,propertyName:"dragCancelAnimationTrigger",readOnly:!1,enum:[]}),t.push({instance:this.dragCatchAnimationTrigger,propertyName:"dragCatchAnimationTrigger",readOnly:!1,enum:[]}),t.push({instance:this.keyDownAnimationTrigger,propertyName:"keyDownAnimationTrigger",readOnly:!1,enum:[]}),t}}class CPathItem extends CNotifyChangeNotifyObject{get name(){return this._name}set name(t){this._name!=t&&(this._name=t,this.doChange())}get kind(){return this._kind}set kind(t){this._kind!=t&&(this._kind=t,this.doChange())}get visible(){return this._visible}set visible(t){this._visible!=t&&(this._visible=t,this.doChange())}get group(){return this._group}set group(t){this._group!=t&&(this._group=t,this.doChange())}constructor(){super(),this._name=CSequence.getSequence("item"),this._kind="",this._visible=!0,this._group=!1,this.pathData=new CPathPointList,this.childs=new CPathItems,this.fill=new CFillSet,this.stroke=new CStrokeSet,this.opacity=1,this.shadowBlur=0,this.shadowColor="",this.shadowOffsetX=0,this.shadowOffsetY=0,this.composite="source-over",this.text="",this.textSet=new CTextSet;let t=this;this.childs.parent=this,this.childs.onChange=function(){t.doChange()}}doToData(t){super.doToData(t),CDataClass.putData(t,"name",this.name,""),CDataClass.putData(t,"kind",this.kind,""),CDataClass.putData(t,"pathData",this.pathData.toData(),{},!0),CDataClass.putData(t,"childs",this.childs.toData(),{},!0),CDataClass.putData(t,"fill",this.fill.toData(),{},!0),CDataClass.putData(t,"stroke",this.stroke.toData(),{},!0),CDataClass.putData(t,"opacity",this.opacity,1),CDataClass.putData(t,"shadowBlur",this.shadowBlur,0),CDataClass.putData(t,"shadowColor",this.shadowColor,""),CDataClass.putData(t,"shadowOffsetX",this.shadowOffsetX,0),CDataClass.putData(t,"shadowOffsetY",this.shadowOffsetY,0),CDataClass.putData(t,"composite",this.composite,"source-over"),CDataClass.putData(t,"visible",this.visible,!0),CDataClass.putData(t,"group",this.group,!1)}doFromData(t){super.doFromData(t),this.name=CDataClass.getData(t,"name",""),this.kind=CDataClass.getData(t,"kind",""),this.pathData.fromData(CDataClass.getData(t,"pathData",{},!0)),this.childs.fromData(CDataClass.getData(t,"childs",{},!0)),this.fill.fromData(CDataClass.getData(t,"fill",{},!0)),this.stroke.fromData(CDataClass.getData(t,"stroke",{},!0)),this.opacity=CDataClass.getData(t,"opacity",1),this.shadowBlur=CDataClass.getData(t,"shadowBlur",0),this.shadowColor=CDataClass.getData(t,"shadowColor",""),this.shadowOffsetX=CDataClass.getData(t,"shadowOffsetX",0),this.shadowOffsetY=CDataClass.getData(t,"shadowOffsetY",0),this.composite=CDataClass.getData(t,"composite","source-over"),this.visible=CDataClass.getData(t,"visible",!0),this.group=CDataClass.getData(t,"group",!1)}getData(){let t=new CPathPointList;return function e(i){t.addPointList(i.pathData);for(let t=0;t<i.childs.length;t++)e(i.childs.get(t))}(this),t}rotate(t,e,i=!1){!function t(e,s,o){if(e.pathData.rotate(s,o),i){let t=e.pathData.getBounds();e.pathData.rotate(new CPoint(t.left+t.width/2,t.top+t.height/2),-o)}for(let i=0;i<e.childs.length;i++)t(e.childs.get(i),s,o)}(this,t,e)}loopPathItem(t){!function e(i){t(i);for(let t=0;t<i.childs.length;t++)e(i.childs.get(t))}(this)}toCanvasItems(t,e){let i=new CCanvasItems;return this.loopPathItem((function(s){if(s.visible){let n=function(){let t=i.addItem();return t.kind=ECanvasItemKind.PATH,t.pathFitMode=EFitMode.STRETCH,t}();a=s,(o=n).pathData.addPointList(a.pathData),o.fill.fromData(a.fill.toData()),o.stroke.fromData(a.stroke.toData()),o.opacity=a.opacity,o.shadowBlur=a.shadowBlur,o.shadowColor=a.shadowColor,o.shadowOffsetX=a.shadowOffsetX,o.shadowOffsetY=a.shadowOffsetY,new Function("ci","pi","ci.composite = pi.composite")(o,a),o.text=a.text,o.name=a.name,o.textSet.fromData(a.textSet.toData()),n.pathData.width=t,n.pathData.height=e}var o,a})),i}scale(t,e){this.loopPathItem((function(i){i.pathData.scale(t,e)}))}stretch(t){let e=this.pathData.getBounds();this.pathData.stretchIgnoreSize(t);let i=this.pathData.getBounds(),s=i.width/e.width,o=i.height/e.height;for(let a=0;a<this.childs.length;a++){let n=this.childs.get(a).pathData.getBounds();if(n.isEmpty())this.childs.get(a).stretch(t);else if(e.isEmpty()){let r=(n.left-t.left)*s+i.left,l=(n.top-e.top)*o+i.top,h=new CRect(r,l,r+n.width*s,l+n.height*o);this.childs.get(a).stretch(h)}else{let t=(n.left-e.left)*s+i.left,r=(n.top-e.top)*o+i.top,l=new CRect(t,r,t+n.width*s,r+n.height*o);this.childs.get(a).stretch(l)}}}movePoint(t,e){this.loopPathItem((function(i){i.pathData.movePoint(t,e)}))}getBounds(){let t=Number.MAX_VALUE,e=Number.MAX_VALUE,i=Number.MIN_VALUE,s=Number.MIN_VALUE;return this.loopPathItem((function(o){let a=o.pathData.getBounds();a.isEmpty()||(a.left<t&&(t=a.left),a.top<e&&(e=a.top),a.right>i&&(i=a.right),a.bottom>s&&(s=a.bottom))})),Number.MAX_VALUE,Number.MAX_VALUE,Number.MIN_VALUE,s==Number.MIN_VALUE?new CRect:new CRect(t,e,i,s)}}class CPathItems extends CList{doToData(t){super.doToData(t);let e=[];for(let t=0;t<this.length;t++)e.push(this.get(t).toData());CDataClass.putData(t,"items",e,[],!0)}doFromData(t){super.doFromData(t),this.clear();let e=CDataClass.getData(t,"items",[],!0);for(let t=0;t<e.length;t++){this.addItem().fromData(e[t])}}toData(){let t={};return this.doToData(t),t}addItem(){let t=new CPathItem;return this.add(t),t.parent=this.parent,t}}class CCanvasLayerControl extends CPointerEventControl{get layers(){return this._layers}get expandedLayers(){return this._expandedLayers}get layersResource(){return this._layersResource}set layersResource(t){this.layersResource!=t&&(this._layersResource=t,this.layers.resource=t)}get pathItemsResource(){return this._pathItemsResource}set pathItemsResource(t){if(this._pathItemsResource!=t){this._pathItemsResource=t;let e=CSystem.resources.get(t);if(null!=e){let t=new CPathItems;t.fromData(e);let i=0,s=0;i=parseFloat(e.width),s=parseFloat(e.height),this.layers.clear();for(let e=0;e<t.length;e++){this.layers.addLayer().items.fromData(t.get(e).toCanvasItems(i,s).toData())}}}}constructor(t,e){super(t,e),this._expandedLayers=new CNotifyRect(0,0,0,0),this._layersResource="",this._pathItemsResource="";let i=this;this._layers=new CCanvasLayers(this),this._layers.onChangeLayer=function(t,e,s){e==CCanvasLayers.CON_CHANGE_ADD_LAYER&&s.setCanvasElementPosition(-i.expandedLayers.left,-i.expandedLayers.top,i.position.width+i.expandedLayers.left+i.expandedLayers.right,i.position.height+i.expandedLayers.top+i.expandedLayers.bottom)},this.layers.onChange=function(){let t=CSystem.getChildControls(i);for(let e=0;e<t.length;e++)t[e].bringToFront();i.doChangeLayerCount()},this._expandedLayers.onChange=function(){i.setLayers()}}doToData(t){super.doToData(t),CDataClass.putData(t,"layers",this.layers.toData(),[],!0),CDataClass.putData(t,"expandedLayers",this.expandedLayers.toData(),{},!0),CDataClass.putData(t,"layersResource",this.layersResource,"")}doFromData(t){super.doFromData(t),this.layers.fromData(CDataClass.getData(t,"layers",[],!0)),this.expandedLayers.fromData(CDataClass.getData(t,"expandedLayers",{},!0)),this.layersResource=CDataClass.getData(t,"layersResource","")}doRemove(){this._layers.remove(),super.doRemove()}doSetElementSize(){super.doSetElementSize(),this.doSetLayers()}doSetLayers(){this._layers.setLayersPosition(-this.expandedLayers.left,-this.expandedLayers.top,this.position.width+this.expandedLayers.left+this.expandedLayers.right,this.position.height+this.expandedLayers.top+this.expandedLayers.bottom),null!=this.onSetLayers&&this.onSetLayers(this)}doChangeLayerCount(){null!=this.onChangeLayerCount&&this.onChangeLayerCount(this)}doDraw(){this._layers.draw()}doLayerDraw(t,e,i){null!=this.onLayerDraw&&this.onLayerDraw(this,t,e,i)}setLayers(){this.doSetLayers()}addLayer(){return this._layers.addLayer()}draw(){this.doDraw()}getCanvasItems(t){return this.layers.getCanvasItems(t)}drawImage(t){console.log(t.width,t.height);let e=t.getContext("2d");!function t(i,s,o){if(null!=e){for(let t=0;t<i.layers.length;t++)e.drawImage(i.layers.get(t).canvas,s,o),console.log("draw",i.layers.get(t).canvas.width,i.layers.get(t).canvas.height);let a=CSystem.getChildControls(i);for(let e=0;e<a.length;e++)a[e]instanceof CCanvasLayerControl&&t(a[e],0,0)}}(this,0,0)}static createControl(t,e="",i=0,s=0,o=50,a=50){let n=new CCanvasLayerControl(t,e);return n.position.left=i,n.position.top=s,n.position.width=o,n.position.height=a,n}}class CPanel extends CCanvasLayerControl{static get CON_CHANGE_USE_AUTO_SIZE(){return"changeUseAutoSize"}static get CON_CHANGE_TEXT(){return"changeText"}static get CON_CHANGE_TEXTSET(){return"changeTextSet"}get textSet(){return this._textSet}get text(){if(""!=this.textSet.languageKey){let t=CLanguage.getText(this.textSet.languageKey);return null!=t?t:this.textSet.languageKey}return this._text}set text(t){this._text!=t&&(this._text=t,this.doChange(CPanel.CON_CHANGE_TEXT))}get useAutoSize(){return this._useAutoSize}set useAutoSize(t){this._useAutoSize!=t&&(this._useAutoSize=t,this.doChange(CPanel.CON_CHANGE_USE_AUTO_SIZE))}constructor(t,e){super(t,e),this._textSet=new CTextSet,this._text="",this._useAutoSize=!1;let i=this;this.textSet.onChange=function(){i.doChange(CPanel.CON_CHANGE_TEXTSET)}}doToData(t){super.doToData(t),CDataClass.putData(t,"textSet",this.textSet.toData(),{},!0),CDataClass.putData(t,"text",this.text,""),CDataClass.putData(t,"useAutoSize",this.useAutoSize,!1)}doFromData(t){super.doFromData(t),this.textSet.fromData(CDataClass.getData(t,"textSet",{},!0)),this.text=CDataClass.getData(t,"text",""),this.useAutoSize=CDataClass.getData(t,"useAutoSize",!1)}doChange(t,e){super.doChange(t,e),t==CPanel.CON_CHANGE_TEXT&&(this.doChangeText(),this.doSetAutoSize()),t==CPanel.CON_CHANGE_TEXTSET&&(this.doChangeTextSet(),this.doSetAutoSize()),t==CPanel.CON_CHANGE_USE_AUTO_SIZE&&this.doSetAutoSize()}doSetAutoSize(){this._useAutoSize&&(this.position.width=Math.round(CStringUtil.getTextWidth(this.textSet,this.text))+20)}doChangeTextSet(){for(let t=0;t<this.layers.length;t++){let e=this.layers.get(t).items.getItem("text");for(let t=0;t<e.length;t++)e[t].textSet.fromData(this.textSet.toData())}this.doChangeCountry(CLanguage.localCode),null!=this.onChangeTextSet&&this.onChangeTextSet(this)}doChangeText(){for(let t=0;t<this.layers.length;t++){let e=this.layers.get(t).items.getItem("text");for(let t=0;t<e.length;t++)e[t].text=this.text}this.draw(),null!=this.onChangeText&&this.onChangeText(this)}doChangeCountry(t){this.doSetAutoSize();for(let t=0;t<this.layers.length;t++){let e=this.layers.get(t).items.getItem("text");for(let t=0;t<e.length;t++)e[t].text=this.text}this.draw(),super.doChangeCountry(t)}doThisPointerUp(t,e){if(super.doThisPointerUp(t,e),"mouse"==t.pointerType&&2==t.button&&null!=this.popup){this.popup.resource=this.popup.popupResource,t.pageX+this.popup.popupWidth<=window.innerWidth?this.popup.position.left=t.pageX:this.popup.position.left=t.pageX-this.popup.popupWidth;let e=30*this.popup.items.length+10;t.pageY+e<=window.innerHeight?this.popup.position.top=t.pageY:this.popup.position.top=t.pageY-e,this.popup.position.width=this.popup.popupWidth,this.popup.popupCaller=this,this.popup.show()}}canvasItemText(t,e){for(let i=0;i<this.layers.length;i++){let s=this.layers.get(i).items.getItem(t);for(let t=0;t<s.length;t++)s[t].text=e}}}class CPage extends CPanel{constructor(){super(...arguments),this._pageResource="",this.addPropertyNames=[]}get pageResource(){return this._pageResource}set pageResource(t){this._pageResource=t,""!=t&&(this.resource=t)}doToData(t){super.doToData(t),CDataClass.putData(t,"pageResource",this.pageResource,"")}doFromData(t){super.doFromData(t),this.pageResource=CDataClass.getData(t,"pageResource","")}addProperties(){let t=super.addProperties();return t.push({instance:this.addPropertyNames,propertyName:"addPropertyNames",readOnly:!1,enum:[]}),t}}class CCover extends CPanel{get showAnimatorResource(){return this._showAnimatorResource}set showAnimatorResource(t){this._showAnimatorResource=t,""!=t&&(this.showAnimationTrigger=CAnimator.animatorFromResource(this,t))}get hideAnimatorResource(){return this._hideAnimatorResource}set hideAnimatorResource(t){this._hideAnimatorResource=t,""!=t&&(this.hideAnimationTrigger=CAnimator.animatorFromResource(this,t))}constructor(t,e){super(t,e),this.isClickHide=!0,this.isHideClear=!1,this._showAnimatorResource="",this._hideAnimatorResource="",this.visible=!1}doClick(t){super.doClick(t),this.isClickHide&&this.hideCover()}doToData(t){super.doToData(t),CDataClass.putData(t,"showAnimatorResource",this.showAnimatorResource,""),CDataClass.putData(t,"hideAnimatorResource",this.hideAnimatorResource,""),null!=this.showAnimationTrigger&&CDataClass.putData(t,"showAnimationTrigger",this.showAnimationTrigger.toData(),{},!0),null!=this.hideAnimationTrigger&&CDataClass.putData(t,"hideAnimationTrigger",this.hideAnimationTrigger.toData(),{},!0)}doFromData(t){super.doFromData(t),CAnimator.fromAnimatorData(t,this,"showAnimationTrigger"),CAnimator.fromAnimatorData(t,this,"hideAnimationTrigger"),this.showAnimatorResource=CDataClass.getData(t,"showAnimatorResource",""),this.hideAnimatorResource=CDataClass.getData(t,"hideAnimatorResource","")}doShowCover(){if(this.bringToFront(),null!=this.parent&&(this.position.left=0,this.position.top=0,this.position.width=this.parent.position.width,this.position.height=this.parent.position.height),null!=this.onBeforeShow&&this.onBeforeShow(this),this.visible=!0,null!=this.showAnimationTrigger){let t=this;this.showAnimationTrigger.onAfterAnimation=function(){null!=t.onShow&&t.onShow(t)},this.showAnimationTrigger.start()}else null!=this.onShow&&this.onShow(this)}doHideCover(){null!=this.onBeforeHide&&this.onBeforeHide(this);let t=this;function e(){if(t.isHideClear){let e=CSystem.getChildControls(t);for(let t=e.length-1;t>=0;t--)e[t].remove()}}null!=this.hideAnimationTrigger?(this.hideAnimationTrigger.onAfterAnimation=function(){t.visible=!1,e(),null!=t.onHide&&t.onHide(t)},this.hideAnimationTrigger.start()):(this.visible=!1,e(),null!=this.onHide&&this.onHide(this))}showCover(t=!0,e){this.isClickHide=t,e&&(this.isHideClear=e),this.doShowCover()}hideCover(){this.doHideCover()}addProperties(){let t=super.addProperties();return t.push({instance:this.showAnimationTrigger,propertyName:"showAnimationTrigger",readOnly:!1,enum:[]}),t.push({instance:this.hideAnimationTrigger,propertyName:"hideAnimationTrigger",readOnly:!1,enum:[]}),t}}class CDragIcon extends CPanel{constructor(){super(...arguments),this._isOverCatchControl=!1,this.dragStartPosition=new CPoint,this._dropAnimatorResource="",this._cancelAnimatorResource="",this._changeOverCatchControlAnimatorResource=""}get dropAnimatorResource(){return this._dropAnimatorResource}set dropAnimatorResource(t){this._dropAnimatorResource=t,""!=t&&(this.dropAnimationTrigger=CAnimator.animatorFromResource(this,t))}get cancelAnimatorResource(){return this._cancelAnimatorResource}set cancelAnimatorResource(t){this._cancelAnimatorResource=t,""!=t&&(this.cancelAnimationTrigger=CAnimator.animatorFromResource(this,t))}get changeOverCatchControlAnimatorResource(){return this._changeOverCatchControlAnimatorResource}set changeOverCatchControlAnimatorResource(t){this._changeOverCatchControlAnimatorResource=t,""!=t&&(this.changeOverCatchControlAnimationTrigger=CAnimator.animatorFromResource(this,t))}get isOverCatchControl(){return this._isOverCatchControl}set isOverCatchControl(t){this._isOverCatchControl!=t&&(this._isOverCatchControl=t,this.doChangeOverCatchControl())}doToData(t){super.doToData(t),CDataClass.putData(t,"dropAnimatorResource",this.dropAnimatorResource,""),CDataClass.putData(t,"cancelAnimatorResource",this.cancelAnimatorResource,""),CDataClass.putData(t,"changeOverCatchControlAnimatorResource",this.changeOverCatchControlAnimatorResource,""),null!=this.dropAnimationTrigger&&CDataClass.putData(t,"dropAnimationTrigger",this.dropAnimationTrigger.toData(),{},!0),null!=this.cancelAnimationTrigger&&CDataClass.putData(t,"cancelAnimationTrigger",this.cancelAnimationTrigger.toData(),{},!0),null!=this.changeOverCatchControlAnimationTrigger&&CDataClass.putData(t,"changeOverCatchControlAnimationTrigger",this.changeOverCatchControlAnimationTrigger.toData(),{},!0)}doFromData(t){super.doFromData(t),CAnimator.fromAnimatorData(t,this,"dropAnimationTrigger"),CAnimator.fromAnimatorData(t,this,"cancelAnimationTrigger"),CAnimator.fromAnimatorData(t,this,"changeOverCatchControlAnimationTrigger"),this.dropAnimatorResource=CDataClass.getData(t,"dropAnimatorResource",""),this.cancelAnimatorResource=CDataClass.getData(t,"cancelAnimatorResource",""),this.changeOverCatchControlAnimatorResource=CDataClass.getData(t,"changeOverCatchControlAnimatorResource","")}doChangeOverCatchControl(){null!=this.changeOverCatchControlAnimationTrigger&&(this.isOverCatchControl?this.triggerTrue(this.changeOverCatchControlAnimationTrigger):this.triggerFalse(this.changeOverCatchControlAnimationTrigger))}doDrop(){if(null!=this.dropAnimationTrigger){let t=this;this.dropAnimationTrigger.onAfterAnimation=function(){t.remove()},this.dropAnimationTrigger.start()}else this.remove()}doCancel(){if(console.log("do cancel",this.cancelAnimationTrigger),null!=this.cancelAnimationTrigger){let t=this;this.cancelAnimationTrigger.onAfterAnimation=function(){t.remove()},this.cancelAnimationTrigger.start()}else this.remove()}addProperties(){let t=super.addProperties();return t.push({instance:this.dropAnimationTrigger,propertyName:"dropAnimationTrigger",readOnly:!1,enum:[]}),t.push({instance:this.cancelAnimationTrigger,propertyName:"cancelAnimationTrigger",readOnly:!1,enum:[]}),t}}class CHint extends CPanel{constructor(){super(...arguments),this._hintAnimatorResource=""}get hintAnimatorResource(){return this._hintAnimatorResource}set hintAnimatorResource(t){this._hintAnimatorResource=t,""!=t&&(this.hideAnimationTrigger=CAnimator.animatorFromResource(this,t))}doToData(t){super.doToData(t),CDataClass.putData(t,"hintAnimatorResource",this.hintAnimatorResource,""),null!=this.hideAnimationTrigger&&CDataClass.putData(t,"hideAnimationTrigger",this.hideAnimationTrigger.toData(),{},!0)}doFromData(t){super.doFromData(t),CAnimator.fromAnimatorData(t,this,"hideAnimationTrigger"),this.hintAnimatorResource=CDataClass.getData(t,"hintAnimatorResource","")}doShowh(t){this.hasPointerEvent=!1,this.text=CLanguage.getText(t)}doHideh(){this.visible=!1}doHide(){super.doHide(),this.remove()}showHint(t){this.doShowh(t)}hideHint(){this.doHideh()}addProperties(){let t=super.addProperties();return t.push({instance:this.hideAnimationTrigger,propertyName:"hideAnimationTrigger",readOnly:!1,enum:[]}),t}}class CGraphicInfo extends CResourceClass{constructor(){super(...arguments),this.opacity=1,this.position=new CPosition,this.transform=new CTransform,this.filter=new CFilter,this.layers=new CCanvasLayers(void 0)}doToData(t){super.doToData(t),CDataClass.putData(t,"opacity",this.opacity,1),CDataClass.putData(t,"position",this.position.toData(),{},!0),CDataClass.putData(t,"transform",this.transform.toData(),{},!0),CDataClass.putData(t,"filter",this.filter.toData(),{},!0),CDataClass.putData(t,"layers",this.layers.toData(),{},!0)}doFromData(t){super.doFromData(t),this.opacity=CDataClass.getData(t,"opacity",1),this.position.fromData(CDataClass.getData(t,"position",{},!0)),this.transform.fromData(CDataClass.getData(t,"transform",{},!0)),this.filter.fromData(CDataClass.getData(t,"filter",{},!0)),this.layers.fromData(CDataClass.getData(t,"layers",{},!0))}doRemove(){this.layers.remove(),super.doRemove()}static controlGraphicInfo(t,e){let i=new CGraphicInfo;return i.opacity=t.opacity,null==e?i.position.fromData(t.position.toData()):i.position.fromData(e),i.transform.fromData(t.transform.toData()),i.filter.fromData(t.filter.toData()),i.layers.fromData(t.layers.toData()),i}static setControlGraphicInfo(t,e){e.opacity=t.opacity,e.position.fromData(t.position.toData()),e.transform.fromData(t.transform.toData()),e.filter.fromData(t.filter.toData()),e.layers.fromData(t.layers.toData())}}class CAnimationControlSceneSection extends CResourceClass{constructor(){super(...arguments),this.controlName="",this.property="",this.script="",this._graphData="",this.graphPath=new CPathPointList,this.positionPoints=new Array,this.positionPath=new CPathPointList,this.timeTag=new Array,this.objectData=new CList,this.startTime=0,this.duration=100,this.startValue=0,this.stopValue=0,this.isLoop=!1}get graphData(){return this._graphData}set graphData(t){if("string"==typeof t){let e=CSystem.resources.get(t);null!=e&&(this._graphData=e)}else this._graphData=t}doToData(t){super.doToData(t),CDataClass.putData(t,"controlName",this.controlName,""),CDataClass.putData(t,"property",this.property,""),CDataClass.putData(t,"script",this.script,""),"string"==typeof this.graphData?CDataClass.putData(t,"graphData",this.graphData,""):CDataClass.putData(t,"graphData",this.graphData,[],!0),CDataClass.putData(t,"graphPath",this.graphPath.toData(),{},!0);let e=new Array;for(let t=0;t<this.objectData.length;t++)e.push({duration:this.objectData.get(t).sectionT,centerX:this.objectData.get(t).centerX,centerY:this.objectData.get(t).centerY,info:this.objectData.get(t).info.toData()});CDataClass.putData(t,"objectData",e,[],!0);let i=new Array;for(let t=0;t<this.positionPoints.length;t++)i.push({x:this.positionPoints[t].x,y:this.positionPoints[t].y});CDataClass.putData(t,"positionPoints",i,[],!0),CDataClass.putData(t,"positionPath",this.positionPath.toData(),{},!0),CDataClass.putData(t,"timeTag",this.timeTag,[],!0),CDataClass.putData(t,"startTime",this.startTime,0),CDataClass.putData(t,"duration",this.duration,100),CDataClass.putData(t,"startValue",CGraphAnimationValue.graphValueToData(this.startValue)),CDataClass.putData(t,"stopValue",CGraphAnimationValue.graphValueToData(this.stopValue)),CDataClass.putData(t,"isLoop",this.isLoop,!1)}doFromData(t){super.doFromData(t),this.controlName=CDataClass.getData(t,"controlName",""),this.property=CDataClass.getData(t,"property",""),this.script=CDataClass.getData(t,"script",""),this.graphData=CDataClass.getData(t,"graphData"),this.graphPath.fromData(CDataClass.getData(t,"graphPath",{},!0)),this.clearObjectData();let e=CDataClass.getData(t,"objectData",[],!0);for(let t=0;t<e.length;t++){let i=new CGraphicInfo;i.fromData(e[t].info);let s={sectionT:e[t].duration,centerX:e[t].centerX,centerY:e[t].centerY,info:i};this.objectData.add(s)}let i=CDataClass.getData(t,"positionPoints",[],!0);this.positionPoints=[];for(let t=0;t<i.length;t++){let e=new CPoint(i[t].x,i[t].y);this.positionPoints.push(e)}this.positionPath.fromData(CDataClass.getData(t,"positionPath",{},!0)),this.timeTag=CDataClass.getData(t,"timeTag",[],!0),this.startTime=CDataClass.getData(t,"startTime",0),this.duration=CDataClass.getData(t,"duration",100),this.startValue=CGraphAnimationValue.graphValueFromData(CDataClass.getData(t,"startValue")),this.stopValue=CGraphAnimationValue.graphValueFromData(CDataClass.getData(t,"stopValue")),this.isLoop=CDataClass.getData(t,"isLoop",!1)}doRemove(){this.clearObjectData(),super.doRemove()}clearObjectData(){for(let t=0;t<this.objectData.length;t++)this.objectData.get(t).info.remove();this.objectData.clear()}graphDataCopy(){let t=new Array;if("string"!=typeof this.graphData)for(let e=0;e<this.graphData.length;e++)t.push(this.graphData[e]);return t}graphDataFromData(t){this.graphData=[];for(let e=0;e<t.length;e++)this.graphData.push(t[e])}timeTagCopy(){let t=new Array;for(let e=0;e<this.timeTag.length;e++)t.push({tagName:this.timeTag[e].tagName,tagColor:this.timeTag[e].tagColor,duration:this.timeTag[e].duration});return t}timeTagFromData(t){this.timeTag=[];for(let e=0;e<t.length;e++)this.timeTag.push({tagName:t[e].tagName,tagColor:t[e].tagColor,duration:t[e].duration})}}class CAnimationControlScene extends CResourceClass{constructor(){super(...arguments),this.sections=new CList,this.startTime=0,this.duration=1e3,this.speedStartValue=1,this.speedStopValue=1}doToData(t){super.doToData(t);let e=new Array;for(let t=0;t<this.sections.length;t++)e.push(this.sections.get(t).toData());CDataClass.putData(t,"sections",e,[],!0),CDataClass.putData(t,"startTime",this.startTime,0),CDataClass.putData(t,"duration",this.duration,1e3),CDataClass.putData(t,"speedStopValue",this.speedStopValue,0),CDataClass.putData(t,"speedStartValue",this.speedStartValue,0),CDataClass.putData(t,"speedGraphData",this.speedGraphData,void 0)}doFromData(t){super.doFromData(t),this.clearSections();let e=CDataClass.getData(t,"sections",[],!0);for(let t=0;t<e.length;t++){let i=new CAnimationControlSceneSection;i.fromData(e[t]),this.sections.add(i)}this.startTime=CDataClass.getData(t,"startTime",0),this.duration=CDataClass.getData(t,"duration",1e3),this.speedStartValue=CDataClass.getData(t,"speedStartValue",0),this.speedStopValue=CDataClass.getData(t,"speedStopValue",0),this.speedGraphData=CDataClass.getData(t,"speedGraphData",void 0)}doRemove(){this.clearSections(),super.doRemove()}clearSections(){for(let t=0;t<this.sections.length;t++)this.sections.get(t).remove();this.sections.clear()}}class CSceneAnimation extends CResourceClass{constructor(){super(...arguments),this.__startTime=0,this._timeSections=new CList,this.time=new CTime,this.duration=1e3,this.startTimeSpeed=1,this.stopTimeSpeed=1}get timeSections(){return this._timeSections}doRemove(){this._timeSections.clear(),this.time.remove(),super.doRemove()}doTick(t,e,i,s,o){null!=this.onTick&&this.onTick(this,t,e,i,s,o)}doBeforeStart(){null!=this.onBeforeStart&&this.onBeforeStart(this)}doFinish(){null!=this.onFinish&&this.onFinish(this)}doStart(){let t=this,e=CTime.now;this.time.time=e,this.time.clearTimeSection();for(let i=0;i<this._timeSections.length;i++){let s=new CTimeSection(this.time),o=this._timeSections.get(i).graphNameOrData;if("string"==typeof o){let t=CSystem.resources.get(o);s.values=t}else s.values=o;s.startTime=e+this._timeSections.get(i).startTime,s.stopTime=e+this._timeSections.get(i).startTime+this._timeSections.get(i).duration,s.isLoop=this._timeSections.get(i).isLoop;let a=this._timeSections.get(i).sectionName;s.onTick=function(e,i,o,n){if(null!=o){let e=s.values[Math.round(CCalc.cr(s.values.length-1,0,1,n,2))];t.doTick(a,i,o,n,e)}}}let i=!1;this.time.onChangeTime=function(){if(this.time>t.__startTime+t.duration&&(i?(CTime.times.delete(t.time),t.doFinish()):i=!0),null!=t.timeSpeedGraphData){let e=CCalc.crRange2Value(t.__startTime,t.__startTime+t.duration,t.time.time,0,t.timeSpeedGraphData.length-1),i=Math.round(e);e=i>t.timeSpeedGraphData.length-1?t.timeSpeedGraphData.length-1:i,t.time.speed=t.startTimeSpeed+(t.stopTimeSpeed-t.startTimeSpeed)*t.timeSpeedGraphData[e]}},this.__startTime=e,CTime.times.add(CSequence.getSequence("tempAnimation"),this.time)}start(){this.doBeforeStart(),this.doStart()}addSection(t,e,i,s,o=!1){this._timeSections.add({sectionName:t,graphNameOrData:e,startTime:i,duration:s,isLoop:o})}moveTime(t){let e=this,i=CTime.now;this.time.time=i,this.time.clearTimeSection();for(let t=0;t<this._timeSections.length;t++){let s=new CTimeSection(this.time),o=this._timeSections.get(t).graphNameOrData;if("string"==typeof o){let t=CSystem.resources.get(o);s.values=t}else s.values=o;s.startTime=i+this._timeSections.get(t).startTime,s.stopTime=i+this._timeSections.get(t).startTime+this._timeSections.get(t).duration;let a=this._timeSections.get(t).sectionName;s.onTick=function(t,i,o,n){null!=o&&e.doTick(a,i,o,n,s.values[Math.round(CCalc.cr(s.values.length-1,0,1,n,2))])}}for(let e=0;e<this.time.timeSections.length;e++){let s=this.time.timeSections[e],o=i+t;s.startTime<=o&&s.stopTime>o?s.doTick(o-1,o,CCalc.crRange2Value(s.startTime,s.stopTime,o,0,1)):s.startTime>o?s.doTick(o-1,o,0):s.doTick(o-1,o,1)}}}class CSceneAnimator extends CSceneAnimation{constructor(){super(...arguments),this.__sections=new Map}doRemove(){this.__sections.clear(),this.animationControl=void 0,super.doRemove()}doBeforeStart(){if(null!=this.animationControl){this.timeSections.clear(),this.__sections.clear();let t=this.animationControl.sceneData;for(let e=0;e<t.sections.length;e++)t.sections.get(e).control=this.animationControl.getObject(t.sections.get(e).controlName),delete t.sections.get(e).__lastSet,this.addSection(t.sections.get(e).controlName+"."+t.sections.get(e).property+e,t.sections.get(e).graphData,t.sections.get(e).startTime,t.sections.get(e).duration,t.sections.get(e).isLoop),this.__sections.set(t.sections.get(e).controlName+"."+t.sections.get(e).property+e,t.sections.get(e))}super.doBeforeStart()}doTick(t,e,i,s,o){if(null!=this.animationControl){let e=this.__sections.get(t);null!=e&&this.setObjects(t,i-this.__startTime,o,e)}super.doTick(t,e,i,s,o)}setObjects(t,e,i,s){if(null!=s.control)if(s.property.indexOf("script")>=0){new Function("animator","animationControl","sectionName","workingTime","graphValue","info","control",s.script)(this,this.animationControl,t,e,i,s,s.control)}else{if("number"==typeof s.startValue&&"number"==typeof s.stopValue)s.property.indexOf("position.left")>=0||s.property.indexOf("position.width")>=0||s.property.indexOf("transform.translateX")>=0?new Function("c","c."+s.property+" = "+this.getValue("x",CCalc.crRange2Value(0,1,i,s.startValue,s.stopValue)))(s.control):s.property.indexOf("position.top")>=0||s.property.indexOf("position.height")>=0||s.property.indexOf("transform.translateY")>=0?new Function("c","c."+s.property+" = "+this.getValue("y",CCalc.crRange2Value(0,1,i,s.startValue,s.stopValue)))(s.control):new Function("c","c."+s.property+" = "+CCalc.crRange2Value(0,1,i,s.startValue,s.stopValue))(s.control);else if(s.startValue instanceof CPoint&&s.stopValue instanceof CPoint)new Function("c","c."+s.property+".x = "+CCalc.crRange2Value(0,1,i,s.startValue.x,s.stopValue.x)+";c."+s.property+".y = "+CCalc.crRange2Value(0,1,i,s.startValue.y,s.stopValue.y)+";")(s.control);else if(s.startValue instanceof CRect&&s.stopValue instanceof CRect)new Function("c","c."+s.property+".left = "+CCalc.crRange2Value(0,1,i,s.startValue.left,s.stopValue.left)+";c."+s.property+".top = "+CCalc.crRange2Value(0,1,i,s.startValue.top,s.stopValue.top)+";c."+s.property+".right = "+CCalc.crRange2Value(0,1,i,s.startValue.right,s.stopValue.right)+";c."+s.property+".bottom = "+CCalc.crRange2Value(0,1,i,s.startValue.bottom,s.stopValue.bottom)+";")(s.control);else if(s.startValue instanceof CNotifyPoint&&s.stopValue instanceof CNotifyPoint)new Function("c","c."+s.property+".x = "+CCalc.crRange2Value(0,1,i,s.startValue.x,s.stopValue.x)+";c."+s.property+".y = "+CCalc.crRange2Value(0,1,i,s.startValue.y,s.stopValue.y)+";")(s.control);else if(s.startValue instanceof CNotifyRect&&s.stopValue instanceof CNotifyRect)new Function("c","c."+s.property+".left = "+CCalc.crRange2Value(0,1,i,s.startValue.left,s.stopValue.left)+";c."+s.property+".top = "+CCalc.crRange2Value(0,1,i,s.startValue.top,s.stopValue.top)+";c."+s.property+".right = "+CCalc.crRange2Value(0,1,i,s.startValue.right,s.stopValue.right)+";c."+s.property+".bottom = "+CCalc.crRange2Value(0,1,i,s.startValue.bottom,s.stopValue.bottom)+";")(s.control);else if(s.startValue instanceof CColorInfo&&s.stopValue instanceof CColorInfo){let t="rgba("+CCalc.crRange2Value(0,1,i,s.startValue.r,s.stopValue.r)+","+CCalc.crRange2Value(0,1,i,s.startValue.g,s.stopValue.g)+","+CCalc.crRange2Value(0,1,i,s.startValue.b,s.stopValue.b)+","+CCalc.crRange2Value(0,1,i,s.startValue.a,s.stopValue.a)+")";new Function("c","c."+s.property+' = "'+t+'";')(s.control)}if(s.objectData.length>0)if(s.objectData.get(s.objectData.length-1).sectionT<i&&null==s.__lastSet)s.control.opacity=s.objectData.get(s.objectData.length-1).info.opacity,0==s.positionPoints.length&&(s.control.position.left=this.getValue("x",s.objectData.get(s.objectData.length-1).info.position.left),s.control.position.top=this.getValue("y",s.objectData.get(s.objectData.length-1).info.position.top)),s.control.position.width=this.getValue("x",s.objectData.get(s.objectData.length-1).info.position.width),s.control.position.height=this.getValue("y",s.objectData.get(s.objectData.length-1).info.position.height),s.control.transform.rotateX=s.objectData.get(s.objectData.length-1).info.transform.rotateX,s.control.transform.rotateY=s.objectData.get(s.objectData.length-1).info.transform.rotateY,s.control.transform.rotateZ=s.objectData.get(s.objectData.length-1).info.transform.rotateZ,s.control.transform.translateX=this.getValue("x",s.objectData.get(s.objectData.length-1).info.transform.translateX),s.control.transform.translateY=this.getValue("y",s.objectData.get(s.objectData.length-1).info.transform.translateY),s.control.transform.translateZ=s.objectData.get(s.objectData.length-1).info.transform.translateZ,s.control.transform.scaleX=s.objectData.get(s.objectData.length-1).info.transform.scaleX,s.control.transform.scaleY=s.objectData.get(s.objectData.length-1).info.transform.scaleY,s.control.transform.scaleZ=s.objectData.get(s.objectData.length-1).info.transform.scaleZ,s.control.transform.rotationPointX=s.objectData.get(s.objectData.length-1).info.transform.rotationPointX,s.control.transform.rotationPointY=s.objectData.get(s.objectData.length-1).info.transform.rotationPointY,s.control.transform.rotationPointZ=s.objectData.get(s.objectData.length-1).info.transform.rotationPointZ,s.control.filter.blurValue=s.objectData.get(s.objectData.length-1).info.filter.blurValue,s.control.filter.brightnessValue=s.objectData.get(s.objectData.length-1).info.filter.brightnessValue,s.control.filter.constrastValue=s.objectData.get(s.objectData.length-1).info.filter.constrastValue,s.control.filter.grayscaleValue=s.objectData.get(s.objectData.length-1).info.filter.grayscaleValue,s.control.filter.hueRotateValue=s.objectData.get(s.objectData.length-1).info.filter.hueRotateValue,s.control.filter.invertValue=s.objectData.get(s.objectData.length-1).info.filter.invertValue,s.control.filter.opacityValue=s.objectData.get(s.objectData.length-1).info.filter.opacityValue,s.control.filter.shadowBlur=s.objectData.get(s.objectData.length-1).info.filter.shadowBlur,s.control.filter.filterSet.shadow&&(s.control.filter.shadowColor=s.objectData.get(s.objectData.length-1).info.filter.shadowColor),s.control.filter.shadowX=this.getValue("x",s.objectData.get(s.objectData.length-1).info.filter.shadowX),s.control.filter.shadowY=this.getValue("y",s.objectData.get(s.objectData.length-1).info.filter.shadowY),CCanvasLayers.setLayersMiddlePathData(s.objectData.get(s.objectData.length-1).info.layers,s.objectData.get(s.objectData.length-1).info.layers,s.control.layers,1),s.__lastSet=!0;else{let t,e,o=0,a=-1;if(i>0)for(let t=0;t<s.objectData.length;t++){if(o<i&&i<=s.objectData.get(t).sectionT){a=t;break}o=s.objectData.get(t).sectionT}if(-1!=a&&(e=s.objectData.get(a),a>0&&(t=s.objectData.get(a-1))),null==t&&(t=s.objectData.get(0),t.sectionT=0),null!=e){if(s.control.opacity=CCalc.crRange2Value(t.sectionT,e.sectionT,i,t.info.opacity,e.info.opacity),0==s.positionPoints.length&&(s.control.position.left=this.getValue("x",CCalc.crRange2Value(t.sectionT,e.sectionT,i,t.info.position.left,e.info.position.left)),s.control.position.top=this.getValue("y",CCalc.crRange2Value(t.sectionT,e.sectionT,i,t.info.position.top,e.info.position.top))),s.control.position.width=this.getValue("x",CCalc.crRange2Value(t.sectionT,e.sectionT,i,t.info.position.width,e.info.position.width)),s.control.position.height=this.getValue("y",CCalc.crRange2Value(t.sectionT,e.sectionT,i,t.info.position.height,e.info.position.height)),s.control.transform.rotateX=CCalc.crRange2Value(t.sectionT,e.sectionT,i,t.info.transform.rotateX,e.info.transform.rotateX),s.control.transform.rotateY=CCalc.crRange2Value(t.sectionT,e.sectionT,i,t.info.transform.rotateY,e.info.transform.rotateY),s.control.transform.rotateZ=CCalc.crRange2Value(t.sectionT,e.sectionT,i,t.info.transform.rotateZ,e.info.transform.rotateZ),s.control.transform.translateX=this.getValue("x",CCalc.crRange2Value(t.sectionT,e.sectionT,i,t.info.transform.translateX,e.info.transform.translateX)),s.control.transform.translateY=this.getValue("y",CCalc.crRange2Value(t.sectionT,e.sectionT,i,t.info.transform.translateY,e.info.transform.translateY)),s.control.transform.translateZ=CCalc.crRange2Value(t.sectionT,e.sectionT,i,t.info.transform.translateZ,e.info.transform.translateZ),s.control.transform.scaleX=CCalc.crRange2Value(t.sectionT,e.sectionT,i,t.info.transform.scaleX,e.info.transform.scaleX),s.control.transform.scaleY=CCalc.crRange2Value(t.sectionT,e.sectionT,i,t.info.transform.scaleY,e.info.transform.scaleY),s.control.transform.scaleZ=CCalc.crRange2Value(t.sectionT,e.sectionT,i,t.info.transform.scaleZ,e.info.transform.scaleZ),s.control.transform.rotationPointX=CCalc.crRange2Value(t.sectionT,e.sectionT,i,t.info.transform.rotationPointX,e.info.transform.rotationPointX),s.control.transform.rotationPointY=CCalc.crRange2Value(t.sectionT,e.sectionT,i,t.info.transform.rotationPointY,e.info.transform.rotationPointY),s.control.transform.rotationPointZ=CCalc.crRange2Value(t.sectionT,e.sectionT,i,t.info.transform.rotationPointZ,e.info.transform.rotationPointZ),s.control.filter.blurValue=CCalc.crRange2Value(t.sectionT,e.sectionT,i,t.info.filter.blurValue,e.info.filter.blurValue),s.control.filter.brightnessValue=CCalc.crRange2Value(t.sectionT,e.sectionT,i,t.info.filter.brightnessValue,e.info.filter.brightnessValue),s.control.filter.constrastValue=CCalc.crRange2Value(t.sectionT,e.sectionT,i,t.info.filter.constrastValue,e.info.filter.constrastValue),s.control.filter.grayscaleValue=CCalc.crRange2Value(t.sectionT,e.sectionT,i,t.info.filter.grayscaleValue,e.info.filter.grayscaleValue),s.control.filter.hueRotateValue=CCalc.crRange2Value(t.sectionT,e.sectionT,i,t.info.filter.hueRotateValue,e.info.filter.hueRotateValue),s.control.filter.invertValue=CCalc.crRange2Value(t.sectionT,e.sectionT,i,t.info.filter.invertValue,e.info.filter.invertValue),s.control.filter.opacityValue=CCalc.crRange2Value(t.sectionT,e.sectionT,i,t.info.filter.opacityValue,e.info.filter.opacityValue),s.control.filter.shadowBlur=CCalc.crRange2Value(t.sectionT,e.sectionT,i,t.info.filter.shadowBlur,e.info.filter.shadowBlur),s.control.filter.filterSet.shadow){let o=new CColor(t.info.filter.shadowColor),a=new CColor(e.info.filter.shadowColor),n=CCalc.crRange2Value(t.sectionT,e.sectionT,i,o.r,a.r),r=CCalc.crRange2Value(t.sectionT,e.sectionT,i,o.g,a.g),l=CCalc.crRange2Value(t.sectionT,e.sectionT,i,o.b,a.b),h=CCalc.crRange2Value(t.sectionT,e.sectionT,i,o.a,a.a);s.control.filter.shadowColor="rgba("+n+","+r+","+l+","+h+")"}s.control.filter.shadowX=this.getValue("x",CCalc.crRange2Value(t.sectionT,e.sectionT,i,t.info.filter.shadowX,e.info.filter.shadowX)),s.control.filter.shadowY=this.getValue("y",CCalc.crRange2Value(t.sectionT,e.sectionT,i,t.info.filter.shadowY,e.info.filter.shadowY)),CCanvasLayers.setLayersMiddlePathData(t.info.layers,e.info.layers,s.control.layers,CCalc.crRange2Value(t.sectionT,e.sectionT,i,0,1))}}if(s.positionPoints.length>0){let t=Math.round(CCalc.crRange2Value(0,1,i,0,s.positionPoints.length-1)),e=s.positionPoints[t];s.control.position.left=this.getValue("x",e.x)-s.control.transform.rotationPointX*s.control.position.width,s.control.position.top=this.getValue("y",e.y)-s.control.transform.rotationPointY*s.control.position.height}}}getValue(t,e){return null!=this.animationControl?"x"==t?e*(this.animationControl.position.width/this.animationControl.orgPosition.width):e*(this.animationControl.position.height/this.animationControl.orgPosition.height):e}}class CAnimationControl extends CPanel{get transformerPoints(){return this._transformerPoints}get sceneData(){return this._sceneData}get isScene(){return this.__isScene}get objectsCount(){return this._objectsCount}set objectsCount(t){if(this._objectsCount=t,this.objects.length<t){let e=t-this.objects.length;for(let t=0;t<e;t++){let t=new CAnimationControl(this);this.objects.add(t)}}else if(this.objects.length>t){let e=this.objects.length-t;for(let t=0;t<e;t++)this.objects.get(this.objects.length-1).remove(),this.objects.delete(this.objects.length-1)}}constructor(t,e){super(t,e),this.__isScene=!1,this.__objectsIndex=new Map,this.__orgBounds=new CRect,this._objectsCount=0,this._transformerPoints=new CTransformerPoints,this._sceneData=new CAnimationControlScene,this.orgTransfrom=new CTransform,this.orgPosition=new CPosition,this.objects=new CList;let i=this;this.objects.onChange=function(){i.setObjectIndex()}}doToData(t){super.doToData(t);let e=new Array;for(let t=0;t<this.objects.length;t++)e.push(this.objects.get(t).toData());CDataClass.putData(t,"objects",e,[],!0),CDataClass.putData(t,"objectsCount",this.objectsCount,0),CDataClass.putData(t,"orgPosition",this.position.toData(),{},!0),CDataClass.putData(t,"orgTransfrom",this.transform.toData(),{},!0),CDataClass.putData(t,"sceneData",this.sceneData.toData(),{},!0)}doFromData(t){super.doFromData(t),this.clear(),this.objectsCount=CDataClass.getData(t,"objectsCount",0);let e=CDataClass.getData(t,"objects",[],!0);for(let t=0;t<e.length;t++)this.objects.get(t).fromData(e[t]);this.orgPosition.fromData(CDataClass.getData(t,"orgPosition",{},!0)),this.orgTransfrom.fromData(CDataClass.getData(t,"orgTransfrom",{},!0)),this.sceneData.fromData(CDataClass.getData(t,"sceneData",{},!0)),this.setObjectIndex();for(let t=0;t<this.sceneData.sections.length;t++)this.sceneData.sections.get(t).control=this.getObject(this.sceneData.sections.get(t).controlName);this.orgData=t}doRemove(){null!=this.orgPathData&&this.orgPathData.remove(),this.clear(),super.doRemove()}doChangeSize(){super.doChangeSize();let t=this.position.width/this.orgPosition.width,e=this.position.height/this.orgPosition.height;this.objectsScale(t,e)}doScene(){let t=this;if(!this.__isScene){this.doSetStart();let e=this.getSceneAnimation();e.animationControl=this,e.duration=this.sceneData.duration,e.onFinish=function(){t.__isScene=!1,e.remove()},this.__isScene=!0,e.start(),null!=this.onScene&&this.onScene(this)}}doSetStart(){this.doSetTime(0)}doSetTime(t){let e=this.getSceneAnimation();e.doBeforeStart(),e.moveTime(t),e.remove()}addAnimationObject(){let t=new CAnimationControl(this);return this.objects.add(t),t}clear(){for(let t=0;t<this.objects.length;t++)this.objects.get(t).remove();this.objects.clear()}objectsScale(t,e){for(let i=0;i<this.objects.length;i++)this.objects.get(i).position.left=this.objects.get(i).orgPosition.left*t,this.objects.get(i).position.top=this.objects.get(i).orgPosition.top*e,this.objects.get(i).position.width=this.objects.get(i).orgPosition.width*t,this.objects.get(i).position.height=this.objects.get(i).orgPosition.height*e}orgPathdataSet(){null!=this.orgPathData&&this.orgPathData.remove();let t=new CCanvasLayers(void 0);t.fromData(this.layers.toData()),this.orgPathData=t,this.__orgBounds=new CRect(0,0,this.position.width,this.position.height)}scene(){this.doScene()}getObject(t){return this.__objectsIndex.get(t)}setObjectIndex(){this.__objectsIndex.clear(),this.__objectsIndex.set(this.propertyName,this);for(let t=0;t<this.objects.length;t++)this.__objectsIndex.set(this.objects.get(t).propertyName,this.objects.get(t))}copyTo(){let t=new CAnimationControl;return t.fromData(this.toData()),t}getSceneAnimation(){let t=new CSceneAnimator;if(1e3==this.sceneData.duration){let e=0;for(let t=0;t<this.sceneData.sections.length;t++)e=CCalc.max(e,this.sceneData.sections.get(t).startTime+this.sceneData.sections.get(t).duration);t.duration=e}else t.duration=this.sceneData.duration;return t.animationControl=this,t}setOriginalData(){null!=this.orgData&&this.fromData(this.orgData)}deleteObject(t){for(let e=0;e<this.objects.length;e++)if(this.objects.get(e)==t){this.objects.get(e).remove(),this.objects.delete(e),this.objectsCount--;break}}}!function(t){t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT"}(EPickupAlignKind||(EPickupAlignKind={})),function(t){t[t.TOP=0]="TOP",t[t.BOTTOM=1]="BOTTOM"}(EPickupShowKind||(EPickupShowKind={}));class CButton extends CPanel{constructor(t,e){super(t,e),this.pickupResource="",this.pickupHeight=200,this.pickupAlignKind=EPickupAlignKind.LEFT,this.pickupShowKind=EPickupShowKind.BOTTOM,this.usePickupParentBody=!1,this.hasFocus=!0}doToData(t){super.doToData(t),CDataClass.putData(t,"pickupResource",this.pickupResource,""),CDataClass.putData(t,"pickupWidth",this.pickupWidth,void 0),CDataClass.putData(t,"pickupHeight",this.pickupHeight,200),CDataClass.putData(t,"pickupAlignKind",this.pickupAlignKind,EPickupAlignKind.LEFT),CDataClass.putData(t,"pickupShowKind",this.pickupShowKind,EPickupShowKind.BOTTOM),CDataClass.putData(t,"usePickupParentBody",this.usePickupParentBody,!1)}doFromData(t){super.doFromData(t),this.pickupResource=CDataClass.getData(t,"pickupResource",""),this.pickupWidth=CDataClass.getData(t,"pickupWidth",void 0),this.pickupHeight=CDataClass.getData(t,"pickupHeight",200),this.pickupAlignKind=CDataClass.getData(t,"pickupAlignKind",EPickupAlignKind.LEFT),this.pickupShowKind=CDataClass.getData(t,"pickupShowKind",EPickupShowKind.BOTTOM),this.usePickupParentBody=CDataClass.getData(t,"usePickupParentBody",!1)}doKeyDown(t){super.doKeyDown(t)," "!=t.key&&"Enter"!=t.key||this.click()}getPickupWidth(){return null==this.pickupWidth?this.position.width:this.pickupWidth}doClick(t){super.doClick(t);let e=this;if(""!=this.pickupResource)if(this.usePickupParentBody){let t=this.controlElement.getBoundingClientRect(),i=t.left;if(this.pickupAlignKind==EPickupAlignKind.RIGHT&&(i=t.left+t.width-this.getPickupWidth()),null==this._pickup){let s=t.top;s=this.pickupShowKind==EPickupShowKind.BOTTOM?t.top+t.height+1:t.top-this.pickupHeight-1,CPickupControl.showPickup(this.pickupResource,document.body,i,s,this.getPickupWidth(),this.pickupHeight,(function(t){e.doBeforePickupShow(t)}),(function(t){e.doAfterPickupShow(t)}),(function(t){e.doBeforePickupRemove(t)}))}else this._pickup.hide(),this._pickup=void 0}else{this.bringToFront();let t=0;if(this.pickupAlignKind==EPickupAlignKind.RIGHT&&(t=this.position.width-this.getPickupWidth()),null==this._pickup){let i=0;i=this.pickupShowKind==EPickupShowKind.BOTTOM?this.position.height+1:this.position.top-this.pickupHeight-1,CPickupControl.showPickup(this.pickupResource,this,t,i,this.getPickupWidth(),this.pickupHeight,(function(t){e.doBeforePickupShow(t)}),(function(t){e.doAfterPickupShow(t)}),(function(t){e.doBeforePickupRemove(t)}))}else this._pickup.hide(),this._pickup=void 0}}doBeforePickupShow(t){this._pickup=t,this._pickup.ignoreControls.add(this);let e=this;this._pickup.onRemove=function(){e._pickup=void 0},null!=this.onBeforePickupShow&&this.onBeforePickupShow(this,t)}doAfterPickupShow(t){null!=this.onAfterPickupShow&&this.onAfterPickupShow(this,t)}doBeforePickupRemove(t){this._pickup=void 0,null!=this.onBeforePickupRemove&&this.onBeforePickupRemove(this,t)}}class CLabel extends CPanel{constructor(t,e){super(t,e);let i=this.layers.addLayer(),s=i.addItem();s.name="backgroundCanvasItem",this.backgroundCanvasItem=s,s=i.addItem(),s.kind=ECanvasItemKind.TEXT,s.name="text"}}class CLabelTextBox extends CLabel{get label(){return this.text}set label(t){this.text=t}get value(){return this.textBox.text}set value(t){this.textBox.text=t}constructor(t,e){super(t,e),this.textBox=new CTextBox(this);let i=this;this.textBox.position.align=EPositionAlign.RIGHT,this.textBox.onResource=function(){i.textBox.position.align=EPositionAlign.RIGHT,i.textSet.hAlign=ETextAlign.HEAD,i.textSet.margins.left=5},this.textBox.position.width=100}doToData(t){super.doToData(t),CDataClass.putData(t,"label",this.label,""),CDataClass.putData(t,"value",this.value,""),CDataClass.putData(t,"textBox",this.textBox.toData(),{},!0)}doFromData(t){super.doFromData(t),this.label=CDataClass.getData(t,"label",""),this.value=CDataClass.getData(t,"value",""),this.textBox.fromData(CDataClass.getData(t,"textBox",{},!0))}doResource(){super.doResource(),this.textBox.position.align=EPositionAlign.RIGHT,this.textSet.hAlign=ETextAlign.HEAD,this.textSet.margins.left=5}addProperties(){let t=new Array;return t.push({instance:this.label,propertyName:"label",readOnly:!1,enum:[]}),t.push({instance:this.value,propertyName:"value",readOnly:!1,enum:[]}),t}}class CCheckBox extends CButton{doClick(t){super.doClick(t),this.checked=!this.checked}}class CSelectBox extends CButton{doClick(t){super.doClick(t),this.selected=!this.selected}}class CSelectGroupBox extends CButton{constructor(){super(...arguments),this._groupName=""}get groupName(){return this._groupName}set groupName(t){this._groupName=t}doClick(t){super.doClick(t),this.selected=!0}doChangeSelected(){if(this.selected){let t=this.getGroupOtherItems();for(let e=0;e<t.length;e++)t[e].selected=!1}super.doChangeSelected()}getGroupOtherItems(){let t=new Array,e=CSystem.controls.findControls([{columnName:"className",value:this.className}]);for(let i=0;i<e.length;i++)e[i].control!=this&&e[i].control.as().groupName==this.groupName&&t.push(e[i].control);return t}}class CPickupControl extends CPanel{constructor(t,e){super(t,e),this.autoRemove=!1,this.ignoreControls=new Set,this.hasFocus=!0,this._visible=!1,this.controlElement.style.display="none"}doResource(){super.doResource(),this.hasFocus=!0,this._visible=!1,this.controlElement.style.display="none"}doShowPickup(){this.visible=!0,null!=this.onShow&&this.onShow(this)}doHidePickup(){null!=this.onBeforeHide&&this.onBeforeHide(this),this.visible=!1}doHide(){this.autoRemove&&this.remove(),super.doHide()}show(){this.doShowPickup()}hide(){this.doHidePickup()}static showPickup(t,e,i,s,o,a,n,r,l){let h=new CPickupControl(e);return h.resource=t,h.position.left=i,h.position.top=s,h.position.width=o,h.position.height=a,h.autoRemove=!0,null!=n&&n(h),h.onBeforeRemove=function(t){null!=l&&l(t)},h.show(),null!=r&&r(h),h}}class CPopupItem{constructor(t,e,i="",s=!1){this.name="",this.text="",this.shortcut="",this.isCode=!1,this.name=t,this.text=e,this.shortcut=i,this.isCode=s}}class CPopupItemControl extends CPanel{constructor(){super(...arguments),this.idx=-1,this.popName=""}}class CPopup extends CPickupControl{get items(){return this._items}constructor(t,e){let i=t;t||(i=document.body),super(i,e),this._items=new CTreeData,this.popupResource="",this.popupItemResource="",this.popupWidth=200,this.position.padding.all=5}itemControlClear(){let t=CSystem.getChildControls(this);for(let e=0;e<t.length;e++)t[e].remove()}itemRefresh(){let t=this;this.itemControlClear();for(let e=0;e<this._items.length;e++){let i=new CPopupItemControl(this);i.idx=e;let s=this._items.getItem(e);if(i.resource=this.popupItemResource,i.position.left=5,i.position.top=30*e+5,i.position.width=this.popupWidth-10,i.position.height=30,null!=s&&null!=s.value){s.value.isCode?i.text=CLanguage.getText(s.value.text):i.text=s.value.text,i.popName=s.value.name,i.canvasItemText("righttext",s.value.shortcut);let o=30*s.childItems.length+10;if(s.childItems.length>0){function a(){t.__cPop=new CPopup,t.__cPop.__pPop=t;let e=t;for(;null!=e.__pPop;)e=e.__pPop;t.__cPop.__apPop=e,t.__cPop.idx=i.idx,t.__cPop.popupResource=t.popupResource,t.__cPop.resource=t.popupResource,t.__cPop.popupItemResource=t.popupItemResource,t.__cPop.popupWidth=t.popupWidth,t.__cPop.autoRemove=!0,null!=s&&t.__cPop.items.fromData(s.childItems.toData()),i.getElementBounds().right+t.popupWidth<=window.innerWidth?t.__cPop.position.left=i.getElementBounds().right:t.__cPop.position.left=i.getElementBounds().left-t.popupWidth,i.getElementBounds().top+o<=window.innerHeight?t.__cPop.position.top=i.getElementBounds().top:t.__cPop.position.top=i.getElementBounds().top-o+i.position.height,t.__cPop.position.width=t.popupWidth,t.__cPop.show()}i.canvasItemText("rightarrow","▶"),i.onThisPointerOver=function(){if(null!=t.__cPop){if(i.idx!=t.__cPop.idx){function e(t){null!=t.__cPop&&e(t.__cPop),t.hide()}e(t.__cPop),a()}}else a()}}else i.onThisPointerOver=function(){if(null!=t.__cPop){function e(t){null!=t.__cPop&&e(t.__cPop),t.hide()}e(t.__cPop),t.__cPop=void 0}};i.onClick=function(){null!=t.__apPop?t.__apPop.doPopupClick(i.popName,i.text):t.doPopupClick(i.popName,i.text),t.hide()}}}this.position.height=30*this._items.length+10}doResource(){super.doResource(),this.position.padding.all=5}doPopupClick(t,e){null!=this.onPopupClick&&this.onPopupClick(this,t,e)}doHidePickup(){this.__cPop=void 0,this.__pPop=void 0,this.__apPop=void 0,super.doHidePickup()}addItem(t,e,i,s=!1,o){return null!=o?o.add(new CPopupItem(t,e,i,s)):this.items.add(new CPopupItem(t,e,i,s))}show(){this.itemRefresh(),super.show()}}class CPopupButton extends CButton{constructor(){super(...arguments),this._menuData=new CTreeData,this.popupResource="",this.popupItemResource="",this.popupWidth=200,this.popupMargin=0,this.onMenuClick=new Array}get menuData(){return this._menuData}doToData(t){super.doToData(t),CDataClass.putData(t,"items",this.menuData.toData(),{},!0),CDataClass.putData(t,"popupResource",this.popupResource,""),CDataClass.putData(t,"popupItemResource",this.popupItemResource,""),CDataClass.putData(t,"popupWidth",this.popupWidth,200),CDataClass.putData(t,"popupMargin",this.popupMargin,0)}doFromData(t){super.doFromData(t),this.menuData.fromData(CDataClass.getData(t,"items",{},!0)),this.popupResource=CDataClass.getData(t,"popupResource",""),this.popupItemResource=CDataClass.getData(t,"popupItemResource",""),this.popupWidth=CDataClass.getData(t,"popupWidth",200),this.popupMargin=CDataClass.getData(t,"popupMargin",0)}doClick(t){super.doClick(t);let e=this,i=new CPopup;i.items.fromData(this._menuData.toData()),i.resource=this.popupResource,i.popupResource=this.popupResource,i.popupItemResource=this.popupItemResource,i.popupWidth=this.popupWidth;let s=this.controlElement.getBoundingClientRect();s.left+i.popupWidth<=window.innerWidth?i.position.left=s.left:i.position.left=s.left-i.popupWidth;let o=30*i.items.length+10;s.bottom+o<=window.innerHeight?i.position.top=s.bottom+this.popupMargin:i.position.top=s.top-o-this.popupMargin,i.position.width=i.popupWidth,i.popupCaller=this,i.autoRemove=!0,i.show(),i.onPopupClick=function(t,i,s){e.doMenuClick(i,s)}}doMenuClick(t,e){for(let i=0;i<this.onMenuClick.length;i++)this.onMenuClick[i](this,t,e)}}class CElementControl extends CPanel{get element(){return this._element}get elementMargins(){return this._elementMargins}get elementVisible(){return this._elementVisible}set elementVisible(t){this._elementVisible!=t&&(this._elementVisible=t,this.element.style.display=t?"inline-block":"none")}constructor(t,e,i){super(e,i),this._elementMargins=new CNotifyRect,this._elementVisible=!0;let s=this;this._element=document.createElement(t),this._controlElement.appendChild(this._element),this._element.style.position="absolute",this.doInitInnerElement(),this._elementMargins.onChange=function(){s.doSetInnerElementSize()}}doToData(t){super.doToData(t),CDataClass.putData(t,"elementMargins",this._elementMargins.toData(),{},!0),CDataClass.putData(t,"elementVisible",this._elementVisible,!0)}doFromData(t){super.doFromData(t),this.elementMargins.fromData(CDataClass.getData(t,"elementMargins",{},!0)),this.elementVisible=CDataClass.getData(t,"elementVisible",!0)}doResource(){super.doResource(),this.elementBringToFront()}doRemove(){this.element.remove(),super.doRemove()}doSetElementSize(){super.doSetElementSize(),this.doSetInnerElementSize()}doChangeLayerCount(){this.elementBringToFront(),super.doChangeLayerCount()}doInitInnerElement(){let t=this;this._element.addEventListener("pointerdown",(function(e){t.enabled&&t.doElementPointerDown(e)})),this._element.addEventListener("pointermove",(function(e){t.enabled&&t.doElementPointerMove(e)})),this._element.addEventListener("pointerup",(function(e){t.enabled&&t.doElementPointerUp(e)})),this._element.addEventListener("pointercancel",(function(e){t.enabled&&t.doElementPointerCancel(e)})),this._element.addEventListener("pointerover",(function(e){t.enabled&&t.doElementPointerOver(e)})),this._element.addEventListener("pointerout",(function(e){t.enabled&&t.doElementPointerOut(e)})),this._element.addEventListener("pointerenter",(function(e){t.enabled&&t.doElementPointerEnter(e)})),this._element.addEventListener("pointerleave",(function(e){t.enabled&&t.doElementPointerLeave(e)})),null!=this.onInitInnerElement&&this.onInitInnerElement(this)}doSetInnerElementSize(){this._element.style.left=this.elementMargins.left+"px",this._element.style.top=this.elementMargins.left+"px",this._element.style.width=this.position.width-this.elementMargins.left-this.elementMargins.right+"px",this._element.style.height=this.position.height-this.elementMargins.top-this.elementMargins.bottom+"px",null!=this.onSetInnerElementSize&&this.onSetInnerElementSize(this)}doElementPointerDown(t){null!=this.onElementPointerDown&&this.onElementPointerDown(this,t)}doElementPointerMove(t){null!=this.onElementPointerMove&&this.onElementPointerMove(this,t)}doElementPointerUp(t){null!=this.onElementPointerUp&&this.onElementPointerUp(this,t)}doElementPointerCancel(t){null!=this.onElementPointerCancel&&this.onElementPointerCancel(this,t)}doElementPointerOver(t){null!=this.onElementPointerOver&&this.onElementPointerOver(this,t)}doElementPointerEnter(t){null!=this.onElementPointerEnter&&this.onElementPointerEnter(this,t)}doElementPointerOut(t){null!=this.onElementPointerOut&&this.onElementPointerOut(this,t)}doElementPointerLeave(t){null!=this.onElementPointerLeave&&this.onElementPointerLeave(this,t)}elementBringToFront(){this.element.parentNode==this.controlElement&&(this.controlElement.removeChild(this.element),this.controlElement.appendChild(this.element))}}class CImage extends CElementControl{get src(){return this._src}set src(t){this._src!=t&&(this._src=t,this._element.src=t)}constructor(t,e){super("img",t,e),this._src="",this._element.style.pointerEvents="none";let i=this;this._element.onload=function(){i.doImageLoad()}}doImageLoad(){null!=this.onImageLoad&&this.onImageLoad(this)}doToData(t){super.doToData(t),CDataClass.putData(t,"src",this.src,"")}doFromData(t){super.doFromData(t),this.src=CDataClass.getData(t,"src","")}doInitInnerElement(){this._element.style.border="none",this._element.style.outline="none",this._element.style.objectFit="contain",this._element.style.objectPosition="center",super.doInitInnerElement()}}class CTextBox extends CElementControl{get input(){return this._element}get text(){return this.input.value}set text(t){t!=this.input.value&&(this.input.value=t,this.doChange("text"),this.doChangeText())}get focused(){return this._focused}set focused(t){this._focused!=t&&(this._focused=t,t?this.input.focus():this.input.blur(),this.doChange(CControl.CON_CHANGE_FOCUS))}get password(){return"password"==this.input.type}set password(t){this.password!=t&&(this.input.type=t?"password":"text")}constructor(t,e){super("input",t,e)}doChangeDesignMode(){super.doChangeDesignMode(),this.isDesignMode?(this.__designOrgData.elementVisible=this.elementVisible,this.elementVisible=!1):this.elementVisible=this.__designOrgData.elementVisible}doChangeTextSet(){super.doChangeTextSet(),this.input.style.fontSize=this.textSet.fontSize+"px",this.input.style.fontFamily=this.textSet.fontFamily,this.input.style.fontWeight=this.textSet.fontWeight,this.input.style.fontStyle=this.textSet.fontStyle,this.input.style.fontVariant=this.textSet.fontVariant,this.input.style.color=this.textSet.fill.solidColor}doToData(t){super.doToData(t),CDataClass.putData(t,"password",this.password,!1)}doFromData(t){super.doFromData(t),this.password=CDataClass.getData(t,"password",!1)}doSetInnerElementSize(){this._element.style.left=this.elementMargins.left+"px",this._element.style.top=this.elementMargins.top+"px",this._element.style.width=this.position.width-this.elementMargins.left-this.elementMargins.right-4+"px",this._element.style.height=this.position.height-this.elementMargins.top-this.elementMargins.bottom-2+"px",null!=this.onSetInnerElementSize&&this.onSetInnerElementSize(this)}doInitInnerElement(){let t=this;this._element.setAttribute("type","text"),this._element.setAttribute("spellcheck","false"),this._element.style.border="none",this._element.style.outline="none",this._element.style.background="transparent",this._element.addEventListener("focus",(function(){t.focused=!0})),this._element.addEventListener("blur",(function(){t.focused=!1})),this._element.addEventListener("input",(function(e){t.doChange("text"),t.doChangeText()})),this.doChangeTextSet(),super.doInitInnerElement()}addProperties(){let t=super.addProperties();return t.push({instance:this.password,propertyName:"password",readOnly:!1,enum:[]}),t}}class CTextArea extends CElementControl{get textArea(){return this._element}get text(){return this.textArea.value}set text(t){t!=this.textArea.value&&(this.textArea.value=t,this.doChange("text"),this.doChangeText())}get wrap(){return this._wrap}set wrap(t){this._wrap!=t&&(this._wrap=t,t?this.textArea.setAttribute("wrap","on"):this.textArea.setAttribute("wrap","off"),this.doChange("wrap"))}get focused(){return this._focused}set focused(t){this._focused!=t&&(this._focused=t,t?this.textArea.focus():this.textArea.blur(),this.doChange(CControl.CON_CHANGE_FOCUS))}get scrollbarResource(){return this._scrollbarResource}set scrollbarResource(t){this._scrollbarResource!=t&&(this._scrollbarResource=t,this.doChangeScrollbarResource())}get scrollbarLength(){return this._scrollbarLength}set scrollbarLength(t){this._scrollbarLength!=t&&(this._scrollbarLength=t,this.doChangeScrollbarInfo())}get hScrollbar(){return this._hScrollbar}get vScrollbar(){return this._vScrollbar}get useHScrollbar(){return this._useHScrollbar}set useHScrollbar(t){this._useHScrollbar!=t&&(this._useHScrollbar=t,this.doChange("useHScrollbar"),this.doChangeScrollbarInfo())}get useVScrollbar(){return this._useVScrollbar}set useVScrollbar(t){this._useVScrollbar!=t&&(this._useVScrollbar=t,this.doChange("useVScrollbar"),this.doChangeScrollbarInfo())}constructor(t,e){super("textarea",t,e),this.__useScrollbar=!1,this._wrap=!1,this._scrollbarResource="",this._hScrollbar=new CScrollbar(this),this._vScrollbar=new CScrollbar(this),this._scrollbarLength=15,this._useHScrollbar=!0,this._useVScrollbar=!0,this.useTab=!0,this.useEnter=!0,this.useCtrlA=!0;let i=this;this._vScrollbar.scrollbarKind=EScrollBarKind.V,this._hScrollbar.onResource=function(){i.doSetInnerElementSize()},this._vScrollbar.onResource=function(){i.doSetInnerElementSize()},this._hScrollbar.onScroll=function(t,e){let s=i.textArea.scrollWidth-parseFloat(CStringUtil.replaceAll(i.textArea.style.width,"px",""));i.textArea.scrollLeft=s*e},this._vScrollbar.onScroll=function(t,e){let s=i.textArea.scrollHeight-parseFloat(CStringUtil.replaceAll(i.textArea.style.height,"px",""));i.textArea.scrollTop=s*e},this._hScrollbar.onThisPointerDown=function(){i.__useScrollbar=!0},this._hScrollbar.onThisPointerUp=function(){i.__useScrollbar=!1},this._vScrollbar.onThisPointerDown=function(){i.__useScrollbar=!0},this._vScrollbar.onThisPointerUp=function(){i.__useScrollbar=!1},this.textArea.addEventListener("scroll",(function(t){if(!i.__useScrollbar){let t=i.textArea.scrollWidth-parseFloat(CStringUtil.replaceAll(i.textArea.style.width,"px",""));i.hScrollbar.valueRatio=CCalc.crRange2Value(0,t,i.textArea.scrollLeft,0,1),t=i.textArea.scrollHeight-parseFloat(CStringUtil.replaceAll(i.textArea.style.height,"px","")),i.vScrollbar.valueRatio=CCalc.crRange2Value(0,t,i.textArea.scrollTop,0,1)}})),this.textArea.addEventListener("keydown",(function(t){if("A"==t.key.toUpperCase()&&t.ctrlKey&&i.useCtrlA&&i.textArea.select(),"Tab"==t.code&&i.useTab){var e=i.textArea.value,s=i.textArea.selectionStart,o=i.textArea.selectionEnd;i.textArea.value=e.substring(0,s)+"\t"+e.substring(o),i.textArea.selectionStart=i.textArea.selectionEnd=s+1,t.preventDefault()}if("Enter"==t.code&&!t.ctrlKey&&i.useEnter){if(t.isComposing)return;e=i.textArea.value,s=i.textArea.selectionStart,o=i.textArea.selectionEnd;let a=e.substring(0,s),n="";for(let t=a.length-1;t>=0&&"\n"!=a[t];t--)n=a[t]+n;let r=n.split("\t").length-1;i.textArea.value=e.substring(0,s)+"\n";for(let t=0;t<r;t++)i.textArea.value=i.textArea.value+"\t";i.textArea.value=i.textArea.value+e.substring(o),i.textArea.selectionStart=i.textArea.selectionEnd=s+1+r,t.preventDefault()}}))}doToData(t){super.doToData(t),CDataClass.putData(t,"wrap",this.wrap,!1),CDataClass.putData(t,"scrollbarResource",this.scrollbarResource,""),CDataClass.putData(t,"scrollbarLength",this.scrollbarLength,15),CDataClass.putData(t,"useHScrollbar",this.useHScrollbar,!0),CDataClass.putData(t,"useVScrollbar",this.useVScrollbar,!0),CDataClass.putData(t,"useTab",this.useTab,!0),CDataClass.putData(t,"useCtrlA",this.useCtrlA,!0),CDataClass.putData(t,"useEnter",this.useEnter,!0)}doFromData(t){super.doFromData(t),this.wrap=CDataClass.getData(t,"wrap",!1),this.scrollbarResource=CDataClass.getData(t,"scrollbarResource",""),this.scrollbarLength=CDataClass.getData(t,"scrollbarLength",15),this.useHScrollbar=CDataClass.getData(t,"useHScrollbar",!0),this.useVScrollbar=CDataClass.getData(t,"useVScrollbar",!0),this.useTab=CDataClass.getData(t,"useTab",!0),this.useCtrlA=CDataClass.getData(t,"useCtrlA",!0),this.useEnter=CDataClass.getData(t,"useEnter",!0)}doChildDataMapHandle(t){super.doChildDataMapHandle(t),t.delete(this.hScrollbar),t.delete(this.vScrollbar)}doChangeDesignMode(){super.doChangeDesignMode(),this.isDesignMode?(this.__designOrgData.elementVisible=this.elementVisible,this.__designOrgData.vScrollbar=this.vScrollbar.hasPointerEvent,this.__designOrgData.hScrollbar=this.hScrollbar.hasPointerEvent,this.elementVisible=!1,this.vScrollbar.hasPointerEvent=!1,this.hScrollbar.hasPointerEvent=!1):(this.elementVisible=this.__designOrgData.elementVisible,this.vScrollbar.hasPointerEvent=this.__designOrgData.vScrollbar,this.hScrollbar.hasPointerEvent=this.__designOrgData.hScrollbar)}doSetInnerElementSize(){this._element.style.left=this.elementMargins.left+"px",this._element.style.top=this.elementMargins.top+"px";let t=0,e=0;e=this.useHScrollbar?this.position.height-this.elementMargins.top-this.elementMargins.bottom-this.scrollbarLength:this.position.height-this.elementMargins.top-this.elementMargins.bottom,t=this.useVScrollbar?this.position.width-this.elementMargins.left-this.elementMargins.right-this.scrollbarLength:this.position.width-this.elementMargins.left-this.elementMargins.right,this._element.style.width=t-4+"px",this._element.style.height=e-4+"px",this.useHScrollbar&&(this._hScrollbar.position.left=this.elementMargins.left,this._hScrollbar.position.top=this.position.height-this.elementMargins.bottom-this._scrollbarLength,this._hScrollbar.position.width=t,this._hScrollbar.position.height=this._scrollbarLength,this._hScrollbar.scrollbarKind=EScrollBarKind.H,this._hScrollbar.bringToFront()),this.useVScrollbar&&(this._vScrollbar.position.left=this.position.width-this._scrollbarLength-this.elementMargins.right,this._vScrollbar.position.top=this.elementMargins.top,this._vScrollbar.position.width=this._scrollbarLength,this._vScrollbar.position.height=e,this._vScrollbar.scrollbarKind=EScrollBarKind.V,this._vScrollbar.bringToFront()),this._hScrollbar.visible=this.useHScrollbar,this._vScrollbar.visible=this.useVScrollbar,null!=this.onSetInnerElementSize&&this.onSetInnerElementSize(this)}doInitInnerElement(){let t=this;this._element.setAttribute("spellcheck","false"),this._element.style.border="none",this._element.style.outline="none",this._element.style.background="transparent",this._element.style.resize="none",this._element.style.tabSize="2",this.textArea.setAttribute("wrap","off"),this.textArea.setAttribute("class","scrollno"),this._element.addEventListener("focus",(function(){t.focused=!0})),this._element.addEventListener("blur",(function(){t.focused=!1})),this._element.addEventListener("input",(function(e){t.doChange("text"),t.doChangeText()})),this.doChangeTextSet(),super.doInitInnerElement()}doChangeScrollbarResource(){this._hScrollbar.resource=this._scrollbarResource,this._vScrollbar.resource=this._scrollbarResource}doChangeScrollbarInfo(){this.doSetInnerElementSize()}doChangeCountry(t){super.doChangeCountry(t),""!=this.textSet.languageKey&&(this.text=CLanguage.getText(this.textSet.languageKey))}doChangeTextSet(){super.doChangeTextSet(),this._element.style.fontSize=this.textSet.fontSize+"px",this._element.style.fontFamily=this.textSet.fontFamily,this._element.style.fontWeight=this.textSet.fontWeight,this._element.style.fontStyle=this.textSet.fontStyle,this._element.style.fontVariant=this.textSet.fontVariant,this._element.style.color=this.textSet.fill.solidColor,""!=this.textSet.languageKey&&(this.text=CLanguage.getText(this.textSet.languageKey))}async doSetSettingData(t){t&&(this.wrap=t.wrap,this.wrap?(this.useVScrollbar=t.scrollbar,t.scrollbar||(this.useHScrollbar=!1)):(this.useVScrollbar=t.scrollbar,this.useHScrollbar=t.scrollbar),this.textSet.fromData(t.textSetData))}scrollBottom(){this.textArea.scrollTop=this.textArea.scrollHeight}selectedText(){return this.text.substring(this.textArea.selectionStart,this.textArea.selectionEnd)}isTextSelect(){return this.textArea.selectionStart!=this.textArea.selectionEnd}addLine(t){""==this.text?this.text=t:this.text+="\n"+t}setSettingData(t){this.doSetSettingData(t)}}!function(t){t[t.H=0]="H",t[t.V=1]="V"}(EScrollBarKind||(EScrollBarKind={})),function(t){t[t.BUTTON1=0]="BUTTON1",t[t.BUTTON2=1]="BUTTON2",t[t.BODY=2]="BODY"}(EScrollPressKind||(EScrollPressKind={}));class CCustomScrollBar extends CPanel{get scrollbarKind(){return this._scrollbarKind}set scrollbarKind(t){this._scrollbarKind!=t&&(this._scrollbarKind=t,this.doChangeScrollBarKind())}get useScrollButton(){return this._useScrollButton}set useScrollButton(t){this._useScrollButton!=t&&(this._useScrollButton=t,this.doChangeUseScrollButton())}get min(){return this._min}set min(t){this._min!=t&&(this._min=t,this.doChangeMin())}get max(){return this._max}set max(t){this._max!=t&&(this._max=t,this.doChangeMax())}get value(){return this._value}set value(t){let e=t;e<this.min&&(e=this.min),e>this.max&&(e=this.max),this._value!=e&&(this._value=e,this.doChangeValue())}get valueRatio(){return CCalc.crRange2Value(this.min,this.max,this.value,0,1)}set valueRatio(t){let e=t;e<0&&(e=0),e>1&&(e=1),this.value=CCalc.crRange2Value(0,1,t,this.min,this.max)}constructor(t,e){super(t,e),this._scrollbarKind=EScrollBarKind.H,this._useScrollButton=!1,this._min=0,this._max=100,this._value=0,this.usePointerCapture=!0}getButtonLength(){switch(this._scrollbarKind){case EScrollBarKind.H:return this._useScrollButton?this.position.height:0;case EScrollBarKind.V:return this._useScrollButton?this.position.width:0}}getCursorLength(){switch(this._scrollbarKind){case EScrollBarKind.H:return this.position.height;case EScrollBarKind.V:return this.position.width}}getValuePosition(){let t=0;if(this.scrollbarKind==EScrollBarKind.H){t=(this.position.width-2*this.getButtonLength()-this.getCursorLength())*this.valueRatio}else{t=(this.position.height-2*this.getButtonLength()-this.getCursorLength())*this.valueRatio}return this.useScrollButton&&(t+=this.getButtonLength()),t}doResource(){super.doResource(),this.usePointerCapture=!0}doToData(t){super.doToData(t),CDataClass.putData(t,"scrollbarKind",this.scrollbarKind,EScrollBarKind.H),CDataClass.putData(t,"useScrollButton",this.useScrollButton,!1),CDataClass.putData(t,"min",this.min,0),CDataClass.putData(t,"max",this.max,100),CDataClass.putData(t,"value",this.value,0)}doFromData(t){super.doFromData(t),this.scrollbarKind=CDataClass.getData(t,"scrollbarKind",EScrollBarKind.H),this.useScrollButton=CDataClass.getData(t,"useScrollButton",!1),this.min=CDataClass.getData(t,"min",0),this.max=CDataClass.getData(t,"max",100),this.value=CDataClass.getData(t,"value",0)}doThisPointerDown(t,e){super.doThisPointerDown(t,e),null==this.__scrollPressKind&&(this.scrollbarKind==EScrollBarKind.H?t.offsetX<this.getButtonLength()?(this.__scrollPressKind=EScrollPressKind.BUTTON1,this.doScrollButton1Down()):t.offsetX>this.position.width-this.getButtonLength()?(this.__scrollPressKind=EScrollPressKind.BUTTON2,this.doScrollButton2Down()):(this.__scrollPressKind=EScrollPressKind.BODY,this.doScrollBody(t)):t.offsetY<this.getButtonLength()?(this.__scrollPressKind=EScrollPressKind.BUTTON1,this.doScrollButton1Down()):t.offsetY>this.position.height-this.getButtonLength()?(this.__scrollPressKind=EScrollPressKind.BUTTON2,this.doScrollButton2Down()):(this.__scrollPressKind=EScrollPressKind.BODY,this.doScrollBody(t)))}doThisPointerMove(t,e){super.doThisPointerMove(t,e),this.__scrollPressKind==EScrollPressKind.BODY&&this.doScrollBody(t)}doThisPointerUp(t,e){switch(super.doThisPointerUp(t,e),this.__scrollPressKind){case EScrollPressKind.BUTTON1:this.doScrollButton1up();break;case EScrollPressKind.BUTTON2:this.doScrollButton2up()}this.__scrollPressKind=void 0}doChangeScrollBarKind(){null!=this.onChangeScrollbarKind&&this.onChangeScrollbarKind(this)}doChangeUseScrollButton(){null!=this.onChangeUseScrollButton&&this.onChangeUseScrollButton(this)}doChangeMin(){this.doScroll(),null!=this.onChangeMin&&this.onChangeMin(this)}doChangeMax(){this.doScroll(),null!=this.onChangeMax&&this.onChangeMax(this)}doChangeValue(){this.doScroll(),null!=this.onChangeValue&&this.onChangeValue(this)}doScroll(){null!=this.onScroll&&this.onScroll(this,this.valueRatio,this.getValuePosition())}doScrollButton1Down(){let t=this;this.__interval=setInterval((function(){t.value--}),16),null!=this.onScrollButton1Down&&this.onScrollButton1Down(this)}doScrollButton1up(){clearInterval(this.__interval),null!=this.onScrollButton1Up&&this.onScrollButton1Up(this)}doScrollButton2Down(){let t=this;this.__interval=setInterval((function(){t.value++}),16),null!=this.onScrollButton2Down&&this.onScrollButton2Down(this)}doScrollButton2up(){clearInterval(this.__interval),null!=this.onScrollButton2Up&&this.onScrollButton2Up(this)}doScrollBody(t){if(this.scrollbarKind==EScrollBarKind.H){let e=this.position.width-2*this.getButtonLength()-this.getCursorLength(),i=t.offsetX-this.getButtonLength()-this.getCursorLength()/2;this.valueRatio=CCalc.crRange2Value(0,e,i,0,1)}else{let e=this.position.height-2*this.getButtonLength()-this.getCursorLength(),i=t.offsetY-this.getButtonLength()-this.getCursorLength()/2;this.valueRatio=CCalc.crRange2Value(0,e,i,0,1)}null!=this.onScrollBody&&this.onScrollBody(this,t)}}class CScrollbar extends CCustomScrollBar{doResource(){super.doResource(),this.value=0,this.doSetScrollItems()}doChangeUseScrollButton(){super.doChangeUseScrollButton(),this.doSetScrollItems()}doChangeSize(){super.doChangeSize(),this.doSetScrollItems()}doScrollBody(t){super.doScrollBody(t),this.doSetScrollItems()}doScroll(){super.doScroll(),this.doSetScrollItems()}doSetScrollItems(){let t=this.layers.getCanvasItems("scrollbutton1"),e=this.layers.getCanvasItems("scrollbutton2"),i=this.layers.getCanvasItems("scrollcursor");for(let e=0;e<t.length;e++)t[e].visible=this.useScrollButton,t[e].position.height=this.getButtonLength(),t[e].position.width=this.getButtonLength(),this.scrollbarKind==EScrollBarKind.H&&(t[e].align=ECanvasItemAlign.LEFT),this.scrollbarKind==EScrollBarKind.V&&(t[e].align=ECanvasItemAlign.TOP);for(let t=0;t<e.length;t++)e[t].visible=this.useScrollButton,e[t].position.height=this.getButtonLength(),e[t].position.width=this.getButtonLength(),this.scrollbarKind==EScrollBarKind.H&&(e[t].align=ECanvasItemAlign.RIGHT),this.scrollbarKind==EScrollBarKind.V&&(e[t].align=ECanvasItemAlign.BOTTOM);for(let t=0;t<i.length;t++)i[t].align=ECanvasItemAlign.NONE,this.scrollbarKind==EScrollBarKind.H&&(i[t].position.left=this.getValuePosition(),i[t].position.top=0,i[t].position.height=this.getCursorLength(),i[t].position.width=this.getCursorLength()),this.scrollbarKind==EScrollBarKind.V&&(i[t].position.left=0,i[t].position.top=this.getValuePosition(),i[t].position.height=this.getCursorLength(),i[t].position.width=this.getCursorLength())}}class CScrollBox extends CPanel{get scrollAnimatorResource(){return this._scrollAnimatorResource}set scrollAnimatorResource(t){this._scrollAnimatorResource=t,""!=t&&(this.scrollAnimationTrigger=CAnimator.animatorFromResource(this,t))}get isAutoScroll(){return 0!=this.__autoScroll}get background(){return this._background}get content(){return this._content}get contentWidth(){return this._content.position.width}set contentWidth(t){this._content.position.width=t,this.doChangeContentSize()}get contentHeight(){return this._content.position.height}set contentHeight(t){this._content.position.height=t,this.doChangeContentSize()}get scrollLeft(){return this._background.controlElement.scrollLeft}set scrollLeft(t){this._background.controlElement.scrollLeft=t}get scrollTop(){return this._background.controlElement.scrollTop}set scrollTop(t){this._background.controlElement.scrollTop=t}get scrollbarResource(){return this._scrollbarResource}get scrollWidth(){return this._background.controlElement.scrollWidth}get scrollHeight(){return this._background.controlElement.scrollHeight}set scrollbarResource(t){this._scrollbarResource!=t&&(this._scrollbarResource=t,this.doChangeScrollbarResource())}get scrollbarLength(){return this._scrollbarLength}set scrollbarLength(t){this._scrollbarLength!=t&&(this._scrollbarLength=t,this.doChangeScrollbarInfo())}get useHScrollbar(){return this._useHScrollbar}set useHScrollbar(t){this._useHScrollbar!=t&&(this._useHScrollbar=t,this.doChangeScrollbarInfo())}get useVScrollbar(){return this._useVScrollbar}set useVScrollbar(t){this._useVScrollbar!=t&&(this._useVScrollbar=t,this.doChangeScrollbarInfo())}get hScrollbar(){return this._hScrollbar}get vScrollbar(){return this._vScrollbar}get contentViewWidth(){return this._background.position.width-this.position.padding.left-this.position.padding.right}get contentViewHeight(){return this._background.position.height-this.position.padding.top-this.position.padding.bottom}constructor(t,e){super(t,e),this.__useScrollbar=!1,this.__autoScroll=0,this._background=new CPanel(this),this._scrollbarResource="",this._hScrollbar=new CScrollbar(this),this._vScrollbar=new CScrollbar(this),this._scrollbarLength=15,this._useHScrollbar=!0,this._useVScrollbar=!0,this._scrollAnimatorResource="";let i=this;this._background.overflow="scroll",this._background.onChildDataMapHandle.push((function(t,e){e.delete(i.content)})),this._content=new CLayout(this._background),this.overflow="hidden",this._vScrollbar.scrollbarKind=EScrollBarKind.V,this._hScrollbar.onResource=function(){i.doSetInnerSize()},this._vScrollbar.onResource=function(){i.doSetInnerSize()},this._hScrollbar.onScroll=function(t,e){let s=i.scrollWidth-i._background.position.width;i.scrollLeft=s*e},this._vScrollbar.onScroll=function(t,e){let s=i.scrollHeight-i._background.position.height;i.scrollTop=s*e},this._hScrollbar.onThisPointerDown=function(){i.__useScrollbar=!0},this._hScrollbar.onThisPointerUp=function(){i.__useScrollbar=!1},this._vScrollbar.onThisPointerDown=function(){i.__useScrollbar=!0},this._vScrollbar.onThisPointerUp=function(){i.__useScrollbar=!1},this._background.controlElement.onscroll=function(){i.doScroll()}}doToData(t){super.doToData(t),CDataClass.putData(t,"scrollbarResource",this.scrollbarResource,""),CDataClass.putData(t,"scrollbarLength",this.scrollbarLength,15),CDataClass.putData(t,"useHScrollbar",this.useHScrollbar,!0),CDataClass.putData(t,"useVScrollbar",this.useVScrollbar,!0),CDataClass.putData(t,"contentWidth",this.contentWidth,0),CDataClass.putData(t,"contentHeight",this.contentHeight,0),CDataClass.putData(t,"scrollAnimatorResource",this.scrollAnimatorResource,""),null!=this.scrollAnimationTrigger&&CDataClass.putData(t,"scrollAnimationTrigger",this.scrollAnimationTrigger.toData(),{},!0)}doFromData(t){super.doFromData(t),this.scrollbarResource=CDataClass.getData(t,"scrollbarResource",""),this.scrollbarLength=CDataClass.getData(t,"scrollbarLength",15),this.useHScrollbar=CDataClass.getData(t,"useHScrollbar",!0),this.useVScrollbar=CDataClass.getData(t,"useVScrollbar",!0),this.contentWidth=CDataClass.getData(t,"contentWidth",0),this.contentHeight=CDataClass.getData(t,"contentHeight",0),CAnimator.fromAnimatorData(t,this,"scrollAnimationTrigger"),this.scrollAnimatorResource=CDataClass.getData(t,"scrollAnimatorResource",""),this.overflow="hidden"}doChildDataMapHandle(t){super.doChildDataMapHandle(t);let e=CSystem.getChildControls(this.background);for(let i=0;i<e.length;i++)t.set(e[i],{kind:"background:"+this.propertyName,data:e[i].toData()});let i=CSystem.getChildControls(this.content);for(let e=0;e<i.length;e++)t.set(i[e],{kind:"content:"+this.propertyName,data:i[e].toData()});t.delete(this.background),t.delete(this.content),t.delete(this.hScrollbar),t.delete(this.vScrollbar)}doFromChildData(t,e){let i=super.doFromChildData(t,e);for(let s=0;s<t.length;s++){if(t[s].kind=="background:"+this.propertyName){let o;for(let t=0;t<i.length;t++)i[t].kind=="background:"+this.propertyName&&(o=i[t]);if(e){let i=e[t[s].data.propertyName];i?(i.fromData(t[s].data),o.control=i):(o.control=CControl.controlFromData(t[s].data,this),o.control&&(o.control.parent=this.background))}else{let e=this[t[s].data.propertyName];e?(e.fromData(t[s].data),o.control=e):(o.control=CControl.controlFromData(t[s].data,this),o.control&&(o.control.parent=this.background))}}if(t[s].kind=="content:"+this.propertyName){let o;for(let t=0;t<i.length;t++)i[t].kind=="content:"+this.propertyName&&(o=i[t]);if(e){let i=e[t[s].data.propertyName];i?(i.fromData(t[s].data),o.control=i):(o.control=CControl.controlFromData(t[s].data,this),o.control&&(o.control.parent=this.content))}else{let e=this[t[s].data.propertyName];e?(e.fromData(t[s].data),o.control=e):(o.control=CControl.controlFromData(t[s].data,this),o.control&&(o.control.parent=this.content))}}}return i}doContainerList(){let t=super.doContainerList();return t.getItem(0).addChild({name:"background",control:this.background,isMainContainer:!1}).addChild({name:"content",control:this.content,isMainContainer:!1}),t}doChangeDesignMode(){super.doChangeDesignMode(),this.isDesignMode?(this.__designOrgData.background=this.background.hasPointerEvent,this.__designOrgData.hScrollbar=this.hScrollbar.hasPointerEvent,this.__designOrgData.vScrollbar=this.vScrollbar.hasPointerEvent,this.background.hasPointerEvent=!1,this.hScrollbar.hasPointerEvent=!1,this.vScrollbar.hasPointerEvent=!1):(this.background.hasPointerEvent=this.__designOrgData.background,this.hScrollbar.hasPointerEvent=this.__designOrgData.hScrollbar,this.vScrollbar.hasPointerEvent=this.__designOrgData.vScrollbar)}doResource(){super.doResource(),this.overflow="hidden"}doRemove(){this.content.remove(),super.doRemove()}doChangeSize(){super.doChangeSize(),this.doSetInnerSize()}doSetInnerSize(){this.background.position.left=this.position.padding.left,this.background.position.top=this.position.padding.top;let t=0,e=0;e=this.useHScrollbar?this.position.height-this.position.padding.top-this.position.padding.bottom-this.scrollbarLength:this.position.height-this.position.padding.top-this.position.padding.bottom,t=this.useVScrollbar?this.position.width-this.position.padding.left-this.position.padding.right-this.scrollbarLength:this.position.width-this.position.padding.left-this.position.padding.right,this.background.position.width=t,this.background.position.height=e,this._hScrollbar.visible=this.useHScrollbar,this._vScrollbar.visible=this.useVScrollbar,this.useHScrollbar&&(this._hScrollbar.position.left=this.position.padding.left,this._hScrollbar.position.top=this.position.height-this.position.padding.bottom-this._scrollbarLength,this._hScrollbar.position.width=t,this._hScrollbar.position.height=this._scrollbarLength,this._hScrollbar.scrollbarKind=EScrollBarKind.H,this._hScrollbar.bringToFront(),this._hScrollbar.enabled=t<this.contentWidth),this.useVScrollbar&&(this._vScrollbar.position.left=this.position.width-this._scrollbarLength-this.position.padding.right,this._vScrollbar.position.top=this.position.padding.top,this._vScrollbar.position.width=this._scrollbarLength,this._vScrollbar.position.height=e,this._vScrollbar.scrollbarKind=EScrollBarKind.V,this._vScrollbar.bringToFront(),this._vScrollbar.enabled=e<this.contentHeight),null!=this.onSetInnerSize&&this.onSetInnerSize(this)}doChangeScrollbarResource(){this._hScrollbar.resource=this._scrollbarResource,this._vScrollbar.resource=this._scrollbarResource,null!=this.onChangeScrollbarResource&&this.onChangeScrollbarResource(this)}doChangeScrollbarInfo(){this.doSetInnerSize(),null!=this.onChangeScrollbarInfo&&this.onChangeScrollbarInfo(this)}doChangeContentSize(){this.doSetInnerSize(),null!=this.onChangeContentSize&&this.onChangeContentSize(this)}doScroll(){if(null!=this.scrollAnimationTrigger&&this.scrollAnimationTrigger.start(),!this.__useScrollbar){let t=this.scrollWidth-this._background.position.width;this.hScrollbar.valueRatio=CCalc.crRange2Value(0,t,this.scrollLeft,0,1),t=this.scrollHeight-this._background.position.height,this.vScrollbar.valueRatio=CCalc.crRange2Value(0,t,this.scrollTop,0,1)}null!=this.onScroll&&this.onScroll(this)}scrollToLeft(){let t=this,e=this.scrollTop;CAnimation.animate(100,(function(i,s,o){t.scrollLeft=e+-e*s}))}scrollToRight(){let t=this,e=this.scrollLeft,i=this.scrollWidth-e;CAnimation.animate(100,(function(s,o,a){t.scrollLeft=e+i*o}))}scrollToTop(){let t=this,e=this.scrollTop;CAnimation.animate(100,(function(i,s,o){t.scrollTop=e+-e*s}))}scrollToBottom(){let t=this,e=this.scrollTop,i=this.scrollHeight-e;CAnimation.animate(100,(function(s,o,a){t.scrollTop=e+i*o}))}scrollTo(t,e){let i=t;i>this.scrollWidth&&(i=this.scrollWidth),i<0&&(i=0);let s=e;s>this.scrollHeight&&(s=this.scrollHeight),s<0&&(s=0);let o=this.scrollLeft,a=i-o,n=this.scrollTop,r=s-n,l=this;CAnimation.animate(100,(function(t,e,i){l.scrollLeft=o+a*e,l.scrollTop=n+r*e}))}startAutoScroll(t,e,i=10,s){let o=this,a=0;a="x"==t?this.scrollLeft:this.scrollTop,0==this.__autoScroll&&(this.__autoScroll=setInterval((function(){"x"==t&&(o.hScrollbar.value+=e,null!=s&&s(o.scrollLeft-a),a=o.scrollLeft,o.hScrollbar.value==o.hScrollbar.max&&o.stopAutoScroll()),"y"==t&&(o.vScrollbar.value+=e,null!=s&&s(o.scrollTop-a),a=o.scrollTop,o.vScrollbar.value==o.vScrollbar.max&&o.stopAutoScroll())}),i))}stopAutoScroll(){clearInterval(this.__autoScroll),this.__autoScroll=0}addProperties(){let t=super.addProperties();return t.push({instance:this.scrollAnimationTrigger,propertyName:"scrollAnimationTrigger",readOnly:!1,enum:[]}),t.push({instance:this.contentWidth,propertyName:"contentWidth",readOnly:!1,enum:[]}),t.push({instance:this.contentHeight,propertyName:"contentHeight",readOnly:!1,enum:[]}),t}}class CUnlimitedScrollBox extends CPanel{get scrollAnimatorResource(){return this._scrollAnimatorResource}set scrollAnimatorResource(t){this._scrollAnimatorResource=t,""!=t&&(this.scrollAnimationTrigger=CAnimator.animatorFromResource(this,t))}get isAutoScroll(){return 0!=this.__autoScroll}get background(){return this._background}get content(){return this._content}get scrollMinX(){return this._scrollMinX}set scrollMinX(t){let e=t;e>this.scrollMaxX&&(e=this.scrollMaxX),this._scrollMinX!=e&&(this._scrollMinX=e,this.doChangeScrollArea())}get scrollMaxX(){return this._scrollMaxX}set scrollMaxX(t){let e=t;e<this.scrollMinX&&(e=this.scrollMinX),this._scrollMaxX!=e&&(this._scrollMaxX=e,this.doChangeScrollArea())}get scrollMinY(){return this._scrollMinY}set scrollMinY(t){let e=t;e>this.scrollMaxY&&(e=this.scrollMaxY),this._scrollMinY!=e&&(this._scrollMinY=e,this.doChangeScrollArea())}get scrollMaxY(){return this._scrollMaxY}set scrollMaxY(t){let e=t;e<this.scrollMinY&&(e=this.scrollMinY),this._scrollMaxY!=e&&(this._scrollMaxY=e,this.doChangeScrollArea())}get scrollX(){return this._scrollX}set scrollX(t){let e=t;this.isCirculationX?(e<this._scrollMinX&&(e=this._scrollMaxX-(this._scrollMinX-e)),e>this._scrollMaxX&&(e=this._scrollMinX+(e-this._scrollMaxX))):(e<this._scrollMinX&&(e=this._scrollMinX),e>this._scrollMaxX&&(e=this._scrollMaxX)),this._scrollX==e||isNaN(e)||(this._scrollX=e,this.doChangeScrollValue())}get scrollY(){return this._scrollY}set scrollY(t){let e=t;this.isCirculationY?(e<this._scrollMinY&&(e=this._scrollMaxY-(this._scrollMinY-e)),e>this._scrollMaxY&&(e=this._scrollMinY+(e-this._scrollMaxY))):(e<this._scrollMinY&&(e=this._scrollMinY),e>this._scrollMaxY&&(e=this._scrollMaxY)),this._scrollY==e||isNaN(e)||(this._scrollY=e,this.doChangeScrollValue())}get scrollbarResource(){return this._scrollbarResource}set scrollbarResource(t){this._scrollbarResource!=t&&(this._scrollbarResource=t,this.doChangeScrollbarResource())}get scrollbarLength(){return this._scrollbarLength}set scrollbarLength(t){this._scrollbarLength!=t&&(this._scrollbarLength=t,this.doChangeScrollbarInfo())}get useHScrollbar(){return this._useHScrollbar}set useHScrollbar(t){this._useHScrollbar!=t&&(this._useHScrollbar=t,this.doChangeScrollbarInfo())}get useVScrollbar(){return this._useVScrollbar}set useVScrollbar(t){this._useVScrollbar!=t&&(this._useVScrollbar=t,this.doChangeScrollbarInfo())}get hScrollbar(){return this._hScrollbar}get vScrollbar(){return this._vScrollbar}get contentViewWidth(){return this._background.position.width-this.position.padding.left-this.position.padding.right}get contentViewHeight(){return this._background.position.height-this.position.padding.top-this.position.padding.bottom}constructor(t,e){super(t,e),this.__ignoreScroll=!1,this.__scrollChecker=0,this.__useScrollbar=!1,this.__autoScroll=0,this.__preScrollLeft=0,this.__preScrollTop=0,this._background=new CPanel(this),this._scrollbarResource="",this._hScrollbar=new CScrollbar(this),this._vScrollbar=new CScrollbar(this),this._scrollbarLength=15,this._useHScrollbar=!0,this._useVScrollbar=!0,this._scrollMinX=-9e15,this._scrollMaxX=9e15,this._scrollMinY=-9e15,this._scrollMaxY=9e15,this._scrollX=0,this._scrollY=0,this.scrollStopCheckInterval=100,this.isCirculationX=!1,this.isCirculationY=!1,this._scrollAnimatorResource="";let i=this;this._background.overflow="scroll",this._content=new CLayout(this._background),this._content.position.width=335544,this._content.position.height=335544,this.contentToCenter(),this._vScrollbar.scrollbarKind=EScrollBarKind.V,this._hScrollbar.onResource=function(){i.doSetInnerSize()},this._vScrollbar.onResource=function(){i.doSetInnerSize()},this._hScrollbar.onScroll=function(t,e){i.scrollX=CCalc.crRange2Value(0,1,e,i._scrollMinX,i._scrollMaxX)},this._vScrollbar.onScroll=function(t,e){i.scrollY=CCalc.crRange2Value(0,1,e,i._scrollMinY,i._scrollMaxY)},this._hScrollbar.onThisPointerDown=function(){i.__useScrollbar=!0},this._hScrollbar.onThisPointerUp=function(){i.__useScrollbar=!1},this._vScrollbar.onThisPointerDown=function(){i.__useScrollbar=!0},this._vScrollbar.onThisPointerUp=function(){i.__useScrollbar=!1},this._background.controlElement.onscroll=function(){i.__ignoreScroll||i.doScroll()}}contentToCenter(){this.__ignoreScroll=!0,this._content.position.left=0,this._content.position.top=0,this.background.controlElement.scrollLeft=167772,this.background.controlElement.scrollTop=167772,this.__preScrollLeft=this.background.controlElement.scrollLeft,this.__preScrollTop=this.background.controlElement.scrollTop,this.__ignoreScroll=!1}doToData(t){super.doToData(t),CDataClass.putData(t,"scrollbarResource",this.scrollbarResource,""),CDataClass.putData(t,"scrollbarLength",this.scrollbarLength,15),CDataClass.putData(t,"useHScrollbar",this.useHScrollbar,!0),CDataClass.putData(t,"useVScrollbar",this.useVScrollbar,!0),CDataClass.putData(t,"scrollAnimatorResource",this.scrollAnimatorResource,""),null!=this.scrollAnimationTrigger&&CDataClass.putData(t,"scrollAnimationTrigger",this.scrollAnimationTrigger.toData(),{},!0)}doFromData(t){super.doFromData(t),this.scrollbarResource=CDataClass.getData(t,"scrollbarResource",""),this.scrollbarLength=CDataClass.getData(t,"scrollbarLength",15),this.useHScrollbar=CDataClass.getData(t,"useHScrollbar",!0),this.useVScrollbar=CDataClass.getData(t,"useVScrollbar",!0),CAnimator.fromAnimatorData(t,this,"scrollAnimationTrigger"),this.scrollAnimatorResource=CDataClass.getData(t,"scrollAnimatorResource","")}doRemove(){this.content.remove(),super.doRemove()}doChangeSize(){super.doChangeSize(),this.doSetInnerSize(),this.contentToCenter()}doSetInnerSize(){this.background.position.left=this.position.padding.left,this.background.position.top=this.position.padding.top;let t=0,e=0;e=this.useHScrollbar?this.position.height-this.position.padding.top-this.position.padding.bottom-this.scrollbarLength:this.position.height-this.position.padding.top-this.position.padding.bottom,t=this.useVScrollbar?this.position.width-this.position.padding.left-this.position.padding.right-this.scrollbarLength:this.position.width-this.position.padding.left-this.position.padding.right,this.background.position.width=t,this.background.position.height=e,this._hScrollbar.visible=this.useHScrollbar,this._vScrollbar.visible=this.useVScrollbar,this.useHScrollbar&&(this._hScrollbar.position.left=this.position.padding.left,this._hScrollbar.position.top=this.position.height-this.position.padding.bottom-this._scrollbarLength,this._hScrollbar.position.width=t,this._hScrollbar.position.height=this._scrollbarLength,this._hScrollbar.scrollbarKind=EScrollBarKind.H,this._hScrollbar.bringToFront()),this.useVScrollbar&&(this._vScrollbar.position.left=this.position.width-this._scrollbarLength-this.position.padding.right,this._vScrollbar.position.top=this.position.padding.top,this._vScrollbar.position.width=this._scrollbarLength,this._vScrollbar.position.height=e,this._vScrollbar.scrollbarKind=EScrollBarKind.V,this._vScrollbar.bringToFront()),null!=this.onSetInnerSize&&this.onSetInnerSize(this)}doChangeScrollbarResource(){this._hScrollbar.resource=this._scrollbarResource,this._vScrollbar.resource=this._scrollbarResource,null!=this.onChangeScrollbarResource&&this.onChangeScrollbarResource(this)}doChangeScrollbarInfo(){this.doSetInnerSize(),null!=this.onChangeScrollbarInfo&&this.onChangeScrollbarInfo(this)}doChangeScrollArea(){this.doSetInnerSize()}doScroll(){if(null!=this.scrollAnimationTrigger&&this.scrollAnimationTrigger.start(),this.__preScrollTime=CTime.now,this.scrollX+=this.background.controlElement.scrollLeft-this.__preScrollLeft,this.scrollY+=this.background.controlElement.scrollTop-this.__preScrollTop,this.__preScrollLeft=this.background.controlElement.scrollLeft,this.__preScrollTop=this.background.controlElement.scrollTop,0==this.__scrollChecker){let t=this;this.__scrollChecker=setInterval((function(){null!=t.__preScrollTime&&CTime.now-t.__preScrollTime>t.scrollStopCheckInterval&&0==t.__pressedThisPoints.length&&0==t.__pressedBubblePoints.length&&(clearInterval(t.__scrollChecker),t.__scrollChecker=0,(t.background.controlElement.scrollLeft>3e7||t.background.controlElement.scrollLeft<1e6||t.background.controlElement.scrollTop>3e7||t.background.controlElement.scrollTop<1e6)&&t.contentToCenter(),t.doScrollStop())}),t.scrollStopCheckInterval)}this.__useScrollbar||(this.hScrollbar.valueRatio=CCalc.crRange2Value(this._scrollMinX,this._scrollMaxX,this.scrollX,0,1),this.vScrollbar.valueRatio=CCalc.crRange2Value(this._scrollMinY,this._scrollMaxY,this.scrollY,0,1)),null!=this.onScroll&&this.onScroll(this)}doScrollStop(){null!=this.onScrollStop&&this.onScrollStop(this)}doChangeScrollValue(){null!=this.onChangeScrollValue&&this.onChangeScrollValue(this)}startAutoScroll(t,e,i=10,s){let o=this,a=0;a="x"==t?this.scrollX:this.scrollY,0==this.__autoScroll&&(this.__autoScroll=setInterval((function(){"x"==t&&(o.scrollX+=e,null!=s&&s(o.scrollX-a),a=o.scrollX,o.isCirculationX||o.scrollX!=o.scrollMaxX&&o.scrollX!=o.scrollMinX||o.stopAutoScroll()),"y"==t&&(o.scrollY+=e,null!=s&&s(o.scrollY-a),a=o.scrollY,o.isCirculationY||o.scrollY!=o.scrollMaxY&&o.scrollY!=o.scrollMinY||o.stopAutoScroll())}),i))}stopAutoScroll(){clearInterval(this.__autoScroll),this.__autoScroll=0}addProperties(){let t=super.addProperties();return t.push({instance:this.scrollAnimationTrigger,propertyName:"scrollAnimationTrigger",readOnly:!1,enum:[]}),t}}class CCustomListControl extends CPanel{get scrollBox(){return this._scroll}get itemIndex(){return this._itemIndex}set itemIndex(t){let e=t;e<-1&&(e=-1),this._itemIndex!=e&&(this._itemIndex=e,this.doChangeItemIndex())}get rowHeight(){return this._rowHeight}set rowHeight(t){let e=t;e<0&&(e=0),this._rowHeight!=e&&(this._rowHeight=e,this.doChangeItemInfo())}get itemMargin(){return this._itemMargin}set itemMargin(t){this._itemMargin!=t&&(this._itemMargin=t,this.doChangeItemInfo())}get multiSelect(){return this._multiSelect}set multiSelect(t){this._multiSelect!=t&&(this._multiSelect=t,this.doChangeMultiSelect())}get scrollbarResource(){return this.scrollBox.scrollbarResource}set scrollbarResource(t){this.scrollBox.scrollbarResource!=t&&(this.scrollBox.scrollbarResource=t)}get scrollbarLength(){return this.scrollBox.scrollbarLength}set scrollbarLength(t){this.scrollBox.scrollbarLength=t}get length(){return this.getLength()}get scrollTop(){return this.scrollBox.scrollTop}set scrollTop(t){this.scrollBox.scrollTop=t}get scrollHeight(){return this.scrollBox.scrollHeight}constructor(t,e){super(t,e),this._scroll=new CScrollBox(this),this._itemIndex=-1,this._rowHeight=30,this._itemMargin=0,this._multiSelect=!1,this.useKeyDown=!0;let i=this;this._scroll.position.align=EPositionAlign.CLIENT,this._scroll.useHScrollbar=!1,this._scroll.onScroll=function(){i.doScroll()},this._scroll.onChangeSize=function(){i.doChangeScrollBoxSize()},this._scroll.position.onChangeSize=function(){i.doChangeScrollBoxSize()},this._scroll.onChangeScrollbarInfo=function(){i.doSetScrollContent()},this.scrollBox.background.onThisPointerDown=function(t,e,s){i.doBackgroundPointerDown(e,s)},this.scrollBox.background.onThisPointerMove=function(t,e,s){i.doBackgroundPointerMove(e,s)},this.scrollBox.background.onThisPointerUp=function(t,e,s){i.doBackgroundPointerUp(e,s)},this.scrollBox.background.onThisPointerCancel=function(t,e,s){i.doBackgroundPointerCancel(e,s)},this.scrollBox.background.onThisPointerOver=function(t,e,s){i.doBackgroundPointerOver(e,s)},this.scrollBox.background.onThisPointerOut=function(t,e,s){i.doBackgroundPointerOut(e,s)},this.scrollBox.background.onThisPointerEnter=function(t,e,s){i.doBackgroundPointerEnter(e,s)},this.scrollBox.background.onThisPointerLeave=function(t,e,s){i.doBackgroundPointerLeave(e,s)}}getLength(){return 0}doToData(t){super.doToData(t),CDataClass.putData(t,"rowHeight",this.rowHeight,30),CDataClass.putData(t,"itemMargin",this.itemMargin,0),CDataClass.putData(t,"multiSelect",this.multiSelect,!1),CDataClass.putData(t,"useKeyDown",this.useKeyDown,!0),CDataClass.putData(t,"scrollbarResource",this.scrollbarResource,""),CDataClass.putData(t,"scrollbarLength",this.scrollbarLength,15)}doFromData(t){super.doFromData(t),this.rowHeight=CDataClass.getData(t,"rowHeight",30),this.itemMargin=CDataClass.getData(t,"itemMargin",0),this.multiSelect=CDataClass.getData(t,"multiSelect",!1),this.useKeyDown=CDataClass.getData(t,"useKeyDown",!0),this.scrollbarResource=CDataClass.getData(t,"scrollbarResource",""),this.scrollbarLength=CDataClass.getData(t,"scrollbarLength",15)}doChildDataMapHandle(t){super.doChildDataMapHandle(t),t.delete(this.scrollBox)}doChangeDesignMode(){super.doChangeDesignMode(),this.isDesignMode?(this.__designOrgData.scrollBox=this.scrollBox.hasPointerEvent,this.__designOrgData.background=this.scrollBox.background.hasPointerEvent,this.__designOrgData.hScrollbar=this.scrollBox.hScrollbar.hasPointerEvent,this.__designOrgData.vScrollbar=this.scrollBox.vScrollbar.hasPointerEvent,this.scrollBox.hasPointerEvent=!1,this.scrollBox.background.hasPointerEvent=!1,this.scrollBox.hScrollbar.hasPointerEvent=!1,this.scrollBox.vScrollbar.hasPointerEvent=!1):(this.scrollBox.hasPointerEvent=this.__designOrgData.scrollBox,this.scrollBox.background.hasPointerEvent=this.__designOrgData.background,this.scrollBox.hScrollbar.hasPointerEvent=this.__designOrgData.hScrollbar,this.scrollBox.vScrollbar.hasPointerEvent=this.__designOrgData.vScrollbar)}doChangeSize(){super.doChangeSize(),this.doSetScrollContent()}doChangeItemIndex(){null!=this.onChangeItemIndex&&this.onChangeItemIndex(this)}doChangeItemInfo(){this.doSetScrollContent(),null!=this.onChangeItemInfo&&this.onChangeItemInfo(this)}doSetScrollContent(){this._scroll.contentWidth=this._scroll.contentViewWidth,this._scroll.contentHeight=(this.rowHeight+this.itemMargin)*this.length+this.itemMargin,null!=this.onSetScrollContent&&this.onSetScrollContent(this)}doScroll(){null!=this.onScroll&&this.onScroll(this)}doChangeScrollBoxSize(){this.doSetScrollContent(),null!=this.onChangeScrollBoxSize&&this.onChangeScrollBoxSize(this)}doChangeMultiSelect(){null!=this.onChangeMultiSelect&&this.onChangeMultiSelect(this)}doBackgroundPointerDown(t,e){null!=this.onBackgroundPointerDown&&this.onBackgroundPointerDown(this,t,e)}doBackgroundPointerMove(t,e){null!=this.onBackgroundPointerMove&&this.onBackgroundPointerMove(this,t,e)}doBackgroundPointerUp(t,e){null!=this.onBackgroundPointerUp&&this.onBackgroundPointerUp(this,t,e)}doBackgroundPointerCancel(t,e){null!=this.onBackgroundPointerCancel&&this.onBackgroundPointerCancel(this,t,e)}doBackgroundPointerOver(t,e){null!=this.onBackgroundPointerOver&&this.onBackgroundPointerOver(this,t,e)}doBackgroundPointerOut(t,e){null!=this.onBackgroundPointerOut&&this.onBackgroundPointerOut(this,t,e)}doBackgroundPointerEnter(t,e){null!=this.onBackgroundPointerEnter&&this.onBackgroundPointerEnter(this,t,e)}doBackgroundPointerLeave(t,e){null!=this.onBackgroundPointerLeave&&this.onBackgroundPointerLeave(this,t,e)}doKeyDown(t){super.doKeyDown(t),this.useKeyDown&&("ArrowUp"==t.key&&this.itemIndex>0&&(this.itemIndex--,this.getItemPosition(this.itemIndex).top<this.scrollTop&&this.scrollToIndex(this.itemIndex)),"ArrowDown"==t.key&&this.itemIndex<this.getLength()-1&&(this.itemIndex++,this.getItemPosition(this.itemIndex).top>this.scrollTop+this.scrollBox.contentViewHeight-1&&this.scrollToIndexBottom(this.itemIndex)),"PageUp"==t.key&&(this.scrollTop-=this.scrollBox.contentViewHeight),"PageDown"==t.key&&(this.scrollTop+=this.scrollBox.contentViewHeight),"End"==t.key&&this.scrollToBottom(),"Home"==t.key&&this.scrollToTop())}getItemPosition(t){let e=this.itemMargin+(this.rowHeight+this.itemMargin)*t;return new CRect(this.itemMargin,e,this._scroll.contentViewWidth-this.itemMargin,e+this.rowHeight)}yToIndex(t){if(this.rowHeight<=0)throw new Error("invalid row height : "+this.rowHeight);let e=this.rowHeight+this.itemMargin;return{index:Math.floor(t/e),isMargin:t%e<=this.itemMargin}}getScrollShowPositions(){if(this.rowHeight<=0)throw new Error("invalid row height : "+this.rowHeight);let t=new Array,e=this.yToIndex(this._scroll.scrollTop).index;for(;e*(this.rowHeight+this.itemMargin)+this.itemMargin<this._scroll.scrollTop+this.scrollBox.position.height&&e<this.length;){let i={index:e,position:this.getItemPosition(e)};t.push(i),e++}return t}scrollToBottom(){this.getLength()>0&&this.scrollToIndex(this.getLength()-1)}scrollToTop(){this.getLength()>0&&this.scrollToIndex(0)}scrollToIndex(t){let e=this,i=e.scrollBox.scrollTop,s=e.getItemPosition(t).top-i;CAnimation.animate(100,(function(t,o,a){e.scrollBox.scrollTop=i+s*o}))}scrollToIndexBottom(t){let e=this,i=e.scrollBox.scrollTop,s=e.getItemPosition(t).top-(e.scrollBox.contentViewHeight-e.rowHeight-e.itemMargin)-i;CAnimation.animate(100,(function(t,o,a){e.scrollBox.scrollTop=i+s*o}))}addProperties(){let t=super.addProperties();return t.push({instance:this.scrollBox.scrollbarResource,propertyName:"scrollbarResource",readOnly:!1,enum:[]}),t.push({instance:this.scrollBox.scrollTop,propertyName:"scrollTop",readOnly:!1,enum:[]}),t.push({instance:this.scrollBox.scrollHeight,propertyName:"scrollHeight",readOnly:!1,enum:[]}),t.push({instance:this.scrollBox.scrollbarLength,propertyName:"scrollbarLength",readOnly:!1,enum:[]}),t}}class CCustomCanvasListBox extends CCustomListControl{get listItem1Data(){return this._listItem1Data}set listItem1Data(t){this._listItem1Data!=t&&(this._listItem1Data=t,this._listItem1Data&&(0==this.__listItemData.length?this.__listItemData.push(this._listItem1Data):this.__listItemData[0]=this._listItem1Data))}get listItem2Data(){return this._listItem2Data}set listItem2Data(t){this._listItem2Data!=t&&(this._listItem2Data=t,this._listItem2Data&&(0==this.__listItemData.length?(this.listItem1Data=new CCanvasItems,this.listItem1Data.fromData(this._listItem2Data.toData()),this.__listItemData.push(this.listItem1Data),this.__listItemData.push(this._listItem2Data)):1==this.__listItemData.length?this.__listItemData.push(this._listItem2Data):this.__listItemData.length>1&&(this.__listItemData[1]=this._listItem2Data)))}get checkItems(){return this._checkItems}get checkBoxArea(){return this._checkBoxArea}get itemsContext(){return this._itemsContext}get listItemResource(){return this._listItemResource}set listItemResource(t){this._listItemResource!=t&&(this._listItemResource=t,t.length>0&&this.doChangeListItemResource())}get itemsLayer(){return this.__itemsLayer}get isDraw(){return this._isDraw}set isDraw(t){this._isDraw=t,t&&this.doItemsDraw()}get itemIndex(){return this._itemIndex}set itemIndex(t){let e=t;e<-1&&(e=-1),this._itemIndex!=e&&(this._itemIndex=e,this.doChangeItemIndex())}get useCheckBox(){return this._useCheckBox}set useCheckBox(t){this._useCheckBox!=t&&(this._useCheckBox=t,this.isDraw&&this.__itemsLayer.draw())}constructor(t,e){super(t,e),this.__preItemClick={time:0,index:-1},this.__downIdx=-1,this.__overIdx=-1,this.__offset=new CNotifyPoint(0,0),this.__listItemData=new Array,this._listItemResource=new Array,this._isDraw=!0,this._selecteItems=new Set,this._checkItems=new CSet,this._useCheckBox=!1,this._checkBoxArea=new CRect(0,0,20,20);let i=this;this.__itemsLayer=this.scrollBox.layers.addLayer(),CSystem.elementBrintToFront(this.__itemsLayer.canvas);let s=this.__itemsLayer.canvas.getContext("2d");null!=s&&(this._itemsContext=s),this.__itemsLayer.onDraw=function(){i.doItemsDraw()},this._checkItems.onChange=function(){i.doChangeCheckItems()}}doToData(t){super.doToData(t),CDataClass.putData(t,"listItemResource",this.listItemResource,[],!0),CDataClass.putData(t,"useCheckBox",this.useCheckBox,!1),CDataClass.putData(t,"checkBoxArea",this.checkBoxArea.toData(),{},!0),0==this.listItemResource.length&&(this.listItem1Data&&CDataClass.putData(t,"listItem1Data",this.listItem1Data.toData(),{},!0),this.listItem2Data&&CDataClass.putData(t,"listItem2Data",this.listItem2Data.toData(),{},!0))}doFromData(t){if(super.doFromData(t),this.listItemResource=CDataClass.getData(t,"listItemResource",[],!0),this.useCheckBox=CDataClass.getData(t,"useCheckBox",!1),this.checkBoxArea.fromData(CDataClass.getData(t,"checkBoxArea",{},!0)),0==this.listItemResource.length){let e=CDataClass.getData(t,"listItem1Data",void 0);e&&(this.listItem1Data=new CCanvasItems,this.listItem1Data.fromData(e));let i=CDataClass.getData(t,"listItem2Data",void 0);i&&(this.listItem2Data=new CCanvasItems,this.listItem2Data.fromData(i))}}doBackgroundPointerDown(t,e){let i=this.yToIndex(this.scrollBox.scrollTop+t.offsetY);i.isMargin||i.index>=this.length?this.__downIdx=-1:this.__downIdx=i.index,super.doBackgroundPointerDown(t,e)}doBackgroundPointerMove(t,e){let i=this.yToIndex(this.scrollBox.scrollTop+t.offsetY);i.isMargin?this.__overIdx=-1:this.__overIdx=i.index,this.isDraw&&this.__itemsLayer.draw(),super.doBackgroundPointerMove(t,e)}doBackgroundPointerUp(t,e){let i=this.yToIndex(this.scrollBox.scrollTop+t.offsetY),s=-1;if(s=i.isMargin||i.index>=this.length?-1:i.index,this.__downIdx==s&&(this.itemIndex=s,-1!=s)){if(this.useCheckBox){this.getItemPosition(i.index).offset(0,-this.scrollBox.scrollTop);let e=this.doCheckItem(i.index,t);e.result&&(this.checkItems.has(e.value)?this.checkItems.delete(e.value):this.checkItems.add(e.value))}this.doSelectItem(i.index,t),this.doItemClick(s)}super.doBackgroundPointerUp(t,e)}doBackgroundPointerOut(t,e){this.__overIdx=-1,this.isDraw&&this.__itemsLayer.draw(),super.doBackgroundPointerOut(t,e)}doAddSelectItems(t){this._selecteItems.add(t),this.doChangeSelectItems()}doDeleteSelectItems(t){this._selecteItems.has(t)&&(this._selecteItems.delete(t),this.doChangeSelectItems())}doChangeCheckItems(){this.doItemsDraw(),null!=this.onChangeCheckItems&&this.onChangeCheckItems(this)}doCheckItem(t,e){return{result:!1,value:void 0}}doSelectItem(t,e){}doSelectAll(){for(let t=0;t<this.length;t++)this._selecteItems.add(t);this.doChangeSelectItems()}doChangeSelectItems(){this.isDraw&&this.__itemsLayer.draw()}doItemClick(t){null!=this.onItemClick&&this.onItemClick(this,t),CTime.now-this.__preItemClick.time<this.repeatClickTime&&t==this.__preItemClick.index&&this.doItemDblClick(t),this.__preItemClick={time:(new Date).getTime(),index:t}}doItemDblClick(t){null!=this.onItemDblClick&&this.onItemDblClick(this,t)}doResource(){super.doResource();let t=this;this.__itemsLayer=this.scrollBox.layers.addLayer(),CSystem.elementBrintToFront(this.__itemsLayer.canvas);let e=this.__itemsLayer.canvas.getContext("2d");null!=e&&(this._itemsContext=e),this.__itemsLayer.onDraw=function(){t.doItemsDraw()}}doChangeItemIndex(){super.doChangeItemIndex(),this.__itemsLayer.draw()}doChangeItemInfo(){super.doChangeItemInfo(),this.__itemsLayer.draw()}doScroll(){super.doScroll(),this.__itemsLayer.draw()}doChangeListItemResource(){this.__listItemData=[];for(let t=0;t<this._listItemResource.length;t++){let e=CSystem.resources.get(this._listItemResource[t]);if(null!=e){let t=new CCanvasItems;t.fromData(e),this.__listItemData.push(t)}}this.isDraw&&this.__itemsLayer.draw()}doItemsDraw(){if(null!=this._itemsContext&&this._isDraw){let t=this.getScrollShowPositions();this._itemsContext.clearRect(0,0,this.__itemsLayer.canvas.width,this.__itemsLayer.canvas.height);for(let e=0;e<t.length;e++){t[e].position.offset(0,-this.scrollBox.scrollTop);let i=t[e].index%this.__listItemData.length,s=this.__listItemData[i];if(null!=this.onBeforeItemDraw){let i={resourceOrItems:""};if(this.onBeforeItemDraw(this,this._itemsContext,t[e].index,t[e].position,s,i),""!=i.resourceOrItems)if("string"==typeof i.resourceOrItems){let t=CSystem.resources.get(i.resourceOrItems),e=new CCanvasItems;e.fromData(t),s=e}else s=i.resourceOrItems}this.doItemDraw(this._itemsContext,t[e].index,t[e].position,s)}}}doItemDraw(t,e,i,s){null!=this.onItemDraw&&this.onItemDraw(this,t,e,i,s)}doKeyDown(t){this.useKeyDown&&("ArrowUp"==t.key&&this.itemIndex>0&&(this.itemIndex--,t.shiftKey&&this.multiSelect||this._selecteItems.clear(),this.doAddSelectItems(this.itemIndex),this.getItemPosition(this.itemIndex).top<this.scrollTop&&this.scrollToIndex(this.itemIndex)),"ArrowDown"==t.key&&this.itemIndex<this.getLength()-1&&(this.itemIndex++,t.shiftKey&&this.multiSelect||this._selecteItems.clear(),this.doAddSelectItems(this.itemIndex),this.getItemPosition(this.itemIndex).top>this.scrollTop+this.scrollBox.contentViewHeight-1&&this.scrollToIndexBottom(this.itemIndex)),"PageUp"==t.key&&(this.scrollTop-=this.scrollBox.contentViewHeight),"PageDown"==t.key&&(this.scrollTop+=this.scrollBox.contentViewHeight),"End"==t.key&&this.scrollToBottom(),"Home"==t.key&&this.scrollToTop(),t.ctrlKey&&"A"==t.key.toUpperCase()&&this.selectAll(),t.ctrlKey||"Enter"!=t.key&&" "!=t.key||-1!=this.itemIndex&&this.doItemClick(this.itemIndex)),null!=this.onKeyDown&&this.onKeyDown(this,t)}selectAll(){this.doSelectAll()}itemsDraw(){this.isDraw&&this.__itemsLayer.draw()}addProperties(){let t=super.addProperties();return t.push({instance:this.listItem1Data,propertyName:"listItem1Data",readOnly:!1,enum:[]}),t.push({instance:this.listItem2Data,propertyName:"listItem2Data",readOnly:!1,enum:[]}),t}}class CCustomListBox extends CCustomCanvasListBox{get items(){return this._items}get selectItems(){let t=new Array,e=this;return this._selecteItems.forEach((function(i){t.push(e._items.get(i))})),t}constructor(t,e){super(t,e),this._items=new CNotifyObjectList,this.objects=new Array;let i=this;this.items.onChange.push((function(){i.doSetScrollContent(),i.isDraw&&i.__itemsLayer.draw()}))}getLength(){return this._items.length}doRemove(){this.objects=[],super.doRemove()}doCheckItem(t,e){if(this.useCheckBox){let i=this.getItemPosition(t);if(i.offset(0,-this.scrollBox.scrollTop),e.offsetX>=i.left+this.checkBoxArea.left&&e.offsetX<=i.left+this.checkBoxArea.right&&e.offsetY>=i.top+this.checkBoxArea.top&&e.offsetY<=i.top+this.checkBoxArea.top+this.checkBoxArea.height)return{result:!0,value:t}}return{result:!1,value:void 0}}doSelectItem(t,e){this.multiSelect&&e.ctrlKey?this._selecteItems.has(t)?this.doDeleteSelectItems(t):this.doAddSelectItems(t):(this._selecteItems.clear(),this.doAddSelectItems(t))}doItemDraw(t,e,i,s){if(null!=CSystem.bufferingContext){let o=s.getItem("over");for(let t=0;t<o.length;t++)o[t].visible=e==this.__overIdx;o=s.getItem("select");for(let t=0;t<o.length;t++)o[t].visible=this._selecteItems.has(e);o=s.getItem("itemindex");for(let t=0;t<o.length;t++)o[t].visible=e==this.itemIndex;o=s.getItem("checkBox");for(let t=0;t<o.length;t++)o[t].visible=this.useCheckBox;o=s.getItem("check");for(let t=0;t<o.length;t++)o[t].visible=this.checkItems.has(e)&&this.useCheckBox;s.draw(t,i,this.__offset,CSystem.bufferingContext,1,1),super.doItemDraw(t,e,i,s)}}checkAll(){if(this.useCheckBox){for(let t=0;t<this.length;t++)this.checkItems.add(t);this.isDraw&&this.__itemsLayer.draw()}}add(t){return this.items.add(t)}insert(t,e){return(t==this.itemIndex||t<this.itemIndex)&&this.itemIndex++,this.items.insert(t,e)}delete(t){t==this.itemIndex?this.itemIndex=-1:t<this.itemIndex&&this.itemIndex--,this.items.delete(t)}get(t){return this.items.get(t)}getSelectedItem(){if(-1!=this.itemIndex)return this.get(this.itemIndex)}set(t,e){return this.items.set(t,e)}clear(){this.itemIndex=-1,this.items.clear()}}class CListBox extends CCustomCanvasListBox{get items(){return this._items}get selectItems(){let t=new Array,e=this;return this._selecteItems.forEach((function(i){t.push(e._items.get(i))})),t}constructor(t,e){super(t,e),this._items=new CList,this.objects=new Array;let i=this;this.items.onChange=function(){i.doSetScrollContent(),i.isDraw&&i.__itemsLayer.draw()}}getLength(){return this._items.length}doRemove(){this.objects=[],super.doRemove()}doChangeDesignMode(){if(super.doChangeDesignMode(),this.isDesignMode){this.items.clear();for(let t=0;t<10;t++)this.items.add("Sample data "+(t+1))}}doCheckItem(t,e){if(this.useCheckBox){let i=this.getItemPosition(t);if(i.offset(0,-this.scrollBox.scrollTop),e.offsetX>=i.left+this.checkBoxArea.left&&e.offsetX<=i.left+this.checkBoxArea.right&&e.offsetY>=i.top+this.checkBoxArea.top&&e.offsetY<=i.top+this.checkBoxArea.top+this.checkBoxArea.height)return{result:!0,value:t}}return{result:!1,value:void 0}}doSelectItem(t,e){this.multiSelect&&e.ctrlKey?this._selecteItems.has(t)?this.doDeleteSelectItems(t):this.doAddSelectItems(t):(this._selecteItems.clear(),this.doAddSelectItems(t))}doItemDraw(t,e,i,s){if(null!=CSystem.bufferingContext){let o=s.getItem("over");for(let t=0;t<o.length;t++)o[t].visible=e==this.__overIdx;o=s.getItem("select");for(let t=0;t<o.length;t++)o[t].visible=this._selecteItems.has(e);o=s.getItem("itemindex");for(let t=0;t<o.length;t++)o[t].visible=e==this.itemIndex;o=s.getItem("checkBox");for(let t=0;t<o.length;t++)o[t].visible=this.useCheckBox;o=s.getItem("check");for(let t=0;t<o.length;t++)o[t].visible=this.checkItems.has(e)&&this.useCheckBox;let a=s.getItem("text");for(let t=0;t<a.length;t++)a[t].text=this._items.get(e);s.draw(t,i,this.__offset,CSystem.bufferingContext,1,1),super.doItemDraw(t,e,i,s)}}checkAll(){if(this.useCheckBox){for(let t=0;t<this.length;t++)this.checkItems.add(t);this.isDraw&&this.__itemsLayer.draw()}}doKeyDown(t){if(this.useKeyDown&&t.ctrlKey&&"C"==t.key.toUpperCase()){let t="";for(let e=0;e<this.items.length;e++)0!=e&&(t+="\n"),t+=this.items.get(e);CSystem.setClipboard(t)}super.doKeyDown(t)}add(t){return this.items.add(t)}insert(t,e){return(t==this.itemIndex||t<this.itemIndex)&&this.itemIndex++,this.items.insert(t,e)}delete(t){t==this.itemIndex?this.itemIndex=-1:t<this.itemIndex&&this.itemIndex--,this.items.delete(t)}get(t){return this.items.get(t)}getSelectedItem(){if(-1!=this.itemIndex)return this.get(this.itemIndex)}set(t,e){return this.items.set(t,e)}clear(){this.itemIndex=-1,this.items.clear()}}class CObjectListBox extends CCustomListBox{doChangeDesignMode(){if(super.doChangeDesignMode(),this.isDesignMode){this.items.clear();for(let t=0;t<10;t++)this.items.add({text:"Sample data "+(t+1)})}}doItemDraw(t,e,i,s){let o=this._items.get(e),a=Object.keys(o);for(let t=0;t<a.length;t++){let e=s.getItem(a[t]);for(let i=0;i<e.length;i++)"string"==typeof o[a[t]]?e[i].text=o[a[t]]:e[i].text=o[a[t]]+""}super.doItemDraw(t,e,i,s)}}class CCustomTreeListBox extends CCustomCanvasListBox{get items(){return this._items}get selectItems(){let t=new Array;return this._selecteItems.forEach((function(e){t.push(e)})),t}get stateArea(){return this._stateArea}get levelLength(){return this._levelLength}set levelLength(t){this._levelLength=t,t&&this.itemsDraw()}constructor(t,e,i){super(t,i),this.__items=new Array,this._stateArea=new CRect(0,0,20,20),this._levelLength=20;let s=this;this._items=new CStateTreeData(e,void 0),this._items.onChange.push((function(t,e,i){s.__items=s._items.getExpandedItems(),s.doSetScrollContent(),s.itemsDraw()}))}getLength(){return this.__items.length}doToData(t){super.doToData(t),CDataClass.putData(t,"stateArea",this.stateArea.toData(),{},!0),CDataClass.putData(t,"levelLength",this.levelLength,20)}doFromData(t){super.doFromData(t),this.stateArea.fromData(CDataClass.getData(t,"stateArea",{},!0)),this.levelLength=CDataClass.getData(t,"levelLength",20)}doBackgroundPointerUp(t,e){let i=this.yToIndex(this.scrollBox.scrollTop+t.offsetY),s=-1;if(s=i.isMargin||i.index>=this.length?-1:i.index,this.__downIdx==s&&(this.itemIndex=s,-1!=s)){if(this.doStateItem(i.index,t),this.useCheckBox){this.getItemPosition(i.index).offset(0,-this.scrollBox.scrollTop);let e=this.doCheckItem(i.index,t);e.result&&(this.checkItems.has(e.value)?this.checkItems.delete(e.value):this.checkItems.add(e.value))}this.doSelectItem(i.index,t),this.doItemClick(s)}null!=this.onBackgroundPointerUp&&this.onBackgroundPointerUp(this,t,e)}doStateItem(t,e){let i=this.getItemPosition(t);i.offset(this.__items[t].level*this._levelLength,-this.scrollBox.scrollTop),e.offsetX>=i.left+this.stateArea.left&&e.offsetX<=i.left+this.stateArea.right&&e.offsetY>=i.top+this.stateArea.top&&e.offsetY<=i.top+this.stateArea.bottom&&(this.__items[t].item.state==ETreeItemState.COLLAPSE?this.__items[t].item.state=ETreeItemState.EXPAND:this.__items[t].item.state=ETreeItemState.COLLAPSE)}doCheckItem(t,e){let i=this.getItemPosition(t);return i.offset(this.__items[t].level*this._levelLength,-this.scrollBox.scrollTop),this.useCheckBox&&e.offsetX>=i.left+this.checkBoxArea.left&&e.offsetX<=i.left+this.checkBoxArea.right&&e.offsetY>=i.top+this.checkBoxArea.top&&e.offsetY<=i.top+this.checkBoxArea.top+this.checkBoxArea.height?(null!=this.onCheckItem&&this.onCheckItem(this,this.__items[t].item),{result:!0,value:this.__items[t].item}):{result:!1,value:void 0}}doSelectItem(t,e){this.multiSelect&&e.ctrlKey?this._selecteItems.has(this.__items[t].item)?this.doDeleteSelectItems(this.__items[t].item):this.doAddSelectItems(this.__items[t].item):(this._selecteItems.clear(),this.doAddSelectItems(this.__items[t].item)),null!=this.onSelectItem&&this.onSelectItem(this)}doItemDraw(t,e,i,s){if(null!=CSystem.bufferingContext){let o=s.getItem("over");for(let t=0;t<o.length;t++)o[t].visible=e==this.__overIdx;o=s.getItem("select");for(let t=0;t<o.length;t++)o[t].visible=this._selecteItems.has(this.__items[e].item);o=s.getItem("itemindex");for(let t=0;t<o.length;t++)o[t].visible=e==this.itemIndex;o=s.getItem("checkBox");for(let t=0;t<o.length;t++)o[t].visible=this.useCheckBox;o=s.getItem("empty");for(let t=0;t<o.length;t++)o[t].visible="empty"==this.__items[e].item.getState();o=s.getItem("collapse");for(let t=0;t<o.length;t++)o[t].visible="empty"!=this.__items[e].item.getState()&&this.__items[e].item.state==ETreeItemState.COLLAPSE;o=s.getItem("expand");for(let t=0;t<o.length;t++)o[t].visible="empty"!=this.__items[e].item.getState()&&this.__items[e].item.state==ETreeItemState.EXPAND;o=s.getItem("check");for(let t=0;t<o.length;t++)o[t].visible=this.checkItems.has(this.__items[e].item)&&this.useCheckBox;i.left+=this.__items[e].level*this._levelLength,s.draw(t,i,this.__offset,CSystem.bufferingContext,1,1),super.doItemDraw(t,e,i,s)}}selectItem(t){this.multiSelect||this._selecteItems.clear(),this.doAddSelectItems(t),null!=this.onSelectItem&&this.onSelectItem(this)}clear(){this.itemIndex=-1,this._selecteItems.clear(),this.checkItems.clear(),this.items.clear()}selectClear(){this._selecteItems.clear(),this.itemIndex=-1,this.draw()}}class CTreeListBox extends CCustomTreeListBox{doItemDraw(t,e,i,s){let o=s.getItem("text");for(let t=0;t<o.length;t++)o[t].text=this.__items[e].item.value.text;super.doItemDraw(t,e,i,s)}doChangeDesignMode(){super.doChangeDesignMode()}}class CObjectTreeListBox extends CCustomTreeListBox{doItemDraw(t,e,i,s){let o=this.__items[e].item.value,a=Object.keys(o);for(let t=0;t<a.length;t++){let e=s.getItem(a[t]);for(let i=0;i<e.length;i++)e[i].text=o[a[t]]+""}super.doItemDraw(t,e,i,s)}doChangeDesignMode(){if(super.doChangeDesignMode(),this.isDesignMode){this.items.clear(),this.items.add({text:"Sample item1"});let t=this.items.add({text:"Sample item2"});t.addChild({text:"Sample item2_1"}),t.addChild({text:"Sample item2_2"}),t.addChild({text:"Sample item2_3"}),this.items.add({text:"Sample item3"}),this.items.expandAll()}}}class CListViewItem extends CButton{get index(){let t=this.listView.yToIndex(this.position.top).index;return t<0&&(t=0),t>this.listView.listItems.length-1&&(t=this.listView.listItems.length-1),t}constructor(t,e){super(t,e),this.orderControl=new CPanel(this);let i,s=this;s.orderControl.visible=!1,s.orderControl.position.align=EPositionAlign.PARENT_SIZE,s.orderControl.usePointerCapture=!0,s.orderControl.onResource=function(){s.orderControl.visible=!1,s.orderControl.position.align=EPositionAlign.PARENT_SIZE,s.orderControl.usePointerCapture=!0};let o=this.position.top,a=-1;this.orderControl.onThisPointerDown=function(t,e){i=e,o=s.position.top,s.bringToFront(),a=s.index,s.opacity=.5},this.orderControl.onThisPointerMove=function(t,e){if(null!=i){let t=o+(e.pageY-i.pageY);if(s.position.top=t,a!=s.index){let t,e=s.listView.getItemFromIndex(s.index);for(let i=0;i<e.length;i++)e[i]!=s&&(t=e[i]);if(null!=t){let e=s.listView.getItemPosition(a),i=t.position.top,o=e.top-i;CAnimation.graphAnimate(100,["acc_head_10000.graph"],(function(e,s,a,n,r){t.position.top=i+o*r}))}a=s.index}}},this.orderControl.onThisPointerUp=function(t,e){i=void 0;let o=s.listView.getItemPosition(s.index),a=s.position.top,n=o.top-a;CAnimation.graphAnimate(100,["acc_head_10000.graph"],(function(t,e,i,o,r){s.position.top=a+n*r})),s.listView.resetOrder(s),s.opacity=1}}doToData(t){super.doToData(t),CDataClass.putData(t,"orderControl",this.orderControl.toData(),{},!0)}doFromData(t){super.doFromData(t),this.orderControl.fromData(CDataClass.getData(t,"orderControl",{},!0))}}class CCustomListView extends CCustomListControl{get selectedItems(){let t=new Array;return this._selectItems.forEach((function(e){t.push(e)})),t}get selectedItem(){let t=this.selectedItems;if(t.length>0)return t[0]}get listItems(){return this._listItems}constructor(t,e){super(t,e),this._listItems=new CList,this._selectItems=new Set,this.listItemResource="";let i=this;this.scrollBox.content.onChangeSize=function(){for(let t=0;t<i.listItems.length;t++)i.setItemPosition(t,i.listItems.get(t))}}getLength(){return this._listItems.length}setAllItemPosition(){for(let t=0;t<this.listItems.length;t++)this.setItemPosition(t,this.listItems.get(t))}doSetListItem(t){null!=this.onSetListItem&&this.onSetListItem(this,t)}doItemClick(t){this.multiSelect?t.selected=!t.selected:t.selected=!0,this.doChangeItemSelect(t),null!=this.onListItemClick&&this.onListItemClick(this,t)}doAddItem(){let t=CControl.controlFromResource(this.listItemResource);t.listView=this,this._listItems.add(t),this.doSetScrollContent(),this.setItemPosition(this._listItems.length-1,t),t.parent=this.scrollBox.content;let e=this;return t.onClick=function(){e.doItemClick(t)},t}doInsertItem(t){let e=CControl.controlFromResource(this.listItemResource);this.doSetScrollContent();for(let e=t;e<this._listItems.length;e++)this.setItemPosition(e+1,this._listItems.get(e));e.listView=this,this._listItems.insert(t,e),this.setItemPosition(t,e),e.parent=this.scrollBox.content;let i=this;return e.onClick=function(){i.doItemClick(e)},e}doDeleteItem(t){if(!(t<0||t>=this.length)){this._selectItems.delete(this._listItems.get(t)),this._listItems.get(t).remove(),this._listItems.delete(t);for(let e=t;e<this._listItems.length;e++)this.setItemPosition(e,this._listItems.get(e));this.doSetScrollContent()}}doClear(){for(let t=0;t<this._listItems.length;t++)this._listItems.get(t).remove();this._listItems.clear(),this._selectItems.clear(),this.doSetScrollContent()}doChangeMultiSelect(){super.doChangeMultiSelect()}doChangeItemSelect(t){t.selected?(this.multiSelect||(this._selectItems.forEach((function(e){e!=t&&(e.selected=!1)})),this._selectItems.clear()),this._selectItems.add(t)):this.multiSelect?this._selectItems.delete(t):(this._selectItems.forEach((function(e){e!=t&&(e.selected=!1)})),this._selectItems.clear()),null!=this.onChangeItemSelect&&this.onChangeItemSelect(this,t)}doResetOrder(t){this.listItems.sort((function(t,e){let i=0;return t.index<e.index&&(i=-1),t.index>e.index&&(i=1),i})),null!=this.onResetOrder&&this.onResetOrder(this,t)}setItemPosition(t,e){let i=this.getItemPosition(t);e.position.left=i.left,e.position.top=i.top,e.position.width=i.width,e.position.height=i.height}addItem(){return this.doAddItem()}insertItem(t){return this.doInsertItem(t)}deleteItem(t){this.doDeleteItem(t)}clear(){this.doClear()}getShowItems(){let t=new Array,e=this.getScrollShowPositions();for(let i=0;i<e.length;i++)t.push(this.listItems.get(e[i].index));return t}getItemFromIndex(t){let e=new Array;for(let i=0;i<this.listItems.length;i++)this.listItems.get(i).index==t&&e.push(this.listItems.get(i));return e}resetOrder(t){this.doResetOrder(t)}showOrderControl(){for(let t=0;t<this.listItems.length;t++)this.listItems.get(t).orderControl.bringToFront(),this.listItems.get(t).orderControl.visible=!0}hideOrderControl(){for(let t=0;t<this.listItems.length;t++)this.listItems.get(t).orderControl.visible=!1}}class CListView extends CCustomListView{constructor(t,e){super(t,e)}}class CCustomPickupButton extends CButton{get pickupClientControl(){return this._pickupClientControl}set pickupClientControl(t){this._pickupClientControl=t}doBeforePickupShow(t){super.doBeforePickupShow(t),null!=this._pickupClientControl&&(this._pickupClientControl.parent=t,this._pickupClientControl.position.align=EPositionAlign.CLIENT)}doBeforePickupRemove(t){null!=this._pickupClientControl&&(this._pickupClientControl.parent=void 0),super.doBeforePickupRemove(t)}}class CComboBox extends CButton{get itemIndex(){return this._itemIndex}set itemIndex(t){let e=t;e<-1&&(e=-1),e>this._list.length-1&&(e=this._list.length-1),this._itemIndex!=e&&(this._itemIndex=e,this.doChangeItem())}get comboText(){return this.items.get(this.itemIndex)}get selectText(){return this._selectText}set selectText(t){this._selectText=t,-1==this.itemIndex&&(this.text=t)}get listBox(){return this._list}get listBoxResource(){return this._listBoxResource}set listBoxResource(t){this._listBoxResource=t,this._list.resource=t}get listScrollbarResource(){return this._listScrollbarResource}set listScrollbarResource(t){this._listScrollbarResource=t,this._list.scrollbarResource=t}get items(){return this._list.items}constructor(t,e){super(t,e),this._itemIndex=-1,this._list=new CListBox,this._selectText="",this._listBoxResource="",this._listScrollbarResource="";let i=this;this.listBox.onItemClick=function(){i.doPointerOut(new PointerEvent("")),i.itemIndex=i.listBox.itemIndex,i.listBox.parent.hide()}}doToData(t){super.doToData(t),CDataClass.putData(t,"selectText",this.selectText,""),CDataClass.putData(t,"listBoxResource",this.listBoxResource,""),CDataClass.putData(t,"listScrollbarResource",this.listScrollbarResource,"")}doFromData(t){super.doFromData(t),this.selectText=CDataClass.getData(t,"selectText",""),this.listBoxResource=CDataClass.getData(t,"listBoxResource",""),this.listScrollbarResource=CDataClass.getData(t,"listScrollbarResource","")}doBeforePickupShow(t){if(super.doBeforePickupShow(t),this._list.parent=t,this._list.hasFocus=!0,this._list.position.align=EPositionAlign.CLIENT,this._list.scrollTop=0,this._list.scrollBox.doScroll(),this._list.filter.filterSet.shadow=!0,this._list.filter.shadowX=0,this._list.filter.shadowY=0,this._list.filter.shadowColor="rgba(0,0,0,0.5)",this._list.length>0){let e=t.position.padding.top+t.position.padding.bottom+this._list.position.margins.top+this._list.position.margins.bottom+this._list.position.padding.top+this._list.position.padding.bottom+this._list.rowHeight*this.items.length+this._list.itemMargin*(this.items.length-1);t.position.height>e&&(t.position.height=e)}else t.position.height=20}doBeforePickupRemove(t){this._list.parent=void 0,super.doBeforePickupRemove(t)}doChangeItem(){-1==this.itemIndex?this.text=this.selectText:this.text=this._list.items.get(this._itemIndex),null!=this.onChangeItem&&this.onChangeItem(this)}addProperties(){let t=super.addProperties();return t.push({instance:this.items,propertyName:"items",readOnly:!1,enum:[]}),t}}class CLanguageComboBox extends CComboBox{constructor(t,e){super(t,e),this._isDoSet=!0;let i=this;for(let t=0;t<CLanguage.localNames.length;t++)i.items.add(CLanguage.localNames[t])}doChangeItem(){this.doSetDictionary(CLanguage.codes[this.itemIndex]),super.doChangeItem()}async doSetDictionary(t){this._isDoSet&&(null!=this.onSetDictionary&&await this.onSetDictionary(this,t),CLanguage.localCode=CLanguage.codes[this.itemIndex])}setLocalCodeWithoutUpdate(t){let e=CLanguage.getLanguageFromCode(t);if(e){this._isDoSet=!1;for(let t=0;t<this.items.length;t++)if(this.items.get(t)==e.localName){this.itemIndex=t;break}this._isDoSet=!0}}}class CSplitter extends CPanel{constructor(t,e){super(t,e),this.__downValue=0,this.usePointerCapture=!0}doThisPointerDown(t,e){super.doThisPointerDown(t,e),1==this.pressedThisPoints.length&&(this.__down=t,this.__hcon=this.getHandlingControl(),null!=this.__hcon&&(this.position.align!=EPositionAlign.LEFT&&this.position.align!=EPositionAlign.RIGHT||(this.__downValue=this.__hcon.position.width),this.position.align!=EPositionAlign.TOP&&this.position.align!=EPositionAlign.BOTTOM||(this.__downValue=this.__hcon.position.height)))}doThisPointerMove(t,e){super.doThisPointerMove(t,e),this.isPress&&null!=this.__down&&this.__hcon&&this.pressedThisPoints.length>0&&(this.position.align==EPositionAlign.LEFT&&(this.__hcon.position.width=this.__downValue+(t.pageX-this.__down.pageX)),this.position.align==EPositionAlign.RIGHT&&(this.__hcon.position.width=this.__downValue-(t.pageX-this.__down.pageX)),this.position.align==EPositionAlign.TOP&&(this.__hcon.position.height=this.__downValue+(t.pageY-this.__down.pageY)),this.position.align==EPositionAlign.BOTTOM&&(this.__hcon.position.height=this.__downValue-(t.pageY-this.__down.pageY)))}getHandlingControl(){let t,e=CSystem.getBroControls(this),i=-1;for(let s=e.length-1;s>=0;s--)if(this!=e[s]){if(-1!=i&&this.position.align==e[s].position.align&&e[s].visible){t=e[s];break}}else i=s;return t}}class CCustomUnlimitedScrollBoxControl extends CPanel{get scrollMinX(){return this.scrollBox.scrollMinX}set scrollMinX(t){this.scrollBox.scrollMinX=t}get scrollMaxX(){return this.scrollBox.scrollMaxX}set scrollMaxX(t){this.scrollBox.scrollMaxX=t}get scrollMinY(){return this.scrollBox.scrollMinY}set scrollMinY(t){this.scrollBox.scrollMinY=t}get scrollMaxY(){return this.scrollBox.scrollMaxY}set scrollMaxY(t){this.scrollBox.scrollMaxY=t}get scrollX(){return this.scrollBox.scrollX}set scrollX(t){this.scrollBox.scrollX=t}get scrollY(){return this.scrollBox.scrollY}set scrollY(t){this.scrollBox.scrollY=t}get backgroundArea(){return new CRect(this.scrollBox.background.position.left,this.scrollBox.background.position.top,this.scrollBox.background.position.right,this.scrollBox.background.position.bottom)}constructor(t,e){super(t,e),this.scrollBox=new CUnlimitedScrollBox(this);let i=this;this.scrollBox.position.align=EPositionAlign.CLIENT,this.scrollBox.onSetInnerSize=function(){i.doSetInnerSize()},this.scrollBox.onChangeScrollValue=function(){i.doScrollBoxUpdate(),i.doScroll(i.scrollBox.scrollX,i.scrollBox.scrollY)},this.scrollBox.background.onThisPointerDown=function(t,e,s){i.doBackgoundPointerDown(e,s)},this.scrollBox.background.onThisPointerMove=function(t,e,s){i.doBackgoundPointerMove(e,s)},this.scrollBox.background.onThisPointerUp=function(t,e,s){i.doBackgoundPointerUp(e,s)},this.scrollBox.background.onThisPointerCancel=function(t,e,s){i.doBackgoundPointerCancel(e,s)},this.scrollBox.background.onThisPointerOver=function(t,e,s){i.doBackgoundPointerOver(e,s)},this.scrollBox.background.onThisPointerOut=function(t,e,s){i.doBackgoundPointerOut(e,s)},this.scrollBox.background.onThisPointerEnter=function(t,e,s){i.doBackgoundPointerEnter(e,s)},this.scrollBox.background.onThisPointerLeave=function(t,e,s){i.doBackgoundPointerLeave(e,s)}}doChildDataMapHandle(t){super.doChildDataMapHandle(t),t.delete(this.scrollBox)}doSetInnerSize(){this.doScrollBoxUpdate(),null!=this.onSetInnerSize&&this.onSetInnerSize(this)}doScrollBoxUpdate(){null!=this.onScrollBoxUpdate&&this.onScrollBoxUpdate(this)}doBackgoundPointerDown(t,e){null!=this.onBackgoundPointerDown&&this.onBackgoundPointerDown(this,t,e)}doBackgoundPointerMove(t,e){null!=this.onBackgoundPointerMove&&this.onBackgoundPointerMove(this,t,e)}doBackgoundPointerUp(t,e){null!=this.onBackgoundPointerUp&&this.onBackgoundPointerUp(this,t,e)}doBackgoundPointerCancel(t,e){null!=this.onBackgoundPointerCancel&&this.onBackgoundPointerCancel(this,t,e)}doBackgoundPointerOver(t,e){null!=this.onBackgoundPointerOver&&this.onBackgoundPointerOver(this,t,e)}doBackgoundPointerOut(t,e){null!=this.onBackgoundPointerOut&&this.onBackgoundPointerOut(this,t,e)}doBackgoundPointerEnter(t,e){null!=this.onBackgoundPointerEnter&&this.onBackgoundPointerEnter(this,t,e)}doBackgoundPointerLeave(t,e){null!=this.onBackgoundPointerLeave&&this.onBackgoundPointerLeave(this,t,e)}doScroll(t,e){null!=this.onScroll&&this.onScroll(this,t,e)}doChangeDesignMode(){super.doChangeDesignMode(),this.isDesignMode?(this.__designOrgData.scrollBox=this.scrollBox.hasPointerEvent,this.__designOrgData.background=this.scrollBox.background.hasPointerEvent,this.__designOrgData.hScrollbar=this.scrollBox.hScrollbar.hasPointerEvent,this.__designOrgData.vScrollbar=this.scrollBox.vScrollbar.hasPointerEvent,this.scrollBox.hasPointerEvent=!1,this.scrollBox.background.hasPointerEvent=!1,this.scrollBox.hScrollbar.hasPointerEvent=!1,this.scrollBox.vScrollbar.hasPointerEvent=!1):(this.scrollBox.hasPointerEvent=this.__designOrgData.scrollBox,this.scrollBox.background.hasPointerEvent=this.__designOrgData.background,this.scrollBox.hScrollbar.hasPointerEvent=this.__designOrgData.hScrollbar,this.scrollBox.vScrollbar.hasPointerEvent=this.__designOrgData.vScrollbar)}}class CCellSelectInfo extends CNotifyChangeKindObject{get startCell(){return this._startCell}get stopCell(){return this._stopCell}constructor(){super(),this._startCell=new CNotifyPoint(0,0),this._stopCell=new CNotifyPoint(0,0);let t=this;this._startCell.onChange=function(){t.doChange("startCell")},this._stopCell.onChange=function(){t.doChange("stopCell")}}doToData(t){super.doToData(t),CDataClass.putData(t,"startCell",this.startCell.toData(),{},!0),CDataClass.putData(t,"stopCell",this.stopCell.toData(),{},!0)}doFromData(t){super.doFromData(t),this.startCell.fromData(CDataClass.getData(t,"startCell",{},!0)),this.stopCell.fromData(CDataClass.getData(t,"stopCell",{},!0))}isIn(t){let e=CCalc.minMaxPoint(this._startCell.toPoint(),this._stopCell.toPoint());return t.x>=e.min.x&&t.x<=e.max.x&&t.y>=e.min.y&&t.y<=e.max.y}}class CCellSelectInfoList extends CList{doToData(t){super.doToData(t);for(let e=0;e<this.length;e++)t.push(this.get(e).toData())}doFromData(t){super.doFromData(t),this.clear();for(let e=0;e<t.length;e++){let i=new CCellSelectInfo;i.fromData(t[e]),this.add(i)}}addSelectInfo(t,e,i,s){let o=new CCellSelectInfo;return o.startCell.x=t,o.startCell.y=e,o.stopCell.x=i,o.stopCell.y=s,this.add(o),o}}class CGridInfo extends CNotifyChangeKindObject{static get CON_CHANGE_USE_HEADER(){return"useHeader"}static get CON_CHANGE_HEADER_COUNT(){return"headerCount"}static get CON_CHANGE_HEADER_ROW_HEIGHT(){return"headerRowHeight"}static get CON_CHANGE_MERGE_HEADER_CELL(){return"mergeHeaderCell"}static get CON_CHANGE_USE_INDICATOR(){return"useIndicator"}static get CON_CHANGE_INDICATOR_WIDTH(){return"indicatorWidth"}static get CON_CHANGE_DEFAULT_COLUMN_WIDTH(){return"defaultColumnWidth"}static get CON_CHANGE_DEFAULT_ROW_HEIGHT(){return"defaultRowHeight"}static get CON_CHANGE_CELL_MARGIN(){return"cellMargin"}static get CON_CHANGE_FIX_COUNT(){return"fixCount"}static get CON_CHANGE_DIFF_COLUMN_SIZE(){return"diffColumnSize"}static get CON_CHANGE_DIFF_ROW_SIZE(){return"diffRowSize"}static get CON_CHANGE_MERGE_CELL(){return"mergeCell"}static get CON_CHANGE_USE_FIT_WIDTH(){return"useFitWidth"}static get CON_CHANGE_COLUMN_COUNT(){return"columnCount"}static get CON_CHANGE_ROW_COUNT(){return"rowCount"}get useHeader(){return this._useHeader}set useHeader(t){this._useHeader!=t&&(this._useHeader=t,this.doChange(CGridInfo.CON_CHANGE_USE_HEADER))}get headerCount(){return this._headerCount}set headerCount(t){this._headerCount!=t&&(this._headerCount=t,this.doChange(CGridInfo.CON_CHANGE_HEADER_COUNT))}get headerRowHeight(){return this._headerRowHeight}set headerRowHeight(t){this._headerRowHeight!=t&&(this._headerRowHeight=t,this.doChange(CGridInfo.CON_CHANGE_HEADER_ROW_HEIGHT))}get useIndicator(){return this._useIndicator}set useIndicator(t){this._useIndicator!=t&&(this._useIndicator=t,this.doChange(CGridInfo.CON_CHANGE_USE_INDICATOR))}get indicatorWidth(){return this._indicatorWidth}set indicatorWidth(t){this._indicatorWidth!=t&&(this._indicatorWidth=t,this.doChange(CGridInfo.CON_CHANGE_INDICATOR_WIDTH))}get defaultColumnWidth(){return this._defaultColumnWidth}set defaultColumnWidth(t){this._defaultColumnWidth!=t&&(this._defaultColumnWidth=t,this.doChange(CGridInfo.CON_CHANGE_DEFAULT_COLUMN_WIDTH))}get defaultRowHeight(){return this._defaultRowHeight}set defaultRowHeight(t){this._defaultRowHeight!=t&&(this._defaultRowHeight=t,this.doChange(CGridInfo.CON_CHANGE_DEFAULT_ROW_HEIGHT))}get cellMargin(){return this._cellMargin}set cellMargin(t){this._cellMargin!=t&&(this._cellMargin=t,this.doChange(CGridInfo.CON_CHANGE_CELL_MARGIN))}get useFitWidth(){return this._useFitWidth}set useFitWidth(t){this._useFitWidth!=t&&(this._useFitWidth=t,this.doChange(CGridInfo.CON_CHANGE_USE_FIT_WIDTH))}get columnCount(){return this._columnCount}set columnCount(t){this._columnCount!=t&&(this._columnCount=t,this.doChange(CGridInfo.CON_CHANGE_COLUMN_COUNT))}get rowCount(){return this._rowCount}set rowCount(t){this._rowCount!=t&&(this._rowCount=t,this.doChange(CGridInfo.CON_CHANGE_COLUMN_COUNT))}constructor(){super(),this._useHeader=!0,this._headerCount=1,this._headerRowHeight=20,this.mergeHeaderCell=new CCellSelectInfoList,this._useIndicator=!0,this._indicatorWidth=50,this.fixLeft=new CNumberList,this.fixTop=new CNumberList,this.fixRight=new CNumberList,this.fixBottom=new CNumberList,this._defaultColumnWidth=100,this._defaultRowHeight=20,this._cellMargin=0,this.diffColumnSize=new CNNMap,this.diffRowSize=new CNNMap,this.mergeCell=new CCellSelectInfoList,this._useFitWidth=!1,this._columnCount=10,this._rowCount=0,this.useResizeColumn=!1,this.useResizeRow=!1,this.resizeGripLength=5;let t=this;this.mergeHeaderCell.onChange=function(){t.doChange(CGridInfo.CON_CHANGE_MERGE_HEADER_CELL)},this.fixLeft.onChange=function(){t.doChange(CGridInfo.CON_CHANGE_FIX_COUNT)},this.fixTop.onChange=function(){t.doChange(CGridInfo.CON_CHANGE_FIX_COUNT)},this.fixRight.onChange=function(){t.doChange(CGridInfo.CON_CHANGE_FIX_COUNT)},this.fixBottom.onChange=function(){t.doChange(CGridInfo.CON_CHANGE_FIX_COUNT)},this.diffColumnSize.onChange=function(){t.doChange(CGridInfo.CON_CHANGE_DIFF_COLUMN_SIZE)},this.diffRowSize.onChange=function(){t.doChange(CGridInfo.CON_CHANGE_DIFF_ROW_SIZE)},this.mergeCell.onChange=function(){t.doChange(CGridInfo.CON_CHANGE_MERGE_CELL)}}doToData(t){super.doToData(t),CDataClass.putData(t,"useHeader",this.useHeader,!0),CDataClass.putData(t,"headerCount",this.headerCount,1),CDataClass.putData(t,"headerRowHeight",this.headerRowHeight,20),CDataClass.putData(t,"mergeHeaderCell",this.mergeHeaderCell.toData(),[],!0),CDataClass.putData(t,"fixLeft",this.fixLeft.toData(),[],!0),CDataClass.putData(t,"fixTop",this.fixTop.toData(),[],!0),CDataClass.putData(t,"fixRight",this.fixRight.toData(),[],!0),CDataClass.putData(t,"fixBottom",this.fixBottom.toData(),[],!0),CDataClass.putData(t,"defaultColumnWidth",this.defaultColumnWidth,100),CDataClass.putData(t,"defaultRowHeight",this.defaultRowHeight,20),CDataClass.putData(t,"cellMargin",this.cellMargin,0),CDataClass.putData(t,"diffColumnSize",this.diffColumnSize.toData(),[],!0),CDataClass.putData(t,"diffRowSize",this.diffRowSize.toData(),[],!0),CDataClass.putData(t,"mergeCell",this.mergeCell.toData(),[],!0),CDataClass.putData(t,"useFitWidth",this.useFitWidth,!1),CDataClass.putData(t,"columnCount",this.columnCount,10),CDataClass.putData(t,"rowCount",this.rowCount,0),CDataClass.putData(t,"useResizeColumn",this.useResizeColumn,!1),CDataClass.putData(t,"useResizeRow",this.useResizeRow,!1),CDataClass.putData(t,"useIndicator",this.useIndicator,!0),CDataClass.putData(t,"resizeGripLength",this.resizeGripLength,5),CDataClass.putData(t,"indicatorWidth",this.indicatorWidth,50)}doFromData(t){super.doFromData(t),this.useHeader=CDataClass.getData(t,"useHeader",!0),this.headerCount=CDataClass.getData(t,"headerCount",1),this.headerRowHeight=CDataClass.getData(t,"headerRowHeight",20),this.mergeHeaderCell.fromData(CDataClass.getData(t,"mergeHeaderCell",[],!0)),this.fixLeft.fromData(CDataClass.getData(t,"fixLeft",[],!0)),this.fixTop.fromData(CDataClass.getData(t,"fixTop",[],!0)),this.fixRight.fromData(CDataClass.getData(t,"fixRight",[],!0)),this.fixBottom.fromData(CDataClass.getData(t,"fixBottom",[],!0)),this.defaultColumnWidth=CDataClass.getData(t,"defaultColumnWidth",100),this.defaultRowHeight=CDataClass.getData(t,"defaultRowHeight",20),this.cellMargin=CDataClass.getData(t,"cellMargin",0),this.diffColumnSize.fromData(CDataClass.getData(t,"diffColumnSize",[],!0)),this.diffRowSize.fromData(CDataClass.getData(t,"diffRowSize",[],!0)),this.mergeCell.fromData(CDataClass.getData(t,"mergeCell",[],!0)),this.useFitWidth=CDataClass.getData(t,"useFitWidth",!1),this.columnCount=CDataClass.getData(t,"columnCount",10),this.rowCount=CDataClass.getData(t,"rowCount",0),this.useResizeColumn=CDataClass.getData(t,"useResizeColumn",!1),this.useResizeRow=CDataClass.getData(t,"useResizeRow",!1),this.useIndicator=CDataClass.getData(t,"useIndicator",!0),this.resizeGripLength=CDataClass.getData(t,"resizeGripLength",5),this.indicatorWidth=CDataClass.getData(t,"indicatorWidth",50)}}!function(t){t[t.NONE=0]="NONE",t[t.HEADER_BUTTON=1]="HEADER_BUTTON",t[t.HEADER_LEFT_FIX=2]="HEADER_LEFT_FIX",t[t.HEADER_CLIENT=3]="HEADER_CLIENT",t[t.HEADER_RIGHT_FIX=4]="HEADER_RIGHT_FIX",t[t.INDICATOR_TOP_FIX=5]="INDICATOR_TOP_FIX",t[t.INDICATOR_CLIENT=6]="INDICATOR_CLIENT",t[t.INDICATOR_BOTTOM_FIX=7]="INDICATOR_BOTTOM_FIX",t[t.TOP_LEFT_FIX=8]="TOP_LEFT_FIX",t[t.TOP_CLIENT_FIX=9]="TOP_CLIENT_FIX",t[t.TOP_RIGHT_FIX=10]="TOP_RIGHT_FIX",t[t.BOTTOM_LEFT_FIX=11]="BOTTOM_LEFT_FIX",t[t.BOTTOM_CLIENT_FIX=12]="BOTTOM_CLIENT_FIX",t[t.BOTTOM_RIGHT_FIX=13]="BOTTOM_RIGHT_FIX",t[t.LEFT_FIX=14]="LEFT_FIX",t[t.RIGHT_FIX=15]="RIGHT_FIX",t[t.CLIENT=16]="CLIENT"}(EPointerAreaKind||(EPointerAreaKind={}));class CCustomGrid extends CCustomUnlimitedScrollBoxControl{get scrollbarResource(){return this.scrollBox.scrollbarResource}set scrollbarResource(t){this.scrollBox.scrollbarResource=t}get scrollbarLength(){return this.scrollBox.scrollbarLength}set scrollbarLength(t){this.scrollBox.scrollbarLength=t}constructor(t,e){super(t,e),this.__cellInfo={kind:EPointerAreaKind.NONE,col:-1,row:-1,x:-1,y:-1},this.__downCellInfo={kind:EPointerAreaKind.NONE,col:-1,row:-1,width:-1,height:-1,resizeCol:!1,resizeRow:!1,offsetx:-1,offsety:-1},this.__preClickTime=-1,this.__area=EPointerAreaKind.NONE,this.cellPressed=!1,this.gridInfo=new CGridInfo,this.editable=!1;let i=this;this.gridInfo.onChange=function(t,e){i.doChangeGridInfo(e)},this.doScrollBoxUpdate()}doToData(t){super.doToData(t),CDataClass.putData(t,"gridInfo",this.gridInfo.toData(),{},!0),CDataClass.putData(t,"editable",this.editable,!1),CDataClass.putData(t,"scrollbarResource",this.scrollbarResource,""),CDataClass.putData(t,"scrollbarLength",this.scrollbarLength,15)}doFromData(t){super.doFromData(t),this.gridInfo.fromData(CDataClass.getData(t,"gridInfo",{},!0)),this.editable=CDataClass.getData(t,"editable",!1),this.scrollbarResource=CDataClass.getData(t,"scrollbarResource",""),this.scrollbarLength=CDataClass.getData(t,"scrollbarLength",15)}doBackgoundPointerDown(t,e){super.doBackgoundPointerDown(t,e),this.setBackgroundArea("down",t,e)}doBackgoundPointerMove(t,e){super.doBackgoundPointerMove(t,e),this.setBackgroundArea("move",t,e)}doBackgoundPointerUp(t,e){super.doBackgoundPointerUp(t,e),this.setBackgroundArea("up",t,e),this.cellPressed=!1}doBackgoundPointerOut(t,e){super.doBackgoundPointerOut(t,e),this.doGridPointerOut(this.__area,t,e),this.__area=EPointerAreaKind.NONE}out(t,e){this.__area==EPointerAreaKind.HEADER_BUTTON&&this.doGridPointerOut(EPointerAreaKind.HEADER_BUTTON,t,e),this.__area==EPointerAreaKind.HEADER_LEFT_FIX&&this.doGridPointerOut(EPointerAreaKind.HEADER_LEFT_FIX,t,e),this.__area==EPointerAreaKind.HEADER_CLIENT&&this.doGridPointerOut(EPointerAreaKind.HEADER_CLIENT,t,e),this.__area==EPointerAreaKind.HEADER_RIGHT_FIX&&this.doGridPointerOut(EPointerAreaKind.HEADER_RIGHT_FIX,t,e),this.__area==EPointerAreaKind.INDICATOR_TOP_FIX&&this.doGridPointerOut(EPointerAreaKind.INDICATOR_TOP_FIX,t,e),this.__area==EPointerAreaKind.INDICATOR_CLIENT&&this.doGridPointerOut(EPointerAreaKind.INDICATOR_CLIENT,t,e),this.__area==EPointerAreaKind.INDICATOR_BOTTOM_FIX&&this.doGridPointerOut(EPointerAreaKind.INDICATOR_BOTTOM_FIX,t,e),this.__area==EPointerAreaKind.LEFT_FIX&&this.doGridPointerOut(EPointerAreaKind.LEFT_FIX,t,e),this.__area==EPointerAreaKind.TOP_LEFT_FIX&&this.doGridPointerOut(EPointerAreaKind.TOP_LEFT_FIX,t,e),this.__area==EPointerAreaKind.TOP_CLIENT_FIX&&this.doGridPointerOut(EPointerAreaKind.TOP_CLIENT_FIX,t,e),this.__area==EPointerAreaKind.TOP_RIGHT_FIX&&this.doGridPointerOut(EPointerAreaKind.TOP_RIGHT_FIX,t,e),this.__area==EPointerAreaKind.RIGHT_FIX&&this.doGridPointerOut(EPointerAreaKind.RIGHT_FIX,t,e),this.__area==EPointerAreaKind.BOTTOM_LEFT_FIX&&this.doGridPointerOut(EPointerAreaKind.BOTTOM_LEFT_FIX,t,e),this.__area==EPointerAreaKind.BOTTOM_CLIENT_FIX&&this.doGridPointerOut(EPointerAreaKind.BOTTOM_CLIENT_FIX,t,e),this.__area==EPointerAreaKind.BOTTOM_RIGHT_FIX&&this.doGridPointerOut(EPointerAreaKind.BOTTOM_RIGHT_FIX,t,e),this.__area==EPointerAreaKind.CLIENT&&this.doGridPointerOut(EPointerAreaKind.CLIENT,t,e),this.__area=EPointerAreaKind.NONE}over(t,e){this.__area==EPointerAreaKind.HEADER_BUTTON&&this.doGridPointerOver(EPointerAreaKind.HEADER_BUTTON,t,e),this.__area==EPointerAreaKind.HEADER_LEFT_FIX&&this.doGridPointerOver(EPointerAreaKind.HEADER_LEFT_FIX,t,e),this.__area==EPointerAreaKind.HEADER_CLIENT&&this.doGridPointerOver(EPointerAreaKind.HEADER_CLIENT,t,e),this.__area==EPointerAreaKind.HEADER_RIGHT_FIX&&this.doGridPointerOver(EPointerAreaKind.HEADER_RIGHT_FIX,t,e),this.__area==EPointerAreaKind.INDICATOR_TOP_FIX&&this.doGridPointerOver(EPointerAreaKind.INDICATOR_TOP_FIX,t,e),this.__area==EPointerAreaKind.INDICATOR_CLIENT&&this.doGridPointerOver(EPointerAreaKind.INDICATOR_CLIENT,t,e),this.__area==EPointerAreaKind.INDICATOR_BOTTOM_FIX&&this.doGridPointerOver(EPointerAreaKind.INDICATOR_BOTTOM_FIX,t,e),this.__area==EPointerAreaKind.LEFT_FIX&&this.doGridPointerOver(EPointerAreaKind.LEFT_FIX,t,e),this.__area==EPointerAreaKind.TOP_LEFT_FIX&&this.doGridPointerOver(EPointerAreaKind.TOP_LEFT_FIX,t,e),this.__area==EPointerAreaKind.TOP_CLIENT_FIX&&this.doGridPointerOver(EPointerAreaKind.TOP_CLIENT_FIX,t,e),this.__area==EPointerAreaKind.TOP_RIGHT_FIX&&this.doGridPointerOver(EPointerAreaKind.TOP_RIGHT_FIX,t,e),this.__area==EPointerAreaKind.RIGHT_FIX&&this.doGridPointerOver(EPointerAreaKind.RIGHT_FIX,t,e),this.__area==EPointerAreaKind.BOTTOM_LEFT_FIX&&this.doGridPointerOver(EPointerAreaKind.BOTTOM_LEFT_FIX,t,e),this.__area==EPointerAreaKind.BOTTOM_CLIENT_FIX&&this.doGridPointerOver(EPointerAreaKind.BOTTOM_CLIENT_FIX,t,e),this.__area==EPointerAreaKind.BOTTOM_RIGHT_FIX&&this.doGridPointerOver(EPointerAreaKind.BOTTOM_RIGHT_FIX,t,e),this.__area==EPointerAreaKind.CLIENT&&this.doGridPointerOver(EPointerAreaKind.CLIENT,t,e)}setBackgroundArea(t,e,i){let s=this.getBackgroundHeaderBounds(),o=this.getBackgroundHeaderButtonBounds(),a=this.getBackgroundIndicatorBounds(),n=this.getBackgroundLeftFixBounds(),r=this.getBackgroundTopFixBounds(),l=this.getBackgroundRightFixBounds(),h=this.getBackgroundBottomFixBounds(),d=this.getBackgroundClientBounds();s.isIn(e.offsetX,e.offsetY)&&(e.offsetX>=n.left&&e.offsetX<n.right?this.__area!=EPointerAreaKind.HEADER_LEFT_FIX&&(this.out(e,i),this.__area=EPointerAreaKind.HEADER_LEFT_FIX,this.over(e,i)):e.offsetX>=l.left&&e.offsetX<l.right?this.__area!=EPointerAreaKind.HEADER_RIGHT_FIX&&(this.out(e,i),this.__area=EPointerAreaKind.HEADER_RIGHT_FIX,this.over(e,i)):this.__area!=EPointerAreaKind.HEADER_CLIENT&&(this.out(e,i),this.__area=EPointerAreaKind.HEADER_CLIENT,this.over(e,i)),this.__area==EPointerAreaKind.HEADER_LEFT_FIX&&this.eventExec(t,this.__area,e.offsetX-o.width,e.offsetY,e,i),this.__area==EPointerAreaKind.HEADER_CLIENT&&this.eventExec(t,this.__area,e.offsetX-n.right,e.offsetY,e,i),this.__area==EPointerAreaKind.HEADER_RIGHT_FIX&&this.eventExec(t,this.__area,e.offsetX-d.right,e.offsetY,e,i)),o.isIn(e.offsetX,e.offsetY)&&(this.__area!=EPointerAreaKind.HEADER_BUTTON&&(this.out(e,i),this.__area=EPointerAreaKind.HEADER_BUTTON,this.over(e,i)),this.eventExec(t,this.__area,e.offsetX,e.offsetY,e,i)),a.isIn(e.offsetX,e.offsetY)&&(e.offsetY>=r.top&&e.offsetY<r.bottom?this.__area!=EPointerAreaKind.INDICATOR_TOP_FIX&&(this.out(e,i),this.__area=EPointerAreaKind.INDICATOR_TOP_FIX,this.over(e,i)):e.offsetY>=h.top&&e.offsetY<h.bottom?this.__area!=EPointerAreaKind.INDICATOR_BOTTOM_FIX&&(this.out(e,i),this.__area=EPointerAreaKind.INDICATOR_BOTTOM_FIX,this.over(e,i)):this.__area!=EPointerAreaKind.INDICATOR_CLIENT&&(this.out(e,i),this.__area=EPointerAreaKind.INDICATOR_CLIENT,this.over(e,i)),this.__area==EPointerAreaKind.INDICATOR_TOP_FIX&&this.eventExec(t,this.__area,e.offsetX,e.offsetY-o.height,e,i),this.__area==EPointerAreaKind.INDICATOR_CLIENT&&this.eventExec(t,this.__area,e.offsetX,e.offsetY-r.bottom,e,i),this.__area==EPointerAreaKind.INDICATOR_BOTTOM_FIX&&this.eventExec(t,this.__area,e.offsetX,e.offsetY-d.bottom,e,i)),n.isIn(e.offsetX,e.offsetY)&&(this.__area!=EPointerAreaKind.LEFT_FIX&&(this.out(e,i),this.__area=EPointerAreaKind.LEFT_FIX,this.over(e,i)),this.eventExec(t,this.__area,e.offsetX-o.width,e.offsetY-r.bottom,e,i)),r.isIn(e.offsetX,e.offsetY)&&(e.offsetX>=n.left&&e.offsetX<n.right?this.__area!=EPointerAreaKind.TOP_LEFT_FIX&&(this.out(e,i),this.__area=EPointerAreaKind.TOP_LEFT_FIX,this.over(e,i)):e.offsetX>=l.left&&e.offsetX<l.right?this.__area!=EPointerAreaKind.TOP_RIGHT_FIX&&(this.out(e,i),this.__area=EPointerAreaKind.TOP_RIGHT_FIX,this.over(e,i)):this.__area!=EPointerAreaKind.TOP_CLIENT_FIX&&(this.out(e,i),this.__area=EPointerAreaKind.TOP_CLIENT_FIX,this.over(e,i)),this.__area==EPointerAreaKind.TOP_LEFT_FIX&&this.eventExec(t,this.__area,e.offsetX-o.width,e.offsetY-s.bottom,e,i),this.__area==EPointerAreaKind.TOP_CLIENT_FIX&&this.eventExec(t,this.__area,e.offsetX-n.right,e.offsetY-s.bottom,e,i),this.__area==EPointerAreaKind.TOP_RIGHT_FIX&&this.eventExec(t,this.__area,e.offsetX-d.right,e.offsetY-s.bottom,e,i)),l.isIn(e.offsetX,e.offsetY)&&(this.__area!=EPointerAreaKind.RIGHT_FIX&&(this.out(e,i),this.__area=EPointerAreaKind.RIGHT_FIX,this.over(e,i)),this.eventExec(t,this.__area,e.offsetX-d.right,e.offsetY-r.bottom,e,i)),h.isIn(e.offsetX,e.offsetY)&&(e.offsetX>=n.left&&e.offsetX<n.right?this.__area!=EPointerAreaKind.BOTTOM_LEFT_FIX&&(this.out(e,i),this.__area=EPointerAreaKind.BOTTOM_LEFT_FIX,this.over(e,i)):e.offsetX>=l.left&&e.offsetX<l.right?this.__area!=EPointerAreaKind.BOTTOM_RIGHT_FIX&&(this.out(e,i),this.__area=EPointerAreaKind.BOTTOM_RIGHT_FIX,this.over(e,i)):this.__area!=EPointerAreaKind.BOTTOM_CLIENT_FIX&&(this.out(e,i),this.__area=EPointerAreaKind.BOTTOM_CLIENT_FIX,this.over(e,i)),this.__area==EPointerAreaKind.BOTTOM_LEFT_FIX&&this.eventExec(t,this.__area,e.offsetX-o.width,e.offsetY-d.bottom,e,i),this.__area==EPointerAreaKind.BOTTOM_CLIENT_FIX&&this.eventExec(t,this.__area,e.offsetX-n.right,e.offsetY-d.bottom,e,i),this.__area==EPointerAreaKind.BOTTOM_RIGHT_FIX&&this.eventExec(t,this.__area,e.offsetX-d.right,e.offsetY-d.bottom,e,i)),d.isIn(e.offsetX,e.offsetY)&&(this.__area!=EPointerAreaKind.CLIENT&&(this.out(e,i),this.__area=EPointerAreaKind.CLIENT,this.over(e,i)),this.eventExec(t,this.__area,e.offsetX-n.right,e.offsetY-r.bottom,e,i))}eventExec(t,e,i,s,o,a){"down"==t&&this.doGridPointerDown(e,i,s,o,a),"move"==t&&this.doGridPointerMove(e,i,s,o,a),"up"==t&&this.doGridPointerUp(e,i,s,o,a)}doGridPointerDown(t,e,i,s,o){this.cellEventExec("down",t,e,i,s,o),null!=this.onGridPointerDown&&this.onGridPointerDown(this,t,e,i,s,o)}doGridPointerMove(t,e,i,s,o){this.cellEventExec("move",t,e,i,s,o),null!=this.onGridPointerMove&&this.onGridPointerMove(this,t,e,i,s,o)}doGridPointerUp(t,e,i,s,o){this.cellEventExec("up",t,e,i,s,o),null!=this.onGridPointerUp&&this.onGridPointerUp(this,t,e,i,s,o)}doGridPointerOver(t,e,i){null!=this.onGridPointerOver&&this.onGridPointerOver(this,t,e,i)}doGridPointerOut(t,e,i){this.__cellInfo.kind==EPointerAreaKind.NONE&&-1==this.__cellInfo.col&&-1==this.__cellInfo.row||this.doChangePointerCell(e,i,this.__cellInfo,{kind:EPointerAreaKind.NONE,col:-1,row:-1,x:-1,y:-1}),this.__cellInfo={kind:EPointerAreaKind.NONE,col:-1,row:-1,x:-1,y:-1},null!=this.onGridPointerOut&&this.onGridPointerOut(this,t,e,i)}cellEventExec(t,e,i,s,o,a){let n=-1,r=-1,l=-1,h=-1,d=!1,g=!1,C=0,c=0;function u(t){let e=t.xToColumn(t.scrollX+i);n=e.index;let s=t.getCellBounds(n,0);l=t.scrollX+i-s.left,d=e.isMargin,C=s.width-t.gridInfo.cellMargin}function p(t){let e=0;for(let s=0;s<t.gridInfo.fixLeft.length;s++){if(e<=i&&i<e+t.gridInfo.fixLeft.get(s)){l=i-e,n=s,C=t.gridInfo.fixLeft.get(s);break}e+=t.gridInfo.fixLeft.get(s)+t.gridInfo.cellMargin}}function A(t){let e=t.gridInfo.cellMargin;for(let s=0;s<t.gridInfo.fixRight.length;s++){if(e<=i&&i<e+t.gridInfo.fixRight.get(s)){l=i-e,n=s,C=t.gridInfo.fixRight.get(s);break}e+=t.gridInfo.fixRight.get(s)+t.gridInfo.cellMargin}}function m(t){let e=t.yToRow(t.scrollY+s);r=e.index;let i=t.getCellBounds(0,r);h=t.scrollY+s-i.top,g=e.isMargin,c=i.height-t.gridInfo.cellMargin}if(e==EPointerAreaKind.HEADER_BUTTON){let t=this.getBackgroundHeaderButtonBounds();i<t.width-this.gridInfo.cellMargin&&s<t.height-this.gridInfo.cellMargin&&(n=0,r=0,C=t.width-this.gridInfo.cellMargin,c=t.height-this.gridInfo.cellMargin,l=i,h=s)}if(e==EPointerAreaKind.HEADER_LEFT_FIX||e==EPointerAreaKind.HEADER_CLIENT||e==EPointerAreaKind.HEADER_RIGHT_FIX){let t=0;for(let e=0;e<this.gridInfo.headerCount;e++){if(t<=s&&s<t+this.gridInfo.headerRowHeight){h=s-t,r=e;break}t+=this.gridInfo.headerRowHeight+this.gridInfo.cellMargin}c=this.gridInfo.headerRowHeight,e==EPointerAreaKind.HEADER_LEFT_FIX&&p(this),e==EPointerAreaKind.HEADER_CLIENT&&u(this),e==EPointerAreaKind.HEADER_RIGHT_FIX&&A(this)}if(e==EPointerAreaKind.INDICATOR_TOP_FIX||e==EPointerAreaKind.INDICATOR_CLIENT||e==EPointerAreaKind.INDICATOR_BOTTOM_FIX){let t=this.getBackgroundIndicatorBounds();if(i<t.width-this.gridInfo.cellMargin&&(n=0,C=t.width-this.gridInfo.cellMargin,l=i),e==EPointerAreaKind.INDICATOR_TOP_FIX){let t=0;for(let e=0;e<this.gridInfo.fixTop.length;e++){if(t<=s&&s<t+this.gridInfo.fixTop.get(e)){h=s-t,r=e,c=this.gridInfo.fixTop.get(e);break}t+=this.gridInfo.fixTop.get(e)+this.gridInfo.cellMargin}}if(e==EPointerAreaKind.INDICATOR_CLIENT&&m(this),e==EPointerAreaKind.INDICATOR_BOTTOM_FIX){let t=this.gridInfo.cellMargin;for(let e=0;e<this.gridInfo.fixBottom.length;e++){if(t<=s&&s<t+this.gridInfo.fixBottom.get(e)){h=s-t,r=e,c=this.gridInfo.fixBottom.get(e);break}t+=this.gridInfo.fixBottom.get(e)+this.gridInfo.cellMargin}}}if(e==EPointerAreaKind.TOP_LEFT_FIX||e==EPointerAreaKind.TOP_CLIENT_FIX||e==EPointerAreaKind.TOP_RIGHT_FIX){let t=0;for(let e=0;e<this.gridInfo.fixTop.length;e++){if(t<=s&&s<t+this.gridInfo.fixTop.get(e)){h=s-t,r=e,c=this.gridInfo.fixTop.get(e);break}t+=this.gridInfo.fixTop.get(e)+this.gridInfo.cellMargin}e==EPointerAreaKind.TOP_LEFT_FIX&&p(this),e==EPointerAreaKind.TOP_CLIENT_FIX&&u(this),e==EPointerAreaKind.TOP_RIGHT_FIX&&A(this)}if(e==EPointerAreaKind.BOTTOM_LEFT_FIX||e==EPointerAreaKind.BOTTOM_CLIENT_FIX||e==EPointerAreaKind.BOTTOM_RIGHT_FIX){let t=this.gridInfo.cellMargin;for(let e=0;e<this.gridInfo.fixBottom.length;e++){if(t<=s&&s<t+this.gridInfo.fixBottom.get(e)){h=s-t,r=e,c=this.gridInfo.fixBottom.get(e);break}t+=this.gridInfo.fixBottom.get(e)+this.gridInfo.cellMargin}e==EPointerAreaKind.BOTTOM_LEFT_FIX&&p(this),e==EPointerAreaKind.BOTTOM_CLIENT_FIX&&u(this),e==EPointerAreaKind.BOTTOM_RIGHT_FIX&&A(this)}e==EPointerAreaKind.LEFT_FIX&&(p(this),m(this)),e==EPointerAreaKind.RIGHT_FIX&&(A(this),m(this)),e==EPointerAreaKind.CLIENT&&(u(this),m(this));let f=!0;e==EPointerAreaKind.CLIENT&&(n>=this.gridInfo.columnCount||r>=this.gridInfo.rowCount)&&(f=!1),e==EPointerAreaKind.HEADER_CLIENT&&n>=this.gridInfo.columnCount&&(f=!1),(e==EPointerAreaKind.BOTTOM_LEFT_FIX||e==EPointerAreaKind.TOP_LEFT_FIX||e==EPointerAreaKind.HEADER_LEFT_FIX||e==EPointerAreaKind.LEFT_FIX)&&n>=this.gridInfo.fixLeft.length&&(f=!1),(e==EPointerAreaKind.BOTTOM_RIGHT_FIX||e==EPointerAreaKind.TOP_RIGHT_FIX||e==EPointerAreaKind.HEADER_RIGHT_FIX||e==EPointerAreaKind.RIGHT_FIX)&&n>=this.gridInfo.fixRight.length&&(f=!1),e==EPointerAreaKind.INDICATOR_CLIENT&&r>=this.gridInfo.rowCount&&(f=!1),-1==n||-1==r||d||g||!f?(this.__cellInfo.kind==EPointerAreaKind.NONE&&-1==this.__cellInfo.col&&-1==this.__cellInfo.row||this.doChangePointerCell(o,a,this.__cellInfo,{kind:EPointerAreaKind.NONE,col:-1,row:-1,x:-1,y:-1}),this.__cellInfo={kind:EPointerAreaKind.NONE,col:-1,row:-1,x:-1,y:-1}):(this.__cellInfo.kind==e&&this.__cellInfo.col==n&&this.__cellInfo.row==r||this.doChangePointerCell(o,a,this.__cellInfo,{kind:e,col:n,row:r,x:l,y:h}),this.__cellInfo={kind:e,col:n,row:r,x:l,y:h},"down"==t&&this.doCellPointerDown(e,n,r,l,h,C,c,o,a),"move"==t&&this.doCellPointerMove(e,n,r,l,h,C,c,o,a),"up"==t&&this.doCellPointerUp(e,n,r,l,h,C,c,o,a))}doChangePointerCell(t,e,i,s){-1!=i.col&&-1!=i.row&&this.doCellPointerOut(i.kind,i.col,i.row,t,e),-1!=s.col&&-1!=s.row&&this.doCellPointerOver(s.kind,s.col,s.row,t,e)}doCellPointerDown(t,e,i,s,o,a,n,r,l){let h=!1,d=!1;h="col-resize"==this.scrollBox.background.cursor,d="row-resize"==this.scrollBox.background.cursor,"nwse-resize"==this.scrollBox.background.cursor&&(h=!0,d=!0),this.__downCellInfo={kind:t,col:e,row:i,width:a,height:n,resizeCol:h,resizeRow:d,offsetx:r.offsetX,offsety:r.offsetY},this.cellPressed=!0,null!=this.onCellPointerDown&&this.onCellPointerDown(this,t,e,i,s,o,a,n,r,l)}doCellPointerMove(t,e,i,s,o,a,n,r,l){if(t!=EPointerAreaKind.HEADER_CLIENT&&t!=EPointerAreaKind.HEADER_LEFT_FIX||!this.gridInfo.useResizeColumn||(s>=a-this.gridInfo.resizeGripLength&&s<a?this.scrollBox.background.cursor="col-resize":this.scrollBox.background.cursor="auto"),t==EPointerAreaKind.HEADER_RIGHT_FIX&&this.gridInfo.useResizeColumn&&(s>=0&&s<this.gridInfo.resizeGripLength?this.scrollBox.background.cursor="col-resize":this.scrollBox.background.cursor="auto"),t==EPointerAreaKind.INDICATOR_CLIENT&&(this.gridInfo.useResizeRow&&this.gridInfo.useResizeColumn&&o>=n-this.gridInfo.resizeGripLength&&o<n&&s>=a-this.gridInfo.resizeGripLength&&s<a?this.scrollBox.background.cursor="nwse-resize":this.gridInfo.useResizeColumn&&s>=a-this.gridInfo.resizeGripLength&&s<a?this.scrollBox.background.cursor="col-resize":this.gridInfo.useResizeRow&&o>=n-this.gridInfo.resizeGripLength&&o<n?this.scrollBox.background.cursor="row-resize":this.scrollBox.background.cursor="auto"),t==EPointerAreaKind.INDICATOR_TOP_FIX&&this.gridInfo.useResizeRow&&(o>=n-this.gridInfo.resizeGripLength&&o<n?this.scrollBox.background.cursor="row-resize":this.scrollBox.background.cursor="auto"),t==EPointerAreaKind.INDICATOR_BOTTOM_FIX&&this.gridInfo.useResizeRow&&(o>=0&&o<this.gridInfo.resizeGripLength?this.scrollBox.background.cursor="row-resize":this.scrollBox.background.cursor="auto"),t==EPointerAreaKind.CLIENT&&this.gridInfo.useResizeRow&&this.gridInfo.useResizeColumn&&(o>=n-this.gridInfo.resizeGripLength&&o<n&&s>=a-this.gridInfo.resizeGripLength&&s<a?this.scrollBox.background.cursor="nwse-resize":this.scrollBox.background.cursor="auto"),this.cellPressed&&this.__downCellInfo.resizeCol&&(this.__downCellInfo.kind!=EPointerAreaKind.HEADER_CLIENT&&this.__downCellInfo.kind!=EPointerAreaKind.CLIENT||this.gridInfo.diffColumnSize.set(this.__downCellInfo.col,this.__downCellInfo.width+(r.offsetX-this.__downCellInfo.offsetx)),this.__downCellInfo.kind==EPointerAreaKind.INDICATOR_CLIENT&&(this.gridInfo.indicatorWidth=this.__downCellInfo.width+(r.offsetX-this.__downCellInfo.offsetx)),this.__downCellInfo.kind==EPointerAreaKind.HEADER_LEFT_FIX&&this.gridInfo.fixLeft.set(this.__downCellInfo.col,this.__downCellInfo.width+(r.offsetX-this.__downCellInfo.offsetx)),this.__downCellInfo.kind==EPointerAreaKind.HEADER_RIGHT_FIX&&this.gridInfo.fixRight.set(this.__downCellInfo.col,this.__downCellInfo.width-(r.offsetX-this.__downCellInfo.offsetx))),this.cellPressed&&this.__downCellInfo.resizeRow&&(this.__downCellInfo.kind!=EPointerAreaKind.INDICATOR_CLIENT&&this.__downCellInfo.kind!=EPointerAreaKind.CLIENT||this.gridInfo.diffRowSize.set(this.__downCellInfo.row,this.__downCellInfo.height+(r.offsetY-this.__downCellInfo.offsety)),this.__downCellInfo.kind==EPointerAreaKind.INDICATOR_TOP_FIX&&this.gridInfo.fixTop.set(this.__downCellInfo.row,this.__downCellInfo.height+(r.offsetY-this.__downCellInfo.offsety)),this.__downCellInfo.kind==EPointerAreaKind.INDICATOR_BOTTOM_FIX&&this.gridInfo.fixBottom.set(this.__downCellInfo.row,this.__downCellInfo.height-(r.offsetY-this.__downCellInfo.offsety))),t==EPointerAreaKind.CLIENT&&this.cellPressed&&this.__downCellInfo.kind==EPointerAreaKind.CLIENT&&this.__downCellInfo.col>=0&&this.__downCellInfo.row>=0){let t=new CCellSelectInfo;t.startCell.x=this.__downCellInfo.col,t.startCell.y=this.__downCellInfo.row,t.stopCell.x=e,t.stopCell.y=i;let s=new CCellSelectInfo;s.startCell.x=CCalc.min(t.startCell.x,t.stopCell.x),s.startCell.y=CCalc.min(t.startCell.y,t.stopCell.y),s.stopCell.x=CCalc.max(t.startCell.x,t.stopCell.x),s.stopCell.y=CCalc.max(t.startCell.y,t.stopCell.y),this.doCellDrag(t,s,r,l)}null!=this.onCellPointerMove&&this.onCellPointerMove(this,t,e,i,s,o,a,n,r,l)}doCellPointerUp(t,e,i,s,o,a,n,r,l){this.__downCellInfo.kind==t&&this.__downCellInfo.col==e&&this.__downCellInfo.row==i&&this.doCellClick(t,e,i,s,o,a,n,r,l),null!=this.onCellPointerUp&&this.onCellPointerUp(this,t,e,i,s,o,a,n,r,l)}doCellPointerOver(t,e,i,s,o){null!=this.onCellPointerOver&&this.onCellPointerOver(this,t,e,i,s,o)}doCellPointerOut(t,e,i,s,o){this.gridInfo.useResizeColumn&&(this.scrollBox.background.cursor="auto"),this.gridInfo.useResizeRow&&(this.scrollBox.background.cursor="auto"),null!=this.onCellPointerOut&&this.onCellPointerOut(this,t,e,i,s,o)}doCellClick(t,e,i,s,o,a,n,r,l){CTime.now-this.__preClickTime<this.repeatClickTime&&this.doCellDblClick(t,e,i,r,l),this.__preClickTime=CTime.now,null!=this.onCellClick&&this.onCellClick(this,t,e,i,s,o,a,n,r,l)}doCellDblClick(t,e,i,s,o){null!=this.onCellDblClick&&this.onCellDblClick(this,t,e,i,s,o)}doCellDrag(t,e,i,s){}doSetContentSize(){this.scrollMinX=0,this.scrollMaxX=this.getContentWidth()-this.getBackgroundClientBounds().width,this.scrollBox.hScrollbar.enabled=this.getContentWidth()>this.getBackgroundClientBounds().width,this.scrollMinY=0,this.scrollMaxY=this.getContentHeight()-this.getBackgroundClientBounds().height,this.scrollBox.vScrollbar.enabled=this.getContentHeight()>this.getBackgroundClientBounds().height,this.scrollBox.useHScrollbar=!this.gridInfo.useFitWidth,null!=this.onSetContentSize&&this.onSetContentSize(this)}doSetInnerSize(){this.doSetContentSize(),super.doSetInnerSize()}doScrollBoxUpdate(){this.doSetBounds(),super.doScrollBoxUpdate()}doChangeGridInfo(t){this.doSetBounds(),this.doSetContentSize()}doSetBounds(){this.doSetHeaderBounds(this.getBackgroundHeaderBounds()),this.doSetIndicatorBounds(this.getBackgroundIndicatorBounds()),this.doSetTopFixBounds(this.getBackgroundTopFixBounds()),this.doSetBottomFixBounds(this.getBackgroundBottomFixBounds()),this.doSetLeftFixBounds(this.getBackgroundLeftFixBounds()),this.doSetRightFixBounds(this.getBackgroundRightFixBounds()),this.doSetClientFixBounds(this.getBackgroundClientBounds())}doSetHeaderBounds(t){null!=this.onSetHeaderBounds&&this.onSetHeaderBounds(this,t)}doSetIndicatorBounds(t){null!=this.onSetIndicatorBounds&&this.onSetIndicatorBounds(this,t)}doSetTopFixBounds(t){null!=this.onSetTopBounds&&this.onSetTopBounds(this,t)}doSetBottomFixBounds(t){null!=this.onSetBottomBounds&&this.onSetBottomBounds(this,t)}doSetLeftFixBounds(t){null!=this.onSetLeftBounds&&this.onSetLeftBounds(this,t)}doSetRightFixBounds(t){null!=this.onSetRightBounds&&this.onSetRightBounds(this,t)}doSetClientFixBounds(t){null!=this.onSetClientBounds&&this.onSetClientBounds(this,t)}doCellsBounds(){if(this.gridInfo.columnCount>0||this.gridInfo.rowCount>0){let t=this.getBackgroundColumns(),e=this.getBackgroundRows();this.gridInfo.rowCount>0&&this.doClientCellsBounds(t,e),this.gridInfo.rowCount>0&&this.doLeftCellsBounds(e),this.gridInfo.rowCount>0&&this.doRightCellsBounds(e),this.doTopCellsBounds(t),this.doBottomCellsBounds(t),this.gridInfo.useHeader&&this.gridInfo.columnCount>0&&this.doHeaderCellsBounds(t),this.gridInfo.useIndicator&&this.gridInfo.rowCount>0&&this.doIndicatorCellsBounds(e),this.doBeforeHeaderButtomCellBounds(this.getBackgroundHeaderButtonBounds());let i=this.getBackgroundHeaderButtonBounds();i.right-=this.gridInfo.cellMargin,i.bottom-=this.gridInfo.cellMargin,this.doHeaderButtonCellBounds(i)}}doBeforeHeaderButtomCellBounds(t){}doHeaderButtonCellBounds(t){}doBeforeHeaderLeftFixCellBounds(t){}doBeforeHeaderCellBounds(t){}doBeforeHeaderRightFixCellBounds(t){}doHeaderLeftFixCellBounds(t,e,i){}doHeaderCellBounds(t,e,i,s){}doHeaderRightFixCellBounds(t,e,i){}doHeaderCellsBounds(t){let e=this,i=this.getBackgroundHeaderBounds(),s=CRect.copyFrom(i);s.right=this.getBackgroundLeftFixBounds().right;let o=CRect.copyFrom(i);o.left=this.getBackgroundRightFixBounds().left;let a=CRect.copyFrom(i);a.left=s.right,a.right=o.left,this.doBeforeHeaderCellBounds(a);for(let r=0;r<t.area.length;r++)for(let l=0;l<this.gridInfo.headerCount;l++){let h=new CPoint(t.startIndex+r,l),d="none";for(let g=0;g<this.gridInfo.mergeHeaderCell.length;g++){let C=!1;function c(t){let i=e.gridInfo.mergeHeaderCell.get(t).startCell,s=e.gridInfo.mergeHeaderCell.get(t).stopCell,o=e.getHeaderCellBounds(i.x,i.y),n=e.getHeaderCellBounds(s.x,s.y);o.offset(-e.scrollX,0),n.offset(-e.scrollX,0),e.doHeaderCellBounds(e.gridInfo.mergeHeaderCell.get(t).startCell.x,e.gridInfo.mergeHeaderCell.get(t).startCell.y,new CRect(a.left+o.left,a.top+o.top,a.left+n.right-e.gridInfo.cellMargin,a.top+n.bottom-e.gridInfo.cellMargin),!0),C=!0}this.gridInfo.mergeHeaderCell.get(g).startCell.equal(h)?(d="first",c(g)):this.gridInfo.mergeHeaderCell.get(g).stopCell.equal(h)?(d="last",C||c(g)):this.gridInfo.mergeHeaderCell.get(g).isIn(h)&&(d="merge")}if("merge"!=d&&"first"!=d&&"last"!=d){let u=a.left-t.left+t.area[r].left,p=a.top+(this.gridInfo.headerRowHeight+this.gridInfo.cellMargin)*l,A=a.left-t.left+t.area[r].right-this.gridInfo.cellMargin,m=p+this.gridInfo.headerRowHeight;this.doHeaderCellBounds(t.startIndex+r,l,new CRect(u,p,A,m),!1)}}let n=0;this.doBeforeHeaderLeftFixCellBounds(s);for(let f=0;f<this.gridInfo.fixLeft.length;f++){let D=s.left+n,_=0,I=s.left+this.gridInfo.fixLeft.get(f)+n,E=_+(this.gridInfo.headerRowHeight+this.gridInfo.cellMargin)*this.gridInfo.headerCount-this.gridInfo.cellMargin;this.doHeaderLeftFixCellBounds(f,0,new CRect(D,_,I,E)),n+=this.gridInfo.fixLeft.get(f)+this.gridInfo.cellMargin}n=0,this.doBeforeHeaderRightFixCellBounds(o);for(let y=0;y<this.gridInfo.fixRight.length;y++){let w=o.left+n+this.gridInfo.cellMargin,T=0,P=o.left+this.gridInfo.fixRight.get(y)+n+this.gridInfo.cellMargin,B=T+(this.gridInfo.headerRowHeight+this.gridInfo.cellMargin)*this.gridInfo.headerCount-this.gridInfo.cellMargin;this.doHeaderRightFixCellBounds(y,0,new CRect(w,T,P,B)),n+=this.gridInfo.fixRight.get(y)+this.gridInfo.cellMargin}}doBeforeIndicatorTopFixCellBounds(t){}doBeforeIndicatorCellBounds(t){}doBeforeIndicatorBottomFixCellBounds(t){}doIndicatorTopFixCellBounds(t,e){}doIndicatorCellBounds(t,e){}doIndicatorBottomFixCellBounds(t,e){}doIndicatorCellsBounds(t){let e=this.getBackgroundIndicatorBounds(),i=CRect.copyFrom(e);i.bottom=this.getBackgroundTopFixBounds().bottom;let s=CRect.copyFrom(e);s.top=this.getBackgroundBottomFixBounds().top;let o=CRect.copyFrom(e);o.top=i.bottom,o.bottom=s.top,this.doBeforeIndicatorCellBounds(o);for(let e=0;e<t.area.length;e++){let i=o.left,s=o.top-t.top+t.area[e].top,a=o.right-this.gridInfo.cellMargin,n=o.top-t.top+t.area[e].bottom-this.gridInfo.cellMargin;this.doIndicatorCellBounds(t.startIndex+e,new CRect(i,s,a,n))}let a=0;this.doBeforeIndicatorTopFixCellBounds(i);for(let t=0;t<this.gridInfo.fixTop.length;t++){let e=i.left,s=i.top+a,o=i.right-this.gridInfo.cellMargin,n=i.top+a+this.gridInfo.fixTop.get(t);this.doIndicatorTopFixCellBounds(t,new CRect(e,s,o,n)),a+=this.gridInfo.fixTop.get(t)+this.gridInfo.cellMargin}a=0,this.doBeforeIndicatorBottomFixCellBounds(s);for(let t=0;t<this.gridInfo.fixBottom.length;t++){let e=s.left,i=s.top+a+this.gridInfo.cellMargin,o=s.right-this.gridInfo.cellMargin,n=s.top+a+this.gridInfo.fixBottom.get(t)+this.gridInfo.cellMargin;this.doIndicatorBottomFixCellBounds(t,new CRect(e,i,o,n)),a+=this.gridInfo.fixBottom.get(t)+this.gridInfo.cellMargin}}doBeforeTopLeftFixCellBounds(t){}doBeforeTopCellBounds(t){}doBeforeTopRightFixCellBounds(t){}doTopLeftFixCellBounds(t,e,i){}doTopCellBounds(t,e,i,s){}doTopRightFixCellBounds(t,e,i){}doTopCellsBounds(t){let e=this.getBackgroundTopFixBounds(),i=CRect.copyFrom(e);i.right=this.getBackgroundLeftFixBounds().right;let s=CRect.copyFrom(e);s.left=this.getBackgroundRightFixBounds().left;let o=CRect.copyFrom(e);o.left=i.right,o.right=s.left,this.doBeforeTopCellBounds(o);for(let e=0;e<t.area.length;e++){let i=0;for(let s=0;s<this.gridInfo.fixTop.length;s++){let a=o.left-t.left+t.area[e].left,n=o.top+i,r=o.left-t.left+t.area[e].right-this.gridInfo.cellMargin,l=o.top+i+this.gridInfo.fixTop.get(s);this.doTopCellBounds(t.startIndex+e,s,new CRect(a,n,r,l),!1),i+=this.gridInfo.fixTop.get(s)+this.gridInfo.cellMargin}}let a=0;this.doBeforeTopLeftFixCellBounds(i);for(let t=0;t<this.gridInfo.fixLeft.length;t++){let e=0;for(let s=0;s<this.gridInfo.fixTop.length;s++){let o=i.left+a,n=i.top+e,r=i.left+this.gridInfo.fixLeft.get(t)+a,l=i.top+e+this.gridInfo.fixTop.get(s);this.doTopLeftFixCellBounds(t,s,new CRect(o,n,r,l)),e+=this.gridInfo.fixTop.get(s)+this.gridInfo.cellMargin}a+=this.gridInfo.fixLeft.get(t)+this.gridInfo.cellMargin}a=0,this.doBeforeTopRightFixCellBounds(s);for(let t=0;t<this.gridInfo.fixRight.length;t++){let e=0;for(let i=0;i<this.gridInfo.fixTop.length;i++){let o=s.left+a+this.gridInfo.cellMargin,n=s.top+e,r=s.left+this.gridInfo.fixRight.get(t)+a+this.gridInfo.cellMargin,l=s.top+this.gridInfo.fixTop.get(i)+e;this.doTopRightFixCellBounds(t,i,new CRect(o,n,r,l)),e+=this.gridInfo.fixTop.get(i)+this.gridInfo.cellMargin}a+=this.gridInfo.fixRight.get(t)+this.gridInfo.cellMargin}}doBeforeBottomLeftFixCellBounds(t){}doBeforeBottomCellBounds(t){}doBeforeBottomRightFixCellBounds(t){}doBottomLeftFixCellBounds(t,e,i){}doBottomCellBounds(t,e,i,s){}doBottomRightFixCellBounds(t,e,i){}doBottomCellsBounds(t){let e=this.getBackgroundBottomFixBounds(),i=CRect.copyFrom(e);i.right=this.getBackgroundLeftFixBounds().right;let s=CRect.copyFrom(e);s.left=this.getBackgroundRightFixBounds().left;let o=CRect.copyFrom(e);o.left=i.right,o.right=s.left,this.doBeforeBottomCellBounds(o);for(let e=0;e<t.area.length;e++){let i=0;for(let s=0;s<this.gridInfo.fixBottom.length;s++){let a=o.left-t.left+t.area[e].left,n=o.top+i+this.gridInfo.cellMargin,r=o.left-t.left+t.area[e].right-this.gridInfo.cellMargin,l=o.top+i+this.gridInfo.fixBottom.get(s)+this.gridInfo.cellMargin;this.doBottomCellBounds(t.startIndex+e,s,new CRect(a,n,r,l),!1),i+=this.gridInfo.fixBottom.get(s)+this.gridInfo.cellMargin}}let a=0;this.doBeforeBottomLeftFixCellBounds(i);for(let t=0;t<this.gridInfo.fixLeft.length;t++){let e=0;for(let s=0;s<this.gridInfo.fixBottom.length;s++){let o=i.left+a,n=i.top+e+this.gridInfo.cellMargin,r=i.left+this.gridInfo.fixLeft.get(t)+a,l=i.top+e+this.gridInfo.fixBottom.get(s)+this.gridInfo.cellMargin;this.doBottomLeftFixCellBounds(t,s,new CRect(o,n,r,l)),e+=this.gridInfo.fixBottom.get(s)+this.gridInfo.cellMargin}a+=this.gridInfo.fixLeft.get(t)+this.gridInfo.cellMargin}a=0,this.doBeforeBottomRightFixCellBounds(s);for(let t=0;t<this.gridInfo.fixRight.length;t++){let e=0;for(let i=0;i<this.gridInfo.fixBottom.length;i++){let o=s.left+a+this.gridInfo.cellMargin,n=s.top+e+this.gridInfo.cellMargin,r=s.left+this.gridInfo.fixRight.get(t)+a+this.gridInfo.cellMargin,l=s.top+this.gridInfo.fixBottom.get(i)+e+this.gridInfo.cellMargin;this.doBottomRightFixCellBounds(t,i,new CRect(o,n,r,l)),e+=this.gridInfo.fixBottom.get(i)+this.gridInfo.cellMargin}a+=this.gridInfo.fixRight.get(t)+this.gridInfo.cellMargin}}doBeforeLeftCellBounds(t){}doLeftCellBounds(t,e,i){}doLeftCellsBounds(t){let e=this.getBackgroundLeftFixBounds();this.doBeforeLeftCellBounds(e);for(let i=0;i<t.area.length;i++){let s=0;for(let o=0;o<this.gridInfo.fixLeft.length;o++){let a=e.left+s,n=e.top-t.top+t.area[i].top,r=e.left+s+this.gridInfo.fixLeft.get(o),l=e.top-t.top+t.area[i].bottom-this.gridInfo.cellMargin;this.doLeftCellBounds(o,t.startIndex+i,new CRect(a,n,r,l)),s+=this.gridInfo.fixLeft.get(o)+this.gridInfo.cellMargin}}}doBeforeRightCellBounds(t){}doRightCellBounds(t,e,i){}doRightCellsBounds(t){let e=this.getBackgroundRightFixBounds();this.doBeforeRightCellBounds(e);for(let i=0;i<t.area.length;i++){let s=0;for(let o=0;o<this.gridInfo.fixRight.length;o++){let a=e.left+s+this.gridInfo.cellMargin,n=e.top-t.top+t.area[i].top,r=e.left+s+this.gridInfo.fixRight.get(o)+this.gridInfo.cellMargin,l=e.top-t.top+t.area[i].bottom-this.gridInfo.cellMargin;this.doRightCellBounds(o,t.startIndex+i,new CRect(a,n,r,l)),s+=this.gridInfo.fixRight.get(o)+this.gridInfo.cellMargin}}}doBeforeClientCellBounds(t){}doClientCellBounds(t,e,i,s){}doClientCellsBounds(t,e){let i=this.getBackgroundClientBounds(),s=this;this.doBeforeClientCellBounds(i);for(let o=0;o<t.area.length;o++)for(let a=0;a<e.area.length;a++){let n=new CPoint(t.startIndex+o,e.startIndex+a),r="none";for(let l=0;l<this.gridInfo.mergeCell.length;l++){let h=!1;function d(t){let e=s.gridInfo.mergeCell.get(t).startCell,o=s.gridInfo.mergeCell.get(t).stopCell,a=s.getCellBounds(e.x,e.y),n=s.getCellBounds(o.x,o.y);a.offset(-s.scrollX,-s.scrollY),n.offset(-s.scrollX,-s.scrollY),s.doClientCellBounds(s.gridInfo.mergeCell.get(t).startCell.x,s.gridInfo.mergeCell.get(t).startCell.y,new CRect(i.left+a.left,i.top+a.top,i.left+n.right-s.gridInfo.cellMargin,i.top+n.bottom-s.gridInfo.cellMargin),!0),h=!0}this.gridInfo.mergeCell.get(l).startCell.equal(n)?(r="first",d(l)):this.gridInfo.mergeCell.get(l).stopCell.equal(n)?(r="last",h||d(l)):this.gridInfo.mergeCell.get(l).isIn(n)&&(r="merge",h||d(l))}if("merge"!=r&&"first"!=r&&"last"!=r){let g=i.left-t.left+t.area[o].left,C=i.top-e.top+e.area[a].top,c=i.left-t.left+t.area[o].right-this.gridInfo.cellMargin,u=i.top-e.top+e.area[a].bottom-this.gridInfo.cellMargin;this.doClientCellBounds(t.startIndex+o,e.startIndex+a,new CRect(g,C,c,u),!1)}}}doKeyDown(t){super.doKeyDown(t),"End"==t.key&&(this.scrollY=this.scrollMaxY),"Home"==t.key&&(this.scrollY=this.scrollMinY),"PageDown"==t.key&&(this.scrollY+=this.getBackgroundClientBounds().height),"PageUp"==t.key&&(this.scrollY-=this.getBackgroundClientBounds().height)}getColumnArea(t){if(0==this.gridInfo.diffColumnSize.size)return{left:t*(this.gridInfo.defaultColumnWidth+this.gridInfo.cellMargin),right:(t+1)*(this.gridInfo.defaultColumnWidth+this.gridInfo.cellMargin)};{let e=this.getPreviousDiffColumns(t),i=this.gridInfo.defaultColumnWidth*(t+1-e.columns.length)+e.totalWidth+this.gridInfo.cellMargin*(t+1),s=this.gridInfo.diffColumnSize.get(t);return null!=s?{left:i-this.gridInfo.cellMargin-s,right:i}:{left:i-this.gridInfo.cellMargin-this.gridInfo.defaultColumnWidth,right:i}}}getRowArea(t){if(0==this.gridInfo.diffRowSize.size)return{top:t*(this.gridInfo.defaultRowHeight+this.gridInfo.cellMargin),bottom:(t+1)*(this.gridInfo.defaultRowHeight+this.gridInfo.cellMargin)};{let e=this.getPreviousDiffRows(t),i=this.gridInfo.defaultRowHeight*(t+1-e.rows.length)+e.totalHeight+this.gridInfo.cellMargin*(t+1),s=this.gridInfo.diffRowSize.get(t);return null!=s?{top:i-this.gridInfo.cellMargin-s,bottom:i}:{top:i-this.gridInfo.cellMargin-this.gridInfo.defaultRowHeight,bottom:i}}}xToColumn(t){if(t>=0){if(this.gridInfo.useFitWidth){let e=this.getBackgroundColumns(),i={index:-1,left:0,isMargin:!1};for(let s=0;s<e.area.length;s++){if(t>=e.area[s].left&&t<e.area[s].right-this.gridInfo.cellMargin){i.index=s,i.left=0,i.isMargin=!1;break}if(t>=e.area[s].right-this.gridInfo.cellMargin&&t<e.area[s].right){i.index=s,i.left=0,i.isMargin=!0;break}}return i}{let e=Math.floor(t/(this.gridInfo.defaultColumnWidth+this.gridInfo.cellMargin)),i=this.getColumnArea(e);if(0==this.gridInfo.diffColumnSize.size)return{index:e,left:t-i.left,isMargin:t>=i.right-this.gridInfo.cellMargin&&t<i.right};if(t<i.left){let i=e-1,s=0,o=!1;for(;;){let e=this.getColumnArea(i);if(t>=e.left&&t<e.right){s=t-e.left,o=t>=e.right-this.gridInfo.cellMargin&&t<e.right;break}i--}return{index:i,left:s,isMargin:o}}if(t>=i.right){let i=e+1,s=0,o=!1;for(;;){let e=this.getColumnArea(i);if(t>=e.left&&t<e.right){s=t-e.left,o=t>=e.right-this.gridInfo.cellMargin&&t<e.right;break}i++}return{index:i,left:s,isMargin:o}}return{index:e,left:t-i.left,isMargin:t>=i.right-this.gridInfo.cellMargin&&t<i.right}}}return{index:-1,left:0,isMargin:!1}}yToRow(t){if(t>=0){let e=Math.floor(t/(this.gridInfo.defaultRowHeight+this.gridInfo.cellMargin)),i=this.getRowArea(e);if(0==this.gridInfo.diffRowSize.size)return{index:e,top:t-i.top,isMargin:t>=i.bottom-this.gridInfo.cellMargin&&t<i.bottom};if(t<i.top){let i=e-1,s=0,o=!1;for(;;){let e=this.getRowArea(i);if(t>=e.top&&t<e.bottom){s=t-e.top,o=t>=e.bottom-this.gridInfo.cellMargin&&t<e.bottom;break}i--}return{index:i,top:s,isMargin:o}}if(t>=i.bottom){let i=e+1,s=0,o=!1;for(;;){let e=this.getRowArea(i);if(t>=e.top&&t<e.bottom){s=t-e.top,o=t>=e.bottom-this.gridInfo.cellMargin&&t<e.bottom;break}i++}return{index:i,top:s,isMargin:o}}return{index:e,top:t-i.top,isMargin:t>=i.bottom-this.gridInfo.cellMargin&&t<i.bottom}}return{index:-1,top:0,isMargin:!1}}yToHeaderRow(t){let e=Math.floor(t/(this.gridInfo.headerRowHeight+this.gridInfo.cellMargin)),i=e*(this.gridInfo.headerRowHeight+this.gridInfo.cellMargin),s=(e+1)*(this.gridInfo.headerRowHeight+this.gridInfo.cellMargin);return{index:e,top:t-i,isMargin:t>=s-this.gridInfo.cellMargin&&t<s}}getPreviousDiffColumns(t){let e={totalWidth:0,columns:new Array};return this.gridInfo.diffColumnSize.forEach((function(i,s){s<=t&&(e.totalWidth+=i,e.columns.push({index:s,width:i}))})),e}getPreviousDiffRows(t){let e={totalHeight:0,rows:new Array};return this.gridInfo.diffRowSize.forEach((function(i,s){s<=t&&(e.totalHeight+=i,e.rows.push({index:s,height:i}))})),e}getBackgroundHeaderButtonBounds(){return this.gridInfo.useHeader?this.gridInfo.useIndicator?new CRect(0,0,this.gridInfo.indicatorWidth+this.gridInfo.cellMargin,this.gridInfo.headerRowHeight*this.gridInfo.headerCount+this.gridInfo.cellMargin*this.gridInfo.headerCount):new CRect(0,0,this.gridInfo.cellMargin,this.gridInfo.headerRowHeight*this.gridInfo.headerCount+this.gridInfo.cellMargin*this.gridInfo.headerCount):new CRect(0,0,this.gridInfo.cellMargin,this.gridInfo.cellMargin)}getBackgroundHeaderBounds(){let t=0;return this.gridInfo.useIndicator&&(t=this.gridInfo.indicatorWidth+this.gridInfo.cellMargin),this.gridInfo.useHeader?new CRect(t,0,this.scrollBox.background.position.width,this.gridInfo.headerRowHeight*this.gridInfo.headerCount+this.gridInfo.cellMargin*this.gridInfo.headerCount):new CRect(t,0,this.scrollBox.background.position.width,this.gridInfo.cellMargin)}getBackgroundIndicatorBounds(){return this.gridInfo.useIndicator?new CRect(0,this.getBackgroundHeaderBounds().height,this.gridInfo.indicatorWidth+this.gridInfo.cellMargin,this.scrollBox.background.position.height):new CRect(0,this.getBackgroundHeaderBounds().height,this.gridInfo.cellMargin,this.scrollBox.background.position.height)}getBackgroundTopFixBounds(){let t=CRect.newEmpty();if(0==this.gridInfo.fixTop.length)t.left=this.getBackgroundIndicatorBounds().width,t.top=this.getBackgroundHeaderBounds().height,t.right=this.scrollBox.background.position.width,t.bottom=this.getBackgroundHeaderBounds().height;else{let e=0;for(let t=0;t<this.gridInfo.fixTop.length;t++)e+=this.gridInfo.fixTop.get(t);t.left=this.getBackgroundIndicatorBounds().width,t.top=this.getBackgroundHeaderBounds().height,t.right=this.scrollBox.background.position.width,t.bottom=this.getBackgroundHeaderBounds().height+e+this.gridInfo.cellMargin*this.gridInfo.fixTop.length}return t}getBackgroundLeftFixBounds(){let t=CRect.newEmpty();if(0==this.gridInfo.fixLeft.length)t.left=this.getBackgroundIndicatorBounds().width,t.top=this.getBackgroundHeaderBounds().height+this.getBackgroundTopFixBounds().height,t.right=this.getBackgroundIndicatorBounds().width,t.bottom=this.scrollBox.background.position.height-this.getBackgroundBottomFixBounds().height;else{let e=0;for(let t=0;t<this.gridInfo.fixLeft.length;t++)e+=this.gridInfo.fixLeft.get(t);t.left=this.getBackgroundIndicatorBounds().width,t.top=this.getBackgroundHeaderBounds().height+this.getBackgroundTopFixBounds().height,t.right=this.getBackgroundIndicatorBounds().width+e+this.gridInfo.cellMargin*this.gridInfo.fixLeft.length,t.bottom=this.scrollBox.background.position.height-this.getBackgroundBottomFixBounds().height}return t}getBackgroundRightFixBounds(){let t=CRect.newEmpty();if(0==this.gridInfo.fixRight.length)t.left=this.scrollBox.background.position.width,t.top=this.getBackgroundHeaderBounds().height+this.getBackgroundTopFixBounds().height,t.right=this.scrollBox.background.position.width,t.bottom=this.scrollBox.background.position.height-this.getBackgroundBottomFixBounds().height;else{let e=0;for(let t=0;t<this.gridInfo.fixRight.length;t++)e+=this.gridInfo.fixRight.get(t);t.left=this.scrollBox.background.position.width-e-this.gridInfo.cellMargin*this.gridInfo.fixRight.length,t.top=this.getBackgroundHeaderBounds().height+this.getBackgroundTopFixBounds().height,t.right=this.scrollBox.background.position.width,t.bottom=this.scrollBox.background.position.height-this.getBackgroundBottomFixBounds().height}return t}getBackgroundBottomFixBounds(){let t=CRect.newEmpty();if(0==this.gridInfo.fixBottom.length)t.left=this.getBackgroundIndicatorBounds().width,t.top=this.scrollBox.background.position.height,t.right=this.scrollBox.background.position.width,t.bottom=this.scrollBox.background.position.height;else{let e=0;for(let t=0;t<this.gridInfo.fixBottom.length;t++)e+=this.gridInfo.fixBottom.get(t);t.left=this.getBackgroundIndicatorBounds().width,t.top=this.scrollBox.background.position.height-e-this.gridInfo.cellMargin*this.gridInfo.fixBottom.length,t.right=this.scrollBox.background.position.width,t.bottom=this.scrollBox.background.position.height}return t}getBackgroundClientBounds(){return new CRect(this.getBackgroundLeftFixBounds().right,this.getBackgroundTopFixBounds().bottom,this.scrollBox.background.position.width-this.getBackgroundRightFixBounds().width,this.scrollBox.background.position.height-this.getBackgroundBottomFixBounds().height)}getBackgroundAllClientBounds(){let t=this.getBackgroundLeftFixBounds(),e=this.getBackgroundTopFixBounds(),i=this.getBackgroundRightFixBounds(),s=this.getBackgroundBottomFixBounds();return new CRect(t.left,e.top,i.right,s.bottom)}getContentWidth(){let t=this.getPreviousDiffColumns(this.gridInfo.columnCount-1);return this.gridInfo.defaultColumnWidth*(this.gridInfo.columnCount-t.columns.length)+t.totalWidth+this.gridInfo.cellMargin*this.gridInfo.columnCount-this.gridInfo.cellMargin}getContentHeight(){let t=this.getPreviousDiffRows(this.gridInfo.rowCount-1);return this.gridInfo.defaultRowHeight*(this.gridInfo.rowCount-t.rows.length)+t.totalHeight+this.gridInfo.cellMargin*this.gridInfo.rowCount-this.gridInfo.cellMargin}getCellBounds(t,e){let i=new CRect;if(t>=0&&e>=0){let s=this.getPreviousDiffColumns(t);if(this.gridInfo.useFitWidth){let e=this.getBackgroundColumns();i.left=e.area[t].left,i.right=e.area[t].right}else{i.right=this.gridInfo.defaultColumnWidth*(t+1-s.columns.length)+s.totalWidth+this.gridInfo.cellMargin*(t+1);let e=this.gridInfo.diffColumnSize.get(t);i.left=null==e?i.right-this.gridInfo.defaultColumnWidth-this.gridInfo.cellMargin:i.right-e-this.gridInfo.cellMargin}let o=this.getPreviousDiffRows(e);i.bottom=this.gridInfo.defaultRowHeight*(e+1-o.rows.length)+o.totalHeight+this.gridInfo.cellMargin*(e+1);let a=this.gridInfo.diffRowSize.get(e);i.top=null==a?i.bottom-this.gridInfo.defaultRowHeight-this.gridInfo.cellMargin:i.bottom-a-this.gridInfo.cellMargin}return i}getHeaderCellBounds(t,e){let i=new CRect,s=this.getPreviousDiffColumns(t);if(this.gridInfo.useFitWidth){let e=this.getBackgroundColumns();i.left=e.area[t].left,i.right=e.area[t].right}else{i.right=this.gridInfo.defaultColumnWidth*(t+1-s.columns.length)+s.totalWidth+this.gridInfo.cellMargin*(t+1);let e=this.gridInfo.diffColumnSize.get(t);i.left=null==e?i.right-this.gridInfo.defaultColumnWidth-this.gridInfo.cellMargin:i.right-e-this.gridInfo.cellMargin}return i.bottom=this.gridInfo.headerRowHeight*(e+1)+this.gridInfo.cellMargin*(e+1),i.top=i.bottom-this.gridInfo.headerRowHeight-this.gridInfo.cellMargin,i}getBackgroundColumns(){if(this.gridInfo.useFitWidth){let t=this.getPreviousDiffColumns(this.gridInfo.columnCount-1),e=this.getBackgroundClientBounds().width-t.totalWidth-this.gridInfo.cellMargin*(this.gridInfo.columnCount-1);e/=this.gridInfo.columnCount-t.columns.length;let i=new Array,s=0;for(let t=0;t<this.gridInfo.columnCount;t++){let o=this.gridInfo.diffColumnSize.get(t);null==o?(i.push({left:s,right:s+e+this.gridInfo.cellMargin}),s+=e+this.gridInfo.cellMargin):(i.push({left:s,right:s+o+this.gridInfo.cellMargin}),s+=o+this.gridInfo.cellMargin)}return{startIndex:0,left:0,area:i}}{let t=this.xToColumn(this.scrollX),e=t.index,i=0,s=0,o=new Array;for(;;){let a=this.gridInfo.diffColumnSize.get(e);if(i=null==a?this.gridInfo.defaultColumnWidth+this.gridInfo.cellMargin:a+this.gridInfo.cellMargin,o.push({left:s,right:s+i}),s+=i,this.getBackgroundClientBounds().width<s-t.left||this.gridInfo.columnCount-1<=e)break;e++}return{startIndex:t.index,left:t.left,area:o}}}getBackgroundRows(){let t=this.yToRow(this.scrollY),e=t.index,i=0,s=0,o=new Array;for(;;){let a=this.gridInfo.diffRowSize.get(e);if(i=null==a?this.gridInfo.defaultRowHeight+this.gridInfo.cellMargin:a+this.gridInfo.cellMargin,o.push({top:s,bottom:s+i}),s+=i,this.getBackgroundClientBounds().height<s-t.top||this.gridInfo.rowCount-1<=e)break;e++}return{startIndex:t.index,top:t.top,area:o}}clearDiffColumns(){this.gridInfo.diffColumnSize.clear()}clearDiffRows(){this.gridInfo.diffRowSize.clear()}clearDiff(){this.clearDiffColumns(),this.clearDiffRows()}getMergeCell(t,e){let i=t,s=e;for(let o=0;o<this.gridInfo.mergeCell.length;o++)if(this.gridInfo.mergeCell.get(o).isIn(new CPoint(t,e))){i=this.gridInfo.mergeCell.get(o).startCell.x,s=this.gridInfo.mergeCell.get(o).startCell.y;break}return{column:i,row:s}}getHeaderMergeCell(t,e){let i=t,s=e;for(let o=0;o<this.gridInfo.mergeHeaderCell.length;o++)if(this.gridInfo.mergeHeaderCell.get(o).isIn(new CPoint(t,e))){i=this.gridInfo.mergeHeaderCell.get(o).startCell.x,s=this.gridInfo.mergeHeaderCell.get(o).startCell.y;break}return{column:i,row:s}}addProperties(){let t=super.addProperties();return t.push({instance:this.scrollbarResource,propertyName:"scrollbarResource",readOnly:!1,enum:[]}),t.push({instance:this.scrollbarLength,propertyName:"scrollbarLength",readOnly:!1,enum:[]}),t}}!function(t){t[t.LEFT=0]="LEFT",t[t.CLIENT=1]="CLIENT",t[t.RIGHT=2]="RIGHT"}(ECellControlAlign||(ECellControlAlign={}));class CCellControl extends CNotifyChangeKindObject{get canvasItemsData(){return this._canvasItemsData}get align(){return this._align}set align(t){this._align!=t&&(this._align=t,this.doChange("align"))}get margins(){return this._margins}get width(){return this._width}set width(t){this._width!=t&&(this._width=t,this.doChange("width"))}get controlCanvasItemsResource(){return this._controlCanvasItemsResource}set controlCanvasItemsResource(t){if(this._controlCanvasItemsResource!=t){this._controlCanvasItemsResource=t;let e=CSystem.resources.get(this._controlCanvasItemsResource);null!=e&&this.canvasItemsData.fromData(e),this.doChange("controlCanvasItemsResource")}}get text(){return this._text}set text(t){this._text!=t&&(this._text=t,this.doChange("text"))}get isOver(){return this._isOver}set isOver(t){this._isOver!=t&&(this._isOver=t,this.doChange("isOver"))}constructor(){super(),this._canvasItemsData=new CCanvasItems,this._align=ECellControlAlign.RIGHT,this._width=30,this._margins=new CNotifyRect,this._controlCanvasItemsResource="",this._name="",this._text="",this._isOver=!1,this.col=-1,this.row=-1,this.bounds=new CRect;let t=this;this.margins.onChange=function(){t.doChange("margins")}}}class CCustumCanvasGrid extends CCustomGrid{get cell1Items(){return this._cell1Items}set cell1Items(t){this._cell1Items!=t&&(this._cell1Items=t,this._cell1Items&&(0==this.__cellData.length?this.__cellData.push(this._cell1Items):this.__cellData[0]=this._cell1Items))}get cell2Items(){return this._cell2Items}set cell2Items(t){this._cell2Items!=t&&(this._cell2Items=t,this._cell2Items&&(0==this.__cellData.length?(this.cell1Items=new CCanvasItems,this.cell1Items.fromData(this._cell2Items.toData()),this.__cellData.push(this.cell1Items),this.__cellData.push(this._cell2Items)):1==this.__cellData.length?this.__cellData.push(this._cell2Items):this.__cellData.length>1&&(this.__cellData[1]=this._cell2Items)))}get cellTopLeftFixResource(){return this._cellTopLeftFixResource}set cellTopLeftFixResource(t){this._cellTopLeftFixResource=t,this.__cellTopLeftFixData=[];for(let e=0;e<t.length;e++){let i=CSystem.resources.get(t[e]);if(null!=i){let t=new CCanvasItems;t.fromData(i),this.__cellTopLeftFixData.push(t)}}this.itemLayerDraw()}get cellTopResource(){return this._cellTopResource}set cellTopResource(t){this._cellTopResource=t,this.__cellTopData=[];for(let e=0;e<t.length;e++){let i=CSystem.resources.get(t[e]);if(null!=i){let t=new CCanvasItems;t.fromData(i),this.__cellTopData.push(t)}}this.itemLayerDraw()}get cellTopRightFixResource(){return this._cellTopRightFixResource}set cellTopRightFixResource(t){this._cellTopRightFixResource=t,this.__cellTopRightFixData=[];for(let e=0;e<t.length;e++){let i=CSystem.resources.get(t[e]);if(null!=i){let t=new CCanvasItems;t.fromData(i),this.__cellTopRightFixData.push(t)}}this.itemLayerDraw()}get cellBottomLeftFixResource(){return this._cellBottomLeftFixResource}set cellBottomLeftFixResource(t){this._cellBottomLeftFixResource=t,this.__cellBottomLeftFixData=[];for(let e=0;e<t.length;e++){let i=CSystem.resources.get(t[e]);if(null!=i){let t=new CCanvasItems;t.fromData(i),this.__cellBottomLeftFixData.push(t)}}this.itemLayerDraw()}get cellBottomResource(){return this._cellBottomResource}set cellBottomResource(t){this._cellBottomResource=t,this.__cellBottomData=[];for(let e=0;e<t.length;e++){let i=CSystem.resources.get(t[e]);if(null!=i){let t=new CCanvasItems;t.fromData(i),this.__cellBottomData.push(t)}}this.itemLayerDraw()}get cellBottomRightFixResource(){return this._cellBottomRightFixResource}set cellBottomRightFixResource(t){this._cellBottomRightFixResource=t,this.__cellBottomRightFixData=[];for(let e=0;e<t.length;e++){let i=CSystem.resources.get(t[e]);if(null!=i){let t=new CCanvasItems;t.fromData(i),this.__cellBottomRightFixData.push(t)}}this.itemLayerDraw()}get cellLeftFixResource(){return this._cellLeftFixResource}set cellLeftFixResource(t){this._cellLeftFixResource=t,this.__cellLeftFixData=[];for(let e=0;e<t.length;e++){let i=CSystem.resources.get(t[e]);if(null!=i){let t=new CCanvasItems;t.fromData(i),this.__cellLeftFixData.push(t)}}this.itemLayerDraw()}get cellRightFixResource(){return this._cellRightFixResource}set cellRightFixResource(t){this._cellRightFixResource=t,this.__cellRightFixData=[];for(let e=0;e<t.length;e++){let i=CSystem.resources.get(t[e]);if(null!=i){let t=new CCanvasItems;t.fromData(i),this.__cellRightFixData.push(t)}}this.itemLayerDraw()}get cellResource(){return this._cellResource}set cellResource(t){this._cellResource=t,this.__cellData=[];for(let e=0;e<t.length;e++){let i=CSystem.resources.get(t[e]);if(null!=i){let t=new CCanvasItems;t.fromData(i),this.__cellData.push(t)}}this.itemLayerDraw()}get headerLeftFixResource(){return this._headerLeftFixResource}set headerLeftFixResource(t){this._headerLeftFixResource=t,this.__headerLeftFixData=[];for(let e=0;e<t.length;e++){let i=CSystem.resources.get(t[e]);if(null!=i){let t=new CCanvasItems;t.fromData(i),this.__headerLeftFixData.push(t)}}this.itemLayerDraw()}get headerResource(){return this._headerResource}set headerResource(t){this._headerResource=t,this.__headerData=[];for(let e=0;e<t.length;e++){let i=CSystem.resources.get(t[e]);if(null!=i){let t=new CCanvasItems;t.fromData(i),this.__headerData.push(t)}}this.itemLayerDraw()}get headerRightFixResource(){return this._headerRightFixResource}set headerRightFixResource(t){this._headerRightFixResource=t,this.__headerRightFixData=[];for(let e=0;e<t.length;e++){let i=CSystem.resources.get(t[e]);if(null!=i){let t=new CCanvasItems;t.fromData(i),this.__headerRightFixData.push(t)}}this.itemLayerDraw()}get indicatorTopFixResource(){return this._indicatorTopFixResource}set indicatorTopFixResource(t){this._indicatorTopFixResource=t,this.__indicatorTopFixData=[];for(let e=0;e<t.length;e++){let i=CSystem.resources.get(t[e]);if(null!=i){let t=new CCanvasItems;t.fromData(i),this.__indicatorTopFixData.push(t)}}this.itemLayerDraw()}get indicatorResource(){return this._indicatorResource}set indicatorResource(t){this._indicatorResource=t,this.__indicatorData=[];for(let e=0;e<t.length;e++){let i=CSystem.resources.get(t[e]);if(null!=i){let t=new CCanvasItems;t.fromData(i),this.__indicatorData.push(t)}}this.itemLayerDraw()}get indicatorBottomFixResource(){return this._indicatorBottomFixResource}set indicatorBottomFixResource(t){this._indicatorBottomFixResource=t,this.__indicatorBottomFixData=[];for(let e=0;e<t.length;e++){let i=CSystem.resources.get(t[e]);if(null!=i){let t=new CCanvasItems;t.fromData(i),this.__indicatorBottomFixData.push(t)}}this.itemLayerDraw()}get headerButtonResource(){return this._headerButtonResource}set headerButtonResource(t){if(this._headerButtonResource!=t){this._headerButtonResource=t;let e=CSystem.resources.get(t);null!=e&&this.__headerButtonData.fromData(e),this.itemLayerDraw()}}get selectItems(){return this._selectItems}constructor(t,e){super(t,e),this.isDraw=!0,this.__cellTopLeftFixData=new Array,this.__cellTopData=new Array,this.__cellTopRightFixData=new Array,this.__cellBottomLeftFixData=new Array,this.__cellBottomData=new Array,this.__cellBottomRightFixData=new Array,this.__cellLeftFixData=new Array,this.__cellRightFixData=new Array,this.__cellData=new Array,this.__headerLeftFixData=new Array,this.__headerData=new Array,this.__headerRightFixData=new Array,this.__indicatorTopFixData=new Array,this.__indicatorData=new Array,this.__indicatorBottomFixData=new Array,this.__headerButtonData=new CCanvasItems,this._cellTopLeftFixResource=new ArrayString,this._cellTopResource=new ArrayString,this._cellTopRightFixResource=new ArrayString,this._cellBottomLeftFixResource=new ArrayString,this._cellBottomResource=new ArrayString,this._cellBottomRightFixResource=new ArrayString,this._cellLeftFixResource=new ArrayString,this._cellRightFixResource=new ArrayString,this._cellResource=new ArrayString,this._headerLeftFixResource=new ArrayString,this._headerResource=new ArrayString,this._headerRightFixResource=new ArrayString,this._headerButtonResource="",this._indicatorTopFixResource=new ArrayString,this._indicatorResource=new ArrayString,this._indicatorBottomFixResource=new ArrayString,this._selectItems=new CStringSet,this._multiSelect=!1,this._rowSelect=!0,this.specificCellCanvasItemsResources=new CMap,this.specificCell=new CMap,this.specificColumn=new CMap,this.specificRow=new CMap,this.cellControls=new CMap,this.columnControl=new CMap;let i=this;this.__itemsLayer=this.scrollBox.layers.addLayer(),CSystem.elementBrintToFront(this.__itemsLayer.canvas),this.__itemsLayer.onDraw=function(t,e){i.doItemLayerDraw(e),i.scrollBox.doScroll()},this._selectItems.onChange=function(){i.itemLayerDraw()},this.cellControls.onChange=function(t,e,s,o){if(null!=o){let t=e.split(",");o.onChange=function(){for(let e=0;e<o.length;e++)o.get(e).onChange=function(){i.doChangeCellControl(parseInt(t[0]),parseInt(t[1]),parseInt(t[2]),o.get(e)),i.itemLayerDraw()};i.itemLayerDraw()};for(let e=0;e<o.length;e++)o.get(e).onChange=function(){i.doChangeCellControl(parseInt(t[0]),parseInt(t[1]),parseInt(t[2]),o.get(e)),i.itemLayerDraw()}}i.itemLayerDraw()},this.columnControl.onChange=function(t,e,s,o){if(null!=o){let t=e.split(",");o.onChange=function(){for(let e=0;e<o.length;e++)o.get(e).onChange=function(){i.doChangeCellControl(parseInt(t[0]),parseInt(t[1]),parseInt(t[2]),o.get(e)),i.itemLayerDraw()};i.itemLayerDraw()};for(let e=0;e<o.length;e++)o.get(e).onChange=function(){i.doChangeCellControl(parseInt(t[0]),parseInt(t[1]),parseInt(t[2]),o.get(e)),i.itemLayerDraw()}}i.itemLayerDraw()},this.specificCellCanvasItemsResources.onChange=function(t,e,s,o){i.itemLayerDraw()},this.specificCell.onChange=function(){i.itemLayerDraw()},this.specificColumn.onChange=function(){i.itemLayerDraw()},this.specificRow.onChange=function(){i.itemLayerDraw()}}doToData(t){super.doToData(t),CDataClass.putData(t,"cellTopLeftFixResource",this.cellTopLeftFixResource,[],!0),CDataClass.putData(t,"cellTopResource",this.cellTopResource,[],!0),CDataClass.putData(t,"cellTopRightFixResource",this.cellTopRightFixResource,[],!0),CDataClass.putData(t,"cellBottomLeftFixResource",this.cellBottomLeftFixResource,[],!0),CDataClass.putData(t,"cellBottomResource",this.cellBottomResource,[],!0),CDataClass.putData(t,"cellBottomRightFixResource",this.cellBottomRightFixResource,[],!0),CDataClass.putData(t,"cellLeftFixResource",this.cellLeftFixResource,[],!0),CDataClass.putData(t,"cellRightFixResource",this.cellRightFixResource,[],!0),CDataClass.putData(t,"cellResource",this.cellResource,[],!0),CDataClass.putData(t,"headerLeftFixResource",this.headerLeftFixResource,[],!0),CDataClass.putData(t,"headerResource",this.headerResource,[],!0),CDataClass.putData(t,"headerRightFixResource",this.headerRightFixResource,[],!0),CDataClass.putData(t,"headerButtonResource",this.headerButtonResource,""),CDataClass.putData(t,"indicatorTopFixResource",this.indicatorTopFixResource,[],!0),CDataClass.putData(t,"indicatorResource",this.indicatorResource,[],!0),CDataClass.putData(t,"indicatorBottomFixResource",this.indicatorBottomFixResource,[],!0),0==this.cellResource.length&&(this.cell1Items&&CDataClass.putData(t,"cell1Items",this.cell1Items.toData(),{},!0),this.cell2Items&&CDataClass.putData(t,"cell2Items",this.cell2Items.toData(),{},!0))}doFromData(t){if(super.doFromData(t),this.cellTopLeftFixResource=CDataClass.getData(t,"cellTopLeftFixResource",[],!0),this.cellTopResource=CDataClass.getData(t,"cellTopResource",[],!0),this.cellTopRightFixResource=CDataClass.getData(t,"cellTopRightFixResource",[],!0),this.cellBottomLeftFixResource=CDataClass.getData(t,"cellBottomLeftFixResource",[],!0),this.cellBottomResource=CDataClass.getData(t,"cellBottomResource",[],!0),this.cellBottomRightFixResource=CDataClass.getData(t,"cellBottomRightFixResource",[],!0),this.cellLeftFixResource=CDataClass.getData(t,"cellLeftFixResource",[],!0),this.cellRightFixResource=CDataClass.getData(t,"cellRightFixResource",[],!0),this.cellResource=CDataClass.getData(t,"cellResource",[],!0),this.headerLeftFixResource=CDataClass.getData(t,"headerLeftFixResource",[],!0),this.headerResource=CDataClass.getData(t,"headerResource",[],!0),this.headerRightFixResource=CDataClass.getData(t,"headerRightFixResource",[],!0),this.headerButtonResource=CDataClass.getData(t,"headerButtonResource",""),this.indicatorTopFixResource=CDataClass.getData(t,"indicatorTopFixResource",[],!0),this.indicatorResource=CDataClass.getData(t,"indicatorResource",[],!0),this.indicatorBottomFixResource=CDataClass.getData(t,"indicatorBottomFixResource",[],!0),0==this.cellResource.length){let e=CDataClass.getData(t,"cell1Items",void 0);e&&(this.cell1Items=new CCanvasItems,this.cell1Items.fromData(e));let i=CDataClass.getData(t,"cell2Items",void 0);i&&(this.cell2Items=new CCanvasItems,this.cell2Items.fromData(i))}}clearBounds(t){let e=this.__itemsLayer.context;null!=e&&e.clearRect(t.left,t.top,t.width,t.height)}drawBounds(t,e,i,s,o){let a=this.__itemsLayer.context;if(null!=a){let n=s;if(this.specificRow.has(t+","+i)){let e=this.specificRow.get(t+","+i);if(null!=e){let t=this.specificCellCanvasItemsResources.get(e);if(null!=t){let e=new CCanvasItems;e.fromData(t),n=e}}}if(this.specificColumn.has(t+","+e)){let i=this.specificColumn.get(t+","+e);if(null!=i){let t=this.specificCellCanvasItemsResources.get(i);if(null!=t){let e=new CCanvasItems;e.fromData(t),n=e}}}if(this.specificCell.has(t+","+e+","+i)){let s=this.specificColumn.get(t+","+e+","+i);if(null!=s){let t=this.specificCellCanvasItemsResources.get(s);if(null!=t){let e=new CCanvasItems;e.fromData(t),n=e}}}let r=this.doBeforeCellDraw(t,e,i,n,o);null!=r&&(n=r);let l=n.getItem("over");for(let s=0;s<l.length;s++)if(t==EPointerAreaKind.HEADER_CLIENT){let o=this.getHeaderMergeCell(this.__cellInfo.col,this.__cellInfo.row);l[s].visible=this.__cellInfo.kind==t&&e==o.column&&i==o.row}else if(t==EPointerAreaKind.CLIENT){let o=this.getMergeCell(this.__cellInfo.col,this.__cellInfo.row);l[s].visible=this.__cellInfo.kind==t&&e==o.column&&i==o.row}else l[s].visible=this.__cellInfo.kind==t&&this.__cellInfo.col==e&&this.__cellInfo.row==i;let h=n.getItem("select");for(let t=0;t<h.length;t++)this._rowSelect?h[t].visible=this._selectItems.has(i+""):h[t].visible=this._selectItems.has(e+","+i);this.doCellDraw(a,t,e,i,n,o)}}cellControlBounds(t,e,i,s){let o;if(o=this.cellControls.get(t+","+e+","+i),null==o&&(o=this.columnControl.get(t+","+e)),null!=o){let t=new Array;for(let e=0;e<o.length;e++){let i=o.get(e),a=new CRect;switch(i.align){case ECellControlAlign.LEFT:a.left=s.left+i.margins.left,a.top=s.top+i.margins.top,a.width=i.width,a.height=s.height-(i.margins.bottom+i.margins.top);break;case ECellControlAlign.CLIENT:a.left=s.left+i.margins.left,a.top=s.top+i.margins.top,a.width=s.width-(i.margins.right+i.margins.left),a.height=s.height-(i.margins.bottom+i.margins.top);break;case ECellControlAlign.RIGHT:a.left=s.right-i.width-i.margins.right,a.top=s.top+i.margins.top,a.width=i.width,a.height=s.height-(i.margins.bottom+i.margins.top)}i.bounds=a,t.push(i)}return t}}getCellControls(t,e,i){let s;if(s=this.cellControls.get(t+","+e+","+i),null==s&&(s=this.columnControl.get(t+","+e)),null!=s){let t=new Array;for(let e=0;e<s.length;e++){let i=s.get(e);t.push(i)}return t}}doBeforeCellDraw(t,e,i,s,o){if(null!=this.onBeforeCellDraw)return this.onBeforeCellDraw(this,t,e,i,s,o)}doCellDraw(t,e,i,s,o,a){o.draw(t,a,this.__itemsLayer.offset,CSystem.bufferingContext,1,1);let n=this.cellControlBounds(e,i,s,a);if(null!=n)for(let e=0;e<n.length;e++){let o=n[e],a=o.canvasItemsData.getItem("over");for(let t=0;t<a.length;t++)a[t].visible=o.isOver&&o.col==i&&o.row==s;let r=o.canvasItemsData.getItem("text");for(let t=0;t<r.length;t++)r[t].text=o.text;o.canvasItemsData.draw(t,o.bounds,this.__itemsLayer.offset,CSystem.bufferingContext,1,1)}null!=this.onCellDraw&&this.onCellDraw(this,t,e,i,s,o,a)}doCellPointerMove(t,e,i,s,o,a,n,r,l){super.doCellPointerMove(t,e,i,s,o,a,n,r,l);let h=this.getCellControls(t,e,i);if(null!=h)for(let t=0;t<h.length;t++){let r=!1;switch(h[t].align){case ECellControlAlign.LEFT:r=s>=h[t].margins.left&&s<h[t].margins.left+h[t].width&&o>=h[t].margins.top&&o<n-h[t].margins.bottom;break;case ECellControlAlign.CLIENT:r=s>=h[t].margins.left&&s<a-h[t].margins.right&&o>=h[t].margins.top&&o<n-h[t].margins.bottom;break;case ECellControlAlign.RIGHT:r=s>=a-(h[t].width+h[t].margins.right)&&s<a-h[t].margins.right&&o>=h[t].margins.top&&o<n-h[t].margins.bottom}h[t].isOver!=r&&(h[t].isOver=r,h[t].col=e,h[t].row=i,this.itemLayerDraw())}}doCellPointerOver(t,e,i,s,o){super.doCellPointerOver(t,e,i,s,o),this.itemLayerDraw()}doCellPointerOut(t,e,i,s,o){super.doCellPointerOut(t,e,i,s,o);let a=this.getCellControls(t,e,i);if(null!=a)for(let t=0;t<a.length;t++)0!=a[t].isOver&&(a[t].isOver=!1,this.itemLayerDraw());this.itemLayerDraw()}doCellClick(t,e,i,s,o,a,n,r,l){super.doCellClick(t,e,i,s,o,a,n,r,l);let h=this.getCellControls(t,e,i);if(null!=h)for(let d=0;d<h.length;d++){let g=!1;switch(h[d].align){case ECellControlAlign.LEFT:g=s>=h[d].margins.left&&s<h[d].margins.left+h[d].width&&o>=h[d].margins.top&&o<n-h[d].margins.bottom;break;case ECellControlAlign.CLIENT:g=s>=h[d].margins.left&&s<a-h[d].margins.right&&o>=h[d].margins.top&&o<n-h[d].margins.bottom;break;case ECellControlAlign.RIGHT:g=s>=a-(h[d].width+h[d].margins.right)&&s<a-h[d].margins.right&&o>=h[d].margins.top&&o<n-h[d].margins.bottom}g&&this.doCellControlClick(t,e,i,d,h[d],s,o,a,n,r,l)}}doCellControlClick(t,e,i,s,o,a,n,r,l,h,d){null!=this.onCellControlClick&&this.onCellControlClick(this,t,e,i,s,o,a,n,r,l,h,d)}doSetBounds(){this.itemLayerDraw(),super.doSetBounds()}doItemLayerDraw(t){this.isDraw&&(t.clearRect(0,0,this.__itemsLayer.canvas.width,this.__itemsLayer.canvas.height),this.doCellsBounds())}doBeforeHeaderButtomCellBounds(t){this.clearBounds(t)}doHeaderButtonCellBounds(t){this.__headerButtonData.length>0?this.drawBounds(EPointerAreaKind.HEADER_BUTTON,0,0,this.__headerButtonData,t):this.__headerData.length>0?this.drawBounds(EPointerAreaKind.HEADER_BUTTON,0,0,this.__headerData[0],t):this.__cellData.length>0&&this.drawBounds(EPointerAreaKind.HEADER_BUTTON,0,0,this.__cellData[0],t)}doBeforeHeaderLeftFixCellBounds(t){this.clearBounds(t)}doBeforeHeaderCellBounds(t){this.clearBounds(t)}doBeforeHeaderRightFixCellBounds(t){this.clearBounds(t)}doHeaderLeftFixCellBounds(t,e,i){this.__headerLeftFixData.length>0?this.drawBounds(EPointerAreaKind.HEADER_LEFT_FIX,t,e,this.__headerLeftFixData[e%this.__headerLeftFixData.length],i):this.__headerRightFixData.length>0?this.drawBounds(EPointerAreaKind.HEADER_LEFT_FIX,t,e,this.__headerRightFixData[e%this.__headerRightFixData.length],i):this.__headerData.length>0?this.drawBounds(EPointerAreaKind.HEADER_LEFT_FIX,t,e,this.__headerData[e%this.__headerData.length],i):this.__cellData.length>0&&this.drawBounds(EPointerAreaKind.HEADER_LEFT_FIX,t,e,this.__cellData[e%this.__cellData.length],i)}doHeaderCellBounds(t,e,i,s){this.__headerData.length>0?this.drawBounds(EPointerAreaKind.HEADER_CLIENT,t,e,this.__headerData[e%this.__headerData.length],i):this.__cellData.length>0&&this.drawBounds(EPointerAreaKind.HEADER_CLIENT,t,e,this.__cellData[e%this.__cellData.length],i)}doHeaderRightFixCellBounds(t,e,i){this.__headerRightFixData.length>0?this.drawBounds(EPointerAreaKind.HEADER_RIGHT_FIX,t,e,this.__headerRightFixData[e%this.__headerRightFixData.length],i):this.__headerLeftFixData.length>0?this.drawBounds(EPointerAreaKind.HEADER_RIGHT_FIX,t,e,this.__headerLeftFixData[e%this.__headerLeftFixData.length],i):this.__headerData.length>0?this.drawBounds(EPointerAreaKind.HEADER_RIGHT_FIX,t,e,this.__headerData[e%this.__headerData.length],i):this.__cellData.length>0&&this.drawBounds(EPointerAreaKind.HEADER_RIGHT_FIX,t,e,this.__cellData[e%this.__cellData.length],i)}doBeforeIndicatorTopFixCellBounds(t){this.clearBounds(t)}doBeforeIndicatorCellBounds(t){this.clearBounds(t)}doBeforeIndicatorBottomFixCellBounds(t){this.clearBounds(t)}doIndicatorTopFixCellBounds(t,e){this.__indicatorTopFixData.length>0?this.drawBounds(EPointerAreaKind.INDICATOR_TOP_FIX,0,t,this.__indicatorTopFixData[t%this.__indicatorTopFixData.length],e):this.__indicatorBottomFixData.length>0?this.drawBounds(EPointerAreaKind.INDICATOR_TOP_FIX,0,t,this.__indicatorBottomFixData[t%this.__indicatorBottomFixData.length],e):this.__indicatorData.length>0?this.drawBounds(EPointerAreaKind.INDICATOR_TOP_FIX,0,t,this.__indicatorData[t%this.__indicatorData.length],e):this.__cellData.length>0&&this.drawBounds(EPointerAreaKind.INDICATOR_TOP_FIX,0,t,this.__cellData[t%this.__cellData.length],e)}doIndicatorCellBounds(t,e){this.__indicatorData.length>0?this.drawBounds(EPointerAreaKind.INDICATOR_CLIENT,0,t,this.__indicatorData[t%this.__indicatorData.length],e):this.__cellData.length>0&&this.drawBounds(EPointerAreaKind.INDICATOR_CLIENT,0,t,this.__cellData[t%this.__cellData.length],e)}doIndicatorBottomFixCellBounds(t,e){this.__indicatorBottomFixData.length>0?this.drawBounds(EPointerAreaKind.INDICATOR_BOTTOM_FIX,0,t,this.__indicatorBottomFixData[t%this.__indicatorBottomFixData.length],e):this.__indicatorTopFixData.length>0?this.drawBounds(EPointerAreaKind.INDICATOR_BOTTOM_FIX,0,t,this.__indicatorTopFixData[t%this.__indicatorTopFixData.length],e):this.__indicatorData.length>0?this.drawBounds(EPointerAreaKind.INDICATOR_BOTTOM_FIX,0,t,this.__indicatorData[t%this.__indicatorData.length],e):this.__cellData.length>0&&this.drawBounds(EPointerAreaKind.INDICATOR_BOTTOM_FIX,0,0,this.__cellData[t%this.__cellData.length],e)}doBeforeTopLeftFixCellBounds(t){this.clearBounds(t)}doBeforeTopCellBounds(t){this.clearBounds(t)}doBeforeTopRightFixCellBounds(t){this.clearBounds(t)}doTopLeftFixCellBounds(t,e,i){this.__cellTopLeftFixData.length>0?this.drawBounds(EPointerAreaKind.TOP_LEFT_FIX,t,e,this.__cellTopLeftFixData[e%this.__cellTopLeftFixData.length],i):this.__cellTopRightFixData.length>0?this.drawBounds(EPointerAreaKind.TOP_LEFT_FIX,t,e,this.__cellTopRightFixData[e%this.__cellTopRightFixData.length],i):this.__cellTopData.length>0?this.drawBounds(EPointerAreaKind.TOP_LEFT_FIX,t,e,this.__cellTopData[e%this.__cellTopData.length],i):this.__cellData.length>0&&this.drawBounds(EPointerAreaKind.TOP_LEFT_FIX,t,e,this.__cellData[e%this.__cellData.length],i)}doTopCellBounds(t,e,i,s){this.__cellTopData.length>0?this.drawBounds(EPointerAreaKind.TOP_CLIENT_FIX,t,e,this.__cellTopData[e%this.__cellTopData.length],i):this.__cellData.length>0&&this.drawBounds(EPointerAreaKind.TOP_CLIENT_FIX,t,e,this.__cellData[e%this.__cellData.length],i)}doTopRightFixCellBounds(t,e,i){this.__cellTopRightFixData.length>0?this.drawBounds(EPointerAreaKind.TOP_RIGHT_FIX,t,e,this.__cellTopRightFixData[e%this.__cellTopRightFixData.length],i):this.__cellTopLeftFixData.length>0?this.drawBounds(EPointerAreaKind.TOP_RIGHT_FIX,t,e,this.__cellTopLeftFixData[e%this.__cellTopLeftFixData.length],i):this.__cellTopData.length>0?this.drawBounds(EPointerAreaKind.TOP_RIGHT_FIX,t,e,this.__cellTopData[e%this.__cellTopData.length],i):this.__cellData.length>0&&this.drawBounds(EPointerAreaKind.TOP_RIGHT_FIX,t,e,this.__cellData[e%this.__cellData.length],i)}doBeforeBottomLeftFixCellBounds(t){this.clearBounds(t)}doBeforeBottomCellBounds(t){this.clearBounds(t)}doBeforeBottomRightFixCellBounds(t){this.clearBounds(t)}doBottomLeftFixCellBounds(t,e,i){this.__cellBottomLeftFixData.length>0?this.drawBounds(EPointerAreaKind.BOTTOM_LEFT_FIX,t,e,this.__cellBottomLeftFixData[e%this.__cellBottomLeftFixData.length],i):this.__cellBottomRightFixData.length>0?this.drawBounds(EPointerAreaKind.BOTTOM_LEFT_FIX,t,e,this.__cellBottomRightFixData[e%this.__cellBottomRightFixData.length],i):this.__cellBottomData.length>0?this.drawBounds(EPointerAreaKind.BOTTOM_LEFT_FIX,t,e,this.__cellBottomData[e%this.__cellBottomData.length],i):this.__cellData.length>0&&this.drawBounds(EPointerAreaKind.BOTTOM_LEFT_FIX,t,e,this.__cellData[e%this.__cellData.length],i)}doBottomCellBounds(t,e,i,s){this.__cellBottomData.length>0?this.drawBounds(EPointerAreaKind.BOTTOM_CLIENT_FIX,t,e,this.__cellBottomData[e%this.__cellBottomData.length],i):this.__cellData.length>0&&this.drawBounds(EPointerAreaKind.BOTTOM_CLIENT_FIX,t,e,this.__cellData[e%this.__cellData.length],i)}doBottomRightFixCellBounds(t,e,i){this.__cellBottomRightFixData.length>0?this.drawBounds(EPointerAreaKind.BOTTOM_RIGHT_FIX,t,e,this.__cellBottomRightFixData[e%this.__cellBottomRightFixData.length],i):this.__cellBottomLeftFixData.length>0?this.drawBounds(EPointerAreaKind.BOTTOM_RIGHT_FIX,t,e,this.__cellBottomLeftFixData[e%this.__cellBottomLeftFixData.length],i):this.__cellBottomData.length>0?this.drawBounds(EPointerAreaKind.BOTTOM_RIGHT_FIX,t,e,this.__cellBottomData[e%this.__cellBottomData.length],i):this.__cellData.length>0&&this.drawBounds(EPointerAreaKind.BOTTOM_RIGHT_FIX,t,e,this.__cellData[e%this.__cellData.length],i)}doBeforeLeftCellBounds(t){this.clearBounds(t)}doLeftCellBounds(t,e,i){this.__cellLeftFixData.length>0?this.drawBounds(EPointerAreaKind.LEFT_FIX,t,e,this.__cellLeftFixData[e%this.__cellLeftFixData.length],i):this.__cellRightFixData.length>0?this.drawBounds(EPointerAreaKind.LEFT_FIX,t,e,this.__cellRightFixData[e%this.__cellRightFixData.length],i):this.__cellData.length>0&&this.drawBounds(EPointerAreaKind.LEFT_FIX,t,e,this.__cellData[e%this.__cellData.length],i)}doBeforeRightCellBounds(t){this.clearBounds(t)}doRightCellBounds(t,e,i){this.__cellRightFixData.length>0?this.drawBounds(EPointerAreaKind.RIGHT_FIX,t,e,this.__cellRightFixData[e%this.__cellRightFixData.length],i):this.__cellLeftFixData.length>0?this.drawBounds(EPointerAreaKind.RIGHT_FIX,t,e,this.__cellLeftFixData[e%this.__cellLeftFixData.length],i):this.__cellData.length>0&&this.drawBounds(EPointerAreaKind.RIGHT_FIX,t,e,this.__cellData[e%this.__cellData.length],i)}doClientCellBounds(t,e,i,s){this.__cellData.length>0&&this.drawBounds(EPointerAreaKind.CLIENT,t,e,this.__cellData[e%this.__cellData.length],i)}doChangeCellControl(t,e,i,s){this.itemLayerDraw()}itemLayerDraw(){this.isDraw&&this.__itemsLayer.draw()}addSelectItem(t,e){this._multiSelect||this._selectItems.clear(),this._rowSelect?this._selectItems.add(e+""):this._selectItems.add(t+","+e)}deleteSelectItem(t,e){this._rowSelect?this._selectItems.delete(e+""):this._selectItems.delete(t+","+e)}clearSelectItem(){this._selectItems.clear()}clearCellControl(){this.cellControls.clear(),this.columnControl.clear()}getSelectItems(){let t=new Array,e=this;return this._selectItems.forEach((function(i){if(e._rowSelect)t.push({column:-1,row:parseInt(i)});else{let e=i.split(",");t.push({column:parseInt(e[0]),row:parseInt(e[1])})}})),t}columnToScrollX(t,e){let i=this.getCellBounds(t,0);return"left"==e?i.left:i.left-this.getBackgroundClientBounds().width+i.width-this.gridInfo.cellMargin}scrollXToColumn(t,e){this.scrollX=this.columnToScrollX(t,e)}rowToScrollY(t,e){let i=this.getCellBounds(0,t);return"top"==e?i.top:i.top-this.getBackgroundClientBounds().height+i.height-this.gridInfo.cellMargin}scrollYToRow(t,e){this.scrollY=this.rowToScrollY(t,e)}addCellControl(t,e,i,s,o,a,n,r){let l=new CCellControl;l.align=s,l.width=o,a.length>0&&(l.margins.left=a[0]),a.length>1&&(l.margins.top=a[1]),a.length>2&&(l.margins.right=a[2]),a.length>3&&(l.margins.bottom=a[3]),l.controlCanvasItemsResource=n,l.text=r;let h=this.cellControls.get(t+","+e+","+i);return null==h?(h=new CList,h.add(l),this.cellControls.set(t+","+e+","+i,h)):h.add(l),l}addSpecificCellCanvasItemsResource(t){let e=CSystem.resources.get(t);return null!=e&&(this.specificCellCanvasItemsResources.set(t,e),!0)}addSpecificCell(t,e,i,s){if(this.specificCellCanvasItemsResources.has(t))this.specificCell.set(e+","+i+","+s,t);else{this.addSpecificCellCanvasItemsResource(t)&&this.specificCell.set(e+","+i+","+s,t)}}addSpecificColumn(t,e,i){if(this.specificCellCanvasItemsResources.has(t))this.specificColumn.set(e+","+i,t);else{this.addSpecificCellCanvasItemsResource(t)&&this.specificColumn.set(e+","+i,t)}}addSpecificRow(t,e,i){if(this.specificCellCanvasItemsResources.has(t))this.specificRow.set(e+","+i,t);else{this.addSpecificCellCanvasItemsResource(t)&&this.specificRow.set(e+","+i,t)}}addProperties(){let t=super.addProperties();return t.push({instance:this.cell1Items,propertyName:"cell1Items",readOnly:!1,enum:[]}),t.push({instance:this.cell2Items,propertyName:"cell2Items",readOnly:!1,enum:[]}),t}}!function(t){t[t.CLICK=0]="CLICK",t[t.DOUBLE_CLICK=1]="DOUBLE_CLICK",t[t.F2_KEY=2]="F2_KEY"}(EEditorShowKind||(EEditorShowKind={}));class CCustomDataGrid extends CCustumCanvasGrid{get headerText(){return this._headerText}get headerTextCode(){return this._headerTextCode}get topFixHeaders(){return this._topFixHeaders}get topFixData(){return this.__topFixData}get topFixHeight(){return this._topFixHeight}set topFixHeight(t){this._topFixHeight=t,this.isDraw=!1;for(let e=0;e<this.gridInfo.fixTop.length;e++)this.gridInfo.fixTop.set(e,t);this.isDraw=!0,this.itemLayerDraw()}get bottomFixHeaders(){return this._bottomFixHeaders}get bottomFixData(){return this.__bottomFixData}get bottomFixHeight(){return this._bottomFixHeight}set bottomFixHeight(t){this._bottomFixHeight=t,this.isDraw=!1;for(let e=0;e<this.gridInfo.fixBottom.length;e++)this.gridInfo.fixBottom.set(e,t);this.isDraw=!0,this.itemLayerDraw()}get leftFixHeaders(){return this._leftFixHeaders}get leftFixData(){return this.__leftFixData}get leftFixWidth(){return this._leftFixWidth}set leftFixWidth(t){this._leftFixWidth=t,this.isDraw=!1;for(let e=0;e<this.gridInfo.fixLeft.length;e++)this.gridInfo.fixLeft.set(e,t);this.isDraw=!0,this.itemLayerDraw()}get rightFixHeaders(){return this._rightFixHeaders}get rightFixData(){return this.__rightFixData}get rightFixWidth(){return this._rightFixWidth}set rightFixWidth(t){this._rightFixWidth=t,this.isDraw=!1;for(let e=0;e<this.gridInfo.fixRight.length;e++)this.gridInfo.fixRight.set(e,t);this.isDraw=!0,this.itemLayerDraw()}get topIndicatorText(){return this._topIndicatorText}get indicatorText(){return this._indicatorText}get bottomIndicatorText(){return this._bottomIndicatorText}get leftHeaderText(){return this._leftHeaderText}get rightHeaderText(){return this._rightHeaderText}get column(){return this._column}set column(t){this._column!=t&&(this._column=t)}get row(){return this._row}set row(t){this._row!=t&&(this._row=t)}constructor(t,e){super(t,e),this._topFixHeaders=new CStringList,this._topFixHeight=20,this._bottomFixHeaders=new CStringList,this._bottomFixHeight=20,this._leftFixHeaders=new CStringList,this._leftFixWidth=100,this._rightFixHeaders=new CStringList,this._rightFixWidth=100,this._headerText=new CSSMap,this._headerTextCode=new CSSMap,this._topIndicatorText=new CStringList,this._indicatorText=new CStringList,this._bottomIndicatorText=new CStringList,this._leftHeaderText=new CStringList,this._rightHeaderText=new CStringList,this._column=-1,this._row=-1,this.readOnlyCell=new Set,this.readOnlyColumn=new Set,this.readOnlyRow=new Set,this.useEditorEnter=!1,this.editorShowSet=new Set;let i=this;this.gridInfo.cellMargin=1,this.gridInfo.columnCount=0,this.gridInfo.rowCount=0,this.gridInfo.headerRowHeight=25,this._topFixHeaders.onChange=function(){i.doTopFixCreateData()},this._bottomFixHeaders.onChange=function(){i.doBottomFixCreateData()},this._leftFixHeaders.onChange=function(){i.doLeftFixCreateData()},this._rightFixHeaders.onChange=function(){i.doRightFixCreateData()}}isEditableCell(t,e){if(!this.editable)return!1;let i=this.readOnlyCell.has(t+","+e),s=this.readOnlyColumn.has(t),o=this.readOnlyRow.has(e);return!i&&!s&&!o}doToData(t){super.doToData(t),CDataClass.putData(t,"topFixHeaders",this.topFixHeaders.toData(),[],!0),CDataClass.putData(t,"topFixHeight",this.topFixHeight,20),CDataClass.putData(t,"bottomFixHeaders",this.bottomFixHeaders.toData(),[],!0),CDataClass.putData(t,"bottomFixHeight",this.bottomFixHeight,20),CDataClass.putData(t,"leftFixHeaders",this.leftFixHeaders.toData(),[],!0),CDataClass.putData(t,"leftFixWidth",this.leftFixWidth,100),CDataClass.putData(t,"rightFixHeaders",this.rightFixHeaders.toData(),[],!0),CDataClass.putData(t,"rightFixWidth",this.rightFixWidth,100),CDataClass.putData(t,"topIndicatorText",this.topIndicatorText.toData(),[],!0),CDataClass.putData(t,"indicatorText",this.indicatorText.toData(),[],!0),CDataClass.putData(t,"bottomIndicatorText",this.bottomIndicatorText.toData(),[],!0),CDataClass.putData(t,"leftHeaderText",this.leftHeaderText.toData(),[],!0),CDataClass.putData(t,"rightHeaderText",this.rightHeaderText.toData(),[],!0),CDataClass.putData(t,"headerText",this.headerText.toData(),[],!0),CDataClass.putData(t,"headerTextCode",this.headerTextCode.toData(),[],!0),CDataClass.putData(t,"editorShowSet",CSystem.setToArray(this.editorShowSet),[],!0),CDataClass.putData(t,"readOnlyCell",CSystem.setToArray(this.readOnlyCell),[],!0),CDataClass.putData(t,"readOnlyColumn",CSystem.setToArray(this.readOnlyColumn),[],!0),CDataClass.putData(t,"readOnlyRow",CSystem.setToArray(this.readOnlyRow),[],!0)}doFromData(t){super.doFromData(t),this.topFixHeaders.fromData(CDataClass.getData(t,"topFixHeaders",[],!0)),this.topFixHeight=CDataClass.getData(t,"topFixHeight",20),this.bottomFixHeaders.fromData(CDataClass.getData(t,"bottomFixHeaders",[],!0)),this.bottomFixHeight=CDataClass.getData(t,"bottomFixHeight",20),this.leftFixHeaders.fromData(CDataClass.getData(t,"leftFixHeaders",[],!0)),this.leftFixWidth=CDataClass.getData(t,"leftFixWidth",100),this.rightFixHeaders.fromData(CDataClass.getData(t,"rightFixHeaders",[],!0)),this.rightFixWidth=CDataClass.getData(t,"rightFixWidth",100),this.topIndicatorText.fromData(CDataClass.getData(t,"topIndicatorText",[],!0)),this.indicatorText.fromData(CDataClass.getData(t,"indicatorText",[],!0)),this.bottomIndicatorText.fromData(CDataClass.getData(t,"bottomIndicatorText",[],!0)),this.leftHeaderText.fromData(CDataClass.getData(t,"leftHeaderText",[],!0)),this.rightHeaderText.fromData(CDataClass.getData(t,"rightHeaderText",[],!0)),this.headerText.fromData(CDataClass.getData(t,"headerText",[],!0)),this.headerTextCode.fromData(CDataClass.getData(t,"headerTextCode",[],!0)),CSystem.setFromArray(this.editorShowSet,CDataClass.getData(t,"editorShowSet",[],!0)),CSystem.setFromArray(this.readOnlyCell,CDataClass.getData(t,"readOnlyCell",[],!0)),CSystem.setFromArray(this.readOnlyColumn,CDataClass.getData(t,"readOnlyColumn",[],!0)),CSystem.setFromArray(this.readOnlyRow,CDataClass.getData(t,"readOnlyRow",[],!0))}doRemove(){null!=this.__editor&&this.__editor.remove(),null!=this.__topFixData&&this.__topFixData.remove(),null!=this.__bottomFixData&&this.__bottomFixData.remove(),null!=this.__leftFixData&&this.__leftFixData.remove(),null!=this.__rightFixData&&this.__rightFixData.remove(),this._topFixHeaders.remove(),this._bottomFixHeaders.remove(),this._leftFixHeaders.remove(),this._rightFixHeaders.remove(),this._headerText.remove(),this._headerTextCode.remove(),this._topIndicatorText.remove(),this._indicatorText.remove(),this._bottomIndicatorText.remove(),this._leftHeaderText.remove(),this._rightHeaderText.remove(),this.readOnlyCell.clear(),this.readOnlyColumn.clear(),this.readOnlyRow.clear(),this.editorShowSet.clear(),super.doRemove()}doChildDataMapHandle(t){super.doChildDataMapHandle(t),this.__editor&&t.delete(this.__editor)}doCellDraw(t,e,i,s,o,a){if(e==EPointerAreaKind.CLIENT){let t=o.getItem("cell");for(let e=0;e<t.length;e++){let o=this.getMergeCell(this.column,this.row);t[e].visible=o.column==i&&o.row==s}}super.doCellDraw(t,e,i,s,o,a)}doShowEditor(){let t=this,e=this.getCellBounds(this.column,this.row),i=this.getBackgroundClientBounds();e.offset(i.left-this.scrollX,i.top-this.scrollY),e.left<i.left&&(e.left=i.left),e.right>i.right&&(e.right=i.right),e.top<i.top&&(e.top=i.top),e.bottom>i.bottom&&(e.bottom=i.bottom),this.__editor=new CTextArea,this.__editor.onResource=function(){null!=t.__editor&&(t.__editor.hasFocus=!0)},this.__editor.parent=this.scrollBox,this.__editor.resource="textboxDarkEditor.control",this.__editor.stopPropagation.down=!0,this.__editor.stopPropagation.move=!0,this.__editor.stopPropagation.up=!0,this.__editor.stopPropagation.cancel=!0,this.__editor.stopPropagation.over=!0,this.__editor.stopPropagation.out=!0,this.__editor.stopPropagation.enter=!0,this.__editor.stopPropagation.leave=!0,this.__editor.stopPropagation.keyboard=!0,this.__editor.position.left=e.left,this.__editor.position.top=e.top,this.__editor.position.width=e.width,this.__editor.position.height=e.height,this.__editor.scrollbarLength=10,this.__editor.useEnter=!1,this.__editor.useHScrollbar=!1,this.__editor.useVScrollbar=!1,this.__editor.elementMargins.top=0,this.__editor.elementMargins.bottom=0,this.__editor.bringToFront(),this.__editor.visible=!0,this.__editor.text=this.cell(this.column,this.row),this.__editor.element.focus(),this.__editor.element.select(),this.__editor.flag=!0,this.__editor.element.addEventListener("blur",(function(e){null!=t.__editor&&null!=t.__editor.element&&t.__editor.flag&&t.doEditorApply(t.column,t.row,t.__editor.text)})),this.__editor.onShow=function(){null!=t.__editor&&t.__editor.element.select()},this.__editor.element.addEventListener("keydown",(function(e){if(null!=t.__editor){if("ArrowRight"==e.key&&e.ctrlKey){t.doEditorApply(t.column,t.row,t.__editor.text),t.column++;let e=t.columnToScrollX(t.column,"right");e>t.scrollX&&(t.scrollX=e),t.isEditableCell(t.column,t.row)&&t.doShowEditor()}if("ArrowLeft"==e.key&&e.ctrlKey){t.doEditorApply(t.column,t.row,t.__editor.text),t.column--;let e=t.columnToScrollX(t.column,"left");e<t.scrollX&&(t.scrollX=e),t.isEditableCell(t.column,t.row)&&t.doShowEditor()}if("ArrowDown"==e.key&&e.ctrlKey){t.doEditorApply(t.column,t.row,t.__editor.text),t.row++;let e=t.rowToScrollY(t.row,"bottom");e>t.scrollY&&(t.scrollY=e),t.isEditableCell(t.column,t.row)&&t.doShowEditor()}if("ArrowUp"==e.key&&e.ctrlKey){t.doEditorApply(t.column,t.row,t.__editor.text),t.row--;let e=t.rowToScrollY(t.row,"top");e<t.scrollY&&(t.scrollY=e),t.isEditableCell(t.column,t.row)&&t.doShowEditor()}"Escape"==e.key&&t.doEditorCancel(),t.useEditorEnter||"Enter"!=e.key||(t.doEditorApply(t.column,t.row,t.__editor.text),e.preventDefault()),e.ctrlKey&&"Enter"==e.key&&(t.doEditorApply(t.column,t.row,t.__editor.text),e.preventDefault())}})),null!=this.onShowEditor&&this.onShowEditor(this,this.column,this.row,this.__editor)}doBeforeEditorApply(t,e,i){null!=this.onBeforeEditorApply&&this.onBeforeEditorApply(this,t,e,this.cell(t,e),i)}doEditorApply(t,e,i){if(null!=this.__editor){this.doBeforeEditorApply(t,e,i),this.setCell(this.column,this.row,this.__editor.text),null!=this.onEditorApply&&this.onEditorApply(this,this.column,this.row,this.__editor.text),this.__editor.flag=!1;let s=this.__editor;if(this.__editor=void 0,null!=s.visibleAnimationTrigger){let t=this;s.onHide=function(){s.remove(),null==t.__editor&&(t.focused=!0)},s.visible=!1}else s.remove(),this.focused=!0}}doEditorCancel(){if(null!=this.__editor){this.__editor.flag=!1;let t=this.__editor;if(this.__editor=void 0,null!=t.visibleAnimationTrigger){let e=this;t.onHide=function(){t.remove(),null==e.__editor&&(e.focused=!0)},t.visible=!1}else t.remove(),this.focused=!0;null!=this.onEditorCancel&&this.onEditorCancel(this)}}doWheel(t){super.doWheel(t),this.doEditorCancel()}doCellClick(t,e,i,s,o,a,n,r,l){super.doCellClick(t,e,i,s,o,a,n,r,l),this.isEditableCell(e,i)&&this.editorShowSet.has(EEditorShowKind.CLICK)&&t==EPointerAreaKind.CLIENT&&this.doShowEditor()}doCellDblClick(t,e,i,s,o){super.doCellDblClick(t,e,i,s,o),this.isEditableCell(e,i)&&this.editorShowSet.has(EEditorShowKind.DOUBLE_CLICK)&&t==EPointerAreaKind.CLIENT&&this.doShowEditor()}doKeyDown(t){super.doKeyDown(t),this.isEditableCell(this.column,this.row)&&"F2"==t.key&&this.editorShowSet.has(EEditorShowKind.F2_KEY)&&this.doShowEditor()}doTopFixCreateData(){this.__topFixData=new CTableData(this._topFixHeaders.array,[]);let t=this;this.__topFixData.onChange=function(e,i,s,o){t.doTopFixDataChange(i,s,o)}}doBottomFixCreateData(){this.__bottomFixData=new CTableData(this._topFixHeaders.array,[]);let t=this;this.__bottomFixData.onChange=function(e,i,s,o){t.doBottomFixDataChange(i,s,o)}}doLeftFixCreateData(){this.__leftFixData=new CTableData(this._leftFixHeaders.array,[]);let t=this;this.__leftFixData.onChange=function(e,i,s,o){t.doLeftFixDataChange(i,s,o)}}doRightFixCreateData(){this.__rightFixData=new CTableData(this._rightFixHeaders.array,[]);let t=this;this.__rightFixData.onChange=function(e,i,s,o){t.doRightFixDataChange(i,s,o)}}doTopFixDataChange(t,e,i){if(null!=this.__topFixData){this.isDraw=!1,this.gridInfo.fixTop.clear();for(let t=0;t<this.__topFixData.length;t++)this.gridInfo.fixTop.add(this._topFixHeight);this.isDraw=!0}}doBottomFixDataChange(t,e,i){if(null!=this.__bottomFixData){this.isDraw=!1,this.gridInfo.fixBottom.clear();for(let t=0;t<this.__bottomFixData.length;t++)this.gridInfo.fixBottom.add(this._bottomFixHeight);this.isDraw=!0}}doLeftFixDataChange(t,e,i){if(null!=this.__leftFixData){this.isDraw=!1,this.gridInfo.fixLeft.clear();for(let t=0;t<this.__leftFixData.columnCount;t++)this.gridInfo.fixLeft.add(this._leftFixWidth);this.isDraw=!0}}doRightFixDataChange(t,e,i){if(null!=this.__rightFixData){this.isDraw=!1,this.gridInfo.fixRight.clear();for(let t=0;t<this.__rightFixData.columnCount;t++)this.gridInfo.fixRight.add(this._rightFixWidth);this.isDraw=!0}}doBeforeCellDraw(t,e,i,s,o){if(t!=EPointerAreaKind.TOP_LEFT_FIX&&t!=EPointerAreaKind.TOP_RIGHT_FIX&&t!=EPointerAreaKind.BOTTOM_LEFT_FIX&&t!=EPointerAreaKind.BOTTOM_RIGHT_FIX||s.setText("text",""),t==EPointerAreaKind.LEFT_FIX&&null!=this.__leftFixData&&(this.__leftFixData.length>i&&this.__leftFixData.columnCount>e?s.setText("text",this.__leftFixData.getRow(i).get(e).asString):s.setText("text","")),t==EPointerAreaKind.RIGHT_FIX&&null!=this.__rightFixData&&(this.__rightFixData.length>i&&this.__rightFixData.columnCount>e?s.setText("text",this.__rightFixData.getRow(i).get(e).asString):s.setText("text","")),t==EPointerAreaKind.TOP_CLIENT_FIX&&null!=this.__topFixData&&(this.__topFixData.length>i&&this.__topFixData.columnCount>e?s.setText("text",this.__topFixData.getRow(i).get(e).asString):s.setText("text","")),t==EPointerAreaKind.BOTTOM_CLIENT_FIX&&null!=this.__bottomFixData&&(this.__bottomFixData.length>i&&this.__bottomFixData.columnCount>e?s.setText("text",this.__bottomFixData.getRow(i).get(e).asString):s.setText("text","")),t==EPointerAreaKind.INDICATOR_TOP_FIX&&(i<this._topIndicatorText.length?s.setText("text",this._topIndicatorText.get(i)):s.setText("text","T"+(i+1))),t==EPointerAreaKind.INDICATOR_CLIENT&&(i<this._indicatorText.length?s.setText("text",this._indicatorText.get(i)):s.setText("text",i+1+"")),t==EPointerAreaKind.INDICATOR_BOTTOM_FIX&&(i<this._bottomIndicatorText.length?s.setText("text",this._bottomIndicatorText.get(i)):s.setText("text","B"+(i+1))),t==EPointerAreaKind.HEADER_LEFT_FIX&&(e<this._leftHeaderText.length?s.setText("text",this._leftHeaderText.get(e)):s.setText("text","")),t==EPointerAreaKind.HEADER_CLIENT){let t;if(this._headerTextCode.size>0){let s=this._headerTextCode.get(e+","+i);s&&(t=CLanguage.getText(s))}else t=this._headerText.get(e+","+i);null!=t?s.setText("text",t):s.setText("text","")}return t==EPointerAreaKind.HEADER_RIGHT_FIX&&(e<this._rightHeaderText.length?s.setText("text",this._rightHeaderText.get(e)):s.setText("text","")),super.doBeforeCellDraw(t,e,i,s,o)}cell(t,e){}setCell(t,e,i){}}class CDataGrid extends CCustomDataGrid{get dataSet(){return this.__data}get datas(){let t=new Array;if(null!=this.__data)for(let e=0;e<this.__data.length;e++)t.push(this.__data.get(e));return t}get selectDatas(){let t=new Array,e=this.selectItems,i=this;return e.forEach((function(e){if(i.__data)if(e.indexOf(",")>=0){let s=e.split(",");t.push(i.__data.get(parseInt(s[1])))}else t.push(i.__data.get(parseInt(e)))})),t}set datas(t){if(null!=this.__data){this.__data.clear();for(let e=0;e<t.length;e++)this.__data.add(t[e])}}get multiSelect(){return this._multiSelect}set multiSelect(t){this._multiSelect!=t&&(this._multiSelect=t,t||this._selectItems.clear())}get rowSelect(){return this._rowSelect}set rowSelect(t){this._rowSelect!=t&&(this._selectItems.clear(),this._rowSelect=t)}get headers(){return this._headers}get indexColumns(){return this._indexColumns}get column(){return this._column}set column(t){let e=t;null!=this.__data&&this.headers.length<=e&&(e=this.headers.length-1),e<0&&(e=0),this._column!=e&&(this._column=e,this.itemLayerDraw())}get row(){return this._row}set row(t){let e=t;null!=this.__data&&this.__data.length<=e&&(e=this.__data.length-1),e<0&&(e=0),this._row!=e&&(this._row=e,this.itemLayerDraw())}get length(){return null!=this.__data?this.__data.length:0}constructor(t,e,i=[],s){super(t,s),this._headers=new CStringList,this._indexColumns=new CStringList,this.onDataChange=new Array;let o=this;this.hasFocus=!0,this._headers.onChange=function(){o.doCreateData(e,i)},this._indexColumns.onChange=function(){o.doCreateData(e,i)}}doToData(t){super.doToData(t),CDataClass.putData(t,"headers",this.headers.toData(),[],!0),CDataClass.putData(t,"indexColumns",this.indexColumns.toData(),[],!0),CDataClass.putData(t,"multiSelect",this.multiSelect,!1),CDataClass.putData(t,"rowSelect",this.rowSelect,!0)}doFromData(t){super.doFromData(t),this.headers.fromData(CDataClass.getData(t,"headers",[],!0)),this.indexColumns.fromData(CDataClass.getData(t,"indexColumns",[],!0)),this.multiSelect=CDataClass.getData(t,"multiSelect",!1),this.rowSelect=CDataClass.getData(t,"rowSelect",!0)}doChangeDesignMode(){if(super.doChangeDesignMode(),this.isDesignMode){this.clear();for(let t=0;t<10;t++){let e=this.getNewData("Sample data "+(t+1));this.add(e)}}}doRemove(){this._indexColumns.remove(),this._headers.remove(),null!=this.__data&&this.__data.remove(),super.doRemove()}doCellDblClick(t,e,i,s,o){super.doCellDblClick(t,e,i,s,o),t==EPointerAreaKind.HEADER_BUTTON&&this.autoFitAll()}doKeyDown(t){if("ArrowLeft"==t.key){this.column--;let e=this.columnToScrollX(this.column,"left"),i=this.columnToScrollX(this.column,"right");e<this.scrollX?this.scrollX=e:i>this.scrollX&&(this.scrollX=i),this.multiSelect&&t.ctrlKey||this.doSelectItem(this.column,this.row,!1)}if("ArrowUp"==t.key){this.row--;let e=this.rowToScrollY(this.row,"top"),i=this.rowToScrollY(this.row,"bottom");e<this.scrollY?this.scrollY=e:i>this.scrollY&&(this.scrollY=i),this.multiSelect&&t.ctrlKey||this.doSelectItem(this.column,this.row,!1)}if("ArrowRight"==t.key){this.column++;let e=this.columnToScrollX(this.column,"left"),i=this.columnToScrollX(this.column,"right");i>this.scrollX?this.scrollX=i:e<this.scrollX&&(this.scrollX=e),this.multiSelect&&t.ctrlKey||this.doSelectItem(this.column,this.row,!1)}if("ArrowDown"==t.key){this.row++;let e=this.rowToScrollY(this.row,"top"),i=this.rowToScrollY(this.row,"bottom");i>this.scrollY?this.scrollY=i:e<this.scrollY&&(this.scrollY=e),this.multiSelect&&t.ctrlKey||this.doSelectItem(this.column,this.row,!1)}if("Enter"!=t.key&&" "!=t.key||(this.multiSelect&&t.ctrlKey?this.doSelectItem(this.column,this.row,!0):this.doCellClick(EPointerAreaKind.CLIENT,this.column,this.row,0,0,0,0,new PointerEvent(""),this.__pressedThisPoints)),t.ctrlKey&&"A"==t.key.toUpperCase()&&null!=this.__data&&this.multiSelect)if(this.clearSelectItem(),this.rowSelect)for(let t=0;t<this.__data.length;t++)this.addSelectItem(-1,t);else for(let t=0;t<this.__data.length;t++)for(let e=0;this.headers.length;e++)this.addSelectItem(e,t);t.ctrlKey&&"C"==t.key.toUpperCase()&&navigator.clipboard.writeText(this.selectToClipboardStr()),super.doKeyDown(t)}doCreateData(t,e=[]){this.__data=new CDataSet(t,e),this.__data.trackingChangeData=!1,this.gridInfo.columnCount=this._headers.length;let i=this;this.__data.onChange.push((function(t,e,s,o){i.doDataChange(e,s,o),i.itemLayerDraw()}))}doDataChange(t,e,i){null!=this.__data&&(this.gridInfo.rowCount=this.__data.length);for(let s=0;s<this.onDataChange.length;s++)this.onDataChange[s](this,t,e,i)}doBeforeCellDraw(t,e,i,s,o){if(t==EPointerAreaKind.CLIENT&&null!=this.__data)if(this.__data.length>i&&this.headers.length>e){let t=this.__data.get(i);null!=t&&null!=t[this.headers.get(e)]?"object"==typeof t[this.headers.get(e)]?s.setObject(t[this.headers.get(e)]):s.setText("text",t[this.headers.get(e)]+""):s.setText("text","")}else s.setText("text","");return super.doBeforeCellDraw(t,e,i,s,o)}doSelectItem(t,e,i){i?this.rowSelect?this._selectItems.has(e+"")?this.deleteSelectItem(t,e):this.addSelectItem(t,e):this._selectItems.has(t+","+e)?this.deleteSelectItem(t,e):this.addSelectItem(t,e):(this.clearSelectItem(),this.addSelectItem(t,e)),null!=this.onSelectItem&&this.onSelectItem(this,t,e)}doCellClick(t,e,i,s,o,a,n,r,l){t==EPointerAreaKind.CLIENT&&(this.column=e,this.row=i,this.doSelectItem(e,i,r.ctrlKey)),super.doCellClick(t,e,i,s,o,a,n,r,l)}doCellDrag(t,e,i,s){if(super.doCellDrag(t,e,i,s),this.clearSelectItem(),this.multiSelect&&"mouse"==i.pointerType)if(this.rowSelect)for(let t=e.startCell.y;t<=e.stopCell.y;t++)this.addSelectItem(-1,t);else for(let t=e.startCell.x;t<=e.stopCell.x;t++)for(let i=e.startCell.y;i<=e.stopCell.y;i++)this.addSelectItem(t,i)}doAddData(t){if(null!=this.__data)return this.__data.add(t)}doAddEmptyData(){let t={};for(let e=0;e<this.headers.length;e++)t[this.headers.get(e)]="";if(null!=this.__data)return this.__data.add(t)}doInsertData(t,e){if(null!=this.__data)return this.__data.insert(t,e)}doDeleteData(t){null!=this.__data&&this.__data.delete(t)}doClear(){this.selectItems.clear(),this.row=-1,null!=this.__data&&this.__data.clear()}add(t){return this.doAddData(t)}addEmpty(){return this.doAddEmptyData()}insert(t,e){return this.doInsertData(t,e)}delete(t){this.doDeleteData(t)}clear(){this.doClear()}cell(t,e){if(null!=this.__data){let i=this.__data.get(e);if(i&&this.__data.length>e&&this.headers.length>t)return i[this.headers.get(t)]}}setCell(t,e,i){if(null!=this.__data){let s=this.__data.get(e);s&&(s[this.headers.get(t)]=i)}}get(t){return this.__data?.get(t)}autoFitColumnWidth(t){if(null!=this.__data){let e=0;e=CStringUtil.getTextWidth(this.__headerData[0].get(0).textSet,this._headers.get(t))+10;for(let i=0;i<this.__data.length;i++)e=CCalc.max(e,CStringUtil.getTextWidth(this.__cellData[0].get(0).textSet,this.cell(t,i))+10);this.gridInfo.diffColumnSize.set(t,e)}}autoFitColumnWidthAll(){for(let t=0;t<this._headers.length;t++)this.autoFitColumnWidth(t)}autoFitRowHeight(t){if(null!=this.__data){let e=0;for(let i=0;i<this.headers.length;i++)e=CCalc.max(e,CStringUtil.getTextHeight(this.__cellData[0].get(0).textSet,this.cell(i,t))+10);this.gridInfo.diffRowSize.set(t,e)}}autoFitRowHeightAll(){if(null!=this.__data)for(let t=0;t<this.__data.length;t++)this.autoFitRowHeight(t)}autoFitAll(){this.autoFitColumnWidthAll(),this.autoFitRowHeightAll()}addProperties(){let t=super.addProperties();return t.push({instance:this.datas,propertyName:"datas",readOnly:!1,enum:[]}),t}getChangeData(){if(this.__data)return this.__data.changeData}clearChangeData(){this.__data&&this.__data.clearChangeData()}modifyDataStart(){this.__data&&(this.__data.trackingChangeData=!0)}modifyDataStop(){this.__data&&(this.__data.trackingChangeData=!1,this.__data.clearChangeData())}selectToClipboardStr(){let t="";for(let e=0;e<this.length;e++){let i="";for(let t=0;t<this.gridInfo.columnCount;t++)if(this.rowSelect){if(0!=t&&(i+="\t"),this._selectItems.has(e+"")){let s=this.cell(t,e);(s.indexOf("\n")>=0||s.indexOf("\t")>=0)&&s.indexOf('"')>=0?s='"'+CStringUtil.replaceAll(s,'"','""')+'"':(s.indexOf("\n")>=0||s.indexOf("\t")>=0)&&(s='"'+s+'"'),i+=s}}else if(0!=t&&(i+="\t"),this._selectItems.has(t+","+e)){let s=this.cell(t,e);(s.indexOf("\n")>=0||s.indexOf("\t")>=0)&&s.indexOf('"')>=0?s='"'+CStringUtil.replaceAll(s,'"','""')+'"':(s.indexOf("\n")>=0||s.indexOf("\t")>=0)&&(s='"'+s+'"'),i+=s}""!=CStringUtil.replaceAll(i,"\t","")&&(t+=i+"\n")}return t=t.replace(/\n$/,""),t}getNewData(t){let e={};for(let i=0;i<this.headers.length;i++)e[this.headers[i]]=null==t?"":t;return e}}!function(t){t[t.ALIGN=0]="ALIGN",t[t.AUTO_SIZE=1]="AUTO_SIZE"}(ETabButtonKind||(ETabButtonKind={}));class CTabButton extends CPanel{get tabs(){return this._tabs}get buttons(){return this.__buttons}get scrollBox(){return this._scrollBox}get leftButton(){return this._leftButton}get rightButton(){return this._rightButton}get addButton(){return this._addButton}get deleteButton(){return this._deleteButton}get index(){return this._index}set index(t){t!=this._index&&(this._index=t,this.doChangeIndex())}get tabButtonResource(){return this._tabButtonResource}set tabButtonResource(t){if(t!=this._tabButtonResource){this._tabButtonResource=t;for(let e=0;e<this.__buttons.length;e++)this.__buttons[e].resource=t}}get leftButtonResource(){return this._leftButtonResource}set leftButtonResource(t){t!=this._leftButtonResource&&(this._leftButtonResource=t,this._leftButton.resource=t)}get rightButtonResource(){return this._rightButtonResource}set rightButtonResource(t){t!=this._rightButtonResource&&(this._rightButtonResource=t,this._rightButton.resource=t)}get addButtonResource(){return this._addButtonResource}set addButtonResource(t){t!=this._addButtonResource&&(this._addButtonResource=t,this._addButton.resource=t)}get deleteButtonResource(){return this._deleteButtonResource}set deleteButtonResource(t){t!=this._deleteButtonResource&&(this._deleteButtonResource=t,this._deleteButton.resource=t)}get kind(){return this._kind}set kind(t){t!=this._kind&&(this._kind=t,this.doSetButtions())}get managementButtonLength(){return this._managementButtonLength}set managementButtonLength(t){t!=this._managementButtonLength&&(this._managementButtonLength=t,this.doSetButtions())}get tabButtonMargin(){return this._tabButtonMargin}set tabButtonMargin(t){t!=this._tabButtonMargin&&(this._tabButtonMargin=t,this.doSetButtions())}get useAddButton(){return this._useAddButton}set useAddButton(t){t!=this._useAddButton&&(this._useAddButton=t,this.doSetButtions())}get useDeleteButton(){return this._useDeleteButton}set useDeleteButton(t){t!=this._useDeleteButton&&(this._useDeleteButton=t,this.doSetButtions())}get useArrowButton(){return this._useArrowButton}set useArrowButton(t){t!=this._useArrowButton&&(this._useArrowButton=t,this.doSetButtions())}get useCode(){return this._useCode}set useCode(t){t!=this._useCode&&(this._useCode=t,this.doSetButtions())}get leftButtonText(){return this._leftButtonText}set leftButtonText(t){t!=this._leftButtonText&&(this._leftButtonText=t,this._leftButton.text=t)}get rightButtonText(){return this._rightButtonText}set rightButtonText(t){t!=this._rightButtonText&&(this._rightButtonText=t,this._rightButton.text=t)}get addButtonText(){return this._addButtonText}set addButtonText(t){t!=this._addButtonText&&(this._addButtonText=t,this._addButton.text=t)}get deleteButtonText(){return this._deleteButtonText}set deleteButtonText(t){t!=this._deleteButtonText&&(this._deleteButtonText=t,this._deleteButton.text=t)}constructor(t,e){super(t,e),this.__scrollInterval=0,this.__buttons=new Array,this._scrollBox=new CScrollBox(this),this._leftButton=new CButton(this),this._deleteButton=new CButton(this),this._addButton=new CButton(this),this._rightButton=new CButton(this),this._tabs=new CStringList,this._index=-1,this._tabButtonResource="",this._leftButtonResource="",this._rightButtonResource="",this._addButtonResource="",this._deleteButtonResource="",this._kind=ETabButtonKind.ALIGN,this._managementButtonLength=30,this._tabButtonMargin=0,this._useArrowButton=!1,this._useAddButton=!1,this._useDeleteButton=!1,this._leftButtonText="",this._rightButtonText="",this._addButtonText="",this._deleteButtonText="",this._useCode=!1,this.defaultTabName="Tab";let i=this;this._scrollBox.position.align=EPositionAlign.CLIENT,this._scrollBox.onChangeSize=function(){i.doSetButtions()},this._scrollBox.useHScrollbar=!1,this._scrollBox.useVScrollbar=!1,this._rightButton.position.align=EPositionAlign.RIGHT,this._rightButton.onResource=function(){i._rightButton.position.align=EPositionAlign.RIGHT,i._rightButton.usePointerCapture=!0,i._rightButton.text=i._rightButtonText},this._rightButton.onThisPointerDown=function(){0==i.__scrollInterval&&(i.__scrollInterval=setInterval((function(){i.doTabButtonContentScroll(10)}),16))},this._rightButton.onThisPointerUp=function(){clearInterval(i.__scrollInterval),i.__scrollInterval=0},this._addButton.position.align=EPositionAlign.RIGHT,this._addButton.onClick=function(){i.doAddTab(CSequence.getSequence(i.defaultTabName))},this._addButton.onResource=function(){i._addButton.position.align=EPositionAlign.RIGHT,i._addButton.text=i._addButtonText},this._deleteButton.position.align=EPositionAlign.RIGHT,this._deleteButton.onClick=function(){i.doDeleteTab()},this._deleteButton.onResource=function(){i._deleteButton.position.align=EPositionAlign.RIGHT,i._deleteButton.text=i._deleteButtonText},this._leftButton.position.align=EPositionAlign.LEFT,this._leftButton.onResource=function(){i._leftButton.position.align=EPositionAlign.LEFT,i._leftButton.usePointerCapture=!0,i._leftButton.text=i._leftButtonText},this._leftButton.onThisPointerDown=function(){0==i.__scrollInterval&&(i.__scrollInterval=setInterval((function(){i.doTabButtonContentScroll(-10)}),16))},this._leftButton.onThisPointerUp=function(){clearInterval(i.__scrollInterval),i.__scrollInterval=0},this._tabs.onChange=function(){i.doChangeTabs()}}doToData(t){super.doToData(t),CDataClass.putData(t,"tabs",this.tabs.toData(),[],!0),CDataClass.putData(t,"tabButtonResource",this.tabButtonResource,""),CDataClass.putData(t,"leftButtonResource",this.leftButtonResource,""),CDataClass.putData(t,"rightButtonResource",this.rightButtonResource,""),CDataClass.putData(t,"addButtonResource",this.addButtonResource,""),CDataClass.putData(t,"deleteButtonResource",this.deleteButtonResource,""),CDataClass.putData(t,"kind",this.kind,ETabButtonKind.ALIGN),CDataClass.putData(t,"useArrowButton",this.useArrowButton,!1),CDataClass.putData(t,"useAddButton",this.useAddButton,!1),CDataClass.putData(t,"useDeleteButton",this.useDeleteButton,!1),CDataClass.putData(t,"useCode",this.useCode,!1),CDataClass.putData(t,"managementButtonLength",this.managementButtonLength,30),CDataClass.putData(t,"tabButtonMargin",this.tabButtonMargin,0),CDataClass.putData(t,"defaultTabName",this.defaultTabName,"Tab"),CDataClass.putData(t,"leftButtonText",this.leftButtonText,""),CDataClass.putData(t,"rightButtonText",this.rightButtonText,""),CDataClass.putData(t,"addButtonText",this.addButtonText,""),CDataClass.putData(t,"deleteButtonText",this.deleteButtonText,"")}doFromData(t){super.doFromData(t),this.tabs.fromData(CDataClass.getData(t,"tabs",[],!0)),this.tabButtonResource=CDataClass.getData(t,"tabButtonResource",""),this.leftButtonResource=CDataClass.getData(t,"leftButtonResource",""),this.rightButtonResource=CDataClass.getData(t,"rightButtonResource",""),this.addButtonResource=CDataClass.getData(t,"addButtonResource",""),this.deleteButtonResource=CDataClass.getData(t,"deleteButtonResource",""),this.kind=CDataClass.getData(t,"kind",ETabButtonKind.ALIGN),this.useArrowButton=CDataClass.getData(t,"useArrowButton",!1),this.useAddButton=CDataClass.getData(t,"useAddButton",!1),this.useDeleteButton=CDataClass.getData(t,"useDeleteButton",!1),this.useCode=CDataClass.getData(t,"useCode",!1),this.managementButtonLength=CDataClass.getData(t,"managementButtonLength",30),this.tabButtonMargin=CDataClass.getData(t,"tabButtonMargin",0),this.defaultTabName=CDataClass.getData(t,"defaultTabName","Tab"),this.leftButtonText=CDataClass.getData(t,"leftButtonText",""),this.rightButtonText=CDataClass.getData(t,"rightButtonText",""),this.addButtonText=CDataClass.getData(t,"addButtonText",""),this.deleteButtonText=CDataClass.getData(t,"deleteButtonText","")}doRemove(){this.tabs.clear(),super.doRemove()}doChildDataMapHandle(t){super.doChildDataMapHandle(t);for(let e=0;e<this.__buttons.length;e++)t.delete(this.__buttons[e]);t.delete(this.scrollBox),t.delete(this.leftButton),t.delete(this.deleteButton),t.delete(this.addButton),t.delete(this.rightButton)}doChangeIndex(){for(let t=0;t<this.__buttons.length;t++)this.__buttons[t].selected=this.index==t;null!=this.onChangeIndex&&this.onChangeIndex(this)}doAddTab(t){this.tabs.add(t),null!=this.onAddTab&&this.onAddTab(this,this.tabs.length-1)}doBeforeDeleteTab(t){null!=this.onBeforeDeleteTab&&this.onBeforeDeleteTab(this,t)}doDeleteTab(t){if(null!=t)this.doBeforeDeleteTab(t),this.tabs.delete(t),this.tabs.length<=t?this.index=this.tabs.length-1:this.doChangeIndex();else if(-1!=this.index){let t=this.index;this.doBeforeDeleteTab(t),this.tabs.delete(this.index),this.tabs.length<=t?this.index=this.tabs.length-1:this.doChangeIndex()}null!=this.onDeleteTab&&this.onDeleteTab(this)}doTabButtonContentScroll(t){this.scrollBox.scrollLeft+=t}doTabButtonClick(t){this.index=t,null!=this.onTabButtonClick&&this.onTabButtonClick(this,t)}doChangeTabs(){this.doSetButtions(),null!=this.onChangeTabs&&this.onChangeTabs(this)}doSetButtions(){let t=this;if(this.__buttons.length>this._tabs.length)for(let t=0;t<this.__buttons.length-this._tabs.length;t++)this.__buttons[this.__buttons.length-1].remove(),this.__buttons.splice(this.__buttons.length-1,1);if(this.__buttons.length<this._tabs.length)for(let e=0;e<this._tabs.length-this.__buttons.length;e++){let e=new CButton(this.scrollBox.content);e.onResource=function(){e.useAutoSize=!0},e.resource=this._tabButtonResource;let i=this.__buttons.length;e.onClick=function(){t.doTabButtonClick(i)},this.__buttons.push(e),this.doCreateTabButton(e)}for(let t=0;t<this._tabs.length;t++)this.useCode?this.__buttons[t].textSet.languageKey=this._tabs.get(t):this.__buttons[t].text=this._tabs.get(t);if(this.kind==ETabButtonKind.ALIGN){this.scrollBox.contentHeight=this.scrollBox.position.height,this.scrollBox.contentWidth=this.scrollBox.position.width;let t=(this.scrollBox.position.width-this.tabButtonMargin*(this.__buttons.length-1))/this.__buttons.length,e=0;for(let i=0;i<this.__buttons.length;i++)this.__buttons[i].useAutoSize=!1,this.__buttons[i].position.top=0,this.__buttons[i].position.left=e,this.__buttons[i].position.height=this.scrollBox.position.height,this.__buttons[i].position.width=t,e+=this.__buttons[i].position.width+this._tabButtonMargin}else{let t=0;for(let e=0;e<this.__buttons.length;e++)this.__buttons[e].useAutoSize=!0,this.__buttons[e].position.top=0,this.__buttons[e].position.left=t,this.__buttons[e].position.height=this.scrollBox.position.height,t+=this.__buttons[e].position.width+this._tabButtonMargin;this.scrollBox.contentHeight=this.scrollBox.position.height,this.scrollBox.contentWidth=t}this._leftButton.visible=this.useArrowButton&&this.kind==ETabButtonKind.AUTO_SIZE,this._rightButton.visible=this.useArrowButton&&this.kind==ETabButtonKind.AUTO_SIZE,this._addButton.visible=this.useAddButton&&this.kind==ETabButtonKind.AUTO_SIZE,this._deleteButton.visible=this.useDeleteButton&&this.kind==ETabButtonKind.AUTO_SIZE,this._leftButton.position.width=this._managementButtonLength,this._rightButton.position.width=this._managementButtonLength,this._addButton.position.width=this._managementButtonLength,this._deleteButton.position.width=this._managementButtonLength,null!=this.onSetButtons&&this.onSetButtons(this)}doCreateTabButton(t){null!=this.onCreateTabButton&&this.onCreateTabButton(this,t)}doChangeCountry(t){if(super.doChangeCountry(t),this.useCode){let t=this;setTimeout((function(){t.doSetButtions()}),100)}}addTab(t){this.doAddTab(t)}deleteTab(t){this.doDeleteTab(t)}clear(){this.tabs.clear()}scrollToLeft(){this._scrollBox.scrollToLeft()}scrollToRight(){this._scrollBox.scrollToRight()}addProperties(){let t=new Array;for(let e=0;e<this.__buttons.length;e++)t.push({instance:this.__buttons[e],propertyName:"buttons["+e+"]",readOnly:!1,enum:[]});return t}}class CTab extends CPanel{get body(){return this._body}get tabs(){return this._tab.tabs}get tabButtons(){return this._tab}get tabSheets(){return this._tabSheets}get index(){return this._tab.index}set index(t){this._tab.index=t}get tabButtonResource(){return this._tabButtonResource}set tabButtonResource(t){this._tabButtonResource!=t&&(this._tabButtonResource=t,this._tab.tabButtonResource=t,this._tab.doSetButtions())}get tabButtonPosition(){return this._tabButtonPosition}set tabButtonPosition(t){this._tabButtonPosition!=t&&(this._tabButtonPosition=t,this._tab.position.align="top"==t?EPositionAlign.TOP:EPositionAlign.BOTTOM)}get leftButtonResource(){return this._tab.leftButtonResource}set leftButtonResource(t){this._tab.leftButtonResource=t}get rightButtonResource(){return this._tab.rightButtonResource}set rightButtonResource(t){this._tab.rightButtonResource=t}get addButtonResource(){return this._tab.addButtonResource}set addButtonResource(t){this._tab.addButtonResource=t}get deleteButtonResource(){return this._tab.deleteButtonResource}set deleteButtonResource(t){this._tab.deleteButtonResource=t}get kind(){return this._tab.kind}set kind(t){this._tab.kind=t}get useAddButton(){return this._tab.useAddButton}set useAddButton(t){this._tab.useAddButton=t}get useDeleteButton(){return this._tab.useDeleteButton}set useDeleteButton(t){this._tab.useDeleteButton=t}get useArrowButton(){return this._tab.useArrowButton}set useArrowButton(t){this._tab.useArrowButton=t}get useCode(){return this._tab.useCode}set useCode(t){this._tab.useCode=t}get managementButtonLength(){return this._tab.managementButtonLength}set managementButtonLength(t){this._tab.managementButtonLength=t}get tabButtonMargin(){return this._tab.tabButtonMargin}set tabButtonMargin(t){this._tab.tabButtonMargin=t}get tabResource(){return this._tab.resource}set tabResource(t){this._tab.resource=t}get tabHeight(){return this._tabHeight}set tabHeight(t){this._tabHeight!=t&&(this._tabHeight=t,this._tab.position.height=t)}get tabSheetResource(){return this._tabSheetResource}set tabSheetResource(t){if(this._tabSheetResource!=t){this._tabSheetResource=t;for(let e=0;e<this.tabSheets.length;e++)this.tabSheets.get(e).resource=t}}get tabBodyResource(){return this._body.resource}set tabBodyResource(t){this._body.resource=t}get defaultTabName(){return this._tab.defaultTabName}set defaultTabName(t){this._tab.defaultTabName=t}get leftButtonText(){return this.tabButtons.leftButtonText}set leftButtonText(t){this.tabButtons.leftButtonText=t}get rightButtonText(){return this.tabButtons.rightButtonText}set rightButtonText(t){this.tabButtons.rightButtonText=t}get addButtonText(){return this.tabButtons.addButtonText}set addButtonText(t){this.tabButtons.addButtonText=t}get deleteButtonText(){return this.tabButtons.deleteButtonText}set deleteButtonText(t){this.tabButtons.deleteButtonText=t}constructor(t,e){super(t,e),this._tab=new CTabButton(this),this._tabSheets=new CList,this._tabButtonResource="",this._tabSheetResource="",this._body=new CPanel(this),this._tabHeight=30,this._tabButtonPosition="top";let i=this;this._tab.position.align=EPositionAlign.TOP,this._tab.position.height=this._tabHeight,this._tab.onResource=function(){i._tab.position.align=EPositionAlign.TOP,i._tab.position.height=i._tabHeight},this._tab.onChangeIndex=function(){i.doChangeIndex()},this._tab.onAddTab=function(t,e){i.doAddTab(e)},this._tab.onBeforeDeleteTab=function(t,e){i.doBeforeDeleteTab(e)},this._tab.onDeleteTab=function(){i.doDeleteTab()},this._tab.onTabButtonClick=function(t,e){i.doTabButtonClick(e)},this._tab.onChangeTabs=function(){i.doChangeTabs()},this._body.position.align=EPositionAlign.CLIENT,this._body.onResource=function(){i._body.position.align=EPositionAlign.CLIENT},this._body.propertyName="body",this._body.propertyDataKind="reserveControl,_body"}doToData(t){super.doToData(t),CDataClass.putData(t,"tabs",this.tabs.toData(),[],!0),CDataClass.putData(t,"tabButtonResource",this.tabButtonResource,""),CDataClass.putData(t,"leftButtonResource",this.leftButtonResource,""),CDataClass.putData(t,"rightButtonResource",this.rightButtonResource,""),CDataClass.putData(t,"addButtonResource",this.addButtonResource,""),CDataClass.putData(t,"deleteButtonResource",this.deleteButtonResource,""),CDataClass.putData(t,"kind",this.kind,ETabButtonKind.ALIGN),CDataClass.putData(t,"useArrowButton",this.useArrowButton,!1),CDataClass.putData(t,"useAddButton",this.useAddButton,!1),CDataClass.putData(t,"useDeleteButton",this.useDeleteButton,!1),CDataClass.putData(t,"useCode",this.useCode,!1),CDataClass.putData(t,"managementButtonLength",this.managementButtonLength,30),CDataClass.putData(t,"tabButtonMargin",this.tabButtonMargin,0),CDataClass.putData(t,"defaultTabName",this.defaultTabName,"Tab"),CDataClass.putData(t,"tabResource",this.tabResource,""),CDataClass.putData(t,"tabBodyResource",this.tabBodyResource,""),CDataClass.putData(t,"tabSheetResource",this.tabSheetResource,""),CDataClass.putData(t,"leftButtonText",this.leftButtonText,""),CDataClass.putData(t,"rightButtonText",this.rightButtonText,""),CDataClass.putData(t,"addButtonText",this.addButtonText,""),CDataClass.putData(t,"deleteButtonText",this.deleteButtonText,""),CDataClass.putData(t,"tabHeight",this.tabHeight,30);let e=new Array;for(let t=0;t<this.tabs.length;t++)e.push({button:this.tabButtons.buttons[t].toData(),sheet:this.tabSheets.get(t).toData()});CDataClass.putData(t,"buttonSheet",e,[],!0),CDataClass.putData(t,"tabButtonPosition",this.tabButtonPosition,"top")}doFromData(t){super.doFromData(t),this.tabButtonResource=CDataClass.getData(t,"tabButtonResource",""),this.leftButtonResource=CDataClass.getData(t,"leftButtonResource",""),this.rightButtonResource=CDataClass.getData(t,"rightButtonResource",""),this.addButtonResource=CDataClass.getData(t,"addButtonResource",""),this.deleteButtonResource=CDataClass.getData(t,"deleteButtonResource",""),this.kind=CDataClass.getData(t,"kind",ETabButtonKind.ALIGN),this.useArrowButton=CDataClass.getData(t,"useArrowButton",!1),this.useAddButton=CDataClass.getData(t,"useAddButton",!1),this.useDeleteButton=CDataClass.getData(t,"useDeleteButton",!1),this.useCode=CDataClass.getData(t,"useCode",!1),this.managementButtonLength=CDataClass.getData(t,"managementButtonLength",30),this.tabButtonMargin=CDataClass.getData(t,"tabButtonMargin",0),this.defaultTabName=CDataClass.getData(t,"defaultTabName","Tab"),this.tabResource=CDataClass.getData(t,"tabResource",""),this.tabBodyResource=CDataClass.getData(t,"tabBodyResource",""),this.tabSheetResource=CDataClass.getData(t,"tabSheetResource",""),this.leftButtonText=CDataClass.getData(t,"leftButtonText",""),this.rightButtonText=CDataClass.getData(t,"rightButtonText",""),this.addButtonText=CDataClass.getData(t,"addButtonText",""),this.deleteButtonText=CDataClass.getData(t,"deleteButtonText",""),this.tabHeight=CDataClass.getData(t,"tabHeight",30),this.clear(),this.tabs.fromData(CDataClass.getData(t,"tabs",[],!0));let e=CDataClass.getData(t,"buttonSheet",[],!0);for(let t=0;t<e.length;t++)this.tabButtons.buttons[t].fromData(e[t].button),this.tabSheets.get(t).fromData(e[t].sheet);this.tabButtonPosition=CDataClass.getData(t,"tabButtonPosition","top"),this.body.position.align=EPositionAlign.CLIENT}doChangeDesignMode(){if(super.doChangeDesignMode(),this.isDesignMode){this.__designOrgData.body=this.body.hasPointerEvent,this.body.hasPointerEvent=!1;for(let t=0;t<this._tabSheets.length;t++)this.__designOrgData["sheet"+t]=this._tabSheets.get(t).hasPointerEvent,this._tabSheets.get(t).hasPointerEvent=!1}else{this.body.hasPointerEvent=this.__designOrgData.body;for(let t=0;t<this._tabSheets.length;t++)this._tabSheets.get(t).hasPointerEvent=this.__designOrgData["sheet"+t]}}doContainerList(){let t=super.doContainerList(),e=t.getItem(0);for(let t=0;t<this._tabSheets.length;t++)e.addChild({name:"sheet:"+t,control:this._tabSheets.get(t),isMainContainer:!1});return t}doChildDataMapHandle(t){super.doChildDataMapHandle(t);for(let e=0;e<this._tabSheets.length;e++){let i=CSystem.getChildControls(this._tabSheets.get(e));for(let s=0;s<i.length;s++)t.set(i[s],{kind:"sheet:"+e+":"+this.propertyName+":"+i[s].propertyName,data:i[s].toData()})}t.delete(this._tab);for(let e=0;e<this._tabSheets.length;e++)t.delete(this._tabSheets.get(e));t.delete(this._body)}doFromChildData(t,e){let i=super.doFromChildData(t,e);for(let s=0;s<this._tabSheets.length;s++)for(let o=0;o<t.length;o++)if(0==t[o].kind.indexOf("sheet:"+s+":"+this.propertyName)){let a;for(let e=0;e<i.length;e++)i[e].kind=="sheet:"+s+":"+this.propertyName+":"+t[o].data.propertyName&&(a=i[e]);if(e){let i=e[t[o].data.propertyName];i?(i.fromData(t[o].data),a.control=i):(a.control=CControl.controlFromData(t[o].data,this),a.control&&(a.control.parent=this.tabSheets.get(s)))}else{let e=this[t[o].data.propertyName];e?(e.fromData(t[o].data),a.control=e):(a.control=CControl.controlFromData(t[o].data,this),a.control&&(a.control.parent=this.tabSheets.get(s)))}}for(let t=0;t<i.length;t++);return i}doChangeIndex(){for(let t=0;t<this.tabSheets.length;t++){let e=t==this.index;this.tabSheets.get(t).visible!=e&&(this.tabSheets.get(t).visible=e)}null!=this.onChangeIndex&&this.onChangeIndex(this)}doAddTab(t){null!=this.onAddTab&&this.onAddTab(this)}doBeforeDeleteTab(t){this.tabSheets.get(t).remove(),this.tabSheets.delete(t),null!=this.onBeforeDeleteTab&&this.onBeforeDeleteTab(this,t)}doDeleteTab(){null!=this.onDeleteTab&&this.onDeleteTab(this)}doTabButtonClick(t){null!=this.onTabButtonClick&&this.onTabButtonClick(this,t)}doChangeTabs(){this.tabSheets.length=this.tabs.length;for(let t=0;t<this.tabSheets.length;t++)if(null==this.tabSheets.get(t)){let e=new CPanel(this._body);e.position.align=EPositionAlign.CLIENT,e.visible=!1,e.onResource=function(){e.position.align=EPositionAlign.CLIENT,e.visible=!1},e.resource=this.tabSheetResource,this.tabSheets.set(t,e),e.propertyName="sheet"+t,e.propertyDataKind="reserveControl,parent.tabSheets.get("+t+")",this.doCreateSheet(t,e)}null!=this.onChangeTabs&&this.onChangeTabs(this)}doCreateSheet(t,e){null!=this.onCreateTabSheet&&this.onCreateTabSheet(this,t,e)}addTab(t){this.tabButtons.addTab(t),this.index=this.tabs.length-1,this.tabButtons.scrollToRight()}deleteTab(t){if("string"==typeof t)for(let e=this.tabs.length-1;e>=0;e--)this.tabs.get(e)==t&&this.tabButtons.deleteTab(e);else this.tabButtons.deleteTab(t)}clear(){for(let t=this.tabs.length-1;t>=0;t--)this.tabButtons.deleteTab(t)}addProperties(){let t=new Array;return t.push({instance:this.tabs,propertyName:"tabs",readOnly:!1,enum:[]}),t.push({instance:this.leftButtonResource,propertyName:"leftButtonResource",readOnly:!1,enum:[]}),t.push({instance:this.rightButtonResource,propertyName:"rightButtonResource",readOnly:!1,enum:[]}),t.push({instance:this.addButtonResource,propertyName:"addButtonResource",readOnly:!1,enum:[]}),t.push({instance:this.deleteButtonResource,propertyName:"deleteButtonResource",readOnly:!1,enum:[]}),t.push({instance:this.tabButtons,propertyName:"tabButtons",readOnly:!1,enum:[]}),t.push({instance:this.kind,propertyName:"kind",readOnly:!1,enum:["ALIGN","AUTO_SIZE"]}),t.push({instance:this.useArrowButton,propertyName:"useArrowButton",readOnly:!1,enum:[]}),t.push({instance:this.useAddButton,propertyName:"useAddButton",readOnly:!1,enum:[]}),t.push({instance:this.useDeleteButton,propertyName:"useDeleteButton",readOnly:!1,enum:[]}),t.push({instance:this.useCode,propertyName:"useCode",readOnly:!1,enum:[]}),t.push({instance:this.leftButtonText,propertyName:"leftButtonText",readOnly:!1,enum:[]}),t.push({instance:this.rightButtonText,propertyName:"rightButtonText",readOnly:!1,enum:[]}),t.push({instance:this.addButtonText,propertyName:"addButtonText",readOnly:!1,enum:[]}),t.push({instance:this.deleteButtonText,propertyName:"deleteButtonText",readOnly:!1,enum:[]}),t.push({instance:this.index,propertyName:"index",readOnly:!1,enum:[]}),t}}!function(t){t[t.PREVIOUS_MONTH=0]="PREVIOUS_MONTH",t[t.NOW_MONTH=1]="NOW_MONTH",t[t.NEXT_MONTH=2]="NEXT_MONTH"}(ECalendarDateKind||(ECalendarDateKind={}));class CCalendarDaySheet extends CPanel{constructor(){super(...arguments),this.date=new Date,this.dateKind=ECalendarDateKind.NOW_MONTH}}class CCalendarPickup extends CPanel{constructor(t,e){super(t,e),this.pickupYearFrom=1900,this.pickupYearTo=2100,this.lLeft=new CPanel(this),this.lblYear=new CPanel(this.lLeft),this.lstYear=new CListBox(this.lLeft),this.lRight=new CPanel(this),this.lblMonth=new CPanel(this.lRight),this.lstMonth=new CListBox(this.lRight),this.lLeft.propertyName="lLeft",this.lblYear.propertyName="lblYear",this.lstYear.propertyName="lstYear",this.lRight.propertyName="lRight",this.lblMonth.propertyName="lblMonth",this.lstMonth.propertyName="lstMonth";for(let t=this.pickupYearFrom;t<=this.pickupYearTo;t++)this.lstYear.items.add(t+"");for(let t=1;t<=12;t++)this.lstMonth.items.add(t+"")}doToData(t){super.doToData(t),CDataClass.putData(t,"lLeft",this.lLeft.toData(),{},!0),CDataClass.putData(t,"lblYear",this.lblYear.toData(),{},!0),CDataClass.putData(t,"lstYear",this.lstYear.toData(),{},!0),CDataClass.putData(t,"lRight",this.lRight.toData(),{},!0),CDataClass.putData(t,"lblMonth",this.lblMonth.toData(),{},!0),CDataClass.putData(t,"lstMonth",this.lstMonth.toData(),{},!0)}doFromData(t){super.doFromData(t),this.lLeft.fromData(CDataClass.getData(t,"lLeft",{},!0)),this.lblYear.fromData(CDataClass.getData(t,"lblYear",{},!0)),this.lstYear.fromData(CDataClass.getData(t,"lstYear",{},!0)),this.lRight.fromData(CDataClass.getData(t,"lRight",{},!0)),this.lblMonth.fromData(CDataClass.getData(t,"lblMonth",{},!0)),this.lstMonth.fromData(CDataClass.getData(t,"lstMonth",{},!0))}setList(t,e){for(let e=0;e<this.lstYear.length;e++)if(parseInt(this.lstYear.items.get(e))==t){this.lstYear.itemIndex=e,this.lstYear.scrollToIndex(e);break}for(let t=0;t<this.lstMonth.length;t++)if(parseInt(this.lstMonth.items.get(t))==e){this.lstMonth.itemIndex=t,this.lstMonth.scrollToIndex(t);break}}}class CCalendar extends CPanel{get calendarHeader(){return this._calendarHeader}get calendarDayOfWeek(){return this._calendarDayOfWeek}get calendarBody(){return this._calendarBody}get buttonPrevious(){return this._buttonPrevious}get buttonNext(){return this._buttonNext}get buttonNow(){return this._buttonNow}get buttonPick(){return this._buttonPick}get datePickupResource(){return this._datePickupResource}set datePickupResource(t){this._datePickupResource=t}get dayOfWeekSheets(){return this._dayOfWeekSheets}get daySheets(){return this._daySheets}get calendarHeaderResource(){return this._calendarHeader.resource}set calendarHeaderResource(t){this._calendarHeader.resource=t}get calendarDayOfWeekResource(){return this._calendarDayOfWeek.resource}set calendarDayOfWeekResource(t){this._calendarDayOfWeek.resource=t}get calendarBodyResource(){return this._calendarBody.resource}set calendarBodyResource(t){this._calendarBody.resource=t}get buttonPreviousResource(){return this._buttonPrevious.resource}set buttonPreviousResource(t){this._buttonPrevious.resource=t}get buttonNextResource(){return this._buttonNext.resource}set buttonNextResource(t){this._buttonNext.resource=t}get buttonNowResource(){return this._buttonNow.resource}set buttonNowResource(t){this._buttonNow.resource=t}get buttonPickResource(){return this._buttonPick.resource}set buttonPickResource(t){this._buttonPick.resource=t}get dayOfWeekSheetResource(){return this._dayOfWeekSheetResource}set dayOfWeekSheetResource(t){if(this._dayOfWeekSheetResource!=t){this._dayOfWeekSheetResource=t;for(let e=0;e<this._dayOfWeekSheets.length;e++)this._dayOfWeekSheets[e].resource=t;this.doSetDayOfWeek()}}get daySheetResource(){return this._daySheetResource}set daySheetResource(t){if(this._daySheetResource!=t){this._daySheetResource=t;for(let e=0;e<this._daySheets.length;e++)for(let i=0;i<this._daySheets[e].length;i++)this._daySheets[e][i].resource=t;this.doSetDate()}}get date(){return this._date}set date(t){t.getTime()!=this._date.getTime()&&(this._date=t,this.doChangeDate())}get dayOfWeekText(){return this._dayOfWeekText}set dayOfWeekText(t){this._dayOfWeekText!=t&&(this._dayOfWeekText=t,this.doSetDayOfWeek())}get year(){return this._date.getFullYear()}get month(){return this._date.getMonth()+1}get day(){return this._date.getDate()}get dayOfWeek(){return this._date.getDay()}get yearString(){return this.year+""}get monthString(){return CStringUtil.lpad(this.month+"","0",2)}get dayString(){return CStringUtil.lpad(this.day+"","0",2)}get dayOfWeekString(){if(this._dayOfWeekText.length>this.dayOfWeek)return this._dayOfWeekText[this.dayOfWeek];return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][this.dayOfWeek]}constructor(t,e){super(t,e),this._calendarHeader=new CPanel(this),this._calendarDayOfWeek=new CPanel(this),this._calendarBody=new CPanel(this),this._buttonPrevious=new CButton(this._calendarHeader),this._buttonNext=new CButton(this._calendarHeader),this._buttonNow=new CButton(this._calendarHeader),this._buttonPick=new CButton(this._calendarHeader),this._dayOfWeekSheets=new Array(7),this._daySheets=new Array,this._daySheetResource="",this._dayOfWeekSheetResource="",this._dayOfWeekText=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],this._datePickupResource="";let i=this;this._calendarHeader.position.align=EPositionAlign.TOP,this._calendarHeader.position.height=30,this._calendarHeader.position.parentAlignInfo.gridColumnCount=7,this._calendarHeader.position.parentAlignInfo.gridRowCount=1,this._calendarHeader.propertyName="header",this._calendarHeader.propertyDataKind="reserveControl,_calendarHeader",this._calendarHeader.onResource=function(){i._calendarHeader.position.align=EPositionAlign.TOP,i._calendarHeader.position.height=30,i._calendarHeader.position.parentAlignInfo.gridColumnCount=7,i._calendarHeader.position.parentAlignInfo.gridRowCount=1,i._calendarHeader.text=i.date.getFullYear()+"-"+CStringUtil.lpad(i.date.getMonth()+1+"","0",2)+"-"+CStringUtil.lpad(i.date.getDate()+"","0",2),i._calendarHeader.propertyName="header",i._calendarHeader.propertyDataKind="reserveControl,_calendarHeader"},this._calendarDayOfWeek.position.align=EPositionAlign.TOP,this._calendarDayOfWeek.position.height=30,this._calendarDayOfWeek.position.parentAlignInfo.gridColumnCount=7,this._calendarDayOfWeek.position.parentAlignInfo.gridRowCount=1,this._calendarDayOfWeek.propertyName="dayOfWeek",this._calendarDayOfWeek.propertyDataKind="reserveControl,_calendarDayOfWeek",this._calendarDayOfWeek.onResource=function(){i._calendarDayOfWeek.position.align=EPositionAlign.TOP,i._calendarDayOfWeek.position.height=30,i._calendarDayOfWeek.position.parentAlignInfo.gridColumnCount=7,i._calendarDayOfWeek.position.parentAlignInfo.gridRowCount=1,i._calendarDayOfWeek.propertyName="dayOfWeek",i._calendarDayOfWeek.propertyDataKind="reserveControl,_calendarDayOfWeek"},this._calendarBody.position.align=EPositionAlign.CLIENT,this._calendarBody.position.parentAlignInfo.gridColumnCount=7,this._calendarBody.position.parentAlignInfo.gridRowCount=6,this._calendarBody.propertyName="body",this._calendarBody.propertyDataKind="reserveControl,_calendarBody",this._calendarBody.onResource=function(){i._calendarBody.position.align=EPositionAlign.CLIENT,i._calendarBody.position.parentAlignInfo.gridColumnCount=7,i._calendarBody.position.parentAlignInfo.gridRowCount=6,i._calendarBody.propertyName="body",i._calendarBody.propertyDataKind="reserveControl,_calendarBody"},this._buttonPrevious.position.align=EPositionAlign.LEFT,this._buttonPrevious.onResource=function(){i._buttonPrevious.position.align=EPositionAlign.LEFT},this._buttonPrevious.onClick=function(){i.date=new Date(i.date.getFullYear(),i.date.getMonth()-1,1)},this._buttonNext.position.align=EPositionAlign.RIGHT,this._buttonNext.onResource=function(){i._buttonNext.position.align=EPositionAlign.RIGHT},this._buttonNext.onClick=function(){i.date=new Date(i.date.getFullYear(),i.date.getMonth()+1,1)},this._buttonNow.position.align=EPositionAlign.LEFT,this._buttonNow.onResource=function(){i._buttonNow.position.align=EPositionAlign.LEFT},this._buttonNow.onClick=function(){i.date=new Date},i.calendarHeader.bringToFront(),this._buttonPick.position.align=EPositionAlign.RIGHT,this._buttonPick.onBeforePickupShow=function(t,e){let s=new CCalendarPickup(e,"pick");s.resource=i.datePickupResource,s.setList(i.date.getFullYear(),i.date.getMonth()+1),s.lstYear.onChangeItemIndex=function(){-1!=s.lstYear.itemIndex&&(i.date=new Date(parseInt(s.lstYear.items.get(s.lstYear.itemIndex)),s.lstMonth.itemIndex,1))},s.lstMonth.onChangeItemIndex=function(){-1!=s.lstMonth.itemIndex&&(i.date=new Date(parseInt(s.lstYear.items.get(s.lstYear.itemIndex)),s.lstMonth.itemIndex,1))},s.filter.filterSet.shadow=!0,s.filter.shadowX=0,s.filter.shadowY=0};for(let t=0;t<7;t++){let e=new CPanel(this._calendarDayOfWeek);e.onResource=function(){e.position.alignInfo.gridColumn=t,e.position.alignInfo.gridRow=0,e.position.align=EPositionAlign.GRID,e.propertyName="dayOfWeek"+t,e.propertyDataKind="reserveControl,parent._dayOfWeekSheets["+t+"]"},e.position.alignInfo.gridColumn=t,e.position.alignInfo.gridRow=0,e.position.align=EPositionAlign.GRID,e.propertyName="dayOfWeek"+t,e.propertyDataKind="reserveControl,parent._dayOfWeekSheets["+t+"]",this._dayOfWeekSheets[t]=e}this._daySheets.length=7;for(let t=0;t<7;t++){let e=new Array(6);this._daySheets[t]=e;for(let e=0;e<6;e++){let s=new CCalendarDaySheet(this._calendarBody);s.onResource=function(){s.position.alignInfo.gridColumn=t,s.position.alignInfo.gridRow=e,s.position.align=EPositionAlign.GRID,s.propertyName="dayOfWeek_"+e+"_"+t,s.propertyDataKind="reserveControl,parent._daySheets["+t+"]["+e+"]"},s.position.alignInfo.gridColumn=t,s.position.alignInfo.gridRow=e,s.position.align=EPositionAlign.GRID,s.onClick=function(){i.doSelectDate(s)},s.propertyName="dayOfWeek_"+e+"_"+t,s.propertyDataKind="reserveControl,parent._daySheets["+t+"]["+e+"]",this._daySheets[t][e]=s}}this._date=new Date,this.doChangeDate()}doToData(t){super.doToData(t),CDataClass.putData(t,"daySheetResource",this.daySheetResource,""),CDataClass.putData(t,"dayOfWeekSheetResource",this.dayOfWeekSheetResource,""),CDataClass.putData(t,"datePickupResource",this.datePickupResource,""),CDataClass.putData(t,"date",this.date.getTime()),CDataClass.putData(t,"dayOfWeekText",this.dayOfWeekText,[],!0),CDataClass.putData(t,"calendarHeader",this.calendarHeader.toData(),{},!0),CDataClass.putData(t,"calendarDayOfWeek",this.calendarDayOfWeek.toData(),{},!0),CDataClass.putData(t,"calendarBody",this.calendarBody.toData(),{},!0),CDataClass.putData(t,"buttonPrevious",this.buttonPrevious.toData(),{},!0),CDataClass.putData(t,"buttonNext",this.buttonNext.toData(),{},!0),CDataClass.putData(t,"buttonNow",this.buttonNow.toData(),{},!0),CDataClass.putData(t,"buttonPick",this.buttonPick.toData(),{},!0)}doFromData(t){super.doFromData(t),this.daySheetResource=CDataClass.getData(t,"daySheetResource",""),this.dayOfWeekSheetResource=CDataClass.getData(t,"dayOfWeekSheetResource",""),this.datePickupResource=CDataClass.getData(t,"datePickupResource",""),this.date=new Date(CDataClass.getData(t,"date")),this.dayOfWeekText=CDataClass.getData(t,"dayOfWeekText",[],!0),this.calendarHeader.fromData(CDataClass.getData(t,"calendarHeader",{},!0)),this.calendarDayOfWeek.fromData(CDataClass.getData(t,"calendarDayOfWeek",{},!0)),this.calendarBody.fromData(CDataClass.getData(t,"calendarBody",{},!0)),this.buttonPrevious.fromData(CDataClass.getData(t,"buttonPrevious",{},!0)),this.buttonNext.fromData(CDataClass.getData(t,"buttonNext",{},!0)),this.buttonNow.fromData(CDataClass.getData(t,"buttonNow",{},!0)),this.buttonPick.fromData(CDataClass.getData(t,"buttonPick",{},!0))}doChildDataMapHandle(t){super.doChildDataMapHandle(t),t.delete(this.calendarHeader),t.delete(this.calendarDayOfWeek),t.delete(this.calendarBody);for(let e=0;e<this._daySheets.length;e++)for(let i=0;i<this._daySheets[e].length;i++){let s=CSystem.getChildControls(this._daySheets[e][i]);for(let o=0;o<s.length;o++)t.set(s[o],{kind:"sheet:"+e+":"+i,data:s[o].toData()})}}doChangeDesignMode(){if(super.doChangeDesignMode(),this.isDesignMode){this.__designOrgData.buttonNext=this.buttonNext.hasPointerEvent,this.__designOrgData.buttonNow=this.buttonNow.hasPointerEvent,this.__designOrgData.buttonPick=this.buttonPick.hasPointerEvent,this.__designOrgData.buttonPrevious=this.buttonPrevious.hasPointerEvent,this.__designOrgData.calendarHeader=this.calendarHeader.hasPointerEvent,this.__designOrgData.calendarBody=this.calendarBody.hasPointerEvent,this.__designOrgData.calendarDayOfWeek=this.calendarDayOfWeek.hasPointerEvent,this.buttonNext.hasPointerEvent=!1,this.buttonNow.hasPointerEvent=!1,this.buttonPick.hasPointerEvent=!1,this.buttonPrevious.hasPointerEvent=!1,this.calendarHeader.hasPointerEvent=!1,this.calendarBody.hasPointerEvent=!1,this.calendarDayOfWeek.hasPointerEvent=!1;for(let t=0;t<this.dayOfWeekSheets.length;t++)this.dayOfWeekSheets[t].hasPointerEvent=!this.isDesignMode;for(let t=0;t<this.daySheets.length;t++)for(let e=0;e<this.daySheets[t].length;e++)this.daySheets[t][e].hasPointerEvent=!this.isDesignMode}else{this.buttonNext.hasPointerEvent=this.__designOrgData.buttonNext,this.buttonNow.hasPointerEvent=this.__designOrgData.buttonNow,this.buttonPick.hasPointerEvent=this.__designOrgData.buttonPick,this.buttonPrevious.hasPointerEvent=this.__designOrgData.buttonPrevious,this.calendarHeader.hasPointerEvent=this.__designOrgData.calendarHeader,this.calendarBody.hasPointerEvent=this.__designOrgData.calendarBody,this.calendarDayOfWeek.hasPointerEvent=this.__designOrgData.calendarDayOfWeek;for(let t=0;t<this.dayOfWeekSheets.length;t++)this.dayOfWeekSheets[t].hasPointerEvent=!this.isDesignMode;for(let t=0;t<this.daySheets.length;t++)for(let e=0;e<this.daySheets[t].length;e++)this.daySheets[t][e].hasPointerEvent=!this.isDesignMode}}doSelectDate(t){this.date=t.date,null!=this.onSelectDate&&this.onSelectDate(this)}doChangeDate(){this.doSetDate(),this._calendarHeader.text=this.date.getFullYear()+"-"+CStringUtil.lpad(this.date.getMonth()+1+"","0",2)+"-"+CStringUtil.lpad(this.date.getDate()+"","0",2),null!=this.onChangeDate&&this.onChangeDate(this)}doSetDate(){let t=new CDatetime(this._date.getTime()),e=t.getFirstDayDate().getDay(),i=t.getLastDay();for(let s=0;s<this._daySheets.length;s++)for(let o=0;o<this._daySheets[s].length;o++){let a=s+7*o;this._daySheets[s][o].date=new Date(t.year,t.month-1,a-e+1),this._daySheets[s][o].text=this._daySheets[s][o].date.getDate()+"",this._daySheets[s][o].selected=!1,CDatetime.dateToYYYYMMDD(this._daySheets[s][o].date)==CDatetime.dateToYYYYMMDD(this.date)&&(this._daySheets[s][o].selected=!0,this._daySheets[s][o].focused=!0),a<e?(this._daySheets[s][o].opacity=.5,this._daySheets[s][o].dateKind=ECalendarDateKind.PREVIOUS_MONTH):a>=e&&a<e+i?(this._daySheets[s][o].opacity=1,this._daySheets[s][o].dateKind=ECalendarDateKind.NOW_MONTH):(this._daySheets[s][o].opacity=.5,this._daySheets[s][o].dateKind=ECalendarDateKind.NEXT_MONTH),this.doSetDaySheet(s,o,this._daySheets[s][o])}null!=this.onSetDate&&this.onSetDate(this)}doSetDaySheet(t,e,i){null!=this.onSetDaySheet&&this.onSetDaySheet(this,t,e,i)}doSetDayOfWeek(){for(let t=0;t<this._dayOfWeekSheets.length;t++)this._dayOfWeekText.length>t&&(this._dayOfWeekSheets[t].text=this._dayOfWeekText[t]);null!=this.onSetDayOfWeek&&this.onSetDayOfWeek(this)}}class CClock extends CPanel{get hourAngle(){return this._hourAngle}get minuteAngle(){return this._minuteAngle}get secondAngle(){return this._secondAngle}get date(){return this._date}set date(t){this._date.getTime()!=t.getTime()&&(this._date=t,this.doChangeDate())}get hourHandle(){return this._hourHandle}get minuteHandle(){return this._minuteHandle}get secondHandle(){return this._secondHandle}get useEdit(){return this._useEdit}set useEdit(t){this._useEdit!=t&&(this._useEdit=t,this.doChangeEdit(t))}get amPmText(){return this._amPmText}set amPmText(t){this._amPmText=t,this.doSetTime()}get addHour(){return this._addHour}set addHour(t){this._addHour=t,this.doSetTime()}get addMinute(){return this._addMinute}set addMinute(t){this._addMinute=t,this.doSetTime()}get addSecond(){return this._addSecond}set addSecond(t){this._addSecond=t,this.doSetTime()}get hourCanvasItemName(){return this._hourCanvasItemName}set hourCanvasItemName(t){this._hourCanvasItemName=t,this.doSetTime()}get minuteCanvasItemName(){return this._minuteCanvasItemName}set minuteCanvasItemName(t){this._minuteCanvasItemName=t,this.doSetTime()}get secondCanvasItemName(){return this._secondCanvasItemName}set secondCanvasItemName(t){this._secondCanvasItemName=t,this.doSetTime()}get labelCanvasItemName(){return this._labelCanvasItemName}set labelCanvasItemName(t){this._labelCanvasItemName=t,this.doSetTime()}get amPmCanvasItemName(){return this._amPmCanvasItemName}set amPmCanvasItemName(t){this._amPmCanvasItemName=t,this.doSetTime()}get handleResource(){return this._handleResource}set handleResource(t){this._handleResource=t,this._hourHandle.resource=t,this._minuteHandle.resource=t,this._secondHandle.resource=t}constructor(t,e){super(t,e),this.__editIsAm=!1,this.__tick=0,this.__hourDown=new CPoint(0,0),this.__minDown=new CPoint(0,0),this.__secDown=new CPoint(0,0),this._hourAngle=0,this._minuteAngle=0,this._secondAngle=0,this._date=new Date,this._hourHandle=new CPanel(this),this._minuteHandle=new CPanel(this),this._secondHandle=new CPanel(this),this._useEdit=!1,this._amPmText=["AM","PM"],this._addHour=0,this._addMinute=0,this._addSecond=0,this._hourCanvasItemName="hour",this._minuteCanvasItemName="minute",this._secondCanvasItemName="second",this._labelCanvasItemName="label",this._amPmCanvasItemName="ampm",this._handleResource="",this.interval=100;let i=this;this._hourHandle.visible=!1,this._hourHandle.usePointerCapture=!0,this._hourHandle.onResource=function(){i._hourHandle.visible=!1,i._hourHandle.usePointerCapture=!0,i._hourHandle.text="H",i._hourHandle.useMove=!0,i._hourHandle.resizeAreaLength=0,i._hourHandle.moveAreaLength=100},this._hourHandle.onThisPointerDown=function(t,e,s){i.__secDown=new CPoint(i._hourHandle.position.left+i._hourHandle.position.width/2,i._hourHandle.position.top+i._hourHandle.position.height/2)},this._hourHandle.onPointerUp=function(){i.setHandle()},this._hourHandle.onThisPointerMove=function(t,e,s){if(i._hourHandle.isPress){let t=CPoint.getAngleFromTwoPoint(new CPoint(i.position.width/2,i.position.height/2),new CPoint(i._hourHandle.position.left+i._hourHandle.position.width/2,i._hourHandle.position.top+i._hourHandle.position.height/2));if(i.__editIsAm){let e=CCalc.crRange2Value(0,360,t,3,15);e>12&&(e-=12),i.date=new Date(i.date.getFullYear(),i.date.getMonth()-1,i.date.getDate(),e,i.date.getMinutes(),i.date.getSeconds())}else{let e=CCalc.crRange2Value(0,360,t,15,27);e>24&&(e-=12),i.date=new Date(i.date.getFullYear(),i.date.getMonth()-1,i.date.getDate(),e,i.date.getMinutes(),i.date.getSeconds())}}},this._minuteHandle.visible=!1,this._minuteHandle.usePointerCapture=!0,this._minuteHandle.onResource=function(){i._minuteHandle.visible=!1,i._minuteHandle.usePointerCapture=!0,i._minuteHandle.text="M",i._minuteHandle.useMove=!0,i._minuteHandle.resizeAreaLength=0,i._minuteHandle.moveAreaLength=100},this._minuteHandle.onThisPointerDown=function(t,e,s){i.__secDown=new CPoint(i._minuteHandle.position.left+i._minuteHandle.position.width/2,i._minuteHandle.position.top+i._minuteHandle.position.height/2)},this._minuteHandle.onThisPointerMove=function(t,e,s){if(i._minuteHandle.isPress){let t=CPoint.getAngleFromTwoPoint(new CPoint(i.position.width/2,i.position.height/2),new CPoint(i._minuteHandle.position.left+i._minuteHandle.position.width/2,i._minuteHandle.position.top+i._minuteHandle.position.height/2)),e=CCalc.crRange2Value(0,360,t,15,75);e>60&&(e-=60),i.date=new Date(i.date.getFullYear(),i.date.getMonth()-1,i.date.getDate(),i.date.getHours(),e,i.date.getSeconds())}},this._minuteHandle.onPointerUp=function(){i.setHandle()},this._secondHandle.visible=!1,this._secondHandle.usePointerCapture=!0,this._secondHandle.text="S",this._secondHandle.onResource=function(){i._secondHandle.visible=!1,i._secondHandle.usePointerCapture=!0,i._secondHandle.text="S",i._secondHandle.useMove=!0,i._secondHandle.resizeAreaLength=0,i._secondHandle.moveAreaLength=100},this._secondHandle.onThisPointerDown=function(t,e,s){i.__secDown=new CPoint(i._secondHandle.position.left+i._secondHandle.position.width/2,i._secondHandle.position.top+i._secondHandle.position.height/2)},this._secondHandle.onThisPointerMove=function(t,e,s){if(i._secondHandle.isPress){let t=CPoint.getAngleFromTwoPoint(new CPoint(i.position.width/2,i.position.height/2),new CPoint(i._secondHandle.position.left+i._secondHandle.position.width/2,i._secondHandle.position.top+i._secondHandle.position.height/2)),e=CCalc.crRange2Value(0,360,t,15,75);e>60&&(e-=60),i.date=new Date(i.date.getFullYear(),i.date.getMonth()-1,i.date.getDate(),i.date.getHours(),i.date.getMinutes(),e)}},this._secondHandle.onPointerUp=function(){i.setHandle()}}setHandle(){let t=this.position.width/10,e=4*t-t/2,i=3*t-t/2,s=2*t-t/2;if(!this._hourHandle.isPress){let e=CPoint.getAngleToPoint(new CPoint(this.position.width/2,this.position.height/2),s,s,this._hourAngle-90);this._hourHandle.position.left=e.x-t/2,this._hourHandle.position.top=e.y-t/2,this._hourHandle.position.width=t,this._hourHandle.position.height=t}if(!this._minuteHandle.isPress){let e=CPoint.getAngleToPoint(new CPoint(this.position.width/2,this.position.height/2),i,i,this._minuteAngle-90);this._minuteHandle.position.left=e.x-t/2,this._minuteHandle.position.top=e.y-t/2,this._minuteHandle.position.width=t,this._minuteHandle.position.height=t}if(!this._secondHandle.isPress){let i=CPoint.getAngleToPoint(new CPoint(this.position.width/2,this.position.height/2),e,e,this._secondAngle-90);this._secondHandle.position.left=i.x-t/2,this._secondHandle.position.top=i.y-t/2,this._secondHandle.position.width=t,this._secondHandle.position.height=t}}doToData(t){super.doToData(t),CDataClass.putData(t,"date",this._date.getTime()),CDataClass.putData(t,"amPmText",this.amPmText,["AM","PM"],!0),CDataClass.putData(t,"addHour",this.addHour,0),CDataClass.putData(t,"addMinute",this.addMinute,0),CDataClass.putData(t,"addSecond",this.addSecond,0),CDataClass.putData(t,"hourCanvasItemName",this.hourCanvasItemName,"hour"),CDataClass.putData(t,"minuteCanvasItemName",this.minuteCanvasItemName,"minute"),CDataClass.putData(t,"secondCanvasItemName",this.secondCanvasItemName,"second"),CDataClass.putData(t,"labelCanvasItemName",this.labelCanvasItemName,"label"),CDataClass.putData(t,"amPmCanvasItemName",this.amPmCanvasItemName,"ampm"),CDataClass.putData(t,"handleResource",this.handleResource,"")}doFromData(t){super.doFromData(t),this.date=new Date(CDataClass.getData(t,"date")),this.amPmText=CDataClass.getData(t,"amPmText",["AM","PM"],!0),this.addHour=CDataClass.getData(t,"addHour",0),this.addMinute=CDataClass.getData(t,"addMinute",0),this.addSecond=CDataClass.getData(t,"addSecond",0),this.hourCanvasItemName=CDataClass.getData(t,"hourCanvasItemName","hour"),this.minuteCanvasItemName=CDataClass.getData(t,"minuteCanvasItemName","minute"),this.secondCanvasItemName=CDataClass.getData(t,"secondCanvasItemName","second"),this.labelCanvasItemName=CDataClass.getData(t,"labelCanvasItemName","label"),this.amPmCanvasItemName=CDataClass.getData(t,"amPmCanvasItemName","ampm"),this.handleResource=CDataClass.getData(t,"handleResource","")}doChildDataMapHandle(t){super.doChildDataMapHandle(t),t.delete(this.hourHandle),t.delete(this.secondHandle),t.delete(this.minuteHandle)}doClick(t){super.doClick(t),this.useEdit&&(this.__editIsAm=!this.__editIsAm,this.doSetTime(),this.draw())}doChangeEdit(t){this._hourHandle.visible=t,this._minuteHandle.visible=t,this._secondHandle.visible=t,this.__editIsAm=!(this.date.getHours()>12),this.setHandle()}doChangeDate(){this.doSetTime()}doSetTime(){let t=this.date;t=new Date(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours()+this._addHour,t.getMinutes()+this._addMinute,t.getSeconds()+this._addSecond,t.getMilliseconds());let e=60*t.getHours()*60*1e3+60*t.getMinutes()*1e3+1e3*t.getSeconds()+t.getMilliseconds();this._hourAngle=CCalc.cr(864e5,e,720,0,4);let i=60*t.getMinutes()*1e3+1e3*t.getSeconds()+t.getMilliseconds();this._minuteAngle=CCalc.cr(36e5,i,360,0,4);let s=1e3*t.getSeconds()+t.getMilliseconds();this._secondAngle=CCalc.cr(6e4,s,360,0,4);let o=this.layers.getCanvasItems(this._hourCanvasItemName);for(let t=0;t<o.length;t++)o[t].rotationAngle=this._hourAngle-90;let a=this.layers.getCanvasItems(this._minuteCanvasItemName);for(let t=0;t<a.length;t++)a[t].rotationAngle=this._minuteAngle-90;let n=this.layers.getCanvasItems(this._secondCanvasItemName);for(let t=0;t<n.length;t++)n[t].rotationAngle=this._secondAngle-90;let r=this.layers.getCanvasItems(this._labelCanvasItemName);for(let e=0;e<r.length;e++)r[e].text=CStringUtil.lpad(t.getHours()+"","0",2)+" : "+CStringUtil.lpad(t.getMinutes()+"","0",2)+" : "+CStringUtil.lpad(t.getSeconds()+"","0",2);if(this.useEdit){let t=this.layers.getCanvasItems(this._amPmCanvasItemName);for(let e=0;e<t.length;e++)this.__editIsAm?this.amPmText.length>=2&&(t[e].text=this.amPmText[0]):this.amPmText.length>=2&&(t[e].text=this.amPmText[1])}else{let e=this.layers.getCanvasItems(this._amPmCanvasItemName);for(let i=0;i<e.length;i++)t.getHours()>12?this.amPmText.length>=2&&(e[i].text=this.amPmText[1]):this.amPmText.length>=2&&(e[i].text=this.amPmText[0])}this.useEdit&&this.setHandle()}on(){if(0==this.__tick){this.useEdit=!1;let t=this;this.__tick=setInterval((function(){t.date=new Date}),this.interval)}}off(){0!=this.__tick&&(clearInterval(this.__tick),this.__tick=0)}}class CWindowModel extends CPanel{get title(){return this.caption.text}set title(t){this.caption.text=t}get state(){return this.__state}constructor(t,e){super(t,e),this.__orgPadding=new CRect,this.__orgPosition=new CPosition,this.__state="none",this.caption=new CPanel(this),this.icon=new CPanel(this.caption),this.btnClose=new CButton(this.caption),this.btnMaximize=new CButton(this.caption),this.btnCustomAlign=new CButton(this.caption),this.btnMinimize=new CButton(this.caption),this.btnSendToBack=new CButton(this.caption),this.body=new CPanel(this),this.alignCover=new CCover(this.body),this.customAlign=new CPanel(this.alignCover),this.btnAlignLeftTop=new CButton(this.customAlign),this.btnAlignMiddleTop=new CButton(this.customAlign),this.btnAlignRightTop=new CButton(this.customAlign),this.btnAlignLeftMiddle=new CButton(this.customAlign),this.btnAlignRightMiddle=new CButton(this.customAlign),this.btnAlignLeftBottom=new CButton(this.customAlign),this.btnAlignMiddleBottom=new CButton(this.customAlign),this.btnAlignRightBottom=new CButton(this.customAlign),this.btnAlignCenter=new CButton(this.customAlign),this.cover=new CCover(this.body),this.closeAction="remove";let i=this;function s(){i.__orgPosition.left=i.position.left,i.__orgPosition.top=i.position.top,i.__orgPosition.width=i.position.width,i.__orgPosition.height=i.position.height}this.propertyName="CWindowModel",this.caption.propertyName="caption",this.caption.propertyDataKind="reserveControl,caption",this.btnClose.propertyName="btnClose",this.btnClose.propertyDataKind="reserveControl,parent.btnClose",this.btnMaximize.propertyName="btnMaximize",this.btnMaximize.propertyDataKind="reserveControl,parent.btnMaximize",this.btnCustomAlign.propertyName="btnCustomAlign",this.btnCustomAlign.propertyDataKind="reserveControl,parent.btnCustomAlign",this.btnMinimize.propertyName="btnMinimize",this.btnMinimize.propertyDataKind="reserveControl,parent.btnMinimize",this.body.propertyName="body",this.body.propertyDataKind="reserveControl,body",this.alignCover.propertyName="alignCover",this.alignCover.propertyDataKind="reserveControl,parent.alignCover",this.customAlign.propertyName="customAlign",this.customAlign.propertyDataKind="reserveControl,parent.parent.customAlign",this.btnAlignLeftTop.propertyName="btnAlignLeftTop",this.btnAlignLeftTop.propertyDataKind="reserveControl,parent.parent.parent.btnAlignLeftTop",this.btnAlignMiddleTop.propertyName="btnAlignMiddleTop",this.btnAlignMiddleTop.propertyDataKind="reserveControl,parent.parent.parent.btnAlignMiddleTop",this.btnAlignRightTop.propertyName="btnAlignRightTop",this.btnAlignRightTop.propertyDataKind="reserveControl,parent.parent.parent.btnAlignRightTop",this.btnAlignLeftMiddle.propertyName="btnAlignLeftMiddle",this.btnAlignLeftMiddle.propertyDataKind="reserveControl,parent.parent.parent.btnAlignLeftMiddle",this.btnAlignRightMiddle.propertyName="btnAlignRightMiddle",this.btnAlignRightMiddle.propertyDataKind="reserveControl,parent.parent.parent.btnAlignRightMiddle",this.btnAlignLeftBottom.propertyName="btnAlignLeftBottom",this.btnAlignLeftBottom.propertyDataKind="reserveControl,parent.parent.parent.btnAlignLeftBottom",this.btnAlignMiddleBottom.propertyName="btnAlignMiddleBottom",this.btnAlignMiddleBottom.propertyDataKind="reserveControl,parent.parent.parent.btnAlignMiddleBottom",this.btnAlignRightBottom.propertyName="btnAlignRightBottom",this.btnAlignRightBottom.propertyDataKind="reserveControl,parent.parent.parent.btnAlignRightBottom",this.btnAlignCenter.propertyName="btnAlignCenter",this.btnAlignCenter.propertyDataKind="reserveControl,parent.parent.parent.btnAlignCenter",this.body.onChangeSize=function(){i.cover.position.width=i.body.position.width,i.cover.position.height=i.body.position.height,i.alignCover.position.width=i.body.position.width,i.alignCover.position.height=i.body.position.height},this.btnCustomAlign.onClick=function(){i.alignCover.visible?i.alignCover.hideCover():i.alignCover.showCover()},this.btnClose.onClick=function(){i.close()},this.btnMinimize.onClick=function(){i.minimize()},this.btnMaximize.onClick=function(){i.maximize()},this.btnSendToBack.onClick=function(){i.doSendToBack()},this.btnAlignLeftTop.onClick=function(){null!=i.parent&&(s(),i.position.left=0,i.position.top=0,i.position.width=i.parent.position.width/2,i.position.height=i.parent.position.height/2,i.alignCover.hideCover())},this.btnAlignMiddleTop.onClick=function(){null!=i.parent&&(s(),i.position.left=0,i.position.top=0,i.position.width=i.parent.position.width,i.position.height=i.parent.position.height/2,i.alignCover.hideCover())},this.btnAlignRightTop.onClick=function(){null!=i.parent&&(s(),i.position.left=i.parent.position.width/2,i.position.top=0,i.position.width=i.parent.position.width/2,i.position.height=i.parent.position.height/2,i.alignCover.hideCover())},this.btnAlignLeftMiddle.onClick=function(){null!=i.parent&&(s(),i.position.left=0,i.position.top=0,i.position.width=i.parent.position.width/2,i.position.height=i.parent.position.height,i.alignCover.hideCover())},this.btnAlignCenter.onClick=function(){i.position.left=i.__orgPosition.left,i.position.top=i.__orgPosition.top,i.position.width=i.__orgPosition.width,i.position.height=i.__orgPosition.height,i.alignCover.hideCover()},this.btnAlignRightMiddle.onClick=function(){null!=i.parent&&(s(),i.position.left=i.parent.position.width/2,i.position.top=0,i.position.width=i.parent.position.width/2,i.position.height=i.parent.position.height,i.alignCover.hideCover())},this.btnAlignLeftBottom.onClick=function(){null!=i.parent&&(s(),i.position.left=0,i.position.top=i.parent.position.height/2,i.position.width=i.parent.position.width/2,i.position.height=i.parent.position.height/2,i.alignCover.hideCover())},this.btnAlignMiddleBottom.onClick=function(){null!=i.parent&&(s(),i.position.left=0,i.position.top=i.parent.position.height/2,i.position.width=i.parent.position.width,i.position.height=i.parent.position.height/2,i.alignCover.hideCover())},this.btnAlignRightBottom.onClick=function(){null!=i.parent&&(s(),i.position.left=i.parent.position.width/2,i.position.top=i.parent.position.height/2,i.position.width=i.parent.position.width/2,i.position.height=i.parent.position.height/2,i.alignCover.hideCover())}}setActivate(){null!=CWindowModel.activateWindow?CWindowModel.activateWindow!=this&&(CWindowModel.activateWindow.doDeactivate(),CWindowModel.activateWindow=this,this.doActivate()):(CWindowModel.activateWindow=this,this.doActivate())}doToData(t){super.doToData(t),CDataClass.putData(t,"caption",this.caption.toData(),{},!0),CDataClass.putData(t,"icon",this.icon.toData(),{},!0),CDataClass.putData(t,"btnClose",this.btnClose.toData(),{},!0),CDataClass.putData(t,"btnMaximize",this.btnMaximize.toData(),{},!0),CDataClass.putData(t,"btnCustomAlign",this.btnCustomAlign.toData(),{},!0),CDataClass.putData(t,"btnMinimize",this.btnMinimize.toData(),{},!0),CDataClass.putData(t,"btnSendToBack",this.btnSendToBack.toData(),{},!0),CDataClass.putData(t,"body",this.body.toData(),{},!0),CDataClass.putData(t,"alignCover",this.alignCover.toData(),{},!0),CDataClass.putData(t,"customAlign",this.customAlign.toData(),{},!0),CDataClass.putData(t,"btnAlignLeftTop",this.btnAlignLeftTop.toData(),{},!0),CDataClass.putData(t,"btnAlignMiddleTop",this.btnAlignMiddleTop.toData(),{},!0),CDataClass.putData(t,"btnAlignRightTop",this.btnAlignRightTop.toData(),{},!0),CDataClass.putData(t,"btnAlignLeftMiddle",this.btnAlignLeftMiddle.toData(),{},!0),CDataClass.putData(t,"btnAlignRightMiddle",this.btnAlignRightMiddle.toData(),{},!0),CDataClass.putData(t,"btnAlignLeftBottom",this.btnAlignLeftBottom.toData(),{},!0),CDataClass.putData(t,"btnAlignMiddleBottom",this.btnAlignMiddleBottom.toData(),{},!0),CDataClass.putData(t,"btnAlignRightBottom",this.btnAlignRightBottom.toData(),{},!0),CDataClass.putData(t,"btnAlignCenter",this.btnAlignCenter.toData(),{},!0),CDataClass.putData(t,"closeAction",this.closeAction,"remove"),CDataClass.putData(t,"cover",this.cover.toData(),{},!0),null!=this.showAnimationTrigger&&CDataClass.putData(t,"showAnimationTrigger",this.showAnimationTrigger.toData(),{},!0),null!=this.hideAnimationTrigger&&CDataClass.putData(t,"hideAnimationTrigger",this.hideAnimationTrigger.toData(),{},!0),null!=this.activateAnimationTrigger&&CDataClass.putData(t,"activateAnimationTrigger",this.activateAnimationTrigger.toData(),{},!0),null!=this.maximizeAnimationTrigger&&CDataClass.putData(t,"maximizeAnimationTrigger",this.maximizeAnimationTrigger.toData(),{},!0),null!=this.minimizeAnimationTrigger&&CDataClass.putData(t,"minimizeAnimationTrigger",this.minimizeAnimationTrigger.toData(),{},!0),null!=this.customAlignAnimationTrigger&&CDataClass.putData(t,"customAlignAnimationTrigger",this.customAlignAnimationTrigger.toData(),{},!0)}doFromData(t){super.doFromData(t),this.caption.fromData(CDataClass.getData(t,"caption",{},!0)),this.icon.fromData(CDataClass.getData(t,"icon",{},!0)),this.btnClose.fromData(CDataClass.getData(t,"btnClose",{},!0)),this.btnMaximize.fromData(CDataClass.getData(t,"btnMaximize",{},!0)),this.btnCustomAlign.fromData(CDataClass.getData(t,"btnCustomAlign",{},!0)),this.btnMinimize.fromData(CDataClass.getData(t,"btnMinimize",{},!0)),this.btnSendToBack.fromData(CDataClass.getData(t,"btnSendToBack",{},!0)),this.body.fromData(CDataClass.getData(t,"body",{},!0)),this.alignCover.fromData(CDataClass.getData(t,"alignCover",{},!0)),this.customAlign.fromData(CDataClass.getData(t,"customAlign",{},!0)),this.btnAlignLeftTop.fromData(CDataClass.getData(t,"btnAlignLeftTop",{},!0)),this.btnAlignMiddleTop.fromData(CDataClass.getData(t,"btnAlignMiddleTop",{},!0)),this.btnAlignRightTop.fromData(CDataClass.getData(t,"btnAlignRightTop",{},!0)),this.btnAlignLeftMiddle.fromData(CDataClass.getData(t,"btnAlignLeftMiddle",{},!0)),this.btnAlignRightMiddle.fromData(CDataClass.getData(t,"btnAlignRightMiddle",{},!0)),this.btnAlignLeftBottom.fromData(CDataClass.getData(t,"btnAlignLeftBottom",{},!0)),this.btnAlignMiddleBottom.fromData(CDataClass.getData(t,"btnAlignMiddleBottom",{},!0)),this.btnAlignRightBottom.fromData(CDataClass.getData(t,"btnAlignRightBottom",{},!0)),this.btnAlignCenter.fromData(CDataClass.getData(t,"btnAlignCenter",{},!0)),this.closeAction=CDataClass.getData(t,"closeAction",""),this.cover.fromData(CDataClass.getData(t,"cover",{},!0)),CAnimator.fromAnimatorData(t,this,"showAnimationTrigger"),CAnimator.fromAnimatorData(t,this,"hideAnimationTrigger"),CAnimator.fromAnimatorData(t,this,"activateAnimationTrigger"),CAnimator.fromAnimatorData(t,this,"maximizeAnimationTrigger"),CAnimator.fromAnimatorData(t,this,"minimizeAnimationTrigger"),CAnimator.fromAnimatorData(t,this,"customAlignAnimationTrigger")}doChildDataMapHandle(t){super.doChildDataMapHandle(t);let e=CSystem.getChildControls(this.caption);for(let i=0;i<e.length;i++)t.set(e[i],{kind:"caption",data:e[i].toData()});e=CSystem.getChildControls(this.body);for(let i=0;i<e.length;i++)t.set(e[i],{kind:"body",data:e[i].toData()});t.delete(this.caption),t.delete(this.body),t.delete(this.icon),t.delete(this.btnClose),t.delete(this.btnMaximize),t.delete(this.btnCustomAlign),t.delete(this.btnMinimize),t.delete(this.btnSendToBack),t.delete(this.alignCover),t.delete(this.customAlign),t.delete(this.btnAlignLeftTop),t.delete(this.btnAlignMiddleTop),t.delete(this.btnAlignRightTop),t.delete(this.btnAlignLeftMiddle),t.delete(this.btnAlignRightMiddle),t.delete(this.btnAlignLeftBottom),t.delete(this.btnAlignMiddleBottom),t.delete(this.btnAlignRightBottom),t.delete(this.btnAlignCenter),t.delete(this.cover)}doContainerList(){let t=super.doContainerList(),e=t.getItem(0);return e.addChild({name:"caption",control:this.caption,isMainContainer:!1}),e.addChild({name:"body",control:this.body,isMainContainer:!1}),t}doPointerDown(t){this.setActivate(),super.doPointerDown(t)}doClose(){if("remove"==this.closeAction)if(null!=this.hideAnimationTrigger){let t=this;this.hideAnimationTrigger.onAfterAnimation=function(){t.remove()},this.hideAnimationTrigger.start()}else this.remove();else this.hide()}doActivate(){this.bringToFront();let t=this;if(0!=this.transform.translateZ){let e=this.transform.translateZ,i=this.transform.rotateY,s=this.filter.blurValue;CAnimation.graphAnimate(200,["acc_head_10000.graph"],(function(o,a,n,r,l){t.transform.translateZ=e-e*l,t.transform.rotateY=i-i*l,t.filter.blurValue=s-s*l}))}null!=this.activateAnimationTrigger&&this.triggerTrue(this.activateAnimationTrigger),null!=this.onActivate&&this.onActivate(this)}doDeactivate(){null!=this.activateAnimationTrigger&&this.triggerFalse(this.activateAnimationTrigger),null!=this.onDectivate&&this.onDectivate(this)}doMinimize(){"none"==this.__state?(this.__orgPosition.fromData(this.position.toData()),this.doHidePadding(),this.body.visible=!1,this.position.height=this.caption.position.height,this.btnMaximize.visible=!1,this.__state="minimize"):(this.doShowPadding(),this.body.visible=!0,this.btnMaximize.visible=!0,this.position.height=this.__orgPosition.height,this.__state="none")}doMaximize(){"none"==this.__state?(this.__orgPosition.fromData(this.position.toData()),this.doHidePadding(),this.position.align=EPositionAlign.CLIENT,this.btnMinimize.visible=!1,this.__state="maximize"):(this.position.align=EPositionAlign.NONE,this.position.fromData(this.__orgPosition.toData()),this.btnMinimize.visible=!0,this.__state="none")}doSendToBack(){let t=this;0==this.transform.translateZ&&(this.filter.filterSet.blur||(this.filter.filterSet.blur=!0),CAnimation.graphAnimate(200,["acc_head_10000.graph"],(function(e,i,s,o,a){t.transform.translateZ=-1e4*a,t.transform.rotateY=45*a,t.filter.blurValue=10*a}),void 0,void 0,void 0,void 0,void 0,void 0,(function(){t.sendToBack()})))}doShowPadding(){this.position.padding.left=this.__orgPadding.left,this.position.padding.top=this.__orgPadding.top,this.position.padding.right=this.__orgPadding.right,this.position.padding.bottom=this.__orgPadding.bottom}doHidePadding(){this.__orgPadding.left=this.position.padding.left,this.__orgPadding.top=this.position.padding.top,this.__orgPadding.right=this.position.padding.right,this.__orgPadding.bottom=this.position.padding.bottom,this.position.padding.all=0}doShowWindow(){if(null!=this.onBeforeShow&&this.onBeforeShow(this),this.setActivate(),this.visible=!0,null!=this.showAnimationTrigger){let t=this;this.showAnimationTrigger.onAfterAnimation=function(){null!=t.onShow&&t.onShow(t)},this.showAnimationTrigger.start()}else null!=this.onShow&&this.onShow(this)}doHideWindow(){if(null!=this.onBeforeHide&&this.onBeforeHide(this),null!=this.hideAnimationTrigger){let t=this;this.hideAnimationTrigger.onAfterAnimation=function(){t.visible=!1,null!=t.onHide&&t.onHide(t)},this.hideAnimationTrigger.start()}else this.visible=!1,null!=this.onHide&&this.onHide(this)}close(){this.doClose()}minimize(){this.doMinimize()}maximize(){this.doMaximize()}show(t,e,i,s,o,a){null!=t&&(this.position.left=t),null!=e&&(this.position.top=e),null!=i&&(this.position.width=i),null!=s&&(this.position.height=s),null!=o&&(this.title=o),null!=a&&(this.closeAction=a),this.doShowWindow()}showCenter(t,e,i,s){null!=this.parent&&(this.position.width=t,this.position.height=e,this.position.left=Math.round((this.parent.position.width-this.position.width)/2),this.position.top=Math.round((this.parent.position.height-this.position.height)/2)),null!=i&&(this.title=i),null!=s&&(this.closeAction=s),this.doShowWindow()}hide(){this.doHideWindow()}addProperties(){let t=super.addProperties();return t.push({instance:this.title,propertyName:"title",readOnly:!1,enum:[]}),t.push({instance:this.showAnimationTrigger,propertyName:"showAnimationTrigger",readOnly:!1,enum:[]}),t.push({instance:this.hideAnimationTrigger,propertyName:"hideAnimationTrigger",readOnly:!1,enum:[]}),t.push({instance:this.activateAnimationTrigger,propertyName:"activateAnimationTrigger",readOnly:!1,enum:[]}),t.push({instance:this.maximizeAnimationTrigger,propertyName:"maximizeAnimationTrigger",readOnly:!1,enum:[]}),t.push({instance:this.minimizeAnimationTrigger,propertyName:"minimizeAnimationTrigger",readOnly:!1,enum:[]}),t.push({instance:this.customAlignAnimationTrigger,propertyName:"customAlignAnimationTrigger",readOnly:!1,enum:[]}),t}}class CAlarm extends CPanel{constructor(t,e){super(t,e),this.alarmAnimationTrigger=new CSceneAnimation,this.opacity=0}showAlarm(t=!0){if(t){let t=this;this.alarmAnimationTrigger.onFinish=function(){t.remove()}}this.alarmAnimationTrigger.start()}}class CWorkSpace extends CPanel{constructor(){super(...arguments),this._workSpaceTranslateX=0,this._workSpaceTranslateY=0,this._workSpaceTranslateZ=0}get workSpaceTranslateX(){return this._workSpaceTranslateX}set workSpaceTranslateX(t){this._workSpaceTranslateX!=t&&(this._workSpaceTranslateX=t,this.doChangeWorkSpaceTranslateValue())}get workSpaceTranslateY(){return this._workSpaceTranslateY}set workSpaceTranslateY(t){this._workSpaceTranslateY!=t&&(this._workSpaceTranslateY=t,this.doChangeWorkSpaceTranslateValue())}get workSpaceTranslateZ(){return this._workSpaceTranslateZ}set workSpaceTranslateZ(t){this._workSpaceTranslateZ!=t&&(this._workSpaceTranslateZ=t,this.doChangeWorkSpaceTranslateValue())}doRemove(){if(null!=this.__board){for(let t=0;t<this.__board.workSpaceList.length;t++)if(this.__board.workSpaceList.get(t)==this){this.__board.workSpaceList.delete(t);break}this.__board=void 0}super.doRemove()}doChangeWorkSpaceTranslateValue(){this.transform.translateX=this._workSpaceTranslateX,this.transform.translateY=this._workSpaceTranslateY,this.transform.translateZ=this._workSpaceTranslateZ,null!=this.onChangeWorkSpaceTranslateValue&&this.onChangeWorkSpaceTranslateValue(this)}}class CCamera extends CNotifyChangeNotifyObject{constructor(){super(...arguments),this._x=0,this._y=0,this._z=0,this._angleX=0,this._angleY=0}get x(){return this._x}set x(t){null!=this._x&&(this._x=t,this.doChangeCameraPosition())}get y(){return this._y}set y(t){null!=this._y&&(this._y=t,this.doChangeCameraPosition())}get z(){return this._z}set z(t){null!=this._z&&(this._z=t,this.doChangeCameraPosition())}get angleX(){return this._angleX}set angleX(t){null!=this._angleX&&(this._angleX=t,this.doChangeCameraPosition())}get angleY(){return this._angleY}set angleY(t){null!=this._angleY&&(this._angleY=t,this.doChangeCameraPosition())}doChangeCameraPosition(){null!=this.onChangeCameraPosition&&this.onChangeCameraPosition(this)}}class CWorkSpaceBoard extends CPanel{get camera(){return this._camera}get workSpaceList(){return this._workSpaceList}get selectedWorkSpace(){return this._selectedWorkSpace}set selectedWorkSpace(t){this._selectedWorkSpace!=t&&(this._selectedWorkSpace=t,this.doChangeSelectedWorkSpace())}constructor(t,e){super(t,e),this._camera=new CCamera,this._workSpaceList=new CList,this.animationDuration=0,this.animationGraphName="";let i=this;this.transform.translateZ=.25,this._workSpaceList.onChange=function(){i.doChangeWorkSpaceList()},this._camera.onChangeCameraPosition=function(){i.doChangeCamera()}}setWorkSpaceSize(){for(let t=0;t<this._workSpaceList.length;t++)this._workSpaceList.get(t).position.left=0,this._workSpaceList.get(t).position.top=0,this._workSpaceList.get(t).position.width=this.position.width,this._workSpaceList.get(t).position.height=this.position.height}doChangeSize(){super.doChangeSize(),this.setWorkSpaceSize()}doChangeWorkSpaceList(){this.setWorkSpaceSize(),null!=this.onChangeWorkSpaceList&&this.onChangeWorkSpaceList(this)}doChangeCamera(){for(let t=0;t<this._workSpaceList.length;t++){let e=this._workSpaceList.get(t).workSpaceTranslateX-this.camera.x,i=this._workSpaceList.get(t).workSpaceTranslateY-this.camera.y,s=this._workSpaceList.get(t).workSpaceTranslateZ-this.camera.z,o=CPoint3D.getAngleToPoint3D(new CPoint3D(e,i,s),0,180+this.camera.angleX,Math.abs(this.camera.z-this._workSpaceList.get(t).transform.translateZ)),a=CPoint3D.getAngleToPoint3D(new CPoint3D(e,i,s),90,180+this.camera.angleY,Math.abs(this.camera.z-this._workSpaceList.get(t).transform.translateZ));this._workSpaceList.get(t).transform.translateX=o.x,this._workSpaceList.get(t).transform.translateY=a.y,this._workSpaceList.get(t).transform.translateZ=s,this._workSpaceList.get(t).transform.rotateY=this.camera.angleX,this._workSpaceList.get(t).transform.rotateX=this.camera.angleY}null!=this.onChangeCamera&&this.onChangeCamera(this)}doChangeSelectedWorkSpace(){let t=this;if(null!=this.selectedWorkSpace){let e=this.camera.x,i=this.camera.y,s=this.camera.z,o=this.selectedWorkSpace.workSpaceTranslateX,a=this.selectedWorkSpace.workSpaceTranslateY,n=this.selectedWorkSpace.workSpaceTranslateZ;0!=this.animationDuration&&""!=this.animationGraphName?CAnimation.graphAnimate(this.animationDuration,[this.animationGraphName],(function(r,l,h,d,g){t.camera.x=CCalc.crRange2Value(0,1,g,e,o),t.camera.y=CCalc.crRange2Value(0,1,g,i,a),t.camera.z=CCalc.crRange2Value(0,1,g,s,n)})):(t.camera.x=o,t.camera.y=a,t.camera.z=n)}else{let e=this.camera.x,i=this.camera.y,s=this.camera.z;0!=this.animationDuration&&""!=this.animationGraphName?CAnimation.graphAnimate(this.animationDuration,[this.animationGraphName],(function(o,a,n,r,l){t.camera.x=e-e*l,t.camera.y=i-i*l,t.camera.z=s-s*l})):(t.camera.x=0,t.camera.y=0,t.camera.z=0)}null!=this.onChangeSelectedWorkSpace&&this.onChangeSelectedWorkSpace(this)}addWorkSpace(t,e){let i=new CWorkSpace(this,t);return null!=e&&(i.resource=e),i.position.left=0,i.position.top=0,i.position.width=this.position.width,i.position.height=this.position.height,this.workSpaceList.add(i),i}cameraMove(t,e,i,s,o){let a=this.camera.x,n=this.camera.y,r=this.camera.z,l=this.camera.angleX,h=this.camera.angleY;if(0!=this.animationDuration&&""!=this.animationGraphName){let d=this;CAnimation.graphAnimate(this.animationDuration,[this.animationGraphName],(function(g,C,c,u,p){d.camera.x=CCalc.crRange2Value(0,1,p,a,t),d.camera.y=CCalc.crRange2Value(0,1,p,n,e),d.camera.z=CCalc.crRange2Value(0,1,p,r,i),d.camera.angleX=CCalc.crRange2Value(0,1,p,l,s),d.camera.angleY=CCalc.crRange2Value(0,1,p,h,o)}))}else this.camera.x=t,this.camera.y=e,this.camera.z=i,this.camera.angleX=s,this.camera.angleY=o}}class CIFrame extends CElementControl{get src(){return this._src}set src(t){this._src!=t&&(this._src=t,this.element.src=t)}constructor(t,e){super("iframe",t,e),this._src=""}doToData(t){super.doToData(t),CDataClass.putData(t,"src",this.src,"")}doFromData(t){super.doFromData(t),this.src=CDataClass.getData(t,"src","")}doInitInnerElement(){super.doInitInnerElement(),this.element.setAttribute("className",this.className),this.element.style.outline="none",this.element.style.position="absolute",this.element.style.margin="0px 0px 0px 0px",this.element.style.padding="0px 0px 0px 0px",this.element.style.border="none",this.element.style.zIndex=CSystem.getZPlus()+"",this.element.setAttribute("ondragstart","return false"),this.element.setAttribute("onselectstart","return false"),this.element.setAttribute("oncontextmenu","return false"),this.element.style.touchAction="auto",this.element.style.userSelect="text",this.element.style.pointerEvents="auto"}}class CVideoControl extends CElementControl{get preTime(){return this._preTime}get src(){return this._src}set src(t){this._src!=t&&(this._src=t,this.element.src=t)}get videoWidth(){return this._element.videoWidth}get videoHeight(){return this._element.videoHeight}get duration(){return this._element.duration}get currentTime(){return this.element.currentTime}set currentTime(t){this.element.currentTime=t}get paused(){return this.element.paused}get ended(){return this.element.ended}get seeking(){return this.element.seeking}get volume(){return this.element.volume}set volume(t){this.element.volume=t}constructor(t,e){super("video",t,e),this._src="",this.deleteSections=new Array;let i=this;this.element.addEventListener("timeupdate",(function(t){i.doTimeUpdate(i.currentTime),i._preTime=i.currentTime})),this.element.addEventListener("play",(function(t){i.doPlay()})),this.element.addEventListener("playing",(function(t){i.doPlaying()})),this.element.addEventListener("seeked",(function(t){i.doSeek()})),this.element.addEventListener("ended",(function(t){i.doEnded()})),this.element.addEventListener("volumechange",(function(t){i.doVolumnChange()})),this.element.addEventListener("error",(function(t){i.doError()})),this.element.addEventListener("loadedmetadata",(function(t){i.doLoadedMetaData()})),this.element.addEventListener("loadeddata",(function(t){i.doLoadedData()})),this.element.addEventListener("pause",(function(t){i.doPause()}))}doToData(t){super.doToData(t),CDataClass.putData(t,"src",this.src,"")}doFromData(t){super.doFromData(t),this.src=CDataClass.getData(t,"src","")}doInitInnerElement(){super.doInitInnerElement(),this.element.setAttribute("className",this.className),this.element.style.outline="none",this.element.style.position="absolute",this.element.style.margin="0px 0px 0px 0px",this.element.style.padding="0px 0px 0px 0px",this.element.style.border="none",this.element.style.zIndex=CSystem.getZPlus()+"",this.element.setAttribute("ondragstart","return false"),this.element.setAttribute("onselectstart","return false"),this.element.setAttribute("oncontextmenu","return false"),this.element.style.touchAction="auto",this.element.style.userSelect="text",this.element.style.pointerEvents="auto"}doTimeUpdate(t){if(this.deleteSections.length>0)for(let t=0;t<this.deleteSections.length;t++)if(this.deleteSections[t].startTime>=this.currentTime&&this.deleteSections[t].stopTime<=this.currentTime){this.currentTime=this.deleteSections[t].stopTime+.01;break}null!=this.onTimeUpdate&&this.onTimeUpdate(this,t)}doPlay(){null!=this.onPlay&&this.onPlay(this)}doPlaying(){null!=this.onPlaying&&this.onPlaying(this)}doEnded(){null!=this.onEnded&&this.onEnded(this)}doVolumnChange(){null!=this.onVolumnChange&&this.onVolumnChange(this)}doError(){null!=this.onError&&this.onError(this)}doLoadedMetaData(){null!=this.onLoadedMetaData&&this.onLoadedMetaData(this)}doLoadedData(){null!=this.onLoadedData&&this.onLoadedData(this)}doSeek(){null!=this.onSeek&&this.onSeek(this,this.currentTime)}doPause(){null!=this.onPause&&this.onPause(this)}pause(){this.element.pause()}play(){this.element.play()}currentTimeSync(t){let e=this;return new Promise((function(i){e.element.addEventListener("seeked",(function t(){e.element.removeEventListener("seeked",t),i()})),e.currentTime=t}))}jumpTime(t,e){null!=this.preTime&&this.preTime<t&&this.currentTime>=t&&(this.currentTime=e)}}class CAnimationVideoControl extends CPanel{constructor(t,e){super(t,e),this.videos=new Map,this.control=new CAnimationControl(this),this.deleteSections=new Array,this.control.position.align=EPositionAlign.CLIENT}addVideo(t,e){let i=new CVideoControl(this);null!=e?(i.position.left=e.left,i.position.top=e.top,i.position.width=e.width,i.position.height=e.height):i.position.align=EPositionAlign.CLIENT,i.sendToBack(),this.videos.set(t,i)}animationFromData(t){this.control.fromData(t),this.control.position.align=EPositionAlign.CLIENT}}class CEmptyCanvasControl extends CPanel{constructor(t,e){super(t,e),this.canvas=this.layers.addLayer().canvas;let i=this.canvas.getContext("2d");null!=i&&(this.context=i)}}class CMultiSlideBox extends CPanel{get slideHandles(){return this._slideHandles}get handleResource(){return this._handleResource}set handleResource(t){if(this._handleResource!=t){this._handleResource=t;for(let e=0;e<this._slideHandles.length;e++){let i=this._slideHandles.get(e).text;this._slideHandles.get(e).resource=t,this._slideHandles.get(e).text=i}}}constructor(t,e){super(t,e),this._slideHandles=new CList,this._handleResource="";let i=this;this._slideHandles.onChange=function(){i.doChangeHandles()}}doToData(t){super.doToData(t),CDataClass.putData(t,"handleResource",this.handleResource,"")}doFromData(t){super.doFromData(t),this.handleResource=CDataClass.getData(t,"handleResource","")}doChangeHandles(){null!=this.onChangeHandles&&this.onChangeHandles(this)}doCreateHandle(t,e,i,s,o){let a=new CPanel(this);a.onResource=function(){a.usePointerCapture=!0,a.useMove=!0,a.position.left=e,a.position.top=i,a.position.width=null==s?30:s,a.position.height=null==o?30:o,a.moveAreaLength=a.position.height},a.resource=t,a.usePointerCapture=!0,a.position.left=e,a.position.top=i,a.useMove=!0,a.position.width=null==s?30:s,a.position.height=null==o?30:o,a.moveAreaLength=a.position.height;let n=this;return a.onMove=function(t,e){n.doHandleTrack(a,a.position.left,a.position.top,a.position.left+a.position.width/2,a.position.top+a.position.height/2)},null!=this.onCreateHandle&&this.onCreateHandle(this,a),a}doAddHandle(t,e,i,s,o){let a=this.doCreateHandle(t,e,i,s,o);return this._slideHandles.add(a),null!=this.onAddHandle&&this.onAddHandle(this,t,e,i,s,o),a}doDeleteHandle(t){this._slideHandles.get(t).remove(),this._slideHandles.delete(t),null!=this.onDeleteHandle&&this.onDeleteHandle(this,t)}doClearHandle(){for(let t=0;t<this._slideHandles.length;t++)this._slideHandles.get(t).remove();this._slideHandles.clear(),null!=this.onClear&&this.onClear(this)}doHandleTrack(t,e,i,s,o){null!=this.onHandleTrack&&this.onHandleTrack(this,t,e,i,s,o)}addHandle(t,e,i,s,o){return this.doAddHandle(t,e,i,s,o)}deleteHandle(t){this.doDeleteHandle(t)}clearHandle(){this.doClearHandle()}}!function(t){t[t.X=0]="X",t[t.Y=1]="Y"}(ESlideDirection||(ESlideDirection={}));class CSlideControlBox extends CUnlimitedScrollBox{get controls(){return this._controls}get controlContent(){return this._controlContent}constructor(t,e){super(t,e),this.__interval=0,this._controls=new CList,this._controlContent=new CLayout(this.content),this.slideDirection=ESlideDirection.X,this.centerZ=-3e3,this.y=0,this.radiusX=800,this.radiusY=200,this.radiusZ=1e3,this.useHScrollbar=!1,this.useVScrollbar=!1,this._controlContent.transform.translateZ=.25,this.setControlPosition(this._controlContent)}getLeft(){return this.background.controlElement.scrollLeft}getTop(){return this.background.controlElement.scrollTop}setControlPosition(t){t.position.align!=EPositionAlign.NONE&&(t.position.align=EPositionAlign.NONE),t.position.left=this.getLeft(),t.position.top=this.getTop(),t.position.width=this.background.position.width,t.position.height=this.background.position.height}doChangeSize(){super.doChangeSize(),this.setControlPosition(this._controlContent)}doChangeScrollValue(){super.doChangeScrollArea();for(let t=0;t<this.controls.length;t++)this.controls.get(t).visible=!0,this.controls.get(t).opacity=.5;this.setControlPosition(this._controlContent),this.slideDirection==ESlideDirection.X?this.doSetControlsTransfrom(this.scrollX):this.doSetControlsTransfrom(this.scrollY)}doSetControlsTransfrom(t){let e=360/this._controls.length;for(let i=0;i<this._controls.length;i++){let s,o=i*e-t/10;this.slideDirection==ESlideDirection.X&&(s=CPoint3D.getAngleToPoint3DEllipse(new CPoint3D(0,this.y,this.centerZ),0,o,this.radiusX,this.radiusY,this.radiusZ),this._controls.get(i).transform.rotateY=o,this._controls.get(i).opacity=CCalc.crRange2Value(1,-1,CCalc.cosd(o),1,.1),this._controls.get(i).transform.translateX=s.x,this._controls.get(i).transform.translateY=CCalc.cosd(o)*this.radiusY,this._controls.get(i).transform.translateZ=s.z,this._controls.get(i).controlElement.style.zIndex=9e5-Math.floor(-1*s.z)+""),this.slideDirection==ESlideDirection.Y&&(s=CPoint3D.getAngleToPoint3DEllipse(new CPoint3D(0,this.y,this.centerZ),90,o,this.radiusX,this.radiusY,this.radiusZ),this._controls.get(i).transform.rotateX=360-o,this._controls.get(i).opacity=CCalc.crRange2Value(1,-1,CCalc.cosd(o),1,.1),this._controls.get(i).transform.translateX=CCalc.cosd(o)*this.radiusX,this._controls.get(i).transform.translateY=s.y,this._controls.get(i).transform.translateZ=s.z,this._controls.get(i).controlElement.style.zIndex=9e5-Math.floor(-1*s.z)+"")}}doScrollStop(){super.doScrollStop();let t=new Array;for(let e=0;e<this._controls.length;e++)t.push(this._controls.get(e));t.sort((function(t,e){let i=0;return t.transform.translateZ>e.transform.translateZ&&(i=-1),t.transform.translateZ<e.transform.translateZ&&(i=1),i}));for(let e=0;e<t.length;e++)t[e].visible=0==e;let e=t[0].transform.translateX,i=t[0].transform.translateY,s=t[0].transform.translateZ,o=t[0].transform.rotateY,a=t[0].transform.rotateX,n=t[0].opacity,r=1-t[0].opacity;CAnimation.animate(100,(function(l,h,d){t[0].transform.translateX=e-e*h,t[0].transform.translateY=i-i*h,t[0].transform.translateZ=s-s*h,t[0].transform.rotateX=a-a*h,t[0].transform.rotateY=o-o*h,t[0].opacity=r+n*h}))}addControl(t){t.parent=this.controlContent,t.position.align=EPositionAlign.CLIENT,this._controls.add(t)}}class CHueCircleDrawModel extends CNotifyChangeNotifyObject{constructor(){super(...arguments),this._margin=5,this._weight=20,this._strokeColor="rgba(255,255,255,1)",this._strokeLineWidth=2,this._h=0,this._s=1,this._l=.5,this._a=1}get strokeColor(){return this._strokeColor}set strokeColor(t){this._strokeColor!=t&&(this._strokeColor=t,this.doChange())}get strokeLineWidth(){return this._strokeLineWidth}set strokeLineWidth(t){this._strokeLineWidth!=t&&(this._strokeLineWidth=t,this.doChange())}get margin(){return this._margin}set margin(t){this._margin!=t&&(this._margin=t,this.doChange())}get weight(){return this._weight}set weight(t){this._weight!=t&&(this._weight=t,this.doChange())}get h(){return this._h}set h(t){this._h!=t&&(this._h=t,this.doChange())}get s(){return this._s}set s(t){this._s!=t&&(this._s=t,this.doChange())}get l(){return this._l}set l(t){this._l!=t&&(this._l=t,this.doChange())}get a(){return this._a}set a(t){this._a!=t&&(this._a=t,this.doChange())}doToData(t){super.doToData(t),CDataClass.putData(t,"margin",this.margin,5),CDataClass.putData(t,"weight",this.weight,20),CDataClass.putData(t,"strokeColor",this.strokeColor,"rgba(255,255,255,1)"),CDataClass.putData(t,"strokeLineWidth",this.strokeLineWidth,2),CDataClass.putData(t,"h",this.h,0),CDataClass.putData(t,"s",this.s,1),CDataClass.putData(t,"l",this.l,.5),CDataClass.putData(t,"a",this.a,1)}doFromData(t){super.doFromData(t),this.margin=CDataClass.getData(t,"margin",5),this.weight=CDataClass.getData(t,"weight",20),this.strokeColor=CDataClass.getData(t,"strokeColor","rgba(255,255,255,1)"),this.strokeLineWidth=CDataClass.getData(t,"strokeLineWidth",2),this.h=CDataClass.getData(t,"h",0),this.s=CDataClass.getData(t,"s",1),this.l=CDataClass.getData(t,"l",.5),this.a=CDataClass.getData(t,"a",1)}draw(t,e){if(e.width<=0||e.height<=0)return;let i=t.getImageData(e.left,e.top,e.width,e.height),s=new CPoint(e.left+e.width/2,e.top+e.height/2),o=CCalc.min(e.width,e.height)/2-this.margin,a=o-this.weight;for(let t=0;t<e.width;t++)for(let n=0;n<e.height;n++){let r=e.left+t,l=e.top+n,h=CPoint.getDistancePoints(s,new CPoint(r,l)),d=n*(4*e.width)+4*t;if(h>a&&h<=o){let t=CPoint.getAngleFromTwoPoint(s,new CPoint(r,l)),e=CColor.hslToRGB(new CHSLA(t,1,.5,1));i.data[d]=e.r,i.data[d+1]=e.g,i.data[d+2]=e.b,i.data[d+3]=CCalc.cr(255,0,1,e.a,2)}}t.putImageData(i,e.left,e.top),t.strokeStyle=this._strokeColor,t.lineWidth=this._strokeLineWidth;let n=new CPathPointList,r=new CRect(e.left+this.margin,e.top+this.margin,e.right-this.margin,e.bottom-this.margin),l=new CRect(r.left,r.top,r.left+CCalc.min(r.width,r.height),r.top+CCalc.min(r.width,r.height));l=r.getFitRect(l,!0),l.offset(e.left+this.margin,e.top+this.margin),n.makeEllipseData(l.left,l.top,l.width,l.height),n.setPathData(t),t.stroke(),l.inflate(-this.weight,-this.weight),n.makeEllipseData(l.left,l.top,l.width,l.height),n.setPathData(t),t.stroke();let h=a+(o-a)/2,d=CPoint.getAngleToPoint(s,h,h,this.h),g=new CRect(d.x-this.weight/2,d.y-this.weight/2,d.x+this.weight/2,d.y+this.weight/2);n.makeEllipseData(g.left,g.top,g.width,g.height),n.setPathData(t),t.stroke()}toHSLA(){return new CHSLA(this.h,this.s,this.l,this.a)}toRGBA(){return CColor.hslToRGB(this.toHSLA())}toColor(){return this.toHSLA().toColor()}isHitCircle(t,e){let i=CCalc.min(t.width,t.height)/2-this.margin,s=i-this.weight,o=new CPoint(t.left+t.width/2,t.top+t.height/2),a=CPoint.getDistancePoints(o,e);return a>s&&a<=i}}class CHueCircleSLDrawModel extends CHueCircleDrawModel{constructor(){super(...arguments),this._slcursorWeight=20}get slcursorWeight(){return this._slcursorWeight}set slcursorWeight(t){this._slcursorWeight!=t&&(this._slcursorWeight=t,this.doChange())}doToData(t){super.doToData(t),CDataClass.putData(t,"slcursorWeight",this.slcursorWeight,20)}doFromData(t){super.doFromData(t),this.slcursorWeight=CDataClass.getData(t,"slcursorWeight",20)}draw(t,e){if(e.width<=0||e.height<=0)return;new Function("ctx","ctx.canvas.willReadFrequently = true")(t),super.draw(t,e);let i=new CPoint(e.left+e.width/2,e.top+e.height/2),s=CCalc.min(e.width,e.height)/2-this.margin-this.weight,o=CPoint.getAngleToPoint(i,s,s,45).x-i.x-this.strokeLineWidth,a=new CRect(Math.floor(i.x-o),Math.floor(i.y-o),Math.floor(i.x+o),Math.floor(i.y+o)),n=t.getImageData(a.left,a.top,a.width,a.height);for(let t=0;t<a.width;t++)for(let e=0;e<a.height;e++){let i=e*(4*a.width)+4*t,s=CColor.hslToRGB(new CHSLA(this.h,CCalc.cr(a.width-1,t,1,0,4),CCalc.cr(a.height-1,e,1,0,4),this.a));n.data[i]=s.r,n.data[i+1]=s.g,n.data[i+2]=s.b,n.data[i+3]=255}t.putImageData(n,a.left,a.top),t.strokeStyle=this._strokeColor,t.lineWidth=this._strokeLineWidth;let r=CCalc.cr(a.width,0,1,this.s,2),l=CCalc.cr(a.height,0,1,this.l,2),h=new CRect(a.left+r-this._slcursorWeight/2,a.top+l-this._slcursorWeight/2,a.left+r+this._slcursorWeight/2,a.top+l+this._slcursorWeight/2),d=new CPathPointList;d.makeEllipseData(h.left,h.top,h.width,h.height),d.setPathData(t),t.stroke()}getSLArea(t){let e=new CPoint(t.left+t.width/2,t.top+t.height/2),i=CCalc.min(t.width,t.height)/2-this.margin-this.weight,s=CPoint.getAngleToPoint(e,i,i,45).x-e.x-this.strokeLineWidth;return new CRect(Math.floor(e.x-s),Math.floor(e.y-s),Math.floor(e.x+s),Math.floor(e.y+s))}isHitSLArea(t,e){return this.getSLArea(t).isIn(e.x,e.y)}}class CHueColorBox extends CPanel{constructor(t,e){super(t,e),this.__hit=-1,this._hueModel=new CHueCircleSLDrawModel;let i=this;this._hueModel.onChange=function(t){i.draw()}}get isEditing(){return-1!=this.__hit}get ringMargin(){return this._hueModel.margin}get hueModel(){return this._hueModel}get ringWeight(){return this._hueModel.weight}set ringWeight(t){this._hueModel.weight!=t&&(this._hueModel.weight=t,this.doChange("ringWeight",t))}get slcursorWeight(){return this._hueModel.slcursorWeight}set slcursorWeight(t){this._hueModel.slcursorWeight!=t&&(this._hueModel.slcursorWeight=t,this.doChange("slcursorWeight",t))}get strokeColor(){return this._hueModel.strokeColor}set strokeColor(t){this._hueModel.strokeColor!=t&&(this._hueModel.strokeColor=t,this.doChange("strokeColor",t))}get strokeLineWidth(){return this._hueModel.strokeLineWidth}set strokeLineWidth(t){this._hueModel.strokeLineWidth!=t&&(this._hueModel.strokeLineWidth=t,this.doChange("strokeLineWidth",t))}get rgba(){return this._hueModel.toRGBA()}get color(){return this._hueModel.toRGBA().toColor()}set color(t){let e=new CColor(t).toHSLA();this._hueModel.h==e.h&&this._hueModel.s==e.s&&this._hueModel.l==e.l&&this._hueModel.a==e.a||(this._hueModel.h=e.h,this._hueModel.s=e.s,this._hueModel.l=e.l,this._hueModel.a=e.a,this.doChangeColor())}get hslaColor(){return this._hueModel.toColor()}get hsla(){return this._hueModel.toHSLA()}get h(){return this._hueModel.h}set h(t){this._hueModel.h!=t&&(this._hueModel.h=t,this.doChangeColor())}get s(){return this._hueModel.s}set s(t){this._hueModel.s!=t&&(this._hueModel.s=t,this.doChangeColor())}get l(){return this._hueModel.l}set l(t){this._hueModel.l!=t&&(this._hueModel.l=t,this.doChangeColor())}get a(){return this._hueModel.a}set a(t){this._hueModel.a!=t&&(this._hueModel.a=t,this.doChangeColor())}doToData(t){super.doToData(t),CDataClass.putData(t,"hue",this.hueModel.toData())}doFromData(t){super.doFromData(t),this.hueModel.fromData(CDataClass.getData(t,"hue"))}doThisPointerDown(t,e){super.doThisPointerDown(t,e);let i=new CRect(0,0,this.position.width,this.position.height);this._hueModel.isHitCircle(i,new CPoint(t.offsetX,t.offsetY))&&(this.__hit=0,this.setH(new CPoint(t.offsetX,t.offsetY))),this._hueModel.isHitSLArea(i,new CPoint(t.offsetX,t.offsetY))&&(this.__hit=1,this.setSL(new CPoint(t.offsetX,t.offsetY)))}doThisPointerMove(t,e){super.doThisPointerMove(t,e),0==this.__hit&&this.setH(new CPoint(t.offsetX,t.offsetY)),1==this.__hit&&this.setSL(new CPoint(t.offsetX,t.offsetY))}doThisPointerUp(t,e){super.doThisPointerUp(t,e),this.__hit=-1}doPointerOut(t){super.doPointerOut(t),this.usePointerCapture||(this.__hit=-1)}doChangeColor(){null!=this.onChangeColor&&this.onChangeColor(this)}setH(t){let e=new CRect(0,0,this.position.width,this.position.height),i=new CPoint(e.width/2,e.height/2);this._hueModel.h=CPoint.getAngleFromTwoPoint(i,t),this.doChangeColor()}setSL(t){let e=this._hueModel.getSLArea(new CRect(0,0,this.position.width,this.position.height)),i=CCalc.cr(e.height,t.y-e.top,1,0,4);i<0&&(i=0),i>1&&(i=1);let s=CCalc.cr(e.width,t.x-e.left,1,0,4);s<0&&(s=0),s>1&&(s=1),this._hueModel.s=s,this._hueModel.l=i,this.doChangeColor()}doLayerDraw(t,e,i){super.doLayerDraw(t,e,i),0==t&&e.canvas.width>0&&e.canvas.height>0&&this._hueModel.draw(i,new CRect(0,0,this.position.width,this.position.height))}}class CColorBox extends CPanel{get color(){return this._color}set color(t){this._color!=t&&(this._color=t,this.doChangeColor())}get resource(){return""}set resource(t){this._resource=""}constructor(t,e){super(t,e),this._color="rgba(255,255,255,1)",this.layer=this.layers.addLayer()}doToData(t){super.doToData(t),CDataClass.putData(t,"color",this.color,"rgba(255,255,255,1)")}doFromData(t){super.doFromData(t),this.color=CDataClass.getData(t,"color","rgba(255,255,255,1)")}doChangeColor(){this.draw(),null!=this.onChangeColor&&this.onChangeColor(this)}doLayerDraw(t,e,i){if(super.doLayerDraw(t,e,i),e.canvas.width>0&&e.canvas.height>0){let t=Math.ceil(this.position.width/10)+1,e=Math.ceil(this.position.height/10)+1;for(let s=0;s<e;s++){let e=!1;s%2==1&&(e=!0);for(let o=0;o<t;o++){let t="rgba(204,204,204,1)";e&&(t="rgba(255,255,255,1)"),e=!e,i.fillStyle=t,i.fillRect(10*o,10*s,10*o+10,10*s+10)}}i.fillStyle=this.color,i.fillRect(0,0,this.position.width,this.position.height)}}}class CColorSelectorModel extends CPanel{get color(){return this._color}set color(t){this._color!=t&&(this._color=t,this.doChangeColor())}get hueBoxResource(){return this.hueBox.resource}set hueBoxResource(t){this.hueBox.resource=t}get opacityControlResource(){return this.opacityControl.resource}set opacityControlResource(t){this.opacityControl.resource=t}get textBoxResource(){return this.textBox.resource}set textBoxResource(t){this.textBox.resource=t}get opacityControlHeight(){return this.opacityControl.position.height}set opacityControlHeight(t){this.opacityControl.position.height=t}get textBoxHeight(){return this.textBox.position.height}set textBoxHeight(t){this.textBox.position.height=t}get colorBoxHeight(){return this.colorBox.position.height}set colorBoxHeight(t){this.colorBox.position.height=t}constructor(t,e){super(t,e),this.__changer="",this._color="rgba(255,255,255,1)",this.hueBox=new CHueColorBox(this),this.textBox=new CTextBox(this),this.colorBox=new CColorBox(this),this.opacityControl=new CScrollbar(this);let i=this;this.opacityControl.onChangeValue=function(){i.__changer="opacityControl";let t=new CColor(i.color);t.a=i.opacityControl.valueRatio,i.color=t.toColor(),i.__changer=""},this.colorBox.onChangeColor=function(){i.__changer="hueBox",i.color=i.colorBox.color,i.__changer=""},this.textBox.onKeyDown=function(t,e){"Enter"==e.key&&(i.color=i.textBox.text)},this.hueBox.onChangeColor=function(){i.__changer="hueBox",i.color=i.hueBox.color,i.__changer=""}}doToData(t){super.doToData(t),CDataClass.putData(t,"hueBoxResource",this.hueBoxResource,""),CDataClass.putData(t,"opacityControlResource",this.opacityControlResource,""),CDataClass.putData(t,"textBoxResource",this.textBoxResource,""),CDataClass.putData(t,"opacityControlHeight",this.opacityControlHeight,20),CDataClass.putData(t,"textBoxHeight",this.textBoxHeight,25),CDataClass.putData(t,"colorBoxHeight",this.colorBoxHeight,50),CDataClass.putData(t,"color",this.color,"rgba(255,255,255,1)"),CDataClass.putData(t,"hueBox",this.hueBox.toData(),{},!0),CDataClass.putData(t,"textBox",this.textBox.toData(),{},!0),CDataClass.putData(t,"colorBox",this.colorBox.toData(),{},!0),CDataClass.putData(t,"opacityControl",this.opacityControl.toData(),{},!0)}doFromData(t){super.doFromData(t),this.hueBoxResource=CDataClass.getData(t,"hueBoxResource",""),this.opacityControlResource=CDataClass.getData(t,"opacityControlResource",""),this.textBoxResource=CDataClass.getData(t,"textBoxResource",""),this.opacityControlHeight=CDataClass.getData(t,"opacityControlHeight",20),this.textBoxHeight=CDataClass.getData(t,"textBoxHeight",25),this.colorBoxHeight=CDataClass.getData(t,"colorBoxHeight",50),this.color=CDataClass.getData(t,"color","rgba(255,255,255,1)"),this.hueBox.fromData(CDataClass.getData(t,"hueBox",{},!0)),this.textBox.fromData(CDataClass.getData(t,"textBox",{},!0)),this.colorBox.fromData(CDataClass.getData(t,"colorBox",{},!0)),this.opacityControl.fromData(CDataClass.getData(t,"opacityControl",{},!0))}doChangeColor(){if("hueBox"!=this.__changer&&(this.hueBox.color=this.color),"opacityControl"!=this.__changer){let t=new CColor(this.color);this.opacityControl.valueRatio=t.a}"textBox"!=this.__changer&&(this.textBox.text=this.color),this.colorBox.color=this.color,null!=this.onChangeColor&&this.onChangeColor(this)}doChildDataMapHandle(t){super.doChildDataMapHandle(t),t.delete(this.hueBox),t.delete(this.textBox),t.delete(this.colorBox),t.delete(this.opacityControl)}}class CColorPickupButton extends CButton{get color(){return this._color}set color(t){this._color!=t&&(this._color=t,this.doChangeColor())}get colorSelector(){return this._colorSelector}get colorSelectorResource(){return this._colorSelectorResource}set colorSelectorResource(t){this._colorSelectorResource=t,this._colorSelector.resource=t}constructor(t,e){super(t,e),this._color="rgba(255,255,255,1)",this._colorSelector=new CColorSelectorModel,this._colorSelectorResource="",this.onChangeColor=new Array;let i=this;this.colorSelector.onChangeColor=function(){i.color=i.colorSelector.color}}doToData(t){super.doToData(t),CDataClass.putData(t,"colorSelectorResource",this.colorSelectorResource,"")}doFromData(t){super.doFromData(t),this.colorSelectorResource=CDataClass.getData(t,"colorSelectorResource","")}doBeforePickupShow(t){super.doBeforePickupShow(t),this._colorSelector.color=this.color,this._colorSelector.parent=t,this._colorSelector.hasFocus=!0,this._colorSelector.position.align=EPositionAlign.CLIENT}doBeforePickupRemove(t){this._colorSelector.parent=void 0,super.doBeforePickupRemove(t)}doChangeColor(){let t=this.layers.getCanvasItems("color");for(let e=0;e<t.length;e++)t[e].fill.solidColor=this.color;for(let t=0;t<this.onChangeColor.length;t++)this.onChangeColor[t](this)}}class CSelectArea extends CPanel{get selectAreaResource(){return this._selectAreaResource}set selectAreaResource(t){this._selectAreaResource!=t&&(this._selectAreaResource=t,""!=t&&(this.selectArea.resource=t))}get useSelectArea(){return this._useSelectArea}set useSelectArea(t){this._useSelectArea!=t&&(this._useSelectArea=t)}constructor(t,e){super(t,e),this.__prePoint=new CPoint,this._selectAreaResource="",this._useSelectArea=!0,this.selectArea=new CPanel(this)}doToData(t){super.doToData(t),CDataClass.putData(t,"selectAreaResource",this.selectAreaResource,""),CDataClass.putData(t,"useSelectArea",this.useSelectArea,!0),CDataClass.putData(t,"selectArea",this.selectArea.toData(),{},!0)}doFromData(t){super.doFromData(t),this.selectAreaResource=CDataClass.getData(t,"selectAreaResource",""),this.useSelectArea=CDataClass.getData(t,"useSelectArea",!0),this.selectArea.fromData(CDataClass.getData(t,"selectArea",{},!0))}setSelected(t){let e=Math.min(this.__prePoint.x,t.x),i=Math.min(this.__prePoint.y,t.y),s=Math.max(this.__prePoint.x,t.x),o=Math.max(this.__prePoint.y,t.y);this.selectArea.position.left=e,this.selectArea.position.top=i,this.selectArea.position.width=s-e,this.selectArea.position.height=o-i,this.doTrackSelectArea(new CPoint(e,i),new CPoint(s,o))}doThisPointerDown(t,e){super.doThisPointerDown(t,e),this.useSelectArea&&(this.__prePoint.x=t.offsetX,this.__prePoint.y=t.offsetY,this.selectArea.position.left=t.offsetX,this.selectArea.position.top=t.offsetY,this.selectArea.position.width=0,this.selectArea.position.height=0,this.selectArea.visible=!0,this.selectArea.bringToFront())}doThisPointerMove(t,e){super.doThisPointerMove(t,e),this.isPress&&this.useSelectArea&&this.setSelected(new CPoint(t.offsetX,t.offsetY))}doThisPointerUp(t,e){if(super.doThisPointerUp(t,e),this.useSelectArea){let e=Math.min(this.__prePoint.x,t.offsetX),i=Math.min(this.__prePoint.y,t.offsetY),s=Math.max(this.__prePoint.x,t.offsetX),o=Math.max(this.__prePoint.y,t.offsetY);this.selectArea.visible=!1,this.doSelectArea(new CPoint(e,i),new CPoint(s,o))}}doTrackSelectArea(t,e){null!=this.onTrackSelectArea&&this.onTrackSelectArea(this,t,e)}doSelectArea(t,e){null!=this.onSelectArea&&this.onSelectArea(this,t,e)}}class CSelectPoint extends CPanel{constructor(){super(...arguments),this.magneticPoint=new CList}doBeforeMove(t,e,i){return new CPoint(e,i)}}class CControlPositionEditor extends CPanel{constructor(){super(...arguments),this.lClient=new CPanel(this),this.l1=new CPanel(this.lClient),this.lblLeft=new CPanel(this.l1),this.edtLeft=new CTextBox(this.l1),this.l2=new CPanel(this.lClient),this.lblTop=new CPanel(this.l2),this.edtTop=new CTextBox(this.l2),this.l3=new CPanel(this.lClient),this.lblWidth=new CPanel(this.l3),this.edtWidth=new CTextBox(this.l3),this.l4=new CPanel(this.lClient),this.lblHeight=new CPanel(this.l4),this.edtHeight=new CTextBox(this.l4),this.btnPosition=new CButton(this)}doToData(t){super.doToData(t),CDataClass.putData(t,"lClient",this.lClient.toData(),{},!0),CDataClass.putData(t,"l1",this.l1.toData(),{},!0),CDataClass.putData(t,"lblLeft",this.lblLeft.toData(),{},!0),CDataClass.putData(t,"edtLeft",this.edtLeft.toData(),{},!0),CDataClass.putData(t,"l2",this.l2.toData(),{},!0),CDataClass.putData(t,"lblTop",this.lblTop.toData(),{},!0),CDataClass.putData(t,"edtTop",this.edtTop.toData(),{},!0),CDataClass.putData(t,"l3",this.l3.toData(),{},!0),CDataClass.putData(t,"lblWidth",this.lblWidth.toData(),{},!0),CDataClass.putData(t,"edtWidth",this.edtWidth.toData(),{},!0),CDataClass.putData(t,"l4",this.l4.toData(),{},!0),CDataClass.putData(t,"lblHeight",this.lblHeight.toData(),{},!0),CDataClass.putData(t,"edtHeight",this.edtHeight.toData(),{},!0),CDataClass.putData(t,"btnPosition",this.btnPosition.toData(),{},!0)}doFromData(t){super.doFromData(t),this.lClient.fromData(CDataClass.getData(t,"lClient",{},!0)),this.l1.fromData(CDataClass.getData(t,"l1",{},!0)),this.lblLeft.fromData(CDataClass.getData(t,"lblLeft",{},!0)),this.edtLeft.fromData(CDataClass.getData(t,"edtLeft",{},!0)),this.l2.fromData(CDataClass.getData(t,"l2",{},!0)),this.lblTop.fromData(CDataClass.getData(t,"lblTop",{},!0)),this.edtTop.fromData(CDataClass.getData(t,"edtTop",{},!0)),this.l3.fromData(CDataClass.getData(t,"l3",{},!0)),this.lblWidth.fromData(CDataClass.getData(t,"lblWidth",{},!0)),this.edtWidth.fromData(CDataClass.getData(t,"edtWidth",{},!0)),this.l4.fromData(CDataClass.getData(t,"l4",{},!0)),this.lblHeight.fromData(CDataClass.getData(t,"lblHeight",{},!0)),this.edtHeight.fromData(CDataClass.getData(t,"edtHeight",{},!0)),this.btnPosition.fromData(CDataClass.getData(t,"btnPosition",{},!0))}}class CControlSelector extends CPanel{get control(){return this._control}set control(t){if(this._control!=t)if(this._control=t,null!=this._control){this.parent=this._control.parent,this.position.left=this._control.position.left,this.position.top=this._control.position.top,this.position.width=this._control.position.width,this.position.height=this._control.position.height,this.position.alignInfo.gridColumn=this._control.position.alignInfo.gridColumn,this.position.alignInfo.gridRow=this._control.position.alignInfo.gridRow,this.position.alignInfo.gridRowHeight=this._control.position.alignInfo.gridRowHeight,this.position.alignInfo.pathMiddleValue=this._control.position.alignInfo.pathMiddleValue,this.position.alignInfo.turnAngle=this._control.position.alignInfo.turnAngle,this.position.alignInfo.turnRadiusX=this._control.position.alignInfo.turnRadiusX,this.position.alignInfo.turnRadiusY=this._control.position.alignInfo.turnRadiusY,this.transform.fromData(this._control.transform.toData()),this.bringToFront();for(let t=0;t<this.onSetControl.length;t++)this.onSetControl[t](this)}else this.parent=void 0}get downPoint(){return this.__downMovePoint}constructor(t,e){super(t,e),this.pop=new CPickupControl,this.onSetControl=new Array}doChangeSize(){null!=this.control&&this.control.position.fromData(this.position.toData()),super.doChangeSize()}doChangePosition(t,e){null!=this.control&&this.control.position.fromData(this.position.toData()),super.doChangePosition(t,e)}doThisPointerUp(t,e){super.doThisPointerUp(t,e);let i=this;2==t.button&&CPickupControl.showPickup("empty.control",this,t.offsetX,t.offsetY,300,105,(function(t){let e=new CControlPositionEditor(t);e.resource="darkblue/controlPositionEditor.frame",e.position.align=EPositionAlign.CLIENT,e.edtLeft.text=i.position.left+"",e.edtTop.text=i.position.top+"",e.edtWidth.text=i.position.width+"",e.edtHeight.text=i.position.height+"",e.btnPosition.onClick=function(){i.position.left=parseFloat(e.edtLeft.text),i.position.top=parseFloat(e.edtTop.text),i.position.width=parseFloat(e.edtWidth.text),i.position.height=parseFloat(e.edtHeight.text)}}))}showSelector(){null!=this.control&&(this.position.fromData(this.control.position.toData()),this.visible=!0,this.bringToFront())}getBounds(){return new CRect(this.position.left,this.position.top,this.position.left+this.position.width,this.position.top+this.position.height)}}class CControlSelectorRotate extends CControlSelector{constructor(t,e){super(t,e),this.__centerDown=!1,this.__downRotationHandle=!1,this.__rotationDownPoint=new CPoint,this.rotationCenterHandle=new CPanel(this),this.rotationHandle=new CPanel(this);let i=this;this.rotationCenterHandle.onThisPointerDown=function(){i.__centerDown=!0},this.rotationCenterHandle.onThisPointerMove=function(t,e,s){i.__centerDown&&i.doCenterHandleMove(e)},this.rotationCenterHandle.onThisPointerUp=function(t,e,s){i.__centerDown=!1},this.rotationHandle.onThisPointerDown=function(t,e,s){let o=i.rotationCenterHandle.controlElement.getBoundingClientRect();i.__rotationDownPoint=new CPoint(o.x+o.width/2,o.y+o.height/2),i.__downRotationHandle=!0,i.doBeforeRotation(e)},this.rotationHandle.onThisPointerMove=function(t,e,s){i.__downRotationHandle&&i.doRotation(e)},this.rotationHandle.onThisPointerUp=function(t,e,s){i.__downRotationHandle=!1,i.doAfterRotation(e)}}doToData(t){super.doToData(t),CDataClass.putData(t,"rotationHandle",this.rotationHandle.toData(),{},!0),CDataClass.putData(t,"rotationCenterHandle",this.rotationCenterHandle.toData(),{},!0)}doFromData(t){super.doFromData(t),this.rotationHandle.fromData(CDataClass.getData(t,"rotationHandle",{},!0)),this.rotationCenterHandle.fromData(CDataClass.getData(t,"rotationCenterHandle",{},!0))}doChangeSize(){super.doChangeSize(),this.rotationHandle.position.left=this.position.width+10,this.rotationHandle.position.top=this.position.height/2-this.rotationHandle.position.height/2,this.rotationCenterHandle.position.left=this.position.width*this.transform.rotationPointX-this.rotationCenterHandle.position.width/2,this.rotationCenterHandle.position.top=this.position.height*this.transform.rotationPointY-this.rotationCenterHandle.position.height/2}doCenterHandleMove(t){t.shiftKey&&(this.rotationCenterHandle.position.left=5*Math.floor(this.rotationCenterHandle.position.left/5),this.rotationCenterHandle.position.top=5*Math.floor(this.rotationCenterHandle.position.top/5)),this.transform.rotationPointX=(this.rotationCenterHandle.position.left+this.rotationCenterHandle.position.width/2)/this.position.width,this.transform.rotationPointY=(this.rotationCenterHandle.position.top+this.rotationCenterHandle.position.height/2)/this.position.height,this.control&&(this.control.transform.rotationPointX=this.transform.rotationPointX,this.control.transform.rotationPointY=this.transform.rotationPointY),null!=this.onCenterHandleMove&&this.onCenterHandleMove(this)}doBeforeRotation(t){null!=this.onBeforeRotation&&this.onBeforeRotation(this,t)}doRotation(t){let e=CPoint.getAngleFromTwoPoint(this.__rotationDownPoint,new CPoint(t.pageX,t.pageY));t.shiftKey&&(e=5*Math.floor(e/5)),this.transform.rotateZ=e,this.control&&(this.control.transform.rotateZ=e),null!=this.onRotation&&this.onRotation(this,t)}doAfterRotation(t){null!=this.onAfterRotation&&this.onAfterRotation(this,t)}doKeyDown(t){super.doKeyDown(t),"ArrowUp"==t.key&&(t.shiftKey?this.position.height--:this.position.top--),"ArrowDown"==t.key&&(t.shiftKey?this.position.height++:this.position.top++),"ArrowLeft"==t.key&&(t.shiftKey?this.position.width--:this.position.left--),"ArrowRight"==t.key&&(t.shiftKey?this.position.width++:this.position.left++)}static showSelector(t,e){let i=new CControlSelectorRotate;return i.resource=null!=e?e:"base/baseControlSelectorRotate.control",i.control=t,i.bringToFront(),i}}class CPathSelector extends CControlSelectorRotate{}class CControlSelectorAtypical extends CControlSelectorRotate{constructor(){super(...arguments),this.handleLeftTop=new CPanel(this),this.handleRightTop=new CPanel(this),this.handleLeftLeftBottom=new CPanel(this),this.handleRightBottom=new CPanel(this)}}class CProgressBar extends CPanel{constructor(){super(...arguments),this._min=0,this._max=100,this._value=0,this.progress=new CPanel(this),this.progressText=new CPanel(this)}get min(){return this._min}set min(t){this._min!=t&&(this._min=t,this.doChangeProgress())}get max(){return this._max}set max(t){this._max!=t&&(this._max=t,this.doChangeProgress())}get value(){return this._value}set value(t){this._value!=t&&(this._value=t,this.doChangeProgress())}setProgress(){this.progressText.position.left=0,this.progressText.position.top=0,this.progressText.position.width=this.position.width,this.progressText.position.height=this.position.height;let t=this.position.width-this.position.padding.left-this.position.padding.right-this.progress.position.margins.left-this.progress.position.margins.right,e=CCalc.crRange2Value(this.min,this.max,this.value,0,1);this.progress.position.width=t*e,this.progressText.text=Math.floor(100*e)+"%"}doChangeProgress(){this.setProgress()}doChangeSize(){super.doChangeSize(),this.setProgress()}doToData(t){super.doToData(t),CDataClass.putData(t,"progress",this.progress.toData(),{},!0),CDataClass.putData(t,"progressText",this.progressText.toData(),{},!0),CDataClass.putData(t,"min",this.min,0),CDataClass.putData(t,"max",this.max,100),CDataClass.putData(t,"value",this.value,0)}doFromData(t){super.doFromData(t),this.progress.fromData(CDataClass.getData(t,"progress",{},!0)),this.progressText.fromData(CDataClass.getData(t,"progressText",{},!0)),this.min=CDataClass.getData(t,"min",0),this.max=CDataClass.getData(t,"max",100),this.value=CDataClass.getData(t,"value",0),this.progress.position.align=EPositionAlign.LEFT}doChildDataMapHandle(t){super.doChildDataMapHandle(t),t.delete(this.progress),t.delete(this.progressText)}doChangeDesignMode(){super.doChangeDesignMode(),this.isDesignMode?(this.__designOrgData.progress=this.progress.hasPointerEvent,this.__designOrgData.progressText=this.progressText.hasPointerEvent,this.progress.hasPointerEvent=!1,this.progressText.hasPointerEvent=!1):(this.progress.hasPointerEvent=this.__designOrgData.progress,this.progressText.hasPointerEvent=this.__designOrgData.progressText)}}class CDial extends CPanel{constructor(){super(...arguments),this._center=new CPoint(0,0),this._angle=0,this.onChangeAngle=new Array}get angle(){return this._angle}set angle(t){this._angle!=t&&(this._angle=t,this.doChangeAngle())}doToData(t){super.doToData(t),CDataClass.putData(t,"angle",this.angle,0)}doFromData(t){super.doFromData(t),this.angle=CDataClass.getData(t,"angle",0)}doChangeSize(){super.doChangeSize(),this._center.x=this.position.width/2,this._center.y=this.position.height/2}doChangeAngle(){let t=this.getDialLayer();t&&(t.transform.rotateZ=this._angle);for(let t=0;t<this.onChangeAngle.length;t++)this.onChangeAngle[t](this,this.angle)}doThisPointerDown(t,e){super.doThisPointerDown(t,e);let i=new CPoint(t.offsetX,t.offsetY);this.angle=CPoint.getAngleFromTwoPoint(this._center,i)}doThisPointerMove(t,e){if(super.doThisPointerMove(t,e),this.isPress){let e=new CPoint(t.offsetX,t.offsetY);this.angle=CPoint.getAngleFromTwoPoint(this._center,e)}}getDialLayer(){for(let t=0;t<this.layers.length;t++)if("dial"==this.layers.get(t).name)return this.layers.get(t)}}class CFold extends CPanel{get folded(){return this._folded}set folded(t){this._folded!=t&&(this._folded=t,this.doChangeFolded())}constructor(t,e){super(t,e),this.__orgHeight=0,this._folded=!1,this.caption=new CPanel(this),this.btnFold=new CButton(this.caption),this.body=new CPanel(this);let i=this;this.btnFold.onClick=function(){i.folded=!i.folded},this.caption.onClick=function(){i.folded=!i.folded}}doToData(t){super.doToData(t),CDataClass.putData(t,"caption",this.caption.toData(),{},!0),CDataClass.putData(t,"btnFold",this.btnFold.toData(),{},!0),CDataClass.putData(t,"body",this.body.toData(),{},!0),CDataClass.putData(t,"folded",this.folded,!1),null!=this.foldAnimationTrigger&&CDataClass.putData(t,"foldAnimationTrigger",this.foldAnimationTrigger.toData(),{},!0)}doFromData(t){super.doFromData(t),this.caption.fromData(CDataClass.getData(t,"caption",{},!0)),this.btnFold.fromData(CDataClass.getData(t,"btnFold",{},!0)),this.body.fromData(CDataClass.getData(t,"body",{},!0)),this.folded=CDataClass.getData(t,"folded",!1),CAnimator.fromAnimatorData(t,this,"foldAnimationTrigger")}doChangeFolded(){null!=this.foldAnimationTrigger?this.folded?this.triggerTrue(this.foldAnimationTrigger):this.triggerFalse(this.foldAnimationTrigger):this.folded?(this.__orgHeight=this.position.height,this.position.height=this.caption.position.height):this.position.height=this.__orgHeight,null!=this.onChangeFolded&&this.onChangeFolded(this)}addProperties(){let t=super.addProperties();return t.push({instance:this.foldAnimationTrigger,propertyName:"foldAnimationTrigger",readOnly:!1,enum:[]}),t}}class CPathPointSelectorModel extends CClass{get pathPoint(){return this._pathPoint}set pathPoint(t){if(t!=this._pathPoint&&(this._pathPoint=t,null!=this._pathPoint)){this.point.position.left=this._pathPoint.point.x-5,this.point.position.top=this._pathPoint.point.y-5;let t=this;this.point.onChangeOffset=function(){null!=t._pathPoint&&t.isUpdate&&(0==t.alignPixel?(t._pathPoint.point.x=t.point.position.left+5,t._pathPoint.point.y=t.point.position.top+5):(t._pathPoint.point.x=Math.round((t.point.position.left+5)/t.alignPixel)*t.alignPixel,t._pathPoint.point.y=Math.round((t.point.position.top+5)/t.alignPixel)*t.alignPixel),null!=t._parent&&t._parent.draw())},this._pathPoint.pointKind==EPathPointKind.CURVETO2&&(this.cpoint1=new CPanel(this._parent),this.cpoint1.resource=this.cpoint1Resource,this.cpoint1.position.left=this._pathPoint.cPoint1.x-3,this.cpoint1.position.top=this._pathPoint.cPoint1.y-3,this.cpoint1.position.width=6,this.cpoint1.position.height=6,this.cpoint1.useMove=!0,this.cpoint1.onChangeOffset=function(){null!=t._pathPoint&&null!=t.cpoint1&&t.isUpdate&&(0==t.alignPixel?(t._pathPoint.cPoint1.x=t.cpoint1.position.left+3,t._pathPoint.cPoint1.y=t.cpoint1.position.top+3):(t._pathPoint.cPoint1.x=Math.round((t.cpoint1.position.left+3)/t.alignPixel)*t.alignPixel,t._pathPoint.cPoint1.y=Math.round((t.cpoint1.position.top+3)/t.alignPixel)*t.alignPixel),t._pathPoint.doChange(),null!=t._parent&&t._parent.draw())}),this._pathPoint.pointKind==EPathPointKind.CURVETO3&&(this.cpoint1=new CPanel(this._parent),this.cpoint1.resource=this.cpoint1Resource,this.cpoint1.position.left=this._pathPoint.cPoint1.x-3,this.cpoint1.position.top=this._pathPoint.cPoint1.y-3,this.cpoint1.position.width=6,this.cpoint1.position.height=6,this.cpoint1.useMove=!0,this.cpoint1.onChangeOffset=function(){null!=t._pathPoint&&null!=t.cpoint1&&t.isUpdate&&(0==t.alignPixel?(t._pathPoint.cPoint1.x=t.cpoint1.position.left+3,t._pathPoint.cPoint1.y=t.cpoint1.position.top+3):(t._pathPoint.cPoint1.x=Math.round((t.cpoint1.position.left+3)/t.alignPixel)*t.alignPixel,t._pathPoint.cPoint1.y=Math.round((t.cpoint1.position.top+3)/t.alignPixel)*t.alignPixel),t._pathPoint.doChange(),null!=t._parent&&t._parent.draw())},this.cpoint2=new CPanel(this._parent),this.cpoint2.resource=this.cpoint2Resource,this.cpoint2.position.left=this._pathPoint.cPoint2.x-3,this.cpoint2.position.top=this._pathPoint.cPoint2.y-3,this.cpoint2.position.width=6,this.cpoint2.position.height=6,this.cpoint2.useMove=!0,this.cpoint2.onChangeOffset=function(){null!=t._pathPoint&&null!=t.cpoint2&&t.isUpdate&&(0==t.alignPixel?(t._pathPoint.cPoint2.x=t.cpoint2.position.left+3,t._pathPoint.cPoint2.y=t.cpoint2.position.top+3):(t._pathPoint.cPoint2.x=Math.round((t.cpoint2.position.left+3)/t.alignPixel)*t.alignPixel,t._pathPoint.cPoint2.y=Math.round((t.cpoint2.position.top+3)/t.alignPixel)*t.alignPixel),t._pathPoint.doChange(),null!=t._parent&&t._parent.draw())})}}get parent(){return this._parent}set parent(t){t!=this._parent&&(this._parent=t,this.point.parent=t)}constructor(t,e,i){super(),this.point=new CPanel,this.isUpdate=!0,this.alignPixel=0,this.pointResource="",this.cpoint1Resource="",this.cpoint2Resource="",this.pointResource=t,this.cpoint1Resource=e,this.cpoint2Resource=i,this.point.resource=this.pointResource,this.point.position.width=10,this.point.position.height=10,this.point.useMove=!0}}class CPathPointControlArea extends CControlSelector{constructor(){super(...arguments),this._orgPosition=new CRect,this._orgPoints=new Array,this._points=new Array}doChangeOffset(){super.doChangeOffset(),this.visible&&this.doSetPoints()}doChangeSize(){super.doChangeSize(),this.visible&&this.doSetPoints()}doKeyDown(t){super.doKeyDown(t),"Delete"==t.key&&this.doDeletePoints()}doWheel(t){super.doWheel(t)}doSetPoints(){for(let t=0;t<this._orgPoints.length;t++){let e=this._orgPoints[t].x+(this.position.left-this._orgPosition.left),i=this._orgPoints[t].y+(this.position.top-this._orgPosition.top),s=e-this.position.left,o=i-this.position.top;e=this.position.left+s*(this.position.width/this._orgPosition.width),i=this.position.top+o*(this.position.height/this._orgPosition.height),this._points[t].isCurveControl?(this._points[t].handle.position.left=e-3,this._points[t].handle.position.top=i-3):(this._points[t].handle.position.left=e-5,this._points[t].handle.position.top=i-5)}null!=this.onSetPoints&&this.onSetPoints(this)}doDeletePoints(){if(null!=this._pathPoints){for(let t=0;t<this._points.length;t++)if(!this._points[t].isCurveControl)for(let e=0;e<this._pathPoints.length;e++)this._points[t].point==this._pathPoints.get(e).point&&this._pathPoints.deletePoint(e);null!=this.onDelete&&this.onDelete(this)}}showArea(t,e,i,s,o,a){this.position.left=t,this.position.top=e,this.position.width=i,this.position.height=s,this._orgPosition.left=this.position.left,this._orgPosition.top=this.position.top,this._orgPosition.width=this.position.width,this._orgPosition.height=this.position.height,this._orgPoints=[],this._points=[],this._pathPoints=o;for(let t=0;t<a.length;t++){let e=a[t].point.copyTo();this._orgPoints.push(e),this._points.push(a[t])}this.visible=!0}copyPoints(){}}class CGuideLine extends CResourceClass{constructor(){super(...arguments),this._kind="y"}}class CPathEditorControl extends CSelectArea{get mode(){return this._mode}set mode(t){this._mode!=t&&(this._mode=t,this.doChangeMode())}get pathPointList(){return this._pathPointList}set pathPointList(t){this._pathPointList=t,null!=this._pathPointList&&this.refresh()}get pointResource(){return this._pointResource}set pointResource(t){this._pointResource=t}get cpoint1Resource(){return this._cpoint1Resource}set cpoint1Resource(t){this._cpoint1Resource=t}get cpoint2Resource(){return this._cpoint2Resource}set cpoint2Resource(t){this._cpoint2Resource=t}get points(){return this.__points}constructor(t,e){super(t,e),this.__points=new CList,this._mode="None",this._pointResource="",this._cpoint1Resource="",this._cpoint2Resource="",this.pathPointControlArea=new CPathPointControlArea(this);let i=this;this.pathPointControlArea.onDelete=function(){i.pathPointControlArea.visible=!1,i.refresh()}}doToData(t){super.doToData(t),CDataClass.putData(t,"pointResource",this.pointResource,""),CDataClass.putData(t,"cpoint1Resource",this.cpoint1Resource,""),CDataClass.putData(t,"cpoint2Resource",this.cpoint2Resource,""),CDataClass.putData(t,"pathPointControlArea",this.pathPointControlArea.toData(),{},!0)}doFromData(t){super.doFromData(t),this.pointResource=CDataClass.getData(t,"pointResource",""),this.cpoint1Resource=CDataClass.getData(t,"cpoint1Resource",""),this.cpoint2Resource=CDataClass.getData(t,"cpoint2Resource",""),this.pathPointControlArea.fromData(CDataClass.getData(t,"pathPointControlArea",{},!0))}doThisPointerDown(t,e){if(super.doThisPointerDown(t,e),null!=this._pathPointList&&0==t.button){if("None"==this._mode&&(this.pathPointControlArea.visible=!1),"MoveTo"==this._mode){let e=CPoint.create(t.offsetX,t.offsetY),i=this._pathPointList.addPointMoveTo(e);this.__prePathPoint=e;let s=new CPathPointSelectorModel(this.pointResource,this.cpoint1Resource,this.cpoint2Resource);s.parent=this,s.pathPoint=i,this.__points.add(s)}if("LineTo"==this._mode){let e=CPoint.create(t.offsetX,t.offsetY),i=this._pathPointList.addPointLineTo(CPoint.create(t.offsetX,t.offsetY));this.__prePathPoint=e;let s=new CPathPointSelectorModel(this.pointResource,this.cpoint1Resource,this.cpoint2Resource);s.parent=this,s.pathPoint=i,this.__points.add(s)}if("CurveTo"==this._mode){let e=CPoint.create(t.offsetX,t.offsetY);if(null!=this.__prePathPoint){let t=CPoint.getDistancePoints(e,this.__prePathPoint),i=CPoint.getLineMiddlePoint(this.__prePathPoint,e,CCalc.crRange2Value(0,t,t/3,0,1)),s=CPoint.getLineMiddlePoint(this.__prePathPoint,e,CCalc.crRange2Value(0,t,t/3*2,0,1)),o=this._pathPointList.addPointCurveTo3(e,i,s);this.__prePathPoint=e;let a=new CPathPointSelectorModel(this.pointResource,this.cpoint1Resource,this.cpoint2Resource);a.parent=this,a.pathPoint=o,this.__points.add(a)}else{let t=this._pathPointList.addPointCurveTo3(e,e,e);this.__prePathPoint=e;let i=new CPathPointSelectorModel(this.pointResource,this.cpoint1Resource,this.cpoint2Resource);i.parent=this,i.pathPoint=t,this.__points.add(i)}}}}doKeyDown(t){super.doKeyDown(t),"N"==t.key.toUpperCase()&&(this.mode="None"),"M"==t.key.toUpperCase()&&(this.mode="MoveTo"),"L"==t.key.toUpperCase()&&(this.mode="LineTo"),"V"==t.key.toUpperCase()&&(this.mode="CurveTo"),"E"==t.key.toUpperCase()&&(this.mode="AddEllipse"),"C"==t.key.toUpperCase()&&null!=this.pathPointList&&this.pathPointList.addPointClose()}showArea(t,e){let i=new Array;if(null!=this.pathPointList){let s=new CRect(t.x,t.y,e.x,e.y);for(let t=0;t<this.__points.length;t++){let e=this.__points.get(t).pathPoint;if(null!=e){if(s.isIn(e.point.x,e.point.y)&&i.push({point:e.point,handle:this.__points.get(t).point,isCurveControl:!1}),s.isIn(e.cPoint1.x,e.cPoint1.y)){let s=this.__points.get(t).cpoint1;null!=s&&i.push({point:e.cPoint1,handle:s,isCurveControl:!0})}if(s.isIn(e.cPoint2.x,e.cPoint2.y)){let s=this.__points.get(t).cpoint2;null!=s&&i.push({point:e.cPoint2,handle:s,isCurveControl:!0})}}}}this.pathPointControlArea.showArea(t.x,t.y,e.x-t.x,e.y-t.y,this.pathPointList,i),this.pathPointControlArea.focused=!0}doSelectArea(t,e){super.doSelectArea(t,e),"None"==this.mode&&this.showArea(t,e),"AddEllipse"==this.mode&&null!=this.pathPointList&&(this.pathPointList.makeEllipseData(t.x,t.y,e.x-t.x,e.y-t.y,!1),this.refresh(),this.showArea(t,e))}doChangeMode(){this.pathPointControlArea.visible=!1,"None"==this.mode||"AddEllipse"==this.mode?this.useSelectArea=!0:this.useSelectArea=!1}deletePoint(t){if(null!=this._pathPointList){for(let e=0;e<this.__points.length;e++)if(this.__points.get(e).pathPoint==t){this.__points.get(e).point.remove();let t=this.__points.get(e).cpoint1;null!=t&&t.remove();let i=this.__points.get(e).cpoint2;null!=i&&i.remove(),this.__points.delete(e);break}for(let e=0;e<this._pathPointList.length;e++)if(this._pathPointList.get(e)==t){this._pathPointList.delete(e);break}}}clearPoints(){for(let t=0;t<this.__points.length;t++){this.__points.get(t).point.remove();let e=this.__points.get(t).cpoint1;null!=e&&e.remove();let i=this.__points.get(t).cpoint2;null!=i&&i.remove()}this.__points.clear()}reCreatePoints(){if(null!=this.pathPointList){this.clearPoints();for(let t=0;t<this.pathPointList.length;t++){if(this.pathPointList.get(t).pointKind==EPathPointKind.MOVETO){let e=new CPathPointSelectorModel(this.pointResource,this.cpoint1Resource,this.cpoint2Resource);e.parent=this,e.pathPoint=this.pathPointList.get(t),this.__points.add(e)}if(this.pathPointList.get(t).pointKind==EPathPointKind.LINETO){let e=new CPathPointSelectorModel(this.pointResource,this.cpoint1Resource,this.cpoint2Resource);e.parent=this,e.pathPoint=this.pathPointList.get(t),this.__points.add(e)}if(this.pathPointList.get(t).pointKind==EPathPointKind.CURVETO2){let e=new CPathPointSelectorModel(this.pointResource,this.cpoint1Resource,this.cpoint2Resource);e.parent=this,e.pathPoint=this.pathPointList.get(t),this.__points.add(e)}if(this.pathPointList.get(t).pointKind==EPathPointKind.CURVETO3){let e=new CPathPointSelectorModel(this.pointResource,this.cpoint1Resource,this.cpoint2Resource);e.parent=this,e.pathPoint=this.pathPointList.get(t),this.__points.add(e)}}}}refreshPoints(){for(let t=0;t<this.__points.length;t++){let e=this.__points.get(t).pathPoint;if(null!=e){this.__points.get(t).isUpdate=!1,this.__points.get(t).point.position.left=e.point.x-5,this.__points.get(t).point.position.top=e.point.y-5;let i=this.__points.get(t).cpoint1;null!=i&&(i.position.left=e.cPoint1.x-3,i.position.top=e.cPoint1.y-3);let s=this.__points.get(t).cpoint2;null!=s&&(s.position.left=e.cPoint2.x-3,s.position.top=e.cPoint2.y-3),this.__points.get(t).isUpdate=!0}}}setAlignPixel(){}clear(){null!=this.pathPointList&&(this.pathPointList.clear(),this.clearPoints())}refresh(){if(null!=this.pathPointList){this.reCreatePoints();for(let t=0;t<this.pathPointList.length;t++){let e="";this.pathPointList.get(t).pointKind==EPathPointKind.BEGIN?e="B":this.pathPointList.get(t).pointKind==EPathPointKind.MOVETO?e="M":this.pathPointList.get(t).pointKind==EPathPointKind.LINETO?e="L":this.pathPointList.get(t).pointKind==EPathPointKind.CURVETO2||this.pathPointList.get(t).pointKind==EPathPointKind.CURVETO3?e="C":this.pathPointList.get(t).pointKind==EPathPointKind.CLOSE&&(e="CL")}}}}!function(t){t[t.TO=0]="TO",t[t.BOTH=1]="BOTH",t[t.NONE=2]="NONE"}(EArrowKind||(EArrowKind={}));class CArrowInfo extends CNotifyChangeNotifyObject{get points(){return this._points}get arrowKind(){return this._arrowKind}set arrowKind(t){this._arrowKind!=t&&(this._arrowKind=t,this.doChange())}get arrowDistance(){return this._arrowDistance}set arrowDistance(t){this._arrowDistance!=t&&(this._arrowDistance=t,this.doChange())}get color(){return this._color}set color(t){this._color!=t&&(this._color=t,this.doChange())}get lineWidth(){return this._lineWidth}set lineWidth(t){this._lineWidth!=t&&(this._lineWidth=t,this.doChange())}get useRound(){return this._useRound}set useRound(t){this._useRound!=t&&(this._useRound=t,this.doChange())}get dash(){return this._dash}set dash(t){this._dash!=t&&(this._dash=t,this.doChange())}get pathData(){let t=new CPathPointList,e=new CPathPointList;if(this.points.length>=2){let i=this.points[this.points.length-1],s=this.points[this.points.length-2];for(let e=0;e<this.points.length;e++)if(0==e)t.addPointMoveTo(this.points[e].point.toPoint());else{let i=this.points[e].cpoint1,s=this.points[e].cpoint2;i&&s?t.addPointCurveTo3(this.points[e].point.toPoint(),i.toPoint(),s.toPoint()):t.addPointLineTo(this.points[e].point.toPoint())}if(this._arrowKind!=EArrowKind.NONE){let t;if(t=i.cpoint1&&i.cpoint2?CPoint.getArrowPoint(i.cpoint2.toPoint(),i.point.toPoint(),45,this._arrowDistance):CPoint.getArrowPoint(s.point.toPoint(),i.point.toPoint(),45,this._arrowDistance),e.addPointMoveTo(i.point.toPoint()),e.addPointLineTo(t.arrow1),e.addPointLineTo(t.arrow2),e.addPointLineTo(i.point.toPoint()),e.addPointClose(),this._arrowKind==EArrowKind.BOTH){let i=this.points[1];t=i.cpoint1&&i.cpoint2?CPoint.getArrowPoint(i.cpoint1.toPoint(),this.points[0].point.toPoint(),45,this._arrowDistance):CPoint.getArrowPoint(this.points[1].point.toPoint(),this.points[0].point.toPoint(),45,this._arrowDistance),e.addPointMoveTo(this.points[0].point.toPoint()),e.addPointLineTo(t.arrow1),e.addPointLineTo(t.arrow2),e.addPointLineTo(this.points[0].point.toPoint()),e.addPointClose()}}}return{line:t,arrow:e}}constructor(t){super(),this._arrowKind=EArrowKind.TO,this._arrowDistance=5,this._points=new Array,this._color="#ffffff",this._lineWidth=1,this._useRound=!0,this._dash="";let e=this;if(t){for(let i=0;i<t.length;i++){t[i].point.onChange=function(){e.doChange()};let s=t[i].cpoint1,o=t[i].cpoint2;s&&(s.onChange=function(){e.doChange()}),o&&(o.onChange=function(){e.doChange()})}this._points=t}}doToData(t){super.doToData(t),CDataClass.putData(t,"arrowKind",this._arrowKind,EArrowKind.TO),CDataClass.putData(t,"arrowDistance",this._arrowDistance,5),CDataClass.putData(t,"points",this._points,[],!0),CDataClass.putData(t,"color",this._color,"#ffffff"),CDataClass.putData(t,"lineWidth",this._lineWidth,1),CDataClass.putData(t,"useRound",this._useRound,!0),CDataClass.putData(t,"dash",this._dash,"")}doFromData(t){super.doFromData(t),this._points=CDataClass.getData(t,"points",[],!0),this.arrowKind=CDataClass.getData(t,"arrowKind",EArrowKind.TO),this.arrowDistance=CDataClass.getData(t,"arrowDistance",5),this.color=CDataClass.getData(t,"color","#ffffff"),this.lineWidth=CDataClass.getData(t,"lineWidth",5),this.useRound=CDataClass.getData(t,"useRound",!0),this.dash=CDataClass.getData(t,"dash","")}addPoint(t,e,i){let s,o,a=new CNotifyPoint;t instanceof CPoint?(a=t.toNotifyPoint(),e&&i&&e instanceof CPoint&&i instanceof CPoint&&(s=e.toNotifyPoint(),o=i.toNotifyPoint())):e&&"number"==typeof e&&(a.x=t,a.y=e);let n=this;a.onChange=function(){n.doChange()},s&&(s.onChange=function(){n.doChange()}),o&&(o.onChange=function(){n.doChange()});let r={point:a,cpoint1:s,cpoint2:o};return this._points.push(r),this.doChange(),this._points}insertPoint(t,e,i,s){let o,a,n=new CNotifyPoint;e instanceof CPoint?(n=e.toNotifyPoint(),i&&s&&i instanceof CPoint&&s instanceof CPoint&&(o=i.toNotifyPoint(),a=s.toNotifyPoint())):i&&"number"==typeof i&&(n.x=e,n.y=i);let r=this;n.onChange=function(){r.doChange()},o&&(o.onChange=function(){r.doChange()}),a&&(a.onChange=function(){r.doChange()});let l={point:n,cpoint1:o,cpoint2:a};return this._points.splice(t,0,l),this.doChange(),this._points}deletePoint(t){return this._points.splice(t,1),this.doChange(),this._points}static draw(t,e){t.items.clear();let i=t.items.addItem(),s=t.items.addItem();i.kind=ECanvasItemKind.PATH,i.pathFitMode=EFitMode.ORIGINAL,i.stroke.styleKind=EStyleKind.SOLID,i.stroke.lineWidth=e.lineWidth,i.stroke.solidColor=e.color,e.useRound?(i.stroke.lineCap=EStrokeLineCap.ROUND,i.stroke.lineJoin=EStrokeLineJoin.ROUND):(i.stroke.lineCap=EStrokeLineCap.BUTT,i.stroke.lineJoin=EStrokeLineJoin.MITER),i.stroke.lineDash=e.dash,i.pathData.copyFrom(e.pathData.line),s.kind=ECanvasItemKind.PATH,s.pathFitMode=EFitMode.ORIGINAL,s.fill.styleKind=EStyleKind.SOLID,s.fill.solidColor=e.color,s.stroke.styleKind=EStyleKind.SOLID,s.stroke.solidColor=e.color,s.stroke.lineWidth=e.lineWidth,e.useRound?(s.stroke.lineCap=EStrokeLineCap.ROUND,s.stroke.lineJoin=EStrokeLineJoin.ROUND):(s.stroke.lineCap=EStrokeLineCap.BUTT,s.stroke.lineJoin=EStrokeLineJoin.MITER),s.pathData.copyFrom(e.pathData.arrow),t.draw()}}class CArrows extends CNotifyChangeObject{constructor(){super(...arguments),this._arrowList=new Array}get arrowList(){return this._arrowList}doChange(t,e){null!=this.onChange&&this.onChange(t,e)}doToData(t){super.doToData(t);let e=new Array;for(let t=0;t<this._arrowList.length;t++){let i=this._arrowList[t].toData();e.push(i)}CDataClass.putData(t,"arrowList",e,[],!0)}doFromData(t){super.doFromData(t),this._arrowList=[];let e=CDataClass.getData(t,"arrowList",[],!0);for(let t=0;t<e.length;t++){let i=new CArrowInfo;i.fromData(e[t]),this.addArrow(i)}}addArrow(t){let e=this;t.onChange=function(){e.doChange("point",t)},this._arrowList.push(t),this.doChange("add",t)}insertArrow(t,e){let i=this;e.onChange=function(){i.doChange("point",e)},this._arrowList.splice(t,0,e),this.doChange("insert",e)}deleteArrow(t){if("number"==typeof t){let e=this._arrowList[t];this._arrowList.splice(t,1),this.doChange("delete",e)}else for(let e=this._arrowList.length-1;e>=0;e--)if(this._arrowList[e]==t){let t=this._arrowList[e];this._arrowList.splice(e,1),this.doChange("delete",t)}}clear(){this._arrowList=[],this.doChange("clear")}static selectedArrows(t,e,i){let s=new Array;for(let e=0;e<t.length;e++);return s}}class CArrowBackground extends CPanel{get selectedArrow(){return this._selectedArrow}set selectedArrow(t){this._selectedArrow!=t&&(this._selectedArrow=t,this.draw())}constructor(t,e){super(t,e),this.onChangeArrowList=new Array;let i=this;this.arrows=new CArrows,this.arrows.onChange=function(t,e){i.doChangeArrawList(t,e)},this._arrowLayers=new CCanvasLayers(this),this._arrowLayer=this._arrowLayers.addLayer(),this._arrowLayers.onChangeLayer=function(t,e,s){e==CCanvasLayers.CON_CHANGE_ADD_LAYER&&s.setCanvasElementPosition(-i.expandedLayers.left,-i.expandedLayers.top,i.position.width+i.expandedLayers.left+i.expandedLayers.right,i.position.height+i.expandedLayers.top+i.expandedLayers.bottom)},this._arrowLayers.onChange=function(){let t=CSystem.getChildControls(i);for(let e=0;e<t.length;e++)t[e].bringToFront();i.doChangeLayerCount()}}doChangeArrawList(t,e){this.draw();for(let i=0;i<this.onChangeArrowList.length;i++)this.onChangeArrowList[i](this,t,e)}doToData(t){super.doToData(t),CDataClass.putData(t,"arrowList",this.arrows.toData(),{},!0)}doFromData(t){super.doFromData(t),this.arrows.fromData(CDataClass.getData(t,"arrowList",{},!0))}doRemove(){this.selectedArrow=void 0,super.doRemove()}doDraw(){this._arrowLayer.items.clear();for(let t=0;t<this.arrows.arrowList.length;t++){let e=this._arrowLayer.items.addItem(),i=this._arrowLayer.items.addItem();e.kind=ECanvasItemKind.PATH,e.pathFitMode=EFitMode.ORIGINAL;let s=this.arrows.arrowList[t];e.stroke.styleKind=EStyleKind.SOLID,e.stroke.lineWidth=s.lineWidth,e.stroke.solidColor=s.color,s.useRound?(e.stroke.lineCap=EStrokeLineCap.ROUND,e.stroke.lineJoin=EStrokeLineJoin.ROUND):(e.stroke.lineCap=EStrokeLineCap.BUTT,e.stroke.lineJoin=EStrokeLineJoin.MITER),e.stroke.lineDash=s.dash,e.pathData.copyFrom(s.pathData.line),i.kind=ECanvasItemKind.PATH,i.pathFitMode=EFitMode.ORIGINAL,i.fill.styleKind=EStyleKind.SOLID,i.fill.solidColor=s.color,i.stroke.styleKind=EStyleKind.SOLID,i.stroke.solidColor=s.color,i.stroke.lineWidth=s.lineWidth,s.useRound?(i.stroke.lineCap=EStrokeLineCap.ROUND,i.stroke.lineJoin=EStrokeLineJoin.ROUND):(i.stroke.lineCap=EStrokeLineCap.BUTT,i.stroke.lineJoin=EStrokeLineJoin.MITER),i.pathData.copyFrom(s.pathData.arrow)}if(this._selectedArrow){let t=this.getArrowArea(this._selectedArrow,20),e=this._arrowLayer.items.addItem();e.kind=ECanvasItemKind.PATH,e.pathFitMode=EFitMode.ORIGINAL,e.stroke.styleKind=EStyleKind.SOLID,e.stroke.lineWidth=this._selectedArrow.lineWidth,e.stroke.solidColor=this._selectedArrow.color,this._selectedArrow.useRound?(e.stroke.lineCap=EStrokeLineCap.ROUND,e.stroke.lineJoin=EStrokeLineJoin.ROUND):(e.stroke.lineCap=EStrokeLineCap.BUTT,e.stroke.lineJoin=EStrokeLineJoin.MITER),e.stroke.lineDash=this._selectedArrow.dash,e.pathData.copyFrom(t)}super.doDraw(),this._arrowLayers.draw()}doSetLayers(){super.doSetLayers(),this._arrowLayers.setLayersPosition(-this.expandedLayers.left,-this.expandedLayers.top,this.position.width+this.expandedLayers.left+this.expandedLayers.right,this.position.height+this.expandedLayers.top+this.expandedLayers.bottom)}addArrow(t){if(t instanceof Array){let e=new CArrowInfo;for(let i=0;i<t.length;i++)e.addPoint(t[i]);this.arrows.addArrow(e)}else this.arrows.addArrow(t)}insertArrow(t,e){if(e instanceof Array){let i=new CArrowInfo;for(let t=0;t<e.length;t++)i.addPoint(e[t]);this.arrows.insertArrow(t,i)}else this.arrows.insertArrow(t,e)}deleteArrow(t){this.arrows.deleteArrow(t)}clear(){this.arrows.clear()}getArrowArea(t,e){let i=new CPathPointList,s=t.points[0].point.toPoint(),o=t.points[t.points.length-1].point.toPoint(),a=CPoint.getAngleFromTwoPoint(s,o),n=CPoint.getAngleToPoint(s,e/2,e/2,-90,a),r=CPoint.getAngleToPoint(s,e/2,e/2,90,a),l=CPoint.getAngleToPoint(o,e/2,e/2,90,a),h=CPoint.getAngleToPoint(o,e/2,e/2,-90,a);return i.addPointMoveTo(n),i.addPointLineTo(r),i.addPointLineTo(l),i.addPointLineTo(h),i.addPointClose(),i}checkPointInArrowArea(t,e,i){let s=t.points[0].point.toPoint(),o=t.points[t.points.length-1].point.toPoint(),a=CPoint.getAngleFromTwoPoint(s,o),n=CPoint.getAngleToPoint(s,i/2,i/2,-90,a),r=CPoint.getAngleToPoint(s,i/2,i/2,90,a),l=CPoint.getAngleToPoint(o,i/2,i/2,90,a),h=CPoint.getAngleToPoint(o,i/2,i/2,-90,a),d=CPoint.getAngleFromTwoPoint(n,h),g=CPoint.getAngleFromTwoPoint(n,r),C=CPoint.getAngleFromTwoPoint(l,r),c=CPoint.getAngleFromTwoPoint(l,h),u=CPoint.getAngleFromTwoPoint(n,e),p=CPoint.getAngleFromTwoPoint(l,e);return a>=270&&a<360&&(g+=360,u<=90&&(u+=360)),a>=90&&a<180&&(c+=360,p<=90&&(p+=360)),u>=d&&u<=g&&p>=C&&p<=c}getArrowFromPoint(t,e){for(let i=this.arrows.arrowList.length-1;i>=0;i--)if(this.checkPointInArrowArea(this.arrows.arrowList[i],t,e))return this.arrows.arrowList[i]}}!function(t){t[t.NEW=0]="NEW",t[t.LINK=1]="LINK"}(EDiagramDragKind||(EDiagramDragKind={})),function(t){t[t.NONE=0]="NONE",t[t.EDIT=1]="EDIT",t[t.LINK=2]="LINK"}(EDiagramMode||(EDiagramMode={}));class CDiagramShape extends CPanel{get fromShapeList(){return this._fromShapeList}get toShapeList(){return this._toShapeList}constructor(t,e,i){super(e,i),this._fromShapeList=new Map,this._toShapeList=new Map,this.editorResource="";let s=this;this.diagramData=t instanceof Object?CNotifyChangeObjectMaker.newNotifyObjectWithChildProperties(t,void 0,(function(){return!0}),(function(t,e,i,o){s.doChange("diagramData",{target:t,property:e,value:i,fullName:o})})):t}doToData(t){super.doToData(t),CDataClass.putData(t,"diagramData",this.diagramData,{},!0)}doFromData(t){super.doFromData(t),this.diagramData=CDataClass.getData(t,"diagramData",{},!0)}doRemove(){this.diagram=void 0,this.diagramData=void 0,this._toShapeList.clear(),this._fromShapeList.clear(),super.doRemove()}doClick(t){super.doClick(t),this.diagram&&this.diagram.doDiagramShapeClick(this,t)}doDoubleClick(t){let e=this;if(this.diagram)if(this.diagram.mode!=EDiagramMode.NONE){let t=new CTextArea;t.resource=this.editorResource,t.text=this.text,t.position.width=this.position.width,t.position.height=this.position.height,t.parent=this,t.focused=!0,t.isSave=!0,t.onChangeFocus=function(){t.focused||(t.isSave&&(e.text=t.text),t.remove())},t.onKeyDown=function(e,i){"Escape"==i.key&&(t.isSave=!1,t.focused=!1),"Enter"==i.key&&i.ctrlKey&&(t.focused=!1)},t.textArea.addEventListener("keydown",(function(t){"Delete"==t.key&&t.stopPropagation()}))}else super.doDoubleClick(t),this.diagram.doDiagramShapeDblClick(this,t)}doChangeMode(t){t==EDiagramMode.NONE||t==EDiagramMode.LINK?(this.useMove=!1,this.useResize=!1):(this.useMove=!0,this.useResize=!0)}doAddTo(t,e){this._toShapeList.set(t,e),this.doChange("addTo",t)}doAddFrom(t,e){this._fromShapeList.set(t,e),this.doChange("addFrom",t)}doDeleteTo(t){this._toShapeList.delete(t),this.doChange("deleteTo",t)}doDeleteFrom(t){this._fromShapeList.delete(t),this.doChange("deleteFrom",t)}addTo(t,e){this.doAddTo(t,e)}addFrom(t,e){this.doAddFrom(t,e)}deleteTo(t){this.doDeleteTo(t)}deleteFrom(t){this.doDeleteFrom(t)}changeMode(t){this.doChangeMode(t)}getArrowPoint(t){let e=new CPoint;if(this.diagram){let i=this.getAbstractBounds(),s=CPoint.getCrossPoint(this.getAbstractCenterPoint(),t,new CPoint(i.left,i.top),new CPoint(i.right,i.top)),o=CPoint.getCrossPoint(this.getAbstractCenterPoint(),t,new CPoint(i.right,i.top),new CPoint(i.right,i.bottom)),a=CPoint.getCrossPoint(this.getAbstractCenterPoint(),t,new CPoint(i.right,i.bottom),new CPoint(i.left,i.bottom)),n=CPoint.getCrossPoint(this.getAbstractCenterPoint(),t,new CPoint(i.left,i.bottom),new CPoint(i.left,i.top)),r=9999999,l=new CPoint;s&&i.left<=s.x&&i.right>=s.x&&i.top<=s.y&&i.bottom>=s.y&&CPoint.getDistancePoints(t,s)<r&&(r=CPoint.getDistancePoints(t,s),l=s),o&&i.left<=o.x&&i.right>=o.x&&i.top<=o.y&&i.bottom>=o.y&&CPoint.getDistancePoints(t,o)<r&&(r=CPoint.getDistancePoints(t,o),l=o),a&&i.left<=a.x&&i.right>=a.x&&i.top<=a.y&&i.bottom>=a.y&&CPoint.getDistancePoints(t,a)<r&&(r=CPoint.getDistancePoints(t,a),l=a),n&&CPoint.getDistancePoints(t,n)<r&&i.left<=n.x&&i.right>=n.x&&i.top<=n.y&&i.bottom>=n.y&&CPoint.getDistancePoints(t,n)<r&&(r=CPoint.getDistancePoints(t,n),l=n),e.x=l.x,e.y=l.y}return e}getAbstractBounds(){let t=new CRect;if(this.diagram){let e=this.diagram.shapeLayer.controlElement.getBoundingClientRect(),i=this.controlElement.getBoundingClientRect();t.left=i.left-e.left,t.right=i.right-e.left,t.top=i.top-e.top,t.bottom=i.bottom-e.top}return t}getAbstractCenterPoint(){let t=this.getAbstractBounds();return new CPoint(t.left+t.width/2,t.top+t.height/2)}getChildShapes(){let t=new Array,e=CSystem.getAllChildControls(this);for(let i=0;i<e.length;i++)e[i]instanceof CDiagramShape&&t.push(e[i]);return t}}class CDiagram extends CScrollBox{get mode(){return this._mode}set mode(t){this._mode!=t&&(this._mode=t,this.doChangeDiagram("mode"))}get linkDragLayerColor(){return this._linkDragLayerColor}set linkDragLayerColor(t){this._linkDragLayerColor!=t&&(this._linkDragLayerColor=t,this.linkDragLayerItem.stroke.solidColor=this.linkDragLayerColor)}get linkDragLayerLineWidth(){return this._linkDragLayerLineWidth}set linkDragLayerLineWidth(t){this._linkDragLayerLineWidth!=t&&(this._linkDragLayerLineWidth=t,this.linkDragLayerItem.stroke.lineWidth=this.linkDragLayerLineWidth)}get shapeMagneticLength(){return this._shapeMagneticLength}set shapeMagneticLength(t){this._shapeMagneticLength!=t&&(this._shapeMagneticLength=t,this.doChangeShapeMagnetic())}constructor(t,e){super(t,e),this.__downPagePoint=new CPoint,this.__downOffsetPoint=new CPoint,this._mode=EDiagramMode.EDIT,this._linkDragLayerColor="#000000",this._linkDragLayerLineWidth=1,this._shapeMagneticLength=10,this.shapeEditorResource="",this.lineArrowKind=EArrowKind.TO,this.lineArrowDistance=10,this.lineWidth=1,this.lineColor="#000000",this.lineUseRound=!1,this.lineDash="",this.onChangeDiagram=new Array,this.onCreateDiagramShape=new Array,this.onDiagramShapeClick=new Array,this.onDiagramShapeDblClick=new Array;let i=this;this.shapeLayer=new CPanel(this.content),this.shapeLayer.position.align=EPositionAlign.CLIENT,this.shapeLayer.tabIndex="0",this.shapeLayer.onKeyDown=function(t,e){e.ctrlKey&&"V"==e.key.toUpperCase()&&(e.preventDefault(),e.stopPropagation(),i.doShapePaste())},this.shapeLayer.onClick=function(t,e){let s=i.arrowLayer.getArrowFromPoint(new CPoint(e.offsetX,e.offsetY),20);i.arrowLayer.selectedArrow=s},this.tabIndex="0",this.arrowLayer=new CArrowBackground(this.content),this.arrowLayer.position.align=EPositionAlign.CLIENT,this.arrowLayer.hasPointerEvent=!1,this.linkDragLayer=new CPanel(this),this.linkDragLayer.position.align=EPositionAlign.CLIENT,this.linkDragLayerItem=this.linkDragLayer.addLayer().addItem(),this.linkDragLayerItem.kind=ECanvasItemKind.PATH,this.linkDragLayerItem.stroke.styleKind=EStyleKind.SOLID,this.linkDragLayerItem.stroke.lineWidth=this.linkDragLayerLineWidth,this.linkDragLayerItem.stroke.solidColor=this.linkDragLayerColor,this.linkDragLayerItem.pathFitMode=EFitMode.ORIGINAL,this.linkDragLayer.visible=!1,this.linkDragLayer.usePointerCapture=!0,this.linkDragLayer.onThisPointerDown=function(t,e){i.__downPagePoint=new CPoint(e.pageX,e.pageY),i.__downOffsetPoint=new CPoint(e.offsetX,e.offsetY)},this.linkDragLayer.onThisPointerMove=function(t,e){i.linkDragLayer.isPress&&i.setLinkLayerLine(i.__downOffsetPoint,new CPoint(e.offsetX,e.offsetY))},this.linkDragLayer.onPointerUp=function(t,e){i.linkDragLayerItem.pathData.clear();let s=i.getPointShape(i.__downPagePoint),o=i.getPointShape(new CPoint(e.pageX,e.pageY));s&&o&&s!=o&&i.doLink(s.shape,o.shape)}}doToData(t){super.doToData(t),CDataClass.putData(t,"mode",this.mode,EDiagramMode.EDIT),CDataClass.putData(t,"shapeEditorResource",this.shapeEditorResource,""),CDataClass.putData(t,"lineArrowKind",this.lineArrowKind,EArrowKind.TO),CDataClass.putData(t,"lineArrowDistance",this.lineArrowDistance,10),CDataClass.putData(t,"lineWidth",this.lineWidth,1),CDataClass.putData(t,"lineColor",this.lineColor,"#000000"),CDataClass.putData(t,"lineUseRound",this.lineUseRound,!1),CDataClass.putData(t,"lineDash",this.lineDash,""),CDataClass.putData(t,"shapeMagneticLength",this.shapeMagneticLength,10),CDataClass.putData(t,"shapeLayer",this.shapeLayer.toData(),{},!0);let e=this.getAllShape(),i=new Array,s=new Map,o=new Array,a=new Array;for(let t=0;t<e.length;t++)e[t].data=t,s.set(e[t],t),i.push(e[t].toData());for(let t=0;t<e.length;t++){let i=e[t].data;if("number"==typeof i)if(e[t].parent instanceof CDiagramShape){let a=s.get(e[t].parent);a?o.push({id:i,parentId:a}):o.push({id:i,parentId:-1})}else o.push({id:i,parentId:-1})}for(let t=0;t<e.length;t++)e[t].toShapeList.forEach((function(i,s){let o=e[t].data,n=s.data;if("number"==typeof o&&"number"==typeof n){let t={fromId:o,toId:n,arrowDistance:i.arrowDistance,lineWidth:i.lineWidth,color:i.color,useRound:i.useRound,dash:i.dash};a.push(t)}}));CDataClass.putData(t,"shapes",i,[],!0),CDataClass.putData(t,"parentData",o,[],!0),CDataClass.putData(t,"link",a,[],!0)}doFromData(t){super.doFromData(t),this.doClear(),this.mode=CDataClass.getData(t,"mode",EDiagramMode.EDIT),this.shapeEditorResource=CDataClass.getData(t,"shapeEditorResource",""),this.lineArrowKind=CDataClass.getData(t,"lineArrowKind",EArrowKind.TO),this.lineArrowDistance=CDataClass.getData(t,"lineArrowDistance",10),this.lineWidth=CDataClass.getData(t,"lineWidth",1),this.lineColor=CDataClass.getData(t,"lineColor","#000000"),this.lineUseRound=CDataClass.getData(t,"lineUseRound",!1),this.lineDash=CDataClass.getData(t,"lineDash",""),this.shapeMagneticLength=CDataClass.getData(t,"shapeMagneticLength",10),this.shapeLayer.fromData(CDataClass.getData(t,"shapeLayer",{},!0));let e=CDataClass.getData(t,"shapes",[],!0);CDataClass.getData(t,"parentData",[],!0),CDataClass.getData(t,"link",[],!0);for(let t=0;t<e.length;t++);this.arrowLayer.position.align=EPositionAlign.CLIENT,this.arrowLayer.hasPointerEvent=!1}doDiagramShapeClick(t,e){if(!e.ctrlKey){let t=this.selectedShapeList();for(let e=0;e<t.length;e++)t[e].selected=!1}t.selected=!0;for(let i=0;i<this.onDiagramShapeClick.length;i++)this.onDiagramShapeClick[i](this,t,e)}doDiagramShapeDblClick(t,e){for(let i=0;i<this.onDiagramShapeDblClick.length;i++)this.onDiagramShapeDblClick[i](this,t,e)}doChangeShapeMagnetic(){let t=this.getAllShape();for(let e=0;e<t.length;e++)t[e].magneticLength=this._shapeMagneticLength}doLink(t,e){let i=new CArrowInfo([{point:t.getArrowPoint(e.getAbstractCenterPoint()).toNotifyPoint()},{point:e.getArrowPoint(t.getAbstractCenterPoint()).toNotifyPoint()}]);i.arrowKind=this.lineArrowKind,i.arrowDistance=this.lineArrowDistance,i.lineWidth=this.lineWidth,i.color=this.lineColor,i.useRound=this.lineUseRound,i.dash=this.lineDash,t.addTo(e,i),e.addFrom(t,i),this.arrowLayer.arrows.addArrow(i)}doDeleteLink(t){this.arrowLayer.arrows.deleteArrow(t),this.arrowLayer.selectedArrow==t&&(this.arrowLayer.selectedArrow=void 0);let e=this.getAllShape();for(let i=0;i<e.length;i++){let s=[];e[i].toShapeList.forEach((function(e,i){e==t&&s.push(i)}));let o=[];e[i].fromShapeList.forEach((function(e,i){e==t&&o.push(i)}));for(let t=0;t<s.length;t++)e[i].toShapeList.delete(s[t]);for(let t=0;t<o.length;t++)e[i].fromShapeList.delete(o[t])}}doChangeDiagram(t,e){if("mode"==t){this.linkDragLayer.visible=this.mode==EDiagramMode.LINK;let t=this.getAllShape();for(let e=0;e<t.length;e++){t[e].changeMode(this.mode)}}for(let i=0;i<this.onChangeDiagram.length;i++)this.onChangeDiagram[i](this,t,e)}async doShapeCopy(t){let e=new CTreeData;!function t(e,i){let s=e.add(i.toData()),o=CSystem.getChildControls(i);for(let e=0;e<o.length;e++)o[e]instanceof CDiagramShape&&t(s.childItems,o[e])}(e,t),await navigator.clipboard.writeText(JSON.stringify(e.toData()))}async doShapePaste(t){let e=this,i=await navigator.clipboard.readText(),s=new CTreeData;s.fromData(JSON.parse(i));let o=s.getItem(0);let a=this.shapeLayer;t&&(a=t),function t(i,s){let o=e.doCreateDiagramShape(void 0,i.value,s);for(let e=0;e<i.childItems.length;e++)t(i.childItems.getItem(e),o)}(o,a)}doCreateDiagramShape(t,e,i){let s,o=this;s=i||this.shapeLayer;let a=CControl.controlFromData(e,s);function n(t,e,i){let s=new CPoint,o=new CPoint;i.points.length<=2?(s=t.getArrowPoint(e.getAbstractCenterPoint()),o=e.getArrowPoint(t.getAbstractCenterPoint())):(s=t.getArrowPoint(i.points[1].point.toPoint()),o=e.getArrowPoint(i.points[i.points.length-2].point.toPoint())),i.points[0].point.x=s.x,i.points[0].point.y=s.y,i.points[i.points.length-1].point.x=o.x,i.points[i.points.length-1].point.y=o.y}a.onChange=function(t,e){o.doChangeDiagram("modify",a)},a.diagram=this,a.editorResource=this.shapeEditorResource,a.resizeAreaLength=10,a.tabIndex="0",a.useMove=this.mode==EDiagramMode.EDIT,a.useResize=this.mode==EDiagramMode.EDIT,a.onChange=function(){o.doChangeDiagram("modify",a)},a.onChangeOffset=function(){!function(t){t.toShapeList.forEach((function(e,i){n(t,i,e)})),t.fromShapeList.forEach((function(e,i){n(i,t,e)}));let e=t.getChildShapes();for(let t=0;t<e.length;t++)e[t].toShapeList.forEach((function(i,s){n(e[t],s,i)})),e[t].fromShapeList.forEach((function(i,s){n(s,e[t],i)}));o.arrowLayer.draw()}(a)},a.onChangeSize=function(){a.toShapeList.forEach((function(t,e){n(a,e,t)})),a.fromShapeList.forEach((function(t,e){n(e,a,t)})),o.arrowLayer.draw()},a.onKeyDown=function(t,e){e.stopPropagation(),e.ctrlKey&&"C"==e.key.toUpperCase()&&(e.preventDefault(),e.stopPropagation(),o.doShapeCopy(a)),e.ctrlKey&&"V"==e.key.toUpperCase()&&(e.preventDefault(),e.stopPropagation(),o.doShapePaste(a)),"Delete"==e.key&&o.deleteDiagram(a)},this.doChangeDiagram("add",a);for(let t=0;t<this.onCreateDiagramShape.length;t++)this.onCreateDiagramShape[t](this,a);return a}doAddDiagram(t,e,i,s,o){let a=CSystem.resources.get(s);if(a){let s=this.doCreateDiagramShape(i,a,o);return s.position.left=t,s.position.top=e,s}throw new Error("Not exists resource : "+s)}doDeleteDiagram(t){let e=this,i=this.getAllShape(),s=t.getChildShapes();s.push(t);let o=new Set;for(let t=i.length-1;t>=0;t--)for(let e=0;e<s.length;e++)if(i[t]!=s[e]){let a=i[t].toShapeList.get(s[e]);a&&o.add(a),a=i[t].fromShapeList.get(s[e]),a&&o.add(a),i[t].toShapeList.delete(s[e]),i[t].fromShapeList.delete(s[e])}o.forEach((function(t){e.arrowLayer.arrows.deleteArrow(t),e.arrowLayer.selectedArrow==t&&(e.arrowLayer.selectedArrow=void 0)})),t.remove()}doClear(){let t=CSystem.getChildControls(this.shapeLayer);for(let e=0;e<t.length;e++)t[e].remove()}addDiagram(t,e,i,s,o){if(CSystem.resources.has(s)){return this.doAddDiagram(t,e,i,s,o)}throw new Error("Not exists diagram resource : "+s)}deleteDiagram(t){this.doDeleteDiagram(t)}clear(){this.doClear()}setLinkLayerLine(t,e){this.linkDragLayerItem.pathData.clear(),this.linkDragLayerItem.pathData.addPointMoveTo(t),this.linkDragLayerItem.pathData.addPointLineTo(e);let i=CPoint.getArrowPoint(t,e,45,10);this.linkDragLayerItem.pathData.addPointMoveTo(e),this.linkDragLayerItem.pathData.addPointLineTo(i.arrow1),this.linkDragLayerItem.pathData.addPointMoveTo(e),this.linkDragLayerItem.pathData.addPointLineTo(i.arrow2)}getPointShape(t){let e=CSystem.getAllChildControls(this.shapeLayer),i=this.controlElement.getBoundingClientRect();for(let s=e.length-1;s>=0;s--){let o=e[s];if(o instanceof CDiagramShape){let e=o.controlElement.getBoundingClientRect();if(t.x<=e.x+e.width&&t.x>=e.x&&t.y<=e.y+e.height&&t.y>=e.y)return{shape:o,offsetPoint:new CPoint(t.x-e.x,t.y-e.y),editorPoint:new CPoint(t.x-i.x,t.y-i.y),rect:new CRect(e.x-i.x,e.y-i.y,e.right-i.x,e.bottom-i.y)}}}}getAllShape(){let t=new Array,e=CSystem.getAllChildControls(this.shapeLayer);for(let i=0;i<e.length;i++)e[i]instanceof CDiagramShape&&t.push(e[i]);return t}deleteLink(t){t?this.doDeleteLink(t):this.arrowLayer.selectedArrow&&this.doDeleteLink(this.arrowLayer.selectedArrow)}selectedShapeList(){let t=[],e=this.getAllShape();for(let i=0;i<e.length;i++)e[i].selected&&t.push(e[i]);return t}}class CCustomResourcesList extends CPanel{constructor(){super(...arguments),this._resourceList=new Array,this._itemResource="",this.onChangeResource=new Array}get itemResource(){return this._itemResource}set itemResource(t){this._itemResource!=t&&(this._itemResource=t,this.doItemResource(t))}get resourceList(){return this._resourceList}doChangeResource(t,e,i,s){for(let o=0;o<this.onChangeResource.length;o++)this.onChangeResource[o](this,t,e,i,s)}doAddResource(t,e,i,s,o,a,n){let r=this.doCreateItem(t,e,i,s,o,a);if(!r)throw new Error("Not exists resource : "+e);return this._resourceList.push({resource:e,item:r.item,icon:r.icon,data:n}),this.doChangeResource("add",e,r.item,r.icon),r}doDeleteResource(t){for(let e=this._resourceList.length-1;e>=0;e--)if(t==this._resourceList[e].resource){this._resourceList.splice(e,1),this.doChangeResource("delete",t,this._resourceList[e].item,this._resourceList[e].icon),this._resourceList[e].item.remove();break}}doClear(){this._resourceList=[],this.doChangeResource("clear")}addResource(t,e,i,s,o,a,n,r){let l=this.doAddResource(t,e,i,s,o,a,n);return l&&r&&r(l.item,l.icon),l}deleteResource(t){this.doDeleteResource(t)}clear(){this.doClear()}}class CResourcesDragToolbar extends CCustomResourcesList{constructor(t,e){super(t,e),this.scrollbox=new CScrollBox(this),this.catchPropertyName=[];let i=this;this.scrollbox.onChangeSize=function(){i.scrollbox.contentWidth=i.scrollbox.position.width}}doToData(t){super.doToData(t),CDataClass.putData(t,"scrollbox",this.scrollbox.toData(),{},!0)}doFromData(t){super.doFromData(t),this.scrollbox.fromData(CDataClass.getData(t,"scrollbox",{},!0))}doItemResource(t){for(let e=0;e<this._resourceList.length;e++)this._resourceList[e].item.resource=t}doCreateItem(t,e,i,s,o,a){if(CSystem.resources.has(t)){let n=new CPanel(this.scrollbox.content);n.resource=this.itemResource;let r=new CPanel(n);r.resource=t,r.position.align=EPositionAlign.CENTER,o&&(r.position.width=o),a&&(r.position.height=a),r.hasPointerEvent=!1,n.position.width=i,n.position.height=s,n.dragIconResource=t,n.useDragAndDrop=!0,n.useDragAndDropCancel=!0,n.onDragStart=function(t,i){n.dragData={resource:e}};for(let t=0;t<this.catchPropertyName.length;t++)n.dragCatchControlPropertyNames.add(this.catchPropertyName[t]);return n.position.align=EPositionAlign.TOP,this.scrollbox.contentHeight+=s,{item:n,icon:r}}}}class CResourcesSelectToolbar extends CCustomResourcesList{get itemIndex(){return this.getItemIndex()}set itemIndex(t){if(!(this._resourceList.length>t))throw new Error("Invalid index : "+t);this._resourceList[t].item.selected=!0}constructor(t,e){super(t,e),this.scrollbox=new CScrollBox(this),this.catchPropertyName=[],this.onSelect=new Array;let i=this;this.scrollbox.onChangeSize=function(){i.scrollbox.contentWidth=i.scrollbox.position.width}}doToData(t){super.doToData(t),CDataClass.putData(t,"scrollbox",this.scrollbox.toData(),{},!0)}doFromData(t){super.doFromData(t),this.scrollbox.fromData(CDataClass.getData(t,"scrollbox",{},!0))}doItemResource(t){for(let e=0;e<this._resourceList.length;e++)this._resourceList[e].item.resource=t}doCreateItem(t,e,i,s,o,a){if(CSystem.resources.has(t)){let e=this,n=new CSelectGroupBox(this.scrollbox.content);n.resource=this.itemResource;let r=new CPanel(n);return r.resource=t,r.position.align=EPositionAlign.CENTER,o&&(r.position.width=o),a&&(r.position.height=a),r.hasPointerEvent=!1,n.position.width=i,n.position.height=s,n.groupName=this.name+".select",n.position.align=EPositionAlign.TOP,this.scrollbox.contentHeight+=s,n.onChangeSelected=function(){n.selected&&e.doSelect()},{item:n,icon:r}}}getItemIndex(){let t=-1;for(let e=0;e<this._resourceList.length;e++)if(this._resourceList[e].item.selected){t=e;break}return t}doSelect(){let t,e,i=-1;for(let s=0;s<this._resourceList.length;s++)if(this._resourceList[s].item.selected){i=s,t=this._resourceList[s].item,e=this._resourceList[s].data;break}for(let s=0;s<this.onSelect.length;s++)this.onSelect[s](this,i,t,e)}}class CGradientEditorModel extends CPanel{get gradient(){return this._gradient}set gradient(t){this._gradient=t,this.doSetGradient()}get buttonResource(){return this.buttonAddColor.resource}set buttonResource(t){this.buttonAddColor.resource=t,this.buttonDeleteColor.resource=t}get selectGroupBoxResource(){return this.buttonLinear.resource}set selectGroupBoxResource(t){this.buttonLinear.resource=t,this.buttonRadial.resource=t}get scrollbarResource(){return this.scrollStartRadius.resource}set scrollbarResource(t){this.scrollStartRadius.resource=t,this.scrollStopRadius.resource=t}get gradientBarResource(){return this.gradientBar.resource}set gradientBarResource(t){this.gradientBar.resource=t}get gradientAngleBoxResource(){return this.gradientAngleBox.resource}set gradientAngleBoxResource(t){this.gradientAngleBox.resource=t}get gradientAngleHandleResource(){return this.gradientAngleBox.handleResource}set gradientAngleHandleResource(t){this.gradientAngleBox.handleResource=t}get gradientBarHandleResource(){return this.gradientBar.handleResource}set gradientBarHandleResource(t){this.gradientBar.handleResource=t}get handleLength(){return this._handleLength}set handleLength(t){this._handleLength!=t&&(this._handleLength=t,this.doSetHandle())}constructor(t,e,i){super(t,e),this._gradient=new CGradient,this._handleLength=30,this.clientLayout=new CPanel(this),this.clientTopLayout=new CPanel(this.clientLayout),this.buttonAddColor=new CButton(this.clientTopLayout),this.buttonDeleteColor=new CButton(this.clientTopLayout),this.buttonRadial=new CSelectGroupBox(this.clientTopLayout),this.buttonLinear=new CSelectGroupBox(this.clientTopLayout),this.gradientAngleBox=new CMultiSlideBox(this.clientLayout),this.gradientBar=new CMultiSlideBox(this.clientLayout),this.rightLayout=new CPanel(this),this.scrollStartRadius=new CScrollbar(this.rightLayout),this.scrollStopRadius=new CScrollbar(this.rightLayout),this.grid=new CDataGrid(this.rightLayout),this.splitterR=new CSplitter(this);let s=this;this.colorSelector=new CColorSelectorModel(this.rightLayout),i&&(this.colorSelector.resource=i),this.gradientBar.onHandleTrack=function(t,e,i,o,a,n){s.doSetGradientBar()},this.gradientBar.onCreateHandle=function(t,e){e.onThisPointerDown=function(){s.doSetSelectHandle(e)}},this.gradientBar.onChangeSize=function(){s.doSetHandle(),s.doSetGradientBar()},this.startPointControl=this.gradientAngleBox.addHandle(this.gradientAngleHandleResource,-15,-15),this.startPointControl.data=0,this.stopPointControl=this.gradientAngleBox.addHandle(this.gradientAngleHandleResource,-15,-15),this.stopPointControl.data=1,this.gradientAngleBox.onHandleTrack=function(t,e,i,o,a,n){s.doSetGradientAngle()},this.gradientAngleBox.onChangeSize=function(){s.doSetHandle()},this.colorSelector.onChangeColor=function(){null!=s.__selectedHandle&&(s.__selectedHandle.data=s.colorSelector.color,s.__selectedHandle.layers.length>0&&s.__selectedHandle.layers.get(0).items.length>0&&(s.__selectedHandle.layers.get(0).items.get(0).fill.solidColor=s.colorSelector.color),s.doSetGradientBar())},this.buttonAddColor.onClick=function(){let t=s.addGradientPoint(0,"rgba(255,255,255,0.5)");s.doSetSelectHandle(t)},this.buttonDeleteColor.onClick=function(){if(null!=s.__selectedHandle){for(let t=0;t<s.gradientBar.slideHandles.length;t++)if(s.__selectedHandle==s.gradientBar.slideHandles.get(t)){s.gradientBar.deleteHandle(t);break}s.doSetGradientBar()}},this.buttonLinear.onClick=function(){s.doChangeGradientKind(EGradientKind.LINEAR)},this.buttonRadial.onClick=function(){s.doChangeGradientKind(EGradientKind.RADIAL)},this.buttonLinear.groupName=this.name+"gra",this.buttonRadial.groupName=this.name+"gra",this.scrollStartRadius.onChangeValue=function(){s.doSetGradientAngle()},this.scrollStopRadius.onChangeValue=function(){s.doSetGradientAngle()},this.grid.editable=!0,this.grid.editorShowSet.add(EEditorShowKind.DOUBLE_CLICK),this.grid.editorShowSet.add(EEditorShowKind.F2_KEY),this.grid.onEditorApply=function(t,e,i,o){let a=s.gradientBar.slideHandles.get(i);0==e?a.position.left=CCalc.crRange2Value(0,1,parseFloat(o),-s.handleLength/2,s.gradientBar.position.width-s.handleLength/2):a.data=o,s.doSetGradientBar()},this.doSetHandle()}doToData(t){super.doToData(t),CDataClass.putData(t,"clientLayout",this.clientLayout.toData(),{},!0),CDataClass.putData(t,"clientTopLayout",this.clientTopLayout.toData(),{},!0),CDataClass.putData(t,"buttonAddColor",this.buttonAddColor.toData(),{},!0),CDataClass.putData(t,"buttonDeleteColor",this.buttonDeleteColor.toData(),{},!0),CDataClass.putData(t,"buttonRadial",this.buttonRadial.toData(),{},!0),CDataClass.putData(t,"buttonLinear",this.buttonLinear.toData(),{},!0),CDataClass.putData(t,"gradientAngleBox",this.gradientAngleBox.toData(),{},!0),CDataClass.putData(t,"gradientBar",this.gradientBar.toData(),{},!0),CDataClass.putData(t,"rightLayout",this.rightLayout.toData(),{},!0),CDataClass.putData(t,"colorSelector",this.colorSelector.toData(),{},!0),CDataClass.putData(t,"scrollStartRadius",this.scrollStartRadius.toData(),{},!0),CDataClass.putData(t,"scrollStopRadius",this.scrollStopRadius.toData(),{},!0),CDataClass.putData(t,"grid",this.grid.toData(),{},!0),CDataClass.putData(t,"startPointControl",this.startPointControl.toData(),{},!0),CDataClass.putData(t,"stopPointControl",this.stopPointControl.toData(),{},!0),CDataClass.putData(t,"splitterR",this.splitterR.toData(),{},!0),CDataClass.putData(t,"gradient",this.gradient.toData(),{},!0),CDataClass.putData(t,"handleLength",this.handleLength,30)}doFromData(t){super.doFromData(t),this.clientLayout.fromData(CDataClass.getData(t,"clientLayout",{},!0)),this.clientTopLayout.fromData(CDataClass.getData(t,"clientTopLayout",{},!0)),this.buttonAddColor.fromData(CDataClass.getData(t,"buttonAddColor",{},!0)),this.buttonDeleteColor.fromData(CDataClass.getData(t,"buttonDeleteColor",{},!0)),this.buttonRadial.fromData(CDataClass.getData(t,"buttonRadial",{},!0)),this.buttonLinear.fromData(CDataClass.getData(t,"buttonLinear",{},!0)),this.gradientBar.fromData(CDataClass.getData(t,"gradientBar",{},!0)),this.gradientAngleBox.fromData(CDataClass.getData(t,"gradientAngleBox",{},!0)),this.rightLayout.fromData(CDataClass.getData(t,"rightLayout",{},!0)),this.colorSelector.fromData(CDataClass.getData(t,"colorSelector",{},!0)),this.scrollStartRadius.fromData(CDataClass.getData(t,"scrollStartRadius",{},!0)),this.scrollStopRadius.fromData(CDataClass.getData(t,"scrollStopRadius",{},!0)),this.grid.fromData(CDataClass.getData(t,"grid",{},!0)),this.startPointControl.fromData(CDataClass.getData(t,"startPointControl",{},!0)),this.stopPointControl.fromData(CDataClass.getData(t,"stopPointControl",{},!0)),this.splitterR.fromData(CDataClass.getData(t,"splitterR",{},!0)),this.handleLength=CDataClass.getData(t,"handleLength",30);let e=new CGradient;e.fromData(CDataClass.getData(t,"gradient",{},!0)),this.gradient=e}doChildDataMapHandle(t){super.doChildDataMapHandle(t),t.delete(this.clientLayout),t.delete(this.clientTopLayout),t.delete(this.buttonAddColor),t.delete(this.buttonDeleteColor),t.delete(this.buttonRadial),t.delete(this.buttonLinear),t.delete(this.gradientAngleBox),t.delete(this.gradientBar),t.delete(this.rightLayout),t.delete(this.colorSelector),t.delete(this.scrollStartRadius),t.delete(this.scrollStopRadius),t.delete(this.grid),t.delete(this.splitterR),t.delete(this.startPointControl),t.delete(this.stopPointControl)}doSetSelectHandle(t){this.__selectedHandle=t,"string"==typeof t.data&&(this.colorSelector.color=t.data),null!=this.onSetSelectHandle&&this.onSetSelectHandle(this,t)}doChangeGradientKind(t){t==EGradientKind.LINEAR?this.gradientAngleBox.layers.get(0).items.get(0).fill.gradientKind=EGradientKind.LINEAR:this.gradientAngleBox.layers.get(0).items.get(0).fill.gradientKind=EGradientKind.RADIAL,this.doSetGradientAngle(),null!=this.onChangeGradientKind&&this.onChangeGradientKind(this)}doSetHandle(){let t=this.handleLength/2;this.gradientBar.position.height=2*this.handleLength,this.gradientBar.position.margins.left=t,this.gradientBar.position.margins.right=t;for(let e=0;e<this.gradientBar.slideHandles.length;e++){let i=this.gradientBar.slideHandles.get(e);i.lockMoveY=!0,i.lockMinX=-t,i.lockMaxX=this.gradientBar.position.width-t,i.position.top=(this.gradientBar.position.height-i.position.height)/2,i.position.width=this.handleLength,i.position.height=this.handleLength,i.position.left>i.lockMaxX&&(i.position.left=i.lockMaxX),i.position.left<i.lockMinX&&(i.position.left=i.lockMinX),i.moveAreaLength=i.position.height}this.gradientAngleBox.position.margins.all=t;for(let e=0;e<this.gradientAngleBox.slideHandles.length;e++){let i=this.gradientAngleBox.slideHandles.get(e);i.lockMinX=-t,i.lockMinY=-t,i.lockMaxX=this.gradientAngleBox.position.width-t,i.lockMaxY=this.gradientAngleBox.position.height-t,i.position.width=this.handleLength,i.position.height=this.handleLength,i.position.left>i.lockMaxX&&(i.position.left=i.lockMaxX),i.position.top>i.lockMaxY&&(i.position.top=i.lockMaxY),i.position.left<i.lockMinX&&(i.position.left=i.lockMinX),i.position.top<i.lockMinY&&(i.position.top=i.lockMinY),i.moveAreaLength=i.position.height}null!=this.onSetHandle&&this.onSetHandle(this)}doSetGradientBar(){if(null==this.gradientBar.layers.getLayerFromName("background")){let t=this.gradientBar.layers.addLayer();t.addItem().fill.styleKind=EStyleKind.SOLID;let e=t.addItem();e.fill.styleKind=EStyleKind.SOLID,e.fill.solidColor="#e0e0e0",e.paintKind=EPaintKind.PATTERN,e.paintWidth=10,e.paintHeight=10,e.patternKind=EPatternKind.CHECK_HEAD,t.name="background",this.gradientBar.layers.addLayer()}1==this.gradientBar.layers.length&&this.gradientBar.layers.addLayer(),0==this.gradientBar.layers.get(1).items.length&&this.gradientBar.layers.get(1).items.addItem();let t=this.gradientBar.layers.get(1).items.get(0).fill;t.styleKind=EStyleKind.GRADIENT,t.stopPoint.x=1,t.stopPoint.y=0,t.pointList.clear();for(let e=0;e<this.gradientBar.slideHandles.length;e++){let i=this.gradientBar.slideHandles.get(e),s=i.position.left+i.position.width/2,o="white";null!=i.data&&"string"==typeof i.data&&(o=i.data,i.layers.length>0&&i.layers.get(0).items.length>0&&(i.layers.get(0).items.get(0).fill.solidColor=i.data));let a=new CGradientPoint(CCalc.crRange2Value(0,this.gradientBar.position.width,s,0,1),o);t.pointList.add(a)}this.grid.clear();for(let t=0;t<this.gradientBar.slideHandles.length;t++){let e=CCalc.crRange2Value(-this.handleLength/2,this.gradientBar.position.width-this.handleLength/2,this.gradientBar.slideHandles.get(t).position.left,0,1);this.grid.add({offset:e,data:this.gradientBar.slideHandles.get(t).data})}this.doSetGradientAngle(),null!=this.onSetGradientBar&&this.onSetGradientBar(this)}doSetGradientAngle(){if(this.gradientBar.layers.length>0&&this.gradientBar.layers.length>=2&&this.gradientBar.layers.get(1).items.length>0){let t=this.gradientBar.layers.get(1).items.get(0).fill;if(null==this.gradientAngleBox.layers.getLayerFromName("background")){let t=this.gradientAngleBox.layers.addLayer();t.addItem().fill.styleKind=EStyleKind.SOLID;let e=t.addItem();e.fill.styleKind=EStyleKind.SOLID,e.fill.solidColor="#e0e0e0",e.paintKind=EPaintKind.PATTERN,e.paintHeight=10,e.paintWidth=10,e.patternKind=EPatternKind.CHECK_HEAD,t.name="background",this.gradientAngleBox.layers.addLayer()}1==this.gradientAngleBox.layers.length&&this.gradientBar.layers.addLayer(),0==this.gradientAngleBox.layers.get(1).items.length&&this.gradientAngleBox.layers.get(1).items.addItem();let e=this.gradientAngleBox.layers.get(1).items.get(0).fill;e.fromData(t.toData()),this.buttonLinear.selected?e.gradientKind=EGradientKind.LINEAR:e.gradientKind=EGradientKind.RADIAL,e.startRadius=this.scrollStartRadius.value,e.stopRadius=this.scrollStopRadius.value,e.startPoint.x=CCalc.crRange2Value(0,this.gradientAngleBox.position.width,this.startPointControl.position.left+this.startPointControl.position.width/2,0,1),e.startPoint.y=CCalc.crRange2Value(0,this.gradientAngleBox.position.height,this.startPointControl.position.top+this.startPointControl.position.height/2,0,1),e.stopPoint.x=CCalc.crRange2Value(0,this.gradientAngleBox.position.width,this.stopPointControl.position.left+this.stopPointControl.position.width/2,0,1),e.stopPoint.y=CCalc.crRange2Value(0,this.gradientAngleBox.position.height,this.stopPointControl.position.top+this.stopPointControl.position.height/2,0,1);let i=e.toData();this.doFillData(i),this.gradient.fromData(i),null!=this.onSetGradientAngle&&this.onSetGradientAngle(this)}}doFillData(t){null!=this.onFillData&&this.onFillData(this,t)}doSetGradient(){if(this.gradientAngleBox.layers.length>1){let t=new CGradient;t.fromData(this.gradient.toData()),this.gradientBar.clearHandle();for(let e=0;e<t.pointList.length;e++)this.addGradientPoint(t.pointList.get(e).offset,t.pointList.get(e).color);this.gradientAngleBox.layers.get(1).items.get(0).fill.fromData(t.toData()),this.buttonLinear.selected=!1,this.buttonRadial.selected=!1,t.gradientKind==EGradientKind.LINEAR?this.buttonLinear.selected=!0:this.buttonRadial.selected=!0,this.startPointControl.position.left=CCalc.crRange2Value(0,1,t.startPoint.x,-this.handleLength/2,this.gradientAngleBox.position.width-this.handleLength/2),this.startPointControl.position.top=CCalc.crRange2Value(0,1,t.startPoint.y,-this.handleLength/2,this.gradientAngleBox.position.height-this.handleLength/2),this.stopPointControl.position.left=CCalc.crRange2Value(0,1,t.stopPoint.x,-this.handleLength/2,this.gradientAngleBox.position.width-this.handleLength/2),this.stopPointControl.position.top=CCalc.crRange2Value(0,1,t.stopPoint.y,-this.handleLength/2,this.gradientAngleBox.position.height-this.handleLength/2),this.scrollStartRadius.value=t.startRadius,this.scrollStopRadius.value=t.stopRadius,this.doSetGradientBar(),this.gradientBar.slideHandles.length>0&&this.doSetSelectHandle(this.gradientBar.slideHandles.get(0)),null!=this.onSetGradient&&this.onSetGradient(this)}}addGradientPoint(t,e){let i=this.gradientBar.addHandle(this.gradientBarHandleResource,CCalc.crRange2Value(0,1,t,0,this.gradientBar.position.width)-this._handleLength/2,(this.gradientBar.position.height-this._handleLength)/2,this.handleLength,this.handleLength);return i.data=e,console.log(i),i.layers.length>0&&i.layers.get(0).items.length>0&&(i.layers.get(0).items.get(0).fill.solidColor=e),this.doSetHandle(),this.doSetGradientBar(),i}addProperties(){let t=super.addProperties();return t.push({instance:this.buttonResource,propertyName:"buttonResource",readOnly:!1,enum:[]}),t.push({instance:this.selectGroupBoxResource,propertyName:"selectGroupBoxResource",readOnly:!1,enum:[]}),t.push({instance:this.scrollbarResource,propertyName:"scrollbarResource",readOnly:!1,enum:[]}),t.push({instance:this.gradientBarResource,propertyName:"gradientBarResource",readOnly:!1,enum:[]}),t.push({instance:this.gradientAngleBoxResource,propertyName:"gradientAngleBoxResource",readOnly:!1,enum:[]}),t.push({instance:this.gradientAngleHandleResource,propertyName:"gradientAngleHandleResource",readOnly:!1,enum:[]}),t.push({instance:this.gradientBarHandleResource,propertyName:"gradientBarHandleResource",readOnly:!1,enum:[]}),t}}class CShowMessageFrameModel extends CPanel{constructor(t,e){super(t,e),this.lblTitle=new CPanel(this),this.lblMessage=new CPanel(this),this.lblTitle.propertyName="lblTitle",this.lblMessage.propertyName="lblMessage"}doToData(t){super.doToData(t),CDataClass.putData(t,"lblTitle",this.lblTitle.toData(),{},!0),CDataClass.putData(t,"lblMessage",this.lblMessage.toData(),{},!0)}doFromData(t){super.doFromData(t),this.lblTitle.fromData(CDataClass.getData(t,"lblTitle",{},!0)),this.lblMessage.fromData(CDataClass.getData(t,"lblMessage",{},!0))}}class CShowMessage extends CShowMessageFrameModel{static showMessage(t,e,i,s){let o;o=s||CSystem.browserCovers.get("cover");let a=new CShowMessage(o);a.resource=t,a.position.align=EPositionAlign.CENTER,a.lblTitle.text=e,a.lblMessage.text=i,a.lblMessage.onClick=function(){o.hideCover()};let n=300,r=CStringUtil.getTextWidth(a.lblTitle.textSet,a.lblTitle.text)+10,l=CStringUtil.getTextWidth(a.lblMessage.textSet,a.lblMessage.text)+10;n=Math.max(n,r),n=Math.max(n,l);let h=100,d=CStringUtil.getTextHeight(a.lblMessage.textSet,a.lblMessage.text)+10+a.lblTitle.position.height+a.lblTitle.position.margins.top+a.lblTitle.position.margins.bottom;h=Math.max(h,d),a.position.width=n,a.position.height=h,o.showCover(!0,!0)}}class CWarningPageDesignModel extends CPage{constructor(t,e){super(t,e),this.caption=new CPanel(this),this.btnNew=new CButton(this.caption),this.btnClose=new CButton(this.caption),this.panMessage=new CPanel(this),this.lBottom=new CPanel(this),this.btnOk=new CButton(this.lBottom),this.caption.propertyName="caption",this.btnNew.propertyName="btnNew",this.btnClose.propertyName="btnClose",this.panMessage.propertyName="panMessage",this.lBottom.propertyName="lBottom",this.btnOk.propertyName="btnOk"}doFromData(t){super.doFromData(t)}doResource(){super.doResource()}doChangeSize(){super.doChangeSize()}doChildDataMapHandle(t){super.doChildDataMapHandle(t),t.delete(this.caption),t.delete(this.btnNew),t.delete(this.btnClose),t.delete(this.panMessage),t.delete(this.lBottom),t.delete(this.btnOk)}}class CWarningPage extends CWarningPageDesignModel{static async warning(t,e,i,s){return new Promise((function(o){let a=s;if(null==a&&(a=CSystem.browserCovers.get("cover")),a){let s=new CWarningPage(a);s.resource=t,s.caption.text=e,s.panMessage.text=i,s.position.align=EPositionAlign.CENTER,s.btnClose.onClick=function(){a.hideCover(),o(!1)},s.btnOk.onClick=function(){a.hideCover(),o(!0)};let n=300,r=CStringUtil.getTextWidth(s.btnOk.textSet,s.btnOk.text)+30,l=CStringUtil.getTextWidth(s.panMessage.textSet,s.panMessage.text)+30;n=Math.max(n,r),n=Math.max(n,l);let h=100,d=CStringUtil.getTextHeight(s.panMessage.textSet,s.panMessage.text)+10+s.caption.position.height+s.caption.position.margins.top+s.caption.position.margins.bottom+s.lBottom.position.height+s.lBottom.position.margins.top+s.lBottom.position.margins.bottom+s.position.padding.top+s.position.padding.bottom+50;h=Math.max(h,d),s.position.width=n,s.position.height=h,a.showCover(!1,!0)}else o(!1)}))}}class CConfirmMessageFrameModel extends CShowMessageFrameModel{constructor(t,e){super(t,e),this.lBottom=new CPanel(this),this.btnCancel=new CButton(this.lBottom),this.btnOk=new CButton(this.lBottom),this.lBottom.propertyName="lBottom",this.btnCancel.propertyName="btnCancel",this.btnOk.propertyName="btnOk"}doToData(t){super.doToData(t),CDataClass.putData(t,"lBottom",this.lBottom.toData(),{},!0),CDataClass.putData(t,"btnCancel",this.btnCancel.toData(),{},!0),CDataClass.putData(t,"btnOk",this.btnOk.toData(),{},!0)}doFromData(t){super.doFromData(t),this.lBottom.fromData(CDataClass.getData(t,"lBottom",{},!0)),this.btnCancel.fromData(CDataClass.getData(t,"btnCancel",{},!0)),this.btnOk.fromData(CDataClass.getData(t,"btnOk",{},!0))}}class CConfirmMessage extends CConfirmMessageFrameModel{static confirmSync(t,e,i,s,o){let a;a=o||CSystem.browserCovers.get("cover");let n=new CConfirmMessage(a);n.resource=t,n.position.align=EPositionAlign.CENTER,n.lblTitle.text=e,n.lblMessage.text=i,n.btnOk.onClick=function(){a.hideCover(),s()},n.btnCancel.onClick=function(){a.hideCover()};let r=300,l=CStringUtil.getTextWidth(n.lblTitle.textSet,n.lblTitle.text)+10,h=CStringUtil.getTextWidth(n.lblMessage.textSet,n.lblMessage.text)+10;r=Math.max(r,l),r=Math.max(r,h);let d=100,g=CStringUtil.getTextHeight(n.lblMessage.textSet,n.lblMessage.text)+10+n.lblTitle.position.height+n.lblTitle.position.margins.top+n.lblTitle.position.margins.bottom+n.lBottom.position.height+n.lBottom.position.margins.top+n.lBottom.position.margins.bottom;d=Math.max(d,g),n.position.width=r,n.position.height=d,a.showCover(!1,!0)}static async confirm(t,e,i,s){let o;o=s||CSystem.browserCovers.get("cover");let a=new CConfirmMessage(o);a.resource=t,a.position.align=EPositionAlign.CENTER,a.lblTitle.text=e,a.lblMessage.text=i;let n=300,r=CStringUtil.getTextWidth(a.lblTitle.textSet,a.lblTitle.text)+10,l=CStringUtil.getTextWidth(a.lblMessage.textSet,a.lblMessage.text)+10;n=Math.max(n,r),n=Math.max(n,l);let h=100,d=CStringUtil.getTextHeight(a.lblMessage.textSet,a.lblMessage.text)+10+a.lblTitle.position.height+a.lblTitle.position.margins.top+a.lblTitle.position.margins.bottom+a.lBottom.position.height+a.lBottom.position.margins.top+a.lBottom.position.margins.bottom;return h=Math.max(h,d),a.position.width=n,a.position.height=h,o.showCover(!1,!0),new Promise((function(t){a.btnOk.onClick=function(){o.hideCover(),t(!0)},a.btnCancel.onClick=function(){o.hideCover(),t(!1)}}))}}class CPromptFrameModel extends CPanel{constructor(t,e){super(t,e),this.textBoxResource="",this.labelResource="",this.comboResource="",this.lblTitle=new CPanel(this),this.lClient=new CPanel(this),this.lBottom=new CPanel(this),this.btnCancel=new CButton(this.lBottom),this.btnOk=new CButton(this.lBottom),this.lblTitle.propertyName="lblTitle",this.lClient.propertyName="lClient",this.lBottom.propertyName="lBottom",this.btnCancel.propertyName="btnCancel",this.btnOk.propertyName="btnOk"}doToData(t){super.doToData(t),CDataClass.putData(t,"textBoxResource",this.textBoxResource,""),CDataClass.putData(t,"labelResource",this.labelResource,""),CDataClass.putData(t,"comboResource",this.comboResource,""),CDataClass.putData(t,"lblTitle",this.lblTitle.toData(),{},!0),CDataClass.putData(t,"lClient",this.lClient.toData(),{},!0),CDataClass.putData(t,"lBottom",this.lBottom.toData(),{},!0),CDataClass.putData(t,"btnCancel",this.btnCancel.toData(),{},!0),CDataClass.putData(t,"btnOk",this.btnOk.toData(),{},!0)}doFromData(t){super.doFromData(t),this.textBoxResource=CDataClass.getData(t,"textBoxResource",""),this.labelResource=CDataClass.getData(t,"labelResource",""),this.comboResource=CDataClass.getData(t,"comboResource",""),this.lblTitle.fromData(CDataClass.getData(t,"lblTitle",{},!0)),this.lClient.fromData(CDataClass.getData(t,"lClient",{},!0)),this.lBottom.fromData(CDataClass.getData(t,"lBottom",{},!0)),this.btnCancel.fromData(CDataClass.getData(t,"btnCancel",{},!0)),this.btnOk.fromData(CDataClass.getData(t,"btnOk",{},!0))}}class CPromptMessage extends CPromptFrameModel{constructor(){super(...arguments),this.controlList=[]}static createBox(t,e,i,s=30,o=100,a=300,n=5){i.position.width=a,i.position.height=i.position.padding.top+i.position.padding.bottom+i.lblTitle.position.height+i.lblTitle.position.margins.top+i.lblTitle.position.margins.bottom+i.lClient.position.margins.top+i.lClient.position.margins.bottom+i.lClient.position.padding.top+i.lClient.position.padding.bottom+i.lBottom.position.height+i.lBottom.position.margins.top+i.lBottom.position.margins.bottom+s*t.length+n*(t.length-1),i.controlList=[];for(let a=0;a<t.length;a++){let r=new CPanel(i.lClient);r.position.align=EPositionAlign.TOP,r.position.margins.bottom=n,r.position.height=s;let l=new CPanel(r);l.resource=i.labelResource,l.position.width=o,l.position.align=EPositionAlign.LEFT,l.text=t[a];let h=e[a];if(h instanceof Array){let t=new CComboBox(r);t.resource=i.comboResource,t.position.align=EPositionAlign.CLIENT;for(let e=0;e<h.length;e++)t.items.add(h[e]);t.itemIndex=0,i.controlList.push(t)}else{let t=new CTextBox(r);t.resource=i.textBoxResource,t.position.align=EPositionAlign.CLIENT,e.length>a&&(t.text=h),i.controlList.push(t)}}}static promptSync(t,e,i,s,o,a=[],n=30,r=100,l=300,h=5){let d;d=o||CSystem.browserCovers.get("cover");let g=new CPromptMessage(d);g.resource=t,g.position.align=EPositionAlign.CENTER,g.lblTitle.text=e,d.showCover(!1,!0),this.createBox(i,a,g,n,r,l,h),g.btnOk.onClick=function(){let t=new Array;for(let e=0;e<g.controlList.length;e++)t.push(g.controlList[e].text);d.hideCover(),s(t)},g.btnCancel.onClick=function(){d.hideCover()}}static async prompt(t,e,i,s,o=[],a=30,n=100,r=300,l=5){let h,d=this;h=s||CSystem.browserCovers.get("cover");let g=new CPromptMessage(h);return g.resource=t,g.position.align=EPositionAlign.CENTER,g.lblTitle.text=e,h.showCover(!1,!0),new Promise((function(t){d.createBox(i,o,g,a,n,r,l),g.btnOk.onClick=function(){let e=new Array;for(let t=0;t<g.controlList.length;t++)e.push(g.controlList[t].text);h.hideCover(),t(e)},g.btnCancel.onClick=function(){h.hideCover(),t([])}}))}}class CWindowBlue extends CWindowModel{constructor(t,e){super(t,e),this.resource="window_blue.frame"}}class CWindowTool extends CWindowModel{constructor(t,e){super(t,e),this.resource="window_sky_dialog.frame"}}class CWindowChildTool extends CWindowModel{constructor(t,e){super(t,e),this.resource="chiled_window_20_dialog.frame"}}class CPaper extends CSelectArea{constructor(){super(...arguments),this._useDraw=!0}get useDraw(){return this._useDraw}set useDraw(t){this._useDraw=t}doThisPointerMove(t,e){super.doThisPointerMove(t,e)}doPenDraw(t){super.doPenDraw(t)}}class CIcon extends CPanel{constructor(t,e){super(t,e),this.linkClassName="",this.useMove=!0,this.moveAreaLength=-1,this.useResize=!1,this.resizeAreaLength=0,this.usePointerCapture=!0,this.useMoveClick=!0}doResource(){super.doResource(),this.useMove=!0,this.moveAreaLength=-1,this.useResize=!1,this.resizeAreaLength=0,this.usePointerCapture=!0,this.useMoveClick=!0}doFromData(t){super.doFromData(t),this.useMove=!0,this.moveAreaLength=-1,this.useResize=!1,this.resizeAreaLength=0,this.usePointerCapture=!0,this.useMoveClick=!0}doThisPointerDown(t,e){if(!this.selected){if(null!=this.parent&&this.parent instanceof CICons){let t=this.parent.getSelectedIcons();for(let e=0;e<t.length;e++)t[e].selected=!1}this.selected=!0}super.doThisPointerDown(t,e)}doMove(t){if(super.doMove(t),null!=this.parent&&this.parent instanceof CICons){let t=this.parent.getSelectedIcons();for(let e=0;e<t.length;e++)t[e]!=this&&(t[e].position.left+=this.position.left-this.__preMovePoint.x,t[e].position.top+=this.position.top-this.__preMovePoint.y)}}doClick(t){super.doClick(t);let e=new Function("return new "+this.linkClassName+"()")();e.desktop=CSystem.desktopList.get(0),e.data=this.data,e instanceof CWindowApplication&&(e.mainWindow.icon.fromData(this.toData()),e.mainWindow.icon.transform.scale=1,e.mainWindow.icon.position.left=0,e.mainWindow.icon.position.top=0,e.mainWindow.icon.position.width=25,e.mainWindow.icon.position.height=25),e.execute()}}class CTaskbarIcon extends CIcon{get seq(){return this._seq}set seq(t){this._seq!=t&&(this._seq=t,null!=this.taskbar&&this.taskbar.doChangeTaskbarIconSeq(this))}constructor(t,e){super(t,e),this._seq=-1,this.lockMoveY=!0}doResource(){super.doResource(),this.lockMoveY=!0}doRemove(){this.taskbar=void 0,this.data=void 0,super.doRemove()}}class CICons extends CPaper{doSelectArea(t,e){super.doSelectArea(t,e);let i=this.getIcons(),s=new CRect(t.x,t.y,e.x,e.y);for(let t=0;t<i.length;t++){let e=new CRect(i[t].position.left,i[t].position.top,i[t].position.left+i[t].position.width,i[t].position.top+i[t].position.height);i[t].selected=s.isIntersection(e)}}doKeyDown(t){if(super.doKeyDown(t),t.ctrlKey&&"A"==t.key.toUpperCase()){let t=this.getIcons();for(let e=0;e<t.length;e++)t[e].selected=!0}}getIcons(){let t=new Array,e=CSystem.getChildControls(this);for(let i=0;i<e.length;i++)e[i]instanceof CIcon&&t.push(e[i]);return t}getSelectedIcons(){let t=new Array,e=CSystem.getChildControls(this);for(let i=0;i<e.length;i++)e[i]instanceof CIcon&&e[i].selected&&t.push(e[i]);return t}alignIcons(t,e,i,s){if("force"==t){let t=this.getIcons(),o=i,a=i;if("right"==s)for(let s=0;s<t.length;s++)o+e>window.innerWidth&&(o=i,a+=e+i),t[s].position.left=o,t[s].position.top=a,o+=e+i;else for(let s=0;s<t.length;s++)a+e>window.innerHeight&&(a=i,o+=e+i),t[s].position.left=o,t[s].position.top=a,a+=e+i}else{let t=new Set,o=this.getIcons();for(let a=0;a<o.length;a++){let n=Math.floor(o[a].position.left/(e+i)),r=n*(e+i);n=Math.floor(o[a].position.top/(e+i));let l=n*(e+i);for(;;){if(!t.has(r+","+l)){t.add(r+","+l),o[a].position.left=r+i,o[a].position.top=l+i;break}"right"==s?(r+=e+i,r+e>window.innerWidth&&(r=i,l+=e+i)):(l+=e+i,l+e>window.innerHeight&&(l=i,r+=e+i))}}}}}class CApplication extends CDataClass{static async doBeforeExecute(t){let e={result:!0,message:""};for(let i=0;i<this.onBeforeExecute.length;i++){let s=await this.onBeforeExecute[i](t);s.result||(e=s)}return e}static async doAfterExecute(t){for(let e=0;e<this.onAfterExecute.length;e++)await this.onAfterExecute[e](t)}static async doBeforeTerminate(t){for(let e=0;e<this.onBeforeTerminate.length;e++)await this.onBeforeTerminate[e](t)}static async doAfterTerminate(t){for(let e=0;e<this.onAfterTerminate.length;e++)await this.onAfterTerminate[e](t)}static async doRejectExecute(t,e){for(let i=0;i<this.onRejectExecute.length;i++)await this.onRejectExecute[i](t,e)}static addSystemIcon(t,e,i=!1){CApplication.systemIcon.set(t,e),i?CTaskbar.fixListRight.add(t):CTaskbar.fixListLeft.add(t)}get applicationId(){return this._applicationId}constructor(){super(),this._applicationId=CSequence.getSequence(this.className)}doRemove(){super.doRemove(),this.desktop=void 0}doExecute(){CApplication.applications.set(this.applicationId,this)}doTerminate(){CApplication.applications.delete(this.applicationId),this.remove()}doToData(t){}doFromData(t){}async execute(){let t=await CApplication.doBeforeExecute(this);t.result?(this.doExecute(),await CApplication.doAfterExecute(this)):(await CApplication.doRejectExecute(t,this),this.remove())}async terminate(){await CApplication.doBeforeTerminate(this),this.doTerminate(),await CApplication.doAfterTerminate(this)}}CApplication.systemIcon=new Map,CApplication.applications=new Map,CApplication.onBeforeExecute=new Array,CApplication.onAfterExecute=new Array,CApplication.onBeforeTerminate=new Array,CApplication.onAfterTerminate=new Array,CApplication.onRejectExecute=new Array;class CCoverApplication extends CApplication{constructor(){super(),this.defaultWidth=1e3,this.defaultHeight=600,this.appName=""}doExecute(){if(super.doExecute(),null!=this.desktop&&null!=this.desktop.cover){let t=this;this.desktop.cover.onHide=function(){null!=t.desktop&&null!=t.desktop.cover&&t.doCoverHide(t.desktop.cover)},this.doCoverShow(this.desktop.cover)}else this.terminate()}doCoverShow(t){t.showCover()}doCoverHide(t){}}class CCustomWindowApplication extends CApplication{get mainWindow(){return this._mainWindow}constructor(t){super(),this.appName="";let e=this;this._mainWindow=new CWindowModel(void 0,this.applicationId),this._mainWindow.resource=t,this._mainWindow.closeAction="hide",this._mainWindow.onHide=function(){e.doWindowClose()},this.defaultHeight=600,this.defaultWidth=1e3}doRemove(){this._mainWindow.remove(),super.doRemove()}doExecute(){super.doExecute(),null!=this.desktop&&(this.mainWindow.parent=this.desktop.applicationLayer,this.mainWindow.showCenter(this.defaultWidth,this.defaultHeight,this.appName,"hide"),this.onShow&&this.onShow(this))}doWindowClose(){this.terminate(),null!=this.onWindowClose&&this.onWindowClose(this)}}class CWindowApplication extends CCustomWindowApplication{constructor(){super("window_blue.frame")}}class CToolWindowApplication extends CCustomWindowApplication{constructor(){super("window/blueTool.frame")}}class CTaskbar extends CPanel{get iconLength(){return this._iconLength}set iconLength(t){this._iconLength!=t&&(this._iconLength=t,this.doChangeIconLengthMargin())}get iconMargin(){return this._iconMargin}set iconMargin(t){this._iconMargin!=t&&(this._iconMargin=t,this.doChangeIconLengthMargin())}constructor(t,e){super(t,e),this._iconLength=50,this._iconMargin=10,this.iconsLeft=new CList,this.iconsRight=new CList;let i=this;CSystem.onResourceLoad.push((function(){i.init()}))}doToData(t){super.doToData(t),CDataClass.putData(t,"iconLength",this.iconLength,50),CDataClass.putData(t,"iconMargin",this.iconMargin,10)}doFromData(t){super.doFromData(t),this.iconLength=CDataClass.getData(t,"iconLength",50),this.iconMargin=CDataClass.getData(t,"iconMargin",10)}doRemove(){super.doRemove(),this.desktop=void 0}doChangeSize(){super.doChangeSize(),this.doSetIconsPosition()}doNotifyAppsChange(){}doChangeTaskbarIconSeq(t){let e=t.seq*(this.iconLength+this.iconMargin)+this.iconMargin;t.position.left=e,t.position.top=this.position.height-this.iconLength-this.iconMargin}doChangeIconLengthMargin(){this.doSetIconsPosition()}doSetIconsPosition(){for(let t=0;t<this.iconsLeft.length;t++){let e=t*(this.iconLength+this.iconMargin)+this.iconMargin;this.iconsLeft.get(t).position.left=e,this.iconsLeft.get(t).position.top=(this.position.height-this.iconLength)/2,this.iconsLeft.get(t).position.width=this.iconLength,this.iconsLeft.get(t).position.height=this.iconLength}for(let t=0;t<this.iconsRight.length;t++){let e=this.position.width-(t+1)*(this.iconLength+this.iconMargin);this.iconsRight.get(t).position.left=e,this.iconsRight.get(t).position.top=(this.position.height-this.iconLength)/2,this.iconsRight.get(t).position.width=this.iconLength,this.iconsRight.get(t).position.height=this.iconLength}}doCreateIcons(){function t(t){let e=CApplication.systemIcon.get(t.linkClassName);null!=e?CSystem.resources.has(e)?t.resource=e:(t.resource="empty_icon_button.control",t.text=e):(t.resource="empty_icon_button.control",t.text=t.linkClassName)}for(let e=0;e<CTaskbar.fixListLeft.length;e++){let i=new CTaskbarIcon(this);i.linkClassName=CTaskbar.fixListLeft.get(e),t(i),i.taskbar=this,i.seq=e,i.useMove=!1,i.useMoveClick=!1,this.iconsLeft.add(i)}for(let e=0;e<CTaskbar.fixListRight.length;e++){let i=new CTaskbarIcon(this);i.linkClassName=CTaskbar.fixListRight.get(e),t(i),i.taskbar=this,i.seq=e,i.useMove=!1,this.iconsRight.add(i)}}init(){this.doCreateIcons(),this.doSetIconsPosition()}}CTaskbar.fixListLeft=new CList,CTaskbar.fixListRight=new CList,CTaskbar.systemTaskbars=new CList;class CDesktop extends CICons{get backgroundImageSrc(){return this._backgroundImageSrc}set backgroundImageSrc(t){if(this._backgroundImageSrc!=t){this._backgroundImageSrc=t;let e=this.layers.getCanvasItems("backgroundImage");for(let i=0;i<e.length;i++)e[i].imageSrc=t}}constructor(t,e){super(t,e),this.backgroundLayer=new CAnimationControl(this),this.iconLayer=new CPanel(this),this.gadgetLayer=new CPanel(this),this.clock=new CClock(this.gadgetLayer),this.applicationLayer=new CPanel(this),this.frontLayer=new CPanel(this),this.cover=new CCover(this),this.menu=new CPanel(this),this.popupDesktop=new CPopup,this.popupTaskbar=new CPopup,this.popupTaskbarIcon=new CPopup,this.popupIcon=new CPopup,this.taskbar=new CTaskbar(this),this._backgroundImageSrc="",this.taskbar.desktop=this,this.iconLayer.position.align=EPositionAlign.CLIENT,this.gadgetLayer.position.align=EPositionAlign.CLIENT,this.applicationLayer.position.align=EPositionAlign.CLIENT,this.frontLayer.position.align=EPositionAlign.CLIENT,this.backgroundLayer.position.align=EPositionAlign.CLIENT,this.clock.on()}doResource(){super.doResource(),this.iconLayer.position.align=EPositionAlign.CLIENT,this.gadgetLayer.position.align=EPositionAlign.CLIENT,this.applicationLayer.position.align=EPositionAlign.CLIENT,this.frontLayer.position.align=EPositionAlign.CLIENT,this.backgroundLayer.position.align=EPositionAlign.CLIENT,this.applicationLayer.transform.translateZ=0,CSystem.setDesktopSize(CSystem.desktopAlignKind)}doToData(t){super.doToData(t),CDataClass.putData(t,"taskbar",this.taskbar.toData(),{},!0),CDataClass.putData(t,"menu",this.menu.toData(),{},!0),CDataClass.putData(t,"popupDesktop",this.popupDesktop.toData(),{},!0),CDataClass.putData(t,"popupTaskbar",this.popupTaskbar.toData(),{},!0),CDataClass.putData(t,"popupTaskbarIcon",this.popupTaskbarIcon.toData(),{},!0),CDataClass.putData(t,"popupIcon",this.popupIcon.toData(),{},!0),CDataClass.putData(t,"iconLayer",this.iconLayer.toData(),{},!0),CDataClass.putData(t,"backgroundLayer",this.backgroundLayer.toData(),{},!0),CDataClass.putData(t,"gadgetLayer",this.gadgetLayer.toData(),{},!0),CDataClass.putData(t,"clock",this.clock.toData(),{},!0),CDataClass.putData(t,"applicationLayer",this.applicationLayer.toData(),{},!0),CDataClass.putData(t,"frontLayer",this.frontLayer.toData(),{},!0),CDataClass.putData(t,"cover",this.cover.toData(),{},!0)}doFromData(t){super.doFromData(t),this.taskbar.fromData(CDataClass.getData(t,"taskbar",{},!0)),this.menu.fromData(CDataClass.getData(t,"menu",{},!0)),this.popupDesktop.fromData(CDataClass.getData(t,"popupDesktop",{},!0)),this.popupTaskbar.fromData(CDataClass.getData(t,"popupTaskbar",{},!0)),this.popupTaskbarIcon.fromData(CDataClass.getData(t,"popupTaskbarIcon",{},!0)),this.popupIcon.fromData(CDataClass.getData(t,"popupIcon",{},!0)),this.iconLayer.fromData(CDataClass.getData(t,"iconLayer",{},!0)),this.backgroundLayer.fromData(CDataClass.getData(t,"backgroundLayer",{},!0)),this.gadgetLayer.fromData(CDataClass.getData(t,"gadgetLayer",{},!0)),this.clock.fromData(CDataClass.getData(t,"clock",{},!0)),this.applicationLayer.fromData(CDataClass.getData(t,"applicationLayer",{},!0)),this.frontLayer.fromData(CDataClass.getData(t,"frontLayer",{},!0)),this.cover.fromData(CDataClass.getData(t,"cover",{},!0)),this.iconLayer.position.align=EPositionAlign.CLIENT,this.gadgetLayer.position.align=EPositionAlign.CLIENT,this.applicationLayer.position.align=EPositionAlign.CLIENT,this.frontLayer.position.align=EPositionAlign.CLIENT,this.backgroundLayer.position.align=EPositionAlign.CLIENT,this.applicationLayer.transform.translateZ=0}doChangeSize(){super.doChangeSize(),this.cover.position.width=this.position.width,this.cover.position.height=this.position.height}alignIcons(t,e,i,s){if("force"==t){let t=this.getIcons(),o=i,a=i;if("right"==s)for(let s=0;s<t.length;s++)o+e>window.innerWidth&&(o=i,a+=e+i),t[s].position.left=o,t[s].position.top=a,o+=e+i;else for(let s=0;s<t.length;s++)a+e>window.innerHeight-this.taskbar.position.height&&(a=i,o+=e+i),t[s].position.left=o,t[s].position.top=a,a+=e+i}else{let t=new Set,o=this.getIcons();for(let a=0;a<o.length;a++){let n=Math.floor(o[a].position.left/(e+i)),r=n*(e+i);n=Math.floor(o[a].position.top/(e+i));let l=n*(e+i);for(;;){if(!t.has(r+","+l)){t.add(r+","+l),o[a].position.left=r+i,o[a].position.top=l+i;break}"right"==s?(r+=e+i,r+e>window.innerWidth&&(r=i,l+=e+i)):(l+=e+i,l+e>window.innerHeight-this.taskbar.position.height&&(l=i,r+=e+i))}}}}static newDesktopCover(t){let e=new CCover(document.body),i=e.addLayer().addItem();return i.fill.styleKind=EStyleKind.SOLID,i.fill.solidColor="rgba(0,0,0,0.8)",e.showAnimationTrigger=new CAnimator(e,["line_10000.graph"]),e.showAnimationTrigger.addAnimationGraphProperty("opacity","line_10000.graph",0,1),CSystem.desktopList.length>0&&(e.showAnimationTrigger.onGraphAnimate=function(t,e,i,s,o,a){CSystem.desktopList.get(0).filter.blurValue=10*a}),e.hideAnimationTrigger=new CAnimator(e,["line_10000.graph"]),e.hideAnimationTrigger.addAnimationGraphProperty("opacity","line_10000.graph",1,0),CSystem.desktopList.length&&(e.hideAnimationTrigger.onGraphAnimate=function(t,e,i,s,o,a){CSystem.desktopList.get(0).filter.blurValue=10-10*a}),e.position.left=0,e.position.top=0,e.position.width=window.innerWidth,e.position.height=window.innerHeight,CSystem.browserCovers.set(t,e),e}}class CDialog{static getNewDialogCover(t){let e=CSequence.getSequence("dialogCover"),i=CDesktop.newDesktopCover(CSequence.getSequence("dialogCover"));t.parent=i,t.position.align=EPositionAlign.MIDDLETOP;let s=-t.position.height;return t.transform.translateY=s,t.filter.filterSet.shadow=!0,t.filter.shadowX=0,t.filter.shadowY=0,t.filter.shadowColor="rgba(0,0,127,0.5)",t.filter.shadowBlur=20,i.onBeforeHide=function(){CAnimation.animate(200,(function(e,i,o){t.transform.translateY=CCalc.crRange2Value(0,1,i,0,s),CSystem.clientBody.filter.blurValue=CCalc.crRange2Value(0,1,i,5,0)}),void 0,void 0,void 0,void 0,(function(){t.remove()}))},i.onHide=function(){i.remove(),CSystem.browserCovers.delete(e)},i.onClick=function(){i.hideCover()},i.showCover(!1,!1),CAnimation.animate(200,(function(e,i,o){t.transform.translateY=CCalc.crRange2Value(0,1,i,s,0),CSystem.clientBody.filter.blurValue=CCalc.crRange2Value(0,1,i,0,5)})),i}}class CAppFrame extends CPanel{}class CControls extends CTableData{constructor(){super(["control","id","element","className","controlNamePath","name"],["control","id","element","className","controlNamePath","name"],["object","id","controlNamePath"])}findControls(t){let e=new Array,i=this.find(t);for(let t=0;t<i.length;t++)e.push({control:i[t].get(0).asObject,id:i[t].get(1).asString,element:i[t].get(2).asObject,className:i[t].get(3).asString,controlNamePath:i[t].get(4).asString,name:i[t].get(5).asString});return e}addControl(t){CSystem.controls.add([t,t.id,t.controlElement,t.className,t.getNamPath(),t.name]),window[t.name]=t}deleteControl(t){let e=this.findIndexRow("control",t);this.delete(e),delete window[t.name]}getControlFromElement(t){let e=CSystem.controls.findControls([{columnName:"element",value:t}]);return e.length>0?e[0].control:void 0}getControlFromId(t){let e=CSystem.controls.findControls([{columnName:"id",value:t}]);return e.length>0?e[0].control:void 0}}class CSystem{static doAnimationFrame(t,e){try{CSystem.isDraw&&CSystem.doRequestLayersDraw();for(let i=0;i<CSystem.onAnimationFrame.length;i++)CSystem.onAnimationFrame[i](t,e)}catch(t){console.log("do animation frame error",t)}}static doRequestLayersDraw(){CSystem.requestDraw.size>0&&(CSystem.requestDraw.forEach((function(t){try{t.doDraw()}catch(t){console.log("layer draw error",t)}})),CSystem.requestDraw.clear())}static doResourceLoad(){for(let t=0;t<CSystem.requestResources.length;t++)CSystem.requestResources[t].doResource();CSystem.requestResources=[];for(let t=0;t<CSystem.onResourceLoad.length;t++)CSystem.onResourceLoad[t]()}static doGlobalPointerDown(t){let e=t.target;CSystem.hidePickups(e),CSystem.points.set(t.pointerId,t);for(let e=0;e<CSystem.onPointerDown.length;e++)CSystem.onPointerDown[e](t)}static doGlobalPointerMove(t){for(let e=0;e<CSystem.onPointerMove.length;e++)CSystem.onPointerMove[e](t)}static doGlobalPointerUp(t){for(let e=0;e<CSystem.onPointerUp.length;e++)CSystem.onPointerUp[e](t);CSystem.points.delete(t.pointerId)}static doGlobalPointerCancel(t){for(let e=0;e<CSystem.onPointerCancel.length;e++)CSystem.onPointerCancel[e](t);CSystem.points.delete(t.pointerId)}static hidePickups(t){let e=new Set,i=CSystem.controls.findControls([{columnName:"className",value:"CPickupControl"}]),s=CSystem.controls.findControls([{columnName:"className",value:"CPopup"}]);for(let t=0;t<s.length;t++)i.push(s[t]);for(let t=0;t<i.length;t++)e.add(i[t].control);if(0==e.size)return;let o,a=CSystem.controls.getControlFromElement(t),n=t;for(;null!=n;){if("CONTROL"==n.tagName){let t=CSystem.controls.getControlFromElement(n);if(t instanceof CPickupControl){o=t;break}}n=n.parentElement}e.forEach((function(t){null!=o?t!=o&&t.hide():null!=a&&t.ignoreControls.has(a)||t.hide()}))}static getOverControls(t,e){let i=new Array;for(let s=0;s<CSystem.controls.length;s++){let o=CSystem.controls.getRow(s).get(0).asObject,a=o.getElementBounds(),n=0,r=0,l=a.left<=t.pageX&&a.right>=t.pageX&&a.top<=t.pageY&&a.bottom>=t.pageY;l&&(n=t.pageX-a.left,r=t.pageY-a.top);let h=!1;for(let t=0;t<e.length;t++)a.left<=e.get(t).point.pageX&&a.right>=e.get(t).point.pageX&&a.top<=e.get(t).point.pageY&&a.bottom>=e.get(t).point.pageY&&(h=!0,n=e.get(t).point.pageX-a.left,r=e.get(t).point.pageY-a.top);(l||h)&&i.push({control:o,x:n,y:r})}return i}static getControl(t){if(t instanceof HTMLElement){let e=this.controls.findIndex(2,t);if(e.length>0)return e[0].get(0).asObject}else{let e=this.controls.findIndex(1,t);if(e.length>0)return e[0].get(0).asObject}}static getControlsFromClassName(t){let e=new Array,i=CSystem.controls.findIndex(3,t);for(let t=0;t<i.length;t++)e.push(i[t].get(0).asObject);return e}static getControlsFromName(t){let e=new Array,i=CSystem.controls.findIndex(4,t);for(let t=0;t<i.length;t++)e.push(i[t].get(0).asObject);return e}static getBroControls(t){let e=new Array,i=t.parent;if(null!=i)for(let t=0;t<i.controlElement.children.length;t++){let s=i.controlElement.children[t];if("CONTROL"==s.tagName){let t=this.getControl(s);e.push(t)}}else if(null!=t.controlElement.parentElement)for(let i=0;i<t.controlElement.parentElement.children.length;i++){let s=t.controlElement.parentElement.children[i];if("CONTROL"==s.tagName){let t=this.getControl(s);e.push(t)}}return e}static getBroVisiblePositions(t){let e=new Array,i=CSystem.getBroControls(t);for(let t=0;t<i.length;t++)i[t].visible&&e.push(i[t].position);return e}static getChildControls(t){let e=new Array;for(let i=0;i<t.controlElement.children.length;i++){let s=t.controlElement.children[i];if("CONTROL"==s.tagName){let t=this.getControl(s);e.push(t)}}return e}static getAllChildControls(t){let e=new Array;function i(t,e){e.push(t);let s=CSystem.getChildControls(t);for(let t=0;t<s.length;t++)i(s[t],e)}let s=CSystem.getChildControls(t);for(let t=0;t<s.length;t++)i(s[t],e);return e}static findControls(t){let e=new Array;for(let i=0;i<t.children.length;i++){let s=t.children[i];if("CONTROL"==s.tagName){let t=this.getControl(s);e.push(t)}}return e}static scriptExec(t){let e=document.getElementsByTagName("head")[0],i=document.createElement("script");i.innerText=t,e.appendChild(i)}static styleLoad(t){let e=document.getElementsByTagName("head")[0],i=document.createElement("style");i.innerText=t,e.appendChild(i)}static showBrowserCover(t,e,i=!0){let s=CSystem.browserCovers.get(t);null!=s&&(null!=e&&e(s),s.bringToFront(),s.position.left=0,s.position.top=0,s.position.width=window.innerWidth,s.position.height=window.innerHeight,s.showCover(i))}static hideBrowserCover(t){let e=CSystem.browserCovers.get(t);null!=e&&e.hideCover()}static getZPlus(){return CSystem.zPlus++,this.zPlus}static getZMinus(){return CSystem.zMinus--,CSystem.zMinus}static elementSendToBack(t){if(null!=t.parentElement){let e=t.parentElement;e.removeChild(t),e.prepend(t)}}static elementBrintToFront(t){if(null!=t.parentElement){let e=t.parentElement;e.removeChild(t),e.appendChild(t)}}static controlElementUp(t){let e=t.controlElement.previousElementSibling,i=t.controlElement.parentNode;e&&i&&i.insertBefore(t.controlElement,e)}static controlElementDown(t){let e=t.controlElement.nextElementSibling,i=t.controlElement.parentNode;e&&i&&i.insertBefore(t.controlElement,e.nextElementSibling)}static elementUp(t){let e=t.previousElementSibling,i=t.parentNode;e&&i&&i.insertBefore(t,e)}static elementDown(t){let e=t.nextElementSibling,i=t.parentNode;e&&i&&i.insertBefore(t,e.nextElementSibling)}static async setClipboard(t){await navigator.clipboard.writeText(t)}static async getClipboard(){return await navigator.clipboard.readText()}static init(t){let e=CSystem.resources.get(t);if(null!=e.init){return new Function(e.init)()}}static setToArray(t){let e=new Array;return t.forEach((function(t){e.push(t)})),e}static setFromArray(t,e){t.clear();for(let i=0;i<e.length;i++)t.add(e[i])}static uploadFiles(t){let e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("webkitdirectory",""),e.setAttribute("directory",""),e.onchange=function(i){const s=e.files;null!=s&&null!=t&&t(s),e.remove()},e.click()}static uploadFilesEach(t){let e=document.createElement("input");e.setAttribute("type","file"),e.setAttribute("webkitdirectory",""),e.setAttribute("directory",""),e.onchange=function(i){const s=e.files;if(null!=s)for(let e=0;e<s.length;e++)t(s[e]);e.remove()},e.click()}static saveAsFile(t,e){const i=new Blob([t],{type:"text/plain"}),s=document.createElement("a");s.href=URL.createObjectURL(i),s.download=e,s.click(),URL.revokeObjectURL(s.href)}static saveBlobAsFile(t,e){var i=URL.createObjectURL(t),s=document.createElement("a");s.setAttribute("href",i),s.setAttribute("download",e),s.click(),s.remove(),URL.revokeObjectURL(i)}static loadFromFile(t){let e=document.createElement("input");e.type="file",e.click(),e.onchange=function(i){null!=e.files&&t(e.files[0]),e.remove()}}static loadFromFiles(t){let e=document.createElement("input");e.type="file",e.multiple=!0,e.click(),e.onchange=function(i){null!=e.files&&t(e.files),e.remove()}}static isDarkMode(){return!!window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches}static setDesktopSize(t){if(null==t||"client"==t)for(let t=0;t<CSystem.desktopList.length;t++)CSystem.desktopList.get(t).position.left=0,CSystem.desktopList.get(t).position.top=0,CSystem.desktopList.get(t).position.width=window.innerWidth,CSystem.desktopList.get(t).position.height=window.innerHeight;else if("vert"==t){let t=window.innerHeight/CSystem.desktopList.length;for(let e=0;e<CSystem.desktopList.length;e++)CSystem.desktopList.get(e).position.left=0,CSystem.desktopList.get(e).position.top=e*t,CSystem.desktopList.get(e).position.width=window.innerWidth,CSystem.desktopList.get(e).position.height=t}else if("horz"==t){let t=window.innerWidth/CSystem.desktopList.length;for(let e=0;e<CSystem.desktopList.length;e++)CSystem.desktopList.get(e).position.left=e*t,CSystem.desktopList.get(e).position.top=0,CSystem.desktopList.get(e).position.width=t,CSystem.desktopList.get(e).position.height=window.innerHeight}else if("grid"==t){let t=Math.floor(Math.sqrt(CSystem.desktopList.length)),e=0,i=0,s=0,o=window.innerWidth/t,a=window.innerHeight/Math.ceil(CSystem.desktopList.length/t);for(;;){let n=i*o,r=s*a;if(CSystem.desktopList.get(e).position.left=n,CSystem.desktopList.get(e).position.top=r,CSystem.desktopList.get(e).position.width=o,CSystem.desktopList.get(e).position.height=a,i++,i>=t&&(i=0,s++),e++,e>=CSystem.desktopList.length)break}}}static newDesktop(){let t=new CDesktop(CSystem.clientBody,CSequence.getSequence("desktop"));return CSystem.desktopList.add(t),CSystem.setDesktopSize(CSystem.desktopAlignKind),t}static isApp(){return navigator.userAgent.toLowerCase().indexOf("electron")>=0}static async addDatabase(t,e,i,s){let o=new CIndexedDB(t),a=await o.open(e,i,s);if(a instanceof Error)throw console.error("Database open error",a),a;return CSystem.databases.set(t,o),o}static async deleteDatabase(t){let e=CSystem.databases.get(t);return e&&(e.close(),CSystem.databases.delete(t)),new Promise((function(e,i){let s=window.indexedDB.deleteDatabase(t);s.onerror=function(t){t.target?i(t.target.error.message):i()},s.onsuccess=function(t){e()},s.onblocked=function(t){i("Database is Lock")}}))}static async databaseTransaction(t,e,i){let s=this.databases.get(t);if(!s)return{result:!1,message:"Invalid database name : "+t};{let t=s.transaction(e,"readwrite");if(!t)return{result:!1,message:"Invalid transaction"};try{return await i(s,t),{result:!0,message:""}}catch(e){return t.abort(),{result:!1,message:CStringUtil.errorMessage(e)}}}}}CSystem.databases=new Map,CSystem.points=new Map,CSystem.dragControls=new Set,CSystem.resourcesLoad=!1,CSystem.controls=new CControls,CSystem.resources=new Map,CSystem.requestResources=new Array,CSystem.clientBody=new CPanel,CSystem.desktopList=new CList,CSystem.desktopAlignKind="client",CSystem.browserCovers=new Map,CSystem.systemFont=new Map,CSystem.requestDraw=new CSet,CSystem.isDraw=!0,CSystem.onAnimationFrame=new Array,CSystem.onResourceLoad=new Array,CSystem.onResourceLazyLoad=new Array,CSystem.onPointerDown=new Array,CSystem.onPointerMove=new Array,CSystem.onPointerUp=new Array,CSystem.onPointerCancel=new Array,CSystem.zPlus=0,CSystem.zMinus=0;const CON_SOCKET_URL="ws://203.216.182.241:4500",CON_HOST="http://203.216.182.241:4500";var EFileType,EResultKind,EPathItemAddKind,EPathItemItemKind,EControlKind;!async function(){CSystem.styleLoad("\n        .scrollno {-ms-overflow-style: none;scrollbar-width: none;}\n        .scrollno::-webkit-scrollbar {display: none;}\n    ");let t,e=document.createElement("canvas").getContext("2d");null!=e&&(CSystem.bufferingContext=e),window.requestAnimationFrame((function e(i){let s=(new Date).getTime();null!=t&&CSystem.doAnimationFrame(t,s),t=s,window.requestAnimationFrame(e)})),window.addEventListener("pointerdown",(function(t){CSystem.doGlobalPointerDown(t)})),window.addEventListener("pointermove",(function(t){CSystem.doGlobalPointerMove(t)})),window.addEventListener("pointerup",(function(t){CSystem.doGlobalPointerUp(t)})),window.addEventListener("pointercancel",(function(t){CSystem.doGlobalPointerCancel(t)})),CSystem.clientBody.filter.filterSet.blur=!0,CSystem.clientBody.filter.blurValue=0,window.addEventListener("load",(function(){this.document.body.appendChild(CSystem.clientBody.controlElement),CSystem.clientBody.position.left=0,CSystem.clientBody.position.top=0,CSystem.clientBody.position.width=window.innerWidth,CSystem.clientBody.position.height=window.innerHeight,CDesktop.newDesktopCover("cover"),window.onresize=function(){CSystem.clientBody.position.left=0,CSystem.clientBody.position.top=0,CSystem.clientBody.position.width=window.innerWidth,CSystem.clientBody.position.height=window.innerHeight,CSystem.clientBody.transform.translateZ=0,CSystem.setDesktopSize(CSystem.desktopAlignKind),CSystem.browserCovers.forEach((function(t){t.position.left=0,t.position.top=0,t.position.width=window.innerWidth,t.position.height=window.innerHeight}))}})),window.addEventListener("error",(function(t){console.error(t);var e=new Error(t.message);e.name=t.error.name,e.stack=t.error.stack;var i=`Error: ${t.message} at ${t.filename}:${t.lineno}:${t.colno}\nStack trace: ${e.stack}`;CShowMessage.showMessage("showMessage.frame",CLanguage.getText("W_ERROR"),i)})),window.addEventListener("unhandledrejection",(function(t){console.error(t);const e=t.reason instanceof Error?t.reason.message:"Unknown error";CShowMessage.showMessage("showMessage.frame","Promise Rejection",e)}))}(),function(t){t[t.FILE=0]="FILE",t[t.DIRECTORY=1]="DIRECTORY",t[t.LINK=2]="LINK"}(EFileType||(EFileType={}));class CFileInfo{constructor(){this.fullName="",this.name="",this.fileType=EFileType.FILE,this.creationTime=0,this.modifyTime=0,this.accessTime=0,this.size=0}}!function(t){t[t.SUCCESS=0]="SUCCESS",t[t.ERROR=1]="ERROR"}(EResultKind||(EResultKind={}));class CResultData{constructor(){this.result=EResultKind.SUCCESS,this.message=""}static success(t,e){let i=new CResultData;return i.data=t,null!=e&&(i.message=e),i}static error(t){let e=new CResultData;if(e.result=EResultKind.ERROR,"string"==typeof t)e.message=t;else{let i="Unkwoun error";t instanceof Error&&(i=t.message),e.message=i}return e}static resultToBuffer(t){let e=new CBinaryDataWriter;return e.putByte(t.result),e.putString(t.message),null!=t.data&&(t.data instanceof Uint8Array?e.putBuffer(t.data):t.data instanceof CBinaryDataWriter?e.putBuffer(t.data.getBuffer()):e.putString(JSON.stringify(t.data))),e.getBuffer()}static resultFromBuffer(t){let e=new CBinaryDataReader(t),i=new CResultData;if(i.result=e.getByte(),i.message=e.getString(),e.position<t.byteLength){let t=e.getValue();t.kind==EBinaryDataKind.STRING?i.data=JSON.parse(t.value):i.data=t.value}return i}}class CNewFilePageDesignModel extends CPanel{constructor(t,e){super(t,e),this.lTop1=new CPanel(this),this.lblDirectory=new CPanel(this.lTop1),this.edtDirectory=new CTextBox(this.lTop1),this.btnCreateDirectory=new CButton(this.lTop1),this.lTop2=new CPanel(this),this.lblFile=new CPanel(this.lTop2),this.edtFile=new CTextBox(this.lTop2),this.lClient=new CPanel(this),this.txtFile=new CTextArea(this.lClient),this.btnAddFile=new CButton(this.lClient),this.lTop1.propertyName="lTop1",this.lblDirectory.propertyName="lblDirectory",this.edtDirectory.propertyName="edtDirectory",this.btnCreateDirectory.propertyName="btnCreateDirectory",this.lTop2.propertyName="lTop2",this.lblFile.propertyName="lblFile",this.edtFile.propertyName="edtFile",this.lClient.propertyName="lClient",this.txtFile.propertyName="txtFile",this.btnAddFile.propertyName="btnAddFile"}doToData(t){super.doToData(t),CDataClass.putData(t,"lTop1",this.lTop1.toData(),{},!0),CDataClass.putData(t,"lblDirectory",this.lblDirectory.toData(),{},!0),CDataClass.putData(t,"edtDirectory",this.edtDirectory.toData(),{},!0),CDataClass.putData(t,"btnCreateDirectory",this.btnCreateDirectory.toData(),{},!0),CDataClass.putData(t,"lTop2",this.lTop2.toData(),{},!0),CDataClass.putData(t,"lblFile",this.lblFile.toData(),{},!0),CDataClass.putData(t,"edtFile",this.edtFile.toData(),{},!0),CDataClass.putData(t,"lClient",this.lClient.toData(),{},!0),CDataClass.putData(t,"txtFile",this.txtFile.toData(),{},!0),CDataClass.putData(t,"btnAddFile",this.btnAddFile.toData(),{},!0)}doFromData(t){super.doFromData(t),this.lTop1.fromData(CDataClass.getData(t,"lTop1",{},!0)),this.lblDirectory.fromData(CDataClass.getData(t,"lblDirectory",{},!0)),this.edtDirectory.fromData(CDataClass.getData(t,"edtDirectory",{},!0)),this.btnCreateDirectory.fromData(CDataClass.getData(t,"btnCreateDirectory",{},!0)),this.lTop2.fromData(CDataClass.getData(t,"lTop2",{},!0)),this.lblFile.fromData(CDataClass.getData(t,"lblFile",{},!0)),this.edtFile.fromData(CDataClass.getData(t,"edtFile",{},!0)),this.lClient.fromData(CDataClass.getData(t,"lClient",{},!0)),this.txtFile.fromData(CDataClass.getData(t,"txtFile",{},!0)),this.btnAddFile.fromData(CDataClass.getData(t,"btnAddFile",{},!0))}doResource(){super.doResource()}doChangeSize(){super.doChangeSize()}doChildDataMapHandle(t){super.doChildDataMapHandle(t),t.delete(this.lTop1),t.delete(this.lblDirectory),t.delete(this.edtDirectory),t.delete(this.btnCreateDirectory),t.delete(this.lTop2),t.delete(this.lblFile),t.delete(this.edtFile),t.delete(this.lClient),t.delete(this.txtFile),t.delete(this.btnAddFile)}}class CCustomFinderDesignModel extends CPanel{constructor(t,e){super(t,e),this.lLeft=new CPanel(this),this.lLTop=new CPanel(this.lLeft),this.btnAddItem=new CButton(this.lLTop),this.btnDeleteItem=new CButton(this.lLTop),this.lstBookmark=new CObjectListBox(this.lLeft),this.spl=new CSplitter(this),this.lClient=new CPanel(this),this.lCTop1=new CPanel(this.lClient),this.lblProperty=new CPanel(this.lCTop1),this.edtDirectory=new CTextBox(this.lCTop1),this.btnGo=new CButton(this.lCTop1),this.btnPre=new CButton(this.lCTop1),this.lCTop2=new CPanel(this.lClient),this.btnAdd=new CButton(this.lCTop2),this.btnDelete=new CButton(this.lCTop2),this.btnCopy=new CButton(this.lCTop2),this.btnPaste=new CButton(this.lCTop2),this.btnUpload=new CButton(this.lCTop2),this.btnDownload=new CButton(this.lCTop2),this.grid=new CDataGrid(this.lClient),this.pan=new CPanel(this.lClient),this.lblFileName=new CPanel(this.pan),this.edtFileName=new CTextBox(this.pan),this.btnOk=new CButton(this.pan),this.cover=new CCover(this),this.newCover=new CCover(this),this.lLeft.propertyName="lLeft",this.lLTop.propertyName="lLTop",this.btnAddItem.propertyName="btnAddItem",this.btnDeleteItem.propertyName="btnDeleteItem",this.lstBookmark.propertyName="lstBookmark",this.spl.propertyName="spl",this.lClient.propertyName="lClient",this.lCTop1.propertyName="lCTop1",this.lblProperty.propertyName="lblProperty",this.edtDirectory.propertyName="edtDirectory",this.btnGo.propertyName="btnGo",this.btnPre.propertyName="btnPre",this.lCTop2.propertyName="lCTop2",this.btnAdd.propertyName="btnAdd",this.btnDelete.propertyName="btnDelete",this.btnCopy.propertyName="btnCopy",this.btnPaste.propertyName="btnPaste",this.btnUpload.propertyName="btnUpload",this.btnDownload.propertyName="btnDownload",this.grid.propertyName="grid",this.pan.propertyName="pan",this.lblFileName.propertyName="lblFileName",this.edtFileName.propertyName="edtFileName",this.btnOk.propertyName="btnOk",this.cover.propertyName="cover",this.newCover.propertyName="newCover"}doToData(t){super.doToData(t),CDataClass.putData(t,"lLeft",this.lLeft.toData(),{},!0),CDataClass.putData(t,"lLTop",this.lLTop.toData(),{},!0),CDataClass.putData(t,"btnAddItem",this.btnAddItem.toData(),{},!0),CDataClass.putData(t,"btnDeleteItem",this.btnDeleteItem.toData(),{},!0),CDataClass.putData(t,"lstBookmark",this.lstBookmark.toData(),{},!0),CDataClass.putData(t,"spl",this.spl.toData(),{},!0),CDataClass.putData(t,"lClient",this.lClient.toData(),{},!0),CDataClass.putData(t,"lCTop1",this.lCTop1.toData(),{},!0),CDataClass.putData(t,"lblProperty",this.lblProperty.toData(),{},!0),CDataClass.putData(t,"edtDirectory",this.edtDirectory.toData(),{},!0),CDataClass.putData(t,"btnGo",this.btnGo.toData(),{},!0),CDataClass.putData(t,"btnPre",this.btnPre.toData(),{},!0),CDataClass.putData(t,"lCTop2",this.lCTop2.toData(),{},!0),CDataClass.putData(t,"btnAdd",this.btnAdd.toData(),{},!0),CDataClass.putData(t,"btnDelete",this.btnDelete.toData(),{},!0),CDataClass.putData(t,"btnCopy",this.btnCopy.toData(),{},!0),CDataClass.putData(t,"btnPaste",this.btnPaste.toData(),{},!0),CDataClass.putData(t,"btnUpload",this.btnUpload.toData(),{},!0),CDataClass.putData(t,"btnDownload",this.btnDownload.toData(),{},!0),CDataClass.putData(t,"grid",this.grid.toData(),{},!0),CDataClass.putData(t,"pan",this.pan.toData(),{},!0),CDataClass.putData(t,"lblFileName",this.lblFileName.toData(),{},!0),CDataClass.putData(t,"edtFileName",this.edtFileName.toData(),{},!0),CDataClass.putData(t,"btnOk",this.btnOk.toData(),{},!0),CDataClass.putData(t,"cover",this.cover.toData(),{},!0),CDataClass.putData(t,"newCover",this.newCover.toData(),{},!0)}doFromData(t){super.doFromData(t),this.lLeft.fromData(CDataClass.getData(t,"lLeft",{},!0)),this.lLTop.fromData(CDataClass.getData(t,"lLTop",{},!0)),this.btnAddItem.fromData(CDataClass.getData(t,"btnAddItem",{},!0)),this.btnDeleteItem.fromData(CDataClass.getData(t,"btnDeleteItem",{},!0)),this.lstBookmark.fromData(CDataClass.getData(t,"lstBookmark",{},!0)),this.spl.fromData(CDataClass.getData(t,"spl",{},!0)),this.lClient.fromData(CDataClass.getData(t,"lClient",{},!0)),this.lCTop1.fromData(CDataClass.getData(t,"lCTop1",{},!0)),this.lblProperty.fromData(CDataClass.getData(t,"lblProperty",{},!0)),this.edtDirectory.fromData(CDataClass.getData(t,"edtDirectory",{},!0)),this.btnGo.fromData(CDataClass.getData(t,"btnGo",{},!0)),this.btnPre.fromData(CDataClass.getData(t,"btnPre",{},!0)),this.lCTop2.fromData(CDataClass.getData(t,"lCTop2",{},!0)),this.btnAdd.fromData(CDataClass.getData(t,"btnAdd",{},!0)),this.btnDelete.fromData(CDataClass.getData(t,"btnDelete",{},!0)),this.btnCopy.fromData(CDataClass.getData(t,"btnCopy",{},!0)),this.btnPaste.fromData(CDataClass.getData(t,"btnPaste",{},!0)),this.btnUpload.fromData(CDataClass.getData(t,"btnUpload",{},!0)),this.btnDownload.fromData(CDataClass.getData(t,"btnDownload",{},!0)),this.grid.fromData(CDataClass.getData(t,"grid",{},!0)),this.pan.fromData(CDataClass.getData(t,"pan",{},!0)),this.lblFileName.fromData(CDataClass.getData(t,"lblFileName",{},!0)),this.edtFileName.fromData(CDataClass.getData(t,"edtFileName",{},!0)),this.btnOk.fromData(CDataClass.getData(t,"btnOk",{},!0)),this.cover.fromData(CDataClass.getData(t,"cover",{},!0)),this.newCover.fromData(CDataClass.getData(t,"newCover",{},!0))}doResource(){super.doResource()}doChangeSize(){super.doChangeSize(),this.cover.position.width=this.position.width,this.cover.position.height=this.position.height,this.newCover.position.width=this.position.width,this.newCover.position.height=this.position.height}doChildDataMapHandle(t){super.doChildDataMapHandle(t),t.delete(this.lLeft),t.delete(this.lLTop),t.delete(this.btnAddItem),t.delete(this.btnDeleteItem),t.delete(this.lstBookmark),t.delete(this.spl),t.delete(this.lClient),t.delete(this.lCTop1),t.delete(this.lblProperty),t.delete(this.edtDirectory),t.delete(this.btnGo),t.delete(this.btnPre),t.delete(this.lCTop2),t.delete(this.btnAdd),t.delete(this.btnDelete),t.delete(this.btnCopy),t.delete(this.btnPaste),t.delete(this.btnUpload),t.delete(this.btnDownload),t.delete(this.grid),t.delete(this.pan),t.delete(this.lblFileName),t.delete(this.edtFileName),t.delete(this.btnOk),t.delete(this.cover),t.delete(this.newCover)}}class CFinderModel extends CCustomFinderDesignModel{constructor(t,e){super(t,e),this.__nowCnt=0,this.__totalCount=0,this.fileData=new Array,this.resource="page/finderSelect.page";let i=this;this.grid.onBeforeCellDraw=function(t,e,s,o,a,n){let r=i.grid.cell(2,o);if(e==EPointerAreaKind.CLIENT&&"string"==typeof r&&"DIRECTORY"==r.toUpperCase()&&0==s){let t=new CCanvasItems;t.fromData(a.toData());let e=t.getItem("text");for(let t=0;t<e.length;t++)e[t].textSet.fill.solidColor="#C4E6BD";return t}},this.grid.onCellDblClick=function(t,e,s,o,a,n){i.doCellDblClick(e,s,o,a,n)},this.grid.onCellClick=function(t,e,s,o,a,n,r,l,h,d){i.doCellClick(e,s,o,a,n,r,l,h,d)},this.edtDirectory.onKeyDown=function(t,e){"Enter"==e.key&&i.doCheckAuth()&&i.doSetFiles(i.edtDirectory.text)},this.btnGo.onClick=function(){i.doCheckAuth()&&i.doSetFiles(i.edtDirectory.text)},this.btnPre.onClick=function(){let t=(e=i.edtDirectory.text,/^[a-z]/i.test(e));var e;let s=i.edtDirectory.text.substring(0,2);if(t){let t=i.edtDirectory.text.split("/");if(t.length>=2&&""!=t[1]&&i.doCheckAuth()){let t=i.edtDirectory.text.substring(2,i.edtDirectory.text.length);for(;"/"==t.charAt(0);)t=t.substring(1);"/"==t.charAt(t.length-1)&&(t=t.substring(0,t.length-1));let e=t.split("/"),o="";if(1==e.length)o="/";else for(let t=0;t<e.length-1;t++)o+="/"+e[t];i.edtDirectory.text=s+o,i.doSetFiles(s+o)}}else if(""!=i.edtDirectory.text&&"/"!=i.edtDirectory.text&&i.doCheckAuth()){let t=i.edtDirectory.text;for(;"/"==t.charAt(0);)t=t.substring(1);"/"==t.charAt(t.length-1)&&(t=t.substring(0,t.length-1));let e=t.split("/"),s="";if(1==e.length)s="/";else for(let t=0;t<e.length-1;t++)s+="/"+e[t];i.edtDirectory.text=s,i.doSetFiles(s)}},this.btnAdd.onClick=async function(){i.doCheckAuth()&&i.doCreate()},this.btnDelete.onClick=function(){i.doCheckAuth()&&i.doDelete()},this.btnCopy.onClick=function(){i.doCheckAuth()&&i.doCopy()},this.btnPaste.onClick=function(){i.doCheckAuth()&&i.doPaste()},this.grid.onKeyDown=function(t,e){e.ctrlKey&&"C"==e.key.toUpperCase()&&i.doCheckAuth()&&i.doCopy(),e.ctrlKey&&"V"==e.key.toUpperCase()&&i.doCheckAuth()&&i.doPaste()},this.btnUpload.onClick=function(t,e){},this.btnDownload.onClick=function(t,e){i.doCheckAuth()&&i.grid.selectItems.forEach((function(t){i.doDownload(i.edtDirectory.text+"/"+i.grid.cell(0,parseInt(t)))}))},this.grid.onBeforeEditorApply=async function(t,e,s,o,a){let n=CStringUtil.replaceAll(i.edtDirectory.text+"/"+o,"//","/"),r=CStringUtil.replaceAll(i.edtDirectory.text+"/"+a,"//","/");await i.doRename(n,r)},this.btnAddItem.onClick=function(){i.doAddBookMark()},this.btnDeleteItem.onClick=function(){i.doDeleteBookMark()},this.lstBookmark.onChangeItemIndex=function(){i.doChangeBookmark()}}doCellClick(t,e,i,s,o,a,n,r,l){null!=this.onCellClick&&this.onCellClick(this,t,e,i,s,o,a,n,r,l)}doCellDblClick(t,e,i,s,o){if("DIRECTORY"==this.grid.cell(2,i).toUpperCase()){if(this.doCheckAuth()){let t=this.getFileFullName();this.edtDirectory.text=t,this.doSetFiles(t)}}else this.doCheckAuth()&&this.doFileDblClick(e,i,this.getFileFullName());null!=this.onCellDblClick&&this.onCellDblClick(this,t,e,i,s,o)}doFileDblClick(t,e,i){}async doAddBookMark(){}async doDeleteBookMark(){}async doChangeBookmark(){}getSizeText(t){return t>1073741824?Math.round(t/1073741824)+"Gb":t>1048576?Math.round(t/1048576)+"Mb":t>1024?Math.round(t/1024)+"Kb":t+""}getFileFullName(){if(-1!=this.grid.row){let t=this.edtDirectory.text,e=/^[a-z]/i.test(t),i="";for(e&&(i=t.substring(0,2),t=t.substring(2,t.length));"/"==t.charAt(0);)t=t.substring(1);if(""==t){let t="";return t=e?i+"/"+this.grid.cell(0,this.grid.row):"/"+this.grid.cell(0,this.grid.row),t}{let s="";return s=e?i+"/"+t+"/"+this.grid.cell(0,this.grid.row):"/"+t+"/"+this.grid.cell(0,this.grid.row),s}}return""}}class CPathController extends CPanel{constructor(t,e){super(t,e),this.__isTransForm=!0,this.__isTransForm2=!0,this.xLineCount=9,this.yLineCount=9,this.toolbar=new CPanel(this),this.lblXline=new CPanel(this.toolbar),this.edtXLine=new CTextBox(this.toolbar),this.lblYline=new CPanel(this.toolbar),this.edtYLine=new CTextBox(this.toolbar),this.btnLine=new CButton(this.toolbar),this.btnGridPathSet=new CButton(this.toolbar),this.lblSplite=new CPanel(this.toolbar),this.edtSplite=new CTextBox(this.toolbar),this.btnSplit=new CButton(this.toolbar),this.btnSplitAll=new CButton(this.toolbar),this.btnClose=new CButton(this.toolbar),this.freeTransformHandleLT=new CPanel(this),this.freeTransformHandleRT=new CPanel(this),this.freeTransformHandleLB=new CPanel(this),this.freeTransformHandleRB=new CPanel(this),this.freeTransformHandleLeftC1=new CPanel(this),this.freeTransformHandleLeftC2=new CPanel(this),this.freeTransformHandleTopC1=new CPanel(this),this.freeTransformHandleTopC2=new CPanel(this),this.freeTransformHandleRightC1=new CPanel(this),this.freeTransformHandleRightC2=new CPanel(this),this.freeTransformHandleBottomC1=new CPanel(this),this.freeTransformHandleBottomC2=new CPanel(this);let i=this;this.freeTransformHandleLT.onChangeOffset=function(){i.__isTransForm=!1,i.setLTCurve(),i.__isTransForm=!0,i.__isTransForm&&i.doFreeTransformHandleTrack()},this.freeTransformHandleRT.onChangeOffset=function(){i.__isTransForm=!1,i.setRTCurve(),i.__isTransForm=!0,i.__isTransForm&&i.doFreeTransformHandleTrack()},this.freeTransformHandleLB.onChangeOffset=function(){i.__isTransForm=!1,i.setLBCurve(),i.__isTransForm=!0,i.__isTransForm&&i.doFreeTransformHandleTrack()},this.freeTransformHandleRB.onChangeOffset=function(){i.__isTransForm=!1,i.setRBCurve(),i.__isTransForm=!0,i.__isTransForm&&i.doFreeTransformHandleTrack()},this.freeTransformHandleLeftC1.onChangeOffset=function(){i.__isTransForm&&i.doFreeTransformHandleTrack()},this.freeTransformHandleLeftC2.onChangeOffset=function(){i.__isTransForm&&i.doFreeTransformHandleTrack()},this.freeTransformHandleTopC1.onChangeOffset=function(){i.__isTransForm&&i.doFreeTransformHandleTrack()},this.freeTransformHandleTopC2.onChangeOffset=function(){i.__isTransForm&&i.doFreeTransformHandleTrack()},this.freeTransformHandleRightC1.onChangeOffset=function(){i.__isTransForm&&i.doFreeTransformHandleTrack()},this.freeTransformHandleRightC2.onChangeOffset=function(){i.__isTransForm&&i.doFreeTransformHandleTrack()},this.freeTransformHandleBottomC1.onChangeOffset=function(){i.__isTransForm&&i.doFreeTransformHandleTrack()},this.freeTransformHandleBottomC2.onChangeOffset=function(){i.__isTransForm&&i.doFreeTransformHandleTrack()},this.btnClose.onClick=function(){i.visible=!1},this.btnLine.onClick=function(){i.xLineCount=parseInt(i.edtXLine.text),i.yLineCount=parseInt(i.edtYLine.text)}}doToData(t){super.doToData(t),CDataClass.putData(t,"toolbar",this.toolbar.toData(),{},!0),CDataClass.putData(t,"lblXline",this.lblXline.toData(),{},!0),CDataClass.putData(t,"edtXLine",this.edtXLine.toData(),{},!0),CDataClass.putData(t,"lblYline",this.lblYline.toData(),{},!0),CDataClass.putData(t,"edtYLine",this.edtYLine.toData(),{},!0),CDataClass.putData(t,"btnLine",this.btnLine.toData(),{},!0),CDataClass.putData(t,"btnGridPathSet",this.btnGridPathSet.toData(),{},!0),CDataClass.putData(t,"lblSplite",this.lblSplite.toData(),{},!0),CDataClass.putData(t,"edtSplite",this.edtSplite.toData(),{},!0),CDataClass.putData(t,"btnSplit",this.btnSplit.toData(),{},!0),CDataClass.putData(t,"btnSplitAll",this.btnSplitAll.toData(),{},!0),CDataClass.putData(t,"btnClose",this.btnClose.toData(),{},!0),CDataClass.putData(t,"freeTransformHandleLT",this.freeTransformHandleLT.toData(),{},!0),CDataClass.putData(t,"freeTransformHandleRT",this.freeTransformHandleRT.toData(),{},!0),CDataClass.putData(t,"freeTransformHandleLB",this.freeTransformHandleLB.toData(),{},!0),CDataClass.putData(t,"freeTransformHandleRB",this.freeTransformHandleRB.toData(),{},!0),CDataClass.putData(t,"freeTransformHandleLeftC1",this.freeTransformHandleLeftC1.toData(),{},!0),CDataClass.putData(t,"freeTransformHandleLeftC2",this.freeTransformHandleLeftC2.toData(),{},!0),CDataClass.putData(t,"freeTransformHandleTopC1",this.freeTransformHandleTopC1.toData(),{},!0),CDataClass.putData(t,"freeTransformHandleTopC2",this.freeTransformHandleTopC2.toData(),{},!0),CDataClass.putData(t,"freeTransformHandleRightC1",this.freeTransformHandleRightC1.toData(),{},!0),CDataClass.putData(t,"freeTransformHandleRightC2",this.freeTransformHandleRightC2.toData(),{},!0),CDataClass.putData(t,"freeTransformHandleBottomC1",this.freeTransformHandleBottomC1.toData(),{},!0),CDataClass.putData(t,"freeTransformHandleBottomC2",this.freeTransformHandleBottomC2.toData(),{},!0)}doFromData(t){super.doFromData(t),this.toolbar.fromData(CDataClass.getData(t,"toolbar",{},!0)),this.lblXline.fromData(CDataClass.getData(t,"lblXline",{},!0)),this.edtXLine.fromData(CDataClass.getData(t,"edtXLine",{},!0)),this.lblYline.fromData(CDataClass.getData(t,"lblYline",{},!0)),this.edtYLine.fromData(CDataClass.getData(t,"edtYLine",{},!0)),this.btnLine.fromData(CDataClass.getData(t,"btnLine",{},!0)),this.btnGridPathSet.fromData(CDataClass.getData(t,"btnGridPathSet",{},!0)),this.lblSplite.fromData(CDataClass.getData(t,"lblSplite",{},!0)),this.edtSplite.fromData(CDataClass.getData(t,"edtSplite",{},!0)),this.btnSplit.fromData(CDataClass.getData(t,"btnSplit",{},!0)),this.btnSplitAll.fromData(CDataClass.getData(t,"btnSplitAll",{},!0)),this.btnClose.fromData(CDataClass.getData(t,"btnClose",{},!0)),this.freeTransformHandleLT.fromData(CDataClass.getData(t,"freeTransformHandleLT",{},!0)),this.freeTransformHandleRT.fromData(CDataClass.getData(t,"freeTransformHandleRT",{},!0)),this.freeTransformHandleLB.fromData(CDataClass.getData(t,"freeTransformHandleLB",{},!0)),this.freeTransformHandleRB.fromData(CDataClass.getData(t,"freeTransformHandleRB",{},!0)),this.freeTransformHandleLeftC1.fromData(CDataClass.getData(t,"freeTransformHandleLeftC1",{},!0)),this.freeTransformHandleLeftC2.fromData(CDataClass.getData(t,"freeTransformHandleLeftC2",{},!0)),this.freeTransformHandleTopC1.fromData(CDataClass.getData(t,"freeTransformHandleTopC1",{},!0)),this.freeTransformHandleTopC2.fromData(CDataClass.getData(t,"freeTransformHandleTopC2",{},!0)),this.freeTransformHandleRightC1.fromData(CDataClass.getData(t,"freeTransformHandleRightC1",{},!0)),this.freeTransformHandleRightC2.fromData(CDataClass.getData(t,"freeTransformHandleRightC2",{},!0)),this.freeTransformHandleBottomC1.fromData(CDataClass.getData(t,"freeTransformHandleBottomC1",{},!0)),this.freeTransformHandleBottomC2.fromData(CDataClass.getData(t,"freeTransformHandleBottomC2",{},!0))}doFreeTransformHandleTrack(){this.__isTransForm&&this.__isTransForm2&&(this.doPathDataTransform(),null!=this.onFreeTransformHandleTrack&&this.onFreeTransformHandleTrack(this))}doPathDataTransform(){let t=this.layers.getCanvasItems("line"),e=this.getLTPoint(),i=this.getRTPoint(),s=this.getLBPoint(),o=this.getRBPoint(),a=new CPoint(this.freeTransformHandleLeftC1.position.left,this.freeTransformHandleLeftC1.position.top),n=new CPoint(this.freeTransformHandleLeftC2.position.left,this.freeTransformHandleLeftC2.position.top),r=new CPoint(this.freeTransformHandleTopC1.position.left,this.freeTransformHandleTopC1.position.top),l=new CPoint(this.freeTransformHandleTopC2.position.left,this.freeTransformHandleTopC2.position.top),h=new CPoint(this.freeTransformHandleRightC1.position.left,this.freeTransformHandleRightC1.position.top),d=new CPoint(this.freeTransformHandleRightC2.position.left,this.freeTransformHandleRightC2.position.top),g=new CPoint(this.freeTransformHandleBottomC1.position.left,this.freeTransformHandleBottomC1.position.top),C=new CPoint(this.freeTransformHandleBottomC2.position.left,this.freeTransformHandleBottomC2.position.top);for(let c=0;c<t.length;c++){t[c].pathData.clear(),t[c].pathData.addPointMoveTo(e),t[c].pathData.addPointCurveTo3(i,r,l),t[c].pathData.addPointCurveTo3(o,h,d),t[c].pathData.addPointMoveTo(s),t[c].pathData.addPointCurveTo3(o,g,C),t[c].pathData.addPointMoveTo(e),t[c].pathData.addPointCurveTo3(s,a,n);for(let u=0;u<this.yLineCount;u++){let p=1/(this.yLineCount+1)*(u+1),A=CPoint.yTransformLine(e,i,s,o,a,n,r,l,h,d,g,C,p);t[c].pathData.addPointMoveTo(A.startPoint),t[c].pathData.addPointCurveTo3(A.stopPoint,A.curve1,A.curve2)}for(let u=0;u<this.xLineCount;u++){let p=1/(this.xLineCount+1)*(u+1),A=CPoint.xTransformLine(e,i,s,o,a,n,r,l,h,d,g,C,p);t[c].pathData.addPointMoveTo(A.startPoint),t[c].pathData.addPointCurveTo3(A.stopPoint,A.curve1,A.curve2)}}null!=this.onPathDataTransform&&this.onPathDataTransform(this)}getLTPoint(){return new CPoint(this.freeTransformHandleLT.position.left+this.freeTransformHandleLT.position.width,this.freeTransformHandleLT.position.top+this.freeTransformHandleLT.position.height)}getRTPoint(){return new CPoint(this.freeTransformHandleRT.position.left,this.freeTransformHandleRT.position.top+this.freeTransformHandleRT.position.height)}getLBPoint(){return new CPoint(this.freeTransformHandleLB.position.left+this.freeTransformHandleLB.position.width,this.freeTransformHandleLB.position.top)}getRBPoint(){return new CPoint(this.freeTransformHandleRB.position.left,this.freeTransformHandleRB.position.top)}getC1(t,e){return CPoint.getLineMiddlePoint(t,e,1/3)}getC2(t,e){return CPoint.getLineMiddlePoint(t,e,1/3*2)}setLTCurve(){let t=this.getLTPoint(),e=this.getRTPoint(),i=this.getLBPoint(),s=this.getC1(t,e);this.freeTransformHandleTopC1.position.left=s.x,this.freeTransformHandleTopC1.position.top=s.y,s=this.getC2(t,e),this.freeTransformHandleTopC2.position.left=s.x,this.freeTransformHandleTopC2.position.top=s.y,s=this.getC1(t,i),this.freeTransformHandleLeftC1.position.left=s.x,this.freeTransformHandleLeftC1.position.top=s.y,s=this.getC2(t,i),this.freeTransformHandleLeftC2.position.left=s.x,this.freeTransformHandleLeftC2.position.top=s.y}setRTCurve(){let t=this.getLTPoint(),e=this.getRTPoint(),i=this.getRBPoint(),s=this.getC1(t,e);this.freeTransformHandleTopC1.position.left=s.x,this.freeTransformHandleTopC1.position.top=s.y,s=this.getC2(t,e),this.freeTransformHandleTopC2.position.left=s.x,this.freeTransformHandleTopC2.position.top=s.y,s=this.getC1(e,i),this.freeTransformHandleRightC1.position.left=s.x,this.freeTransformHandleRightC1.position.top=s.y,s=this.getC2(e,i),this.freeTransformHandleRightC2.position.left=s.x,this.freeTransformHandleRightC2.position.top=s.y}setLBCurve(){let t=this.getLTPoint(),e=this.getLBPoint(),i=this.getRBPoint(),s=this.getC1(e,i);this.freeTransformHandleBottomC1.position.left=s.x,this.freeTransformHandleBottomC1.position.top=s.y,s=this.getC2(e,i),this.freeTransformHandleBottomC2.position.left=s.x,this.freeTransformHandleBottomC2.position.top=s.y,s=this.getC1(t,e),this.freeTransformHandleLeftC1.position.left=s.x,this.freeTransformHandleLeftC1.position.top=s.y,s=this.getC2(t,e),this.freeTransformHandleLeftC2.position.left=s.x,this.freeTransformHandleLeftC2.position.top=s.y}setRBCurve(){let t=this.getRTPoint(),e=this.getRBPoint(),i=this.getLBPoint(),s=this.getC1(t,e);this.freeTransformHandleRightC1.position.left=s.x,this.freeTransformHandleRightC1.position.top=s.y,s=this.getC2(t,e),this.freeTransformHandleRightC2.position.left=s.x,this.freeTransformHandleRightC2.position.top=s.y,s=this.getC1(i,e),this.freeTransformHandleBottomC1.position.left=s.x,this.freeTransformHandleBottomC1.position.top=s.y,s=this.getC2(i,e),this.freeTransformHandleBottomC2.position.left=s.x,this.freeTransformHandleBottomC2.position.top=s.y}gridToPathData(){let t=this.getLTPoint(),e=this.getRTPoint(),i=this.getLBPoint(),s=this.getRBPoint(),o=new CPoint(this.freeTransformHandleLeftC1.position.left,this.freeTransformHandleLeftC1.position.top),a=new CPoint(this.freeTransformHandleLeftC2.position.left,this.freeTransformHandleLeftC2.position.top),n=new CPoint(this.freeTransformHandleTopC1.position.left,this.freeTransformHandleTopC1.position.top),r=new CPoint(this.freeTransformHandleTopC2.position.left,this.freeTransformHandleTopC2.position.top),l=new CPoint(this.freeTransformHandleRightC1.position.left,this.freeTransformHandleRightC1.position.top),h=new CPoint(this.freeTransformHandleRightC2.position.left,this.freeTransformHandleRightC2.position.top),d=new CPoint(this.freeTransformHandleBottomC1.position.left,this.freeTransformHandleBottomC1.position.top),g=new CPoint(this.freeTransformHandleBottomC2.position.left,this.freeTransformHandleBottomC2.position.top),C=new CPathPointList;C.clear(),C.addPointMoveTo(t),C.addPointCurveTo3(e,n,r),C.addPointCurveTo3(s,l,h),C.addPointCurveTo3(i,g,d),C.addPointCurveTo3(t,a,o),C.addPointClose();let c=new CPathPointList;for(let C=0;C<this.yLineCount;C++){let u=1/(this.yLineCount+1)*(C+1),p=CPoint.yTransformLine(t,e,i,s,o,a,n,r,l,h,d,g,u);c.addPointMoveTo(p.startPoint),c.addPointCurveTo3(p.stopPoint,p.curve1,p.curve2)}for(let C=0;C<this.xLineCount;C++){let u=1/(this.xLineCount+1)*(C+1),p=CPoint.xTransformLine(t,e,i,s,o,a,n,r,l,h,d,g,u);c.addPointMoveTo(p.startPoint),c.addPointCurveTo3(p.stopPoint,p.curve1,p.curve2)}return{background:C,grid:c}}getTransformBounds(){let t=this.getLTPoint(),e=this.getRTPoint(),i=this.getLBPoint(),s=this.getRBPoint(),o=new CPoint(this.freeTransformHandleLeftC1.position.left,this.freeTransformHandleLeftC1.position.top),a=new CPoint(this.freeTransformHandleLeftC2.position.left,this.freeTransformHandleLeftC2.position.top),n=new CPoint(this.freeTransformHandleTopC1.position.left,this.freeTransformHandleTopC1.position.top),r=new CPoint(this.freeTransformHandleTopC2.position.left,this.freeTransformHandleTopC2.position.top),l=new CPoint(this.freeTransformHandleRightC1.position.left,this.freeTransformHandleRightC1.position.top),h=new CPoint(this.freeTransformHandleRightC2.position.left,this.freeTransformHandleRightC2.position.top),d=new CPoint(this.freeTransformHandleBottomC1.position.left,this.freeTransformHandleBottomC1.position.top),g=new CPoint(this.freeTransformHandleBottomC2.position.left,this.freeTransformHandleBottomC2.position.top),C=Math.min(t.x,e.x,i.x,s.x,o.x,a.x,n.x,r.x,l.x,h.x,d.x,g.x),c=Math.min(t.y,e.y,i.y,s.y,o.y,a.y,n.y,r.y,l.y,h.y,d.y,g.y),u=Math.max(t.x,e.x,i.x,s.x,o.x,a.x,n.x,r.x,l.x,h.x,d.x,g.x),p=Math.max(t.y,e.y,i.y,s.y,o.y,a.y,n.y,r.y,l.y,h.y,d.y,g.y);return new CRect(C,c,u,p)}offTransform(){this.__isTransForm2=!1}onTransform(){this.__isTransForm2=!0,this.doFreeTransformHandleTrack()}}class CPathItemTransformer extends CPathController{get pathItem(){return this._pathItem}set pathItem(t){this._pathItem!=t&&(this._pathItem=t,null!=t&&this.doSetPathData(t))}constructor(t,e){super(t,e),this.__orgPathData=new Map,this.__orgBounds=new CRect;let i=this;this.btnSplit.onClick=function(){null!=i.pathItem&&i.pathItem.pathData.splitLine(parseInt(i.edtSplite.text))},this.btnSplitAll.onClick=function(){null!=i.pathItem&&i.pathItem.loopPathItem((function(t){t.pathData.splitLine(parseInt(i.edtSplite.text))}))},this.btnClose.onClick=function(){i.visible=!1,i.pathItem=void 0}}doSetPathData(t){let e=t.pathData.getBounds();0==t.pathData.length&&(e=new CRect(0,0,0,0));let i=this;this.__orgPathData.clear(),this.__orgBounds=t.pathData.getBounds(),function t(e){let s=e.pathData.copyTo();e.pathData.lineToCurve(),s.lineToCurve(),i.__orgPathData.set(e,s);for(let i=0;i<e.childs.length;i++)t(e.childs.get(i))}(t),this.freeTransformHandleLT.position.left=e.left-this.freeTransformHandleLT.position.width,this.freeTransformHandleLT.position.top=e.top-this.freeTransformHandleLT.position.height,this.freeTransformHandleRT.position.left=e.right,this.freeTransformHandleRT.position.top=e.top-this.freeTransformHandleLT.position.height,this.freeTransformHandleLB.position.left=e.left-this.freeTransformHandleLT.position.width,this.freeTransformHandleLB.position.top=e.bottom,this.freeTransformHandleRB.position.left=e.right,this.freeTransformHandleRB.position.top=e.bottom}doGridToItem(){if(null!=this.pathItem){let t=this.gridToPathData();this.pathItem.pathData.copyFrom(t.background),this.pathItem.childs.addItem().pathData.copyFrom(t.grid)}}doPathDataTransform(){if(null!=this.pathItem){let t=this,e=(this.layers.getCanvasItems("line"),this.getLTPoint()),i=this.getRTPoint(),s=this.getLBPoint(),o=this.getRBPoint(),a=new CPoint(this.freeTransformHandleLeftC1.position.left,this.freeTransformHandleLeftC1.position.top),n=new CPoint(this.freeTransformHandleLeftC2.position.left,this.freeTransformHandleLeftC2.position.top),r=new CPoint(this.freeTransformHandleTopC1.position.left,this.freeTransformHandleTopC1.position.top),l=new CPoint(this.freeTransformHandleTopC2.position.left,this.freeTransformHandleTopC2.position.top),h=new CPoint(this.freeTransformHandleRightC1.position.left,this.freeTransformHandleRightC1.position.top),d=new CPoint(this.freeTransformHandleRightC2.position.left,this.freeTransformHandleRightC2.position.top),g=new CPoint(this.freeTransformHandleBottomC1.position.left,this.freeTransformHandleBottomC1.position.top),C=new CPoint(this.freeTransformHandleBottomC2.position.left,this.freeTransformHandleBottomC2.position.top);function c(u){let p=t.__orgPathData.get(u);if(null!=p&&null!=t.__orgBounds)for(let c=0;c<p.length;c++)if(p.get(c).pointKind==EPathPointKind.MOVETO||p.get(c).pointKind==EPathPointKind.LINETO||p.get(c).pointKind==EPathPointKind.CURVETO2||p.get(c).pointKind==EPathPointKind.CURVETO3){let A=p.get(c).point,m=CPoint.getTransformCurvePoint(t.__orgBounds,A.toPoint(),e,i,s,o,a,n,r,l,h,d,g,C);u.pathData.get(c).point.x=m.x,u.pathData.get(c).point.y=m.y,A=p.get(c).cPoint1,m=CPoint.getTransformCurvePoint(t.__orgBounds,A.toPoint(),e,i,s,o,a,n,r,l,h,d,g,C),u.pathData.get(c).cPoint1.x=m.x,u.pathData.get(c).cPoint1.y=m.y,A=p.get(c).cPoint2,m=CPoint.getTransformCurvePoint(t.__orgBounds,A.toPoint(),e,i,s,o,a,n,r,l,h,d,g,C),u.pathData.get(c).cPoint2.x=m.x,u.pathData.get(c).cPoint2.y=m.y}for(let t=0;t<u.childs.length;t++)c(u.childs.get(t))}c(this.pathItem)}super.doPathDataTransform()}}class CCanvasControlTransfomer extends CPathController{constructor(t,e){super(t,e),this.__orgHasPoint=!1,this.__orgPathData=new Map,this.__orgBounds=new CRect;let i=this;this.btnSplit.onClick=function(){if(null!=i.control)for(let t=0;t<i.control.layers.length;t++)for(let e=0;e<i.control.layers.get(t).items.length;e++)i.control.layers.get(t).items.get(e).pathData.splitLine(parseInt(i.edtSplite.text))},this.btnSplitAll.visible=!1,this.btnClose.onClick=function(){i.visible=!1,null!=i.control&&(i.control.hasPointerEvent=i.__orgHasPoint),i.control=void 0}}doPathDataTransform(){if(null!=this.control){let t=this.getLTPoint(),e=this.getRTPoint(),i=this.getLBPoint(),s=this.getRBPoint(),o=new CPoint(this.freeTransformHandleLeftC1.position.left,this.freeTransformHandleLeftC1.position.top),a=new CPoint(this.freeTransformHandleLeftC2.position.left,this.freeTransformHandleLeftC2.position.top),n=new CPoint(this.freeTransformHandleTopC1.position.left,this.freeTransformHandleTopC1.position.top),r=new CPoint(this.freeTransformHandleTopC2.position.left,this.freeTransformHandleTopC2.position.top),l=new CPoint(this.freeTransformHandleRightC1.position.left,this.freeTransformHandleRightC1.position.top),h=new CPoint(this.freeTransformHandleRightC2.position.left,this.freeTransformHandleRightC2.position.top),d=new CPoint(this.freeTransformHandleBottomC1.position.left,this.freeTransformHandleBottomC1.position.top),g=new CPoint(this.freeTransformHandleBottomC2.position.left,this.freeTransformHandleBottomC2.position.top),C=this.getTransformBounds();this.control.position.left=C.left,this.control.position.top=C.top,this.control.position.width=C.width,this.control.position.height=C.height;for(let C=0;C<this.control.layers.length;C++)for(let c=0;c<this.control.layers.get(C).items.length;c++){let u=this.__orgPathData.get(this.control.layers.get(C).items.get(c));if(null!=u&&null!=this.__orgBounds)for(let p=0;p<u.length;p++)if(u.get(p).pointKind==EPathPointKind.MOVETO||u.get(p).pointKind==EPathPointKind.LINETO||u.get(p).pointKind==EPathPointKind.CURVETO2||u.get(p).pointKind==EPathPointKind.CURVETO3){let A=u.get(p).point,m=CPoint.getTransformCurvePoint(this.__orgBounds,A.toPoint(),t,e,i,s,o,a,n,r,l,h,d,g);m.x-=this.control.position.left,m.y-=this.control.position.top,this.control.layers.get(C).items.get(c).pathData.get(p).point.x=m.x,this.control.layers.get(C).items.get(c).pathData.get(p).point.y=m.y,A=u.get(p).cPoint1,m=CPoint.getTransformCurvePoint(this.__orgBounds,A.toPoint(),t,e,i,s,o,a,n,r,l,h,d,g),m.x-=this.control.position.left,m.y-=this.control.position.top,this.control.layers.get(C).items.get(c).pathData.get(p).cPoint1.x=m.x,this.control.layers.get(C).items.get(c).pathData.get(p).cPoint1.y=m.y,A=u.get(p).cPoint2,m=CPoint.getTransformCurvePoint(this.__orgBounds,A.toPoint(),t,e,i,s,o,a,n,r,l,h,d,g),m.x-=this.control.position.left,m.y-=this.control.position.top,this.control.layers.get(C).items.get(c).pathData.get(p).cPoint2.x=m.x,this.control.layers.get(C).items.get(c).pathData.get(p).cPoint2.y=m.y}this.control.layers.get(C).items.get(c).pathData.width=this.control.position.width,this.control.layers.get(C).items.get(c).pathData.height=this.control.position.height}}super.doPathDataTransform()}setControl(t){if(t.layers.length>0&&t.layers.get(0).items.length>0){let e=t.layers.get(0).items.get(0);e.pathData.width,e.pathData.height;this.control=t,this.__orgBounds=e.pathData.getBounds(),this.offTransform(),this.freeTransformHandleLT.position.left=this.control.position.left,this.freeTransformHandleLT.position.top=this.control.position.top,this.freeTransformHandleRT.position.left=this.control.position.left+this.control.position.width,this.freeTransformHandleRT.position.top=this.control.position.top,this.freeTransformHandleLB.position.left=this.control.position.left,this.freeTransformHandleLB.position.top=this.control.position.top+this.control.position.height,this.freeTransformHandleRB.position.left=this.control.position.left+this.control.position.width,this.freeTransformHandleRB.position.top=this.control.position.top+this.control.position.height,this.onTransform(),this.control.layers.fromData(t.layers.toData()),this.__orgPathData.clear();for(let t=0;t<this.control.layers.length;t++)for(let e=0;e<this.control.layers.get(t).items.length;e++){let i=this.control.layers.get(t).items.get(e);i.pathData.width=this.control.position.width,i.pathData.height=this.control.position.height,i.pathData.stretch(new CRect(0,0,this.control.position.width,this.control.position.height));let s=new CPathPointList;s.fromData(i.pathData.toData()),this.__orgPathData.set(i,s)}this.draw(),this.__orgHasPoint=t.hasPointerEvent,t.hasPointerEvent=!1}}}class CAnimationTransfomer extends CPathController{constructor(t,e){super(t,e),this.__orgPathData=new Map,this.__orgBounds=new CRect;let i=this;this.btnSplit.onClick=function(){if(null!=i.control)for(let t=0;t<i.control.layers.length;t++)for(let e=0;e<i.control.layers.get(t).items.length;e++)i.control.layers.get(t).items.get(e).pathData.splitLine(parseInt(i.edtSplite.text))},this.btnSplitAll.visible=!1,this.btnClose.onClick=function(){i.visible=!1,i.control=void 0}}doPathDataTransform(){if(null!=this.control){let t=this.getLTPoint(),e=this.getRTPoint(),i=this.getLBPoint(),s=this.getRBPoint(),o=new CPoint(this.freeTransformHandleLeftC1.position.left,this.freeTransformHandleLeftC1.position.top),a=new CPoint(this.freeTransformHandleLeftC2.position.left,this.freeTransformHandleLeftC2.position.top),n=new CPoint(this.freeTransformHandleTopC1.position.left,this.freeTransformHandleTopC1.position.top),r=new CPoint(this.freeTransformHandleTopC2.position.left,this.freeTransformHandleTopC2.position.top),l=new CPoint(this.freeTransformHandleRightC1.position.left,this.freeTransformHandleRightC1.position.top),h=new CPoint(this.freeTransformHandleRightC2.position.left,this.freeTransformHandleRightC2.position.top),d=new CPoint(this.freeTransformHandleBottomC1.position.left,this.freeTransformHandleBottomC1.position.top),g=new CPoint(this.freeTransformHandleBottomC2.position.left,this.freeTransformHandleBottomC2.position.top);this.getTransformBounds();this.control.transformerPoints.leftTop.x=t.x,this.control.transformerPoints.leftTop.y=t.y,this.control.transformerPoints.leftBottom.x=i.x,this.control.transformerPoints.leftBottom.y=i.y,this.control.transformerPoints.rightTop.x=e.x,this.control.transformerPoints.rightTop.y=e.y,this.control.transformerPoints.rightBottom.x=s.x,this.control.transformerPoints.rightBottom.y=s.y,this.control.transformerPoints.leftC1.x=o.x,this.control.transformerPoints.leftC1.y=o.y,this.control.transformerPoints.leftC2.x=a.x,this.control.transformerPoints.leftC2.y=a.y,this.control.transformerPoints.topC1.x=n.x,this.control.transformerPoints.topC1.y=n.y,this.control.transformerPoints.topC2.x=r.x,this.control.transformerPoints.topC2.y=r.y,this.control.transformerPoints.rightC1.x=l.x,this.control.transformerPoints.rightC1.y=l.y,this.control.transformerPoints.rightC2.x=h.x,this.control.transformerPoints.rightC2.y=h.y,this.control.transformerPoints.bottomC1.x=d.x,this.control.transformerPoints.bottomC1.y=d.y,this.control.transformerPoints.bottomC2.x=g.x,this.control.transformerPoints.bottomC2.y=g.y}super.doPathDataTransform()}setControl(t){if(t.layers.length>0&&t.layers.get(0).items.length>0){let e=t.layers.get(0).items.get(0);e.pathData.width,e.pathData.height;this.control=t,this.__orgBounds=e.pathData.getBounds(),this.offTransform(),this.freeTransformHandleLT.position.left=this.control.position.left-20,this.freeTransformHandleLT.position.top=this.control.position.top-20,this.freeTransformHandleRT.position.left=this.control.position.left+this.control.position.width,this.freeTransformHandleRT.position.top=this.control.position.top-20,this.freeTransformHandleLB.position.left=this.control.position.left-20,this.freeTransformHandleLB.position.top=this.control.position.top+this.control.position.height,this.freeTransformHandleRB.position.left=this.control.position.left+this.control.position.width,this.freeTransformHandleRB.position.top=this.control.position.top+this.control.position.height,this.onTransform(),this.draw(),this.control.layers.fromData(t.layers.toData()),this.__orgPathData.clear();for(let t=0;t<this.control.layers.length;t++)for(let e=0;e<this.control.layers.get(t).items.length;e++){let i=this.control.layers.get(t).items.get(e);i.pathFitMode=EFitMode.ORIGINAL;let s=new CPathPointList;s.fromData(i.pathData.toData()),this.__orgPathData.set(i,s)}}}}class CTransformerFrame extends CPanel{constructor(t,e){super(t,e),this.__orgPathData=new Map,this.__orgBounds=new CRect,this.control=new CCanvasLayerControl(this),this.transformer=new CPathController(this);let i=this;this.transformer.resource="path_controller.control",this.transformer.position.align=EPositionAlign.CLIENT,this.transformer.onFreeTransformHandleTrack=function(){i.doTransform()},this.transformer.btnSplit.onClick=function(){},this.transformer.btnSplitAll.onClick=function(){},this.transformer.btnClose.onClick=function(){}}doTransform(){let t=this.transformer.getLTPoint(),e=this.transformer.getRTPoint(),i=this.transformer.getLBPoint(),s=this.transformer.getRBPoint(),o=new CPoint(this.transformer.freeTransformHandleLeftC1.position.left,this.transformer.freeTransformHandleLeftC1.position.top),a=new CPoint(this.transformer.freeTransformHandleLeftC2.position.left,this.transformer.freeTransformHandleLeftC2.position.top),n=new CPoint(this.transformer.freeTransformHandleTopC1.position.left,this.transformer.freeTransformHandleTopC1.position.top),r=new CPoint(this.transformer.freeTransformHandleTopC2.position.left,this.transformer.freeTransformHandleTopC2.position.top),l=new CPoint(this.transformer.freeTransformHandleRightC1.position.left,this.transformer.freeTransformHandleRightC1.position.top),h=new CPoint(this.transformer.freeTransformHandleRightC2.position.left,this.transformer.freeTransformHandleRightC2.position.top),d=new CPoint(this.transformer.freeTransformHandleBottomC1.position.left,this.transformer.freeTransformHandleBottomC1.position.top),g=new CPoint(this.transformer.freeTransformHandleBottomC2.position.left,this.transformer.freeTransformHandleBottomC2.position.top),C=this.transformer.getTransformBounds();for(let C=0;C<this.control.layers.length;C++)for(let c=0;c<this.control.layers.get(C).items.length;c++){let u=this.__orgPathData.get(this.control.layers.get(C).items.get(c));if(null!=u&&null!=this.__orgBounds)for(let p=0;p<u.length;p++)if(u.get(p).pointKind==EPathPointKind.MOVETO||u.get(p).pointKind==EPathPointKind.LINETO||u.get(p).pointKind==EPathPointKind.CURVETO2||u.get(p).pointKind==EPathPointKind.CURVETO3){let A=u.get(p).point,m=CPoint.getTransformCurvePoint(this.__orgBounds,A.toPoint(),t,e,i,s,o,a,n,r,l,h,d,g);m.x-=this.control.position.left,m.y-=this.control.position.top,this.control.layers.get(C).items.get(c).pathData.get(p).point.x=m.x,this.control.layers.get(C).items.get(c).pathData.get(p).point.y=m.y,A=u.get(p).cPoint1,m=CPoint.getTransformCurvePoint(this.__orgBounds,A.toPoint(),t,e,i,s,o,a,n,r,l,h,d,g),m.x-=this.control.position.left,m.y-=this.control.position.top,this.control.layers.get(C).items.get(c).pathData.get(p).cPoint1.x=m.x,this.control.layers.get(C).items.get(c).pathData.get(p).cPoint1.y=m.y,A=u.get(p).cPoint2,m=CPoint.getTransformCurvePoint(this.__orgBounds,A.toPoint(),t,e,i,s,o,a,n,r,l,h,d,g),m.x-=this.control.position.left,m.y-=this.control.position.top,this.control.layers.get(C).items.get(c).pathData.get(p).cPoint2.x=m.x,this.control.layers.get(C).items.get(c).pathData.get(p).cPoint2.y=m.y}}this.control.position.left=C.left,this.control.position.top=C.top,this.control.position.width=C.width,this.control.position.height=C.height}setControl(t){if(t.layers.length>0&&t.layers.get(0).items.length>0){let e=t.layers.get(0).items.get(0),i=e.pathData.width,s=e.pathData.height;this.control.position.width=i,this.control.position.height=s,this.control.position.left=(this.position.width-this.control.position.width)/2,this.control.position.top=(this.position.height-this.control.position.height)/2,this.control=t,this.__orgBounds=e.pathData.getBounds(),this.transformer.offTransform(),this.transformer.freeTransformHandleLT.position.left=this.control.position.left-20,this.transformer.freeTransformHandleLT.position.top=this.control.position.top-20,this.transformer.freeTransformHandleRT.position.left=this.control.position.left+this.control.position.width,this.transformer.freeTransformHandleRT.position.top=this.control.position.top-20,this.transformer.freeTransformHandleLB.position.left=this.control.position.left-20,this.transformer.freeTransformHandleLB.position.top=this.control.position.top+this.control.position.height,this.transformer.freeTransformHandleRB.position.left=this.control.position.left+this.control.position.width,this.transformer.freeTransformHandleRB.position.top=this.control.position.top+this.control.position.height,this.transformer.onTransform(),this.transformer.draw(),this.control.layers.fromData(t.layers.toData()),this.__orgPathData.clear();for(let t=0;t<this.control.layers.length;t++)for(let e=0;e<this.control.layers.get(t).items.length;e++){let i=this.control.layers.get(t).items.get(e);i.pathFitMode=EFitMode.ORIGINAL;let s=new CPathPointList;s.fromData(i.pathData.toData()),this.__orgPathData.set(i,s)}}}}!function(t){t[t.NORMAL=0]="NORMAL",t[t.PATTERN=1]="PATTERN",t[t.ROTATION=2]="ROTATION",t[t.RANDOM=3]="RANDOM"}(EPathItemAddKind||(EPathItemAddKind={})),function(t){t[t.EMPTY=0]="EMPTY",t[t.ELLIPSE=1]="ELLIPSE",t[t.RECTANGLE=2]="RECTANGLE",t[t.POLIGON=3]="POLIGON",t[t.HORN=4]="HORN",t[t.TEXT=5]="TEXT",t[t.ETC=6]="ETC"}(EPathItemItemKind||(EPathItemItemKind={}));class CTextAreaFrameModel extends CPanel{constructor(){super(...arguments),this.btnOk=new CButton(this),this.textArea=new CTextArea(this)}doToData(t){super.doToData(t),CDataClass.putData(t,"btnOk",this.btnOk.toData(),{},!0),CDataClass.putData(t,"textArea",this.textArea.toData(),{},!0)}doFromData(t){super.doFromData(t),this.btnOk.fromData(CDataClass.getData(t,"btnOk",{},!0)),this.textArea.fromData(CDataClass.getData(t,"textArea",{},!0))}}class CTextAreaFrame extends CTextAreaFrameModel{constructor(t,e){super(t,e),this.resource="textArea.frame"}}class CPropertyEditor extends CDataGrid{get classInstance(){return this._classInstrance}set classInstance(t){this._classInstrance!=t&&(this._classInstrance=t,this.doSetProperties())}get expandPropertyCellCanvasItemsResource1(){return this._expandPropertyCellCanvasItemsResource1}set expandPropertyCellCanvasItemsResource1(t){this._expandPropertyCellCanvasItemsResource1!=t&&(this._expandPropertyCellCanvasItemsResource1=t,this.addSpecificCellCanvasItemsResource(t))}get expandPropertyCellCanvasItemsResource2(){return this._expandPropertyCellCanvasItemsResource2}set expandPropertyCellCanvasItemsResource2(t){this._expandPropertyCellCanvasItemsResource2!=t&&(this._expandPropertyCellCanvasItemsResource2=t,this.addSpecificCellCanvasItemsResource(t))}constructor(t,e,i,s){super(t,e,i,s),this.__expandProperty=new Set,this._expandPropertyCellCanvasItemsResource1="",this._expandPropertyCellCanvasItemsResource2="",this.editorButtonCanvasItemsResource="",this.enumListBoxResource="",this.enumListItemResource=[],this.propertyData=new Array,this.onlyShowProperty=new Array,this.gridInfo.useResizeColumn=!0,this.headers.add("propertyName"),this.headers.add("instance"),this.headerTextCode.set("0,0","W_PROPERTY"),this.headerText.set("1,0","W_VALUE"),this.editable=!0,this.editorShowSet.add(EEditorShowKind.CLICK),this.editorShowSet.add(EEditorShowKind.F2_KEY),this.gridInfo.useFitWidth=!0,this.readOnlyColumn.add(0),this.addCellControl(EPointerAreaKind.HEADER_CLIENT,1,0,ECellControlAlign.RIGHT,15,[1,1,1,1],this.editorButtonCanvasItemsResource,"-")}doToData(t){super.doToData(t),CDataClass.putData(t,"expandPropertyCellCanvasItemsResource1",this.expandPropertyCellCanvasItemsResource1,""),CDataClass.putData(t,"expandPropertyCellCanvasItemsResource2",this.expandPropertyCellCanvasItemsResource2,""),CDataClass.putData(t,"editorButtonCanvasItemsResource",this.editorButtonCanvasItemsResource,""),CDataClass.putData(t,"enumListBoxResource",this.enumListBoxResource,"")}doFromData(t){super.doFromData(t),this.expandPropertyCellCanvasItemsResource1=CDataClass.getData(t,"expandPropertyCellCanvasItemsResource1",""),this.expandPropertyCellCanvasItemsResource2=CDataClass.getData(t,"expandPropertyCellCanvasItemsResource2",""),this.editorButtonCanvasItemsResource=CDataClass.getData(t,"editorButtonCanvasItemsResource",""),this.enumListBoxResource=CDataClass.getData(t,"enumListBoxResource",""),this.gridInfo.useResizeColumn=!0,this.gridInfo.indicatorWidth=30,this.headerText.clear(),this.headers.clear(),this.headers.add("propertyName"),this.headers.add("instance"),this.headerText.set("0,0","프로퍼티명"),this.headerText.set("1,0","값"),this.editable=!0,this.editorShowSet.add(EEditorShowKind.CLICK),this.editorShowSet.add(EEditorShowKind.F2_KEY),this.gridInfo.useFitWidth=!0,this.readOnlyColumn.add(0)}doBeforeEditorApply(t,e,i){super.doBeforeEditorApply(t,e,i)}doCellControlClick(t,e,i,s,o,a,n,r,l,h,d){super.doCellControlClick(t,e,i,s,o,a,n,r,l,h,d);let g=this;function C(){let t=g.cell(1,i),e=new Function("parent","return new "+t+"(parent)")();if(e instanceof CWindowModel);else if(e instanceof CCustomPropertyAppEditor){e.desktop=CSystem.desktopList.get(0),e.execute();let t=g.propertyData[i].propertyName.split(".");e.property=t[t.length-1],e.instance=g.propertyData[i].classInstance}else if(null!=g.editorCover){e.parent=g.editorCover;let t=e;t.position.align=EPositionAlign.CENTER,t.position.width=t.defalutWidth,t.position.height=t.defalutHeight;let s=g.propertyData[i].propertyName.split(".");t.property=s[s.length-1],t.instance=g.propertyData[i].classInstance,g.editorCover.isHideClear=!0,g.editorCover.showCover()}}if(t==EPointerAreaKind.CLIENT){if(null==CPropertyEditor.classEditor.get(this.propertyData[i].className))if(0==s){if("object"==o.data&&this.doObjectEditorButtonClick(t,e,i,s,o,a,n,r,l,h,d),"boolean"==o.data&&null!=this.classInstance){let t=!this.classInstance.getProperty(this.propertyData[i].propertyName)+"";this.classInstance.setProperty(this.propertyData[i].propertyName,t),o.text=this.classInstance.getProperty(this.propertyData[i].propertyName)+""}if("exception"==o.data&&C(),"enum"==o.data){let t=this.getCellBounds(e,i),s=this.getBackgroundClientBounds();t.offset(s.left,s.top);let d=new CListBox;d.resource=this.enumListBoxResource,d.listItemResource=this.enumListItemResource,d.scrollBox.useVScrollbar=!1,d.filter.filterSet.shadow=!0,d.filter.shadowX=0,d.filter.shadowY=0,d.onChangeItemIndex=function(){null!=g.classInstance&&g.classInstance.setProperty(g.propertyData[i].propertyName,d.itemIndex+""),o.text=g.propertyData[i].enum[d.itemIndex],u.hide()};for(let t=0;t<this.propertyData[i].enum.length;t++)d.items.add(this.propertyData[i].enum[t]);let C=d.items.length*d.rowHeight+(d.items.length-1)*d.itemMargin;C>200&&(C=200);let c=h.pageY-n+o.margins.top+g.gridInfo.cellMargin+l;c+C>window.innerHeight&&(c=c-l-C-5);let u=CPickupControl.showPickup("",CSystem.clientBody,h.pageX-a+o.margins.left+g.gridInfo.cellMargin,c,r,C,(function(t){d.parent=t,d.position.align=EPositionAlign.CLIENT}),void 0,(function(t){d.remove()}))}}else if("+"==o.text){let t=CClassProperty.getProperties(this.propertyData[i].instance),e=this.propertyData[i].propertyName;if(this.propertyData.length-1>i+1)for(let s=t.length-1;s>=0;s--)this.propertyData.splice(i+1,0,{instance:t[s].instance,classInstance:t[s].classInstance,propertyName:e+"."+t[s].propertyName,className:t[s].className,expandName:e,readOnly:t[s].readOnly,enum:t[s].enum});else for(let i=0;i<t.length;i++)this.propertyData.push({instance:t[i].instance,classInstance:t[i].classInstance,propertyName:e+t[i].propertyName,className:t[i].className,expandName:e,readOnly:t[i].readOnly,enum:t[i].enum});this.__expandProperty.add(e),this.refreshData()}else{let t=this.propertyData[i].propertyName;for(let e=this.propertyData.length-1;e>=0;e--)0==this.propertyData[e].expandName.indexOf(t)&&this.propertyData.splice(e,1);let e=[];this.__expandProperty.forEach((function(i){0==i.indexOf(t)&&e.push(i)}));for(let t=0;t<e.length;t++)this.__expandProperty.delete(e[t]);this.refreshData()}else C()}else{for(let t=this.propertyData.length-1;t>=0;t--)""!=this.propertyData[t].expandName&&this.propertyData.splice(t,1);this.__expandProperty.clear(),this.refreshData(),this.scrollY=0}}doSetProperties(){if(null!=this._classInstrance){let t=CClassProperty.getProperties(this._classInstrance);this.clear(),this.clearCellControl(),this.propertyData=[];for(let e=0;e<t.length;e++){if(this.onlyShowProperty.length>0){let i=!1;for(let s=0;s<this.onlyShowProperty.length;s++)t[e].propertyName.indexOf(this.onlyShowProperty[s])>=0&&(i=!0);if(!i)continue}this.propertyData.push({instance:t[e].instance,classInstance:t[e].classInstance,propertyName:t[e].propertyName,className:t[e].className,expandName:"",readOnly:t[e].readOnly,enum:t[e].enum})}this.refreshData()}}doEditorApply(t,e,i){super.doEditorApply(t,e,i),null!=this.classInstance&&this.classInstance.setProperty(this.propertyData[e].propertyName,i)}doObjectEditorButtonClick(t,e,i,s,o,a,n,r,l,h,d){null!=this.onObjectEditorButtonClick&&this.onObjectEditorButtonClick(this,t,e,i,s,o,a,n,r,l,h,d)}refreshData(){this.clear(),this.readOnlyCell.clear(),this.clearCellControl(),this.addCellControl(EPointerAreaKind.HEADER_CLIENT,1,0,ECellControlAlign.RIGHT,15,[1,1,1,1],this.editorButtonCanvasItemsResource,"-"),this.specificRow.clear();for(let t=0;t<this.propertyData.length;t++){let e=!1,i="";for(let s=0;s<CPropertyEditor.exceptionPropertyEditor.length;s++){let o=new Function("obj","return obj instanceof "+CPropertyEditor.exceptionPropertyEditor[s].className)(this.propertyData[t].classInstance),a=this.propertyData[t].propertyName.split(".");if(o&&CPropertyEditor.exceptionPropertyEditor[s].propertyName==a[a.length-1]){e=!0,i=CPropertyEditor.exceptionPropertyEditor[s].editorClassName;break}}if(!e&&"object"==typeof this.propertyData[t].instance){let s=CPropertyEditor.classEditor.get(this.propertyData[t].instance.constructor.name);null!=s&&(e=!0,i=s)}if(e){this.readOnlyCell.add("1,"+t),this.add({propertyName:this.propertyData[t].propertyName,instance:i}),this.addCellControl(EPointerAreaKind.CLIENT,1,t,ECellControlAlign.RIGHT,15,[1,1,1,1],this.editorButtonCanvasItemsResource,"..").data="exception"}else if("object"==typeof this.propertyData[t].instance){this.readOnlyCell.add("1,"+t),this.add({propertyName:this.propertyData[t].propertyName,instance:this.propertyData[t].className});let e=this.addCellControl(EPointerAreaKind.CLIENT,1,t,ECellControlAlign.RIGHT,15,[1,1,17,1],this.editorButtonCanvasItemsResource,"..");e.data="object",this.__expandProperty.has(this.propertyData[t].propertyName)?(e=this.addCellControl(EPointerAreaKind.CLIENT,1,t,ECellControlAlign.RIGHT,15,[1,1,1,1],this.editorButtonCanvasItemsResource,"-"),e.data="object"):(e=this.addCellControl(EPointerAreaKind.CLIENT,1,t,ECellControlAlign.RIGHT,15,[1,1,1,1],this.editorButtonCanvasItemsResource,"+"),e.data="object")}else if("boolean"==typeof this.propertyData[t].instance){this.readOnlyCell.add("1,"+t),this.add({propertyName:this.propertyData[t].propertyName,instance:this.propertyData[t].instance}),this.addCellControl(EPointerAreaKind.CLIENT,1,t,ECellControlAlign.CLIENT,15,[1,1,1,1],this.editorButtonCanvasItemsResource,this.propertyData[t].instance+"").data="boolean"}else if(this.propertyData[t].enum.length>0){this.readOnlyCell.add("1,"+t),this.add({propertyName:this.propertyData[t].propertyName,instance:this.propertyData[t].instance}),this.addCellControl(EPointerAreaKind.CLIENT,1,t,ECellControlAlign.CLIENT,15,[1,1,1,1],this.editorButtonCanvasItemsResource,this.propertyData[t].enum[this.propertyData[t].instance]).data="enum"}else this.propertyData[t].readOnly&&this.readOnlyCell.add("1,"+t),this.add({propertyName:this.propertyData[t].propertyName,instance:this.propertyData[t].instance});if(""!=this.propertyData[t].expandName){this.propertyData[t].expandName.split(".").length%2==1?this.addSpecificRow(this.expandPropertyCellCanvasItemsResource1,EPointerAreaKind.CLIENT,t):this.addSpecificRow(this.expandPropertyCellCanvasItemsResource2,EPointerAreaKind.CLIENT,t)}}}}CPropertyEditor.classEditor=new Map,CPropertyEditor.ignoreProperty=new Set,CPropertyEditor.exceptionPropertyEditor=new Array;class CTabPropertyEditor extends CTab{get propertyEditors(){return this._propertyEditors}get scrollbarLength(){return this._scrollbarLength}set scrollbarLength(t){if(this._scrollbarLength!=t){this._scrollbarLength=t;for(let e=0;e<this.propertyEditors.length;e++)this.propertyEditors.get(e).scrollBox.scrollbarLength=t}}get scrollbarResource(){return this._scrollbarResource}set scrollbarResource(t){if(this._scrollbarResource!=t){this._scrollbarResource=t;for(let e=0;e<this.propertyEditors.length;e++)this.propertyEditors.get(e).scrollBox.scrollbarResource=t}}get headerResource(){return this._headerResource}set headerResource(t){if(this._headerResource!=t){this._headerResource=t;for(let e=0;e<this.propertyEditors.length;e++)this.propertyEditors.get(e).headerResource=t}}get propertyEditorResource(){return this._propertyEditorResource}set propertyEditorResource(t){if(this._propertyEditorResource!=t&&(this._propertyEditorResource=t,""!=t))for(let e=0;e<this.propertyEditors.length;e++)this.propertyEditors.get(e).resource=t}get cellResource(){return this._cellResource}set cellResource(t){if(this._cellResource!=t){this._cellResource=t;for(let e=0;e<this.propertyEditors.length;e++)this.propertyEditors.get(e).cellResource=t}}get expandPropertyCellCanvasItemsResource1(){return this._expandPropertyCellCanvasItemsResource1}set expandPropertyCellCanvasItemsResource1(t){if(this._expandPropertyCellCanvasItemsResource1!=t){this._expandPropertyCellCanvasItemsResource1=t;for(let e=0;e<this.propertyEditors.length;e++)this.propertyEditors.get(e).expandPropertyCellCanvasItemsResource1=t}}get expandPropertyCellCanvasItemsResource2(){return this._expandPropertyCellCanvasItemsResource2}set expandPropertyCellCanvasItemsResource2(t){if(this._expandPropertyCellCanvasItemsResource2!=t){this._expandPropertyCellCanvasItemsResource2=t;for(let e=0;e<this.propertyEditors.length;e++)this.propertyEditors.get(e).expandPropertyCellCanvasItemsResource2=t}}get editorButtonCanvasItemsResource(){return this._editorButtonCanvasItemsResource}set editorButtonCanvasItemsResource(t){if(this._editorButtonCanvasItemsResource!=t){this._editorButtonCanvasItemsResource=t;for(let e=0;e<this.propertyEditors.length;e++)this.propertyEditors.get(e).editorButtonCanvasItemsResource=t}}get enumListBoxResource(){return this._enumListBoxResource}set enumListBoxResource(t){if(this._enumListBoxResource!=t){this._enumListBoxResource=t;for(let e=0;e<this.propertyEditors.length;e++)this.propertyEditors.get(e).enumListBoxResource=t}}get enumListItemResource(){return this._enumListItemResource}set enumListItemResource(t){if(this._enumListItemResource!=t){this._enumListItemResource=t;for(let e=0;e<this.propertyEditors.length;e++)this.propertyEditors.get(e).enumListItemResource=t}}constructor(t,e){super(t,e),this._propertyEditors=new CList,this._scrollbarLength=10,this._scrollbarResource="",this._headerResource=[],this._cellResource=[],this._expandPropertyCellCanvasItemsResource1="",this._expandPropertyCellCanvasItemsResource2="",this._editorButtonCanvasItemsResource="",this._enumListBoxResource="",this._enumListItemResource=[],this._propertyEditorResource="",this.onlyShowProperty=new Array,this.onBeforeEditorApply=new Array,this.useAddButton=!1,this.useArrowButton=!0,this.useDeleteButton=!0}doToData(t){super.doToData(t),CDataClass.putData(t,"scrollbarLength",this.scrollbarLength,10),CDataClass.putData(t,"scrollbarResource",this.scrollbarResource,""),CDataClass.putData(t,"headerResource",this.headerResource,[],!0),CDataClass.putData(t,"cellResource",this.cellResource,[],!0),CDataClass.putData(t,"expandPropertyCellCanvasItemsResource1",this.expandPropertyCellCanvasItemsResource1,""),CDataClass.putData(t,"expandPropertyCellCanvasItemsResource2",this.expandPropertyCellCanvasItemsResource2,""),CDataClass.putData(t,"editorButtonCanvasItemsResource",this.editorButtonCanvasItemsResource,""),CDataClass.putData(t,"enumListBoxResource",this.enumListBoxResource,""),CDataClass.putData(t,"enumListItemResource",this.enumListItemResource,[],!0),CDataClass.putData(t,"propertyEditorResource",this.propertyEditorResource,"")}doFromData(t){super.doFromData(t),this.scrollbarLength=CDataClass.getData(t,"scrollbarLength",10),this.scrollbarResource=CDataClass.getData(t,"scrollbarResource",""),this.headerResource=CDataClass.getData(t,"headerResource",[],!0),this.cellResource=CDataClass.getData(t,"cellResource",[],!0),this.expandPropertyCellCanvasItemsResource1=CDataClass.getData(t,"expandPropertyCellCanvasItemsResource1",""),this.expandPropertyCellCanvasItemsResource2=CDataClass.getData(t,"expandPropertyCellCanvasItemsResource2",""),this.editorButtonCanvasItemsResource=CDataClass.getData(t,"editorButtonCanvasItemsResource",""),this.enumListBoxResource=CDataClass.getData(t,"enumListBoxResource",""),this.enumListItemResource=CDataClass.getData(t,"enumListItemResource",[],!0),this.propertyEditorResource=CDataClass.getData(t,"propertyEditorResource","")}doResource(){super.doResource(),this.useAddButton=!1,this.useArrowButton=!0,this.useDeleteButton=!0}doDeleteTab(){super.doDeleteTab(),this.setPropertyEditors()}doCreateSheet(t,e){super.doCreateSheet(t,e);let i=new CPropertyEditor(e);i.resource=this.propertyEditorResource,i.editorCover=this.editorCover,i.onlyShowProperty=this.onlyShowProperty,i.position.align=EPositionAlign.CLIENT,""==this.propertyEditorResource&&(i.scrollBox.scrollbarLength=this.scrollbarLength,i.scrollBox.scrollbarResource=this.scrollbarResource,i.headerResource=this.headerResource,i.cellResource=this.cellResource),i.expandPropertyCellCanvasItemsResource1=this.expandPropertyCellCanvasItemsResource1,i.expandPropertyCellCanvasItemsResource2=this.expandPropertyCellCanvasItemsResource2,i.editorButtonCanvasItemsResource=this.editorButtonCanvasItemsResource,i.enumListBoxResource=this.enumListBoxResource,i.enumListItemResource=this.enumListItemResource,i.onBeforeCellDraw=function(t,e,s,o,a,n){if("layers"==i.cell(s,o)||"position"==i.cell(s,o)||"transform"==i.cell(s,o)||"filter"==i.cell(s,o)||"fill"==i.cell(s,o)||"stroke"==i.cell(s,o)||"resource"==i.cell(s,o)){let t=new CCanvasItems;t.fromData(a.toData());let e=t.getItem("text");for(let t=0;t<e.length;t++)e[t].textSet.fill.solidColor="#ffffFF";return t}},this.managementButtonLength=25,this.setPropertyEditors();let s=this;i.onObjectEditorButtonClick=function(t,e,o,a,n,r,l,h,d,g,C,c){s.addInstance(i.propertyData[a].instance)},i.onBeforeEditorApply=function(t,e,o,a,n){for(let t=0;t<s.onBeforeEditorApply.length;t++)s.onBeforeEditorApply[t](this,i,e,o,a,n)}}setPropertyEditors(){this._propertyEditors.clear();for(let t=0;t<this.tabSheets.length;t++){let e=CSystem.getChildControls(this.tabSheets.get(t));this._propertyEditors.add(e[0])}}addInstance(t,e){null!=e?this.addTab(e):this.addTab(t.constructor.name),this.propertyEditors.get(this.index).classInstance=t}deleteInstance(t){for(let e=0;e<this.propertyEditors.length;e++)if(this.propertyEditors.get(e).classInstance==t){this.deleteTab(e);break}}}class CClassProperty{static getProperties(t){let e=Object.keys(t),i=new Array;for(let s=0;s<e.length;s++){let o,a,n;if(null!=t.readOnlyProperties&&"function"==typeof t.readOnlyProperties&&(o=t.readOnlyProperties()),null!=t.deleteProperties&&"function"==typeof t.deleteProperties&&(a=t.deleteProperties()),null!=t.enumProperties&&"function"==typeof t.enumProperties&&(n=t.enumProperties()),0!=e[s].indexOf("__")){let r=e[s];0==e[s].indexOf("_")&&(r=e[s].substring(1));let l=new Function("obj","return obj."+r)(t);if(!(CPropertyEditor.ignoreProperty.has(t.constructor.name+"."+r)||CPropertyEditor.ignoreProperty.has("all."+r)||null!=a&&a.has(r))){let e=[];if(null!=n){let t=n.get(r);null!=t&&(e=t)}"object"==typeof l?i.push({instance:l,classInstance:t,className:l.constructor.name,propertyName:r,readOnly:null!=o&&o.has(r),enum:e}):"function"==typeof l||i.push({instance:l,classInstance:t,className:"",propertyName:r,readOnly:null!=o&&o.has(r),enum:e})}}}if(null!=t.addProperties&&"function"==typeof t.addProperties){let e=t.addProperties();for(let s=0;s<e.length;s++)null==t[e[s].propertyName]?"object"==typeof e[s]?null==e[s].instance?i.push({instance:void 0,classInstance:t,className:"",propertyName:e[s].propertyName,readOnly:e[s].readOnly,enum:e[s].enum}):i.push({instance:e[s].instance,classInstance:t,className:e[s].instance.constructor.name,propertyName:e[s].propertyName,readOnly:e[s].readOnly,enum:e[s].enum}):"function"==typeof e[s]||i.push({instance:e[s].instance,classInstance:t,className:"",propertyName:e[s].propertyName,readOnly:e[s].readOnly,enum:e[s].enum}):i.push({instance:e[s].instance,classInstance:t,className:e[s].instance.constructor.name,propertyName:e[s].propertyName,readOnly:e[s].readOnly,enum:e[s].enum})}return i.sort((function(t,e){let i=0;return t.propertyName>e.propertyName&&(i=1),t.propertyName<e.propertyName&&(i=-1),i})),i}}class CCustomPropertyAppEditor extends CToolWindowApplication{constructor(){super(...arguments),this.contentInitResource="",this.property=""}get instance(){return this._instance}set instance(t){this._instance!=t&&(this._instance=t,this.doChangeInstance())}doChangeInstance(){null!=this.onChangeInstance&&this.onChangeInstance(this)}doApply(t){this._instance[this.property]=t}}class CCustomPropertyEditorControl extends CPanel{constructor(t,e){super(t,e),this.contentInitResource="",this.property="",this.defalutWidth=400,this.defalutHeight=400,this.filter.filterSet.shadow=!0,this.filter.shadowX=0,this.filter.shadowY=0,this.filter.shadowBlur=20,this.useResize=!0,this.resizeAreaLength=10,this.position.padding.all=10;let i=this.layers.addLayer().items.addItem();i.fill.styleKind=EStyleKind.SOLID,i.fill.solidColor="#0F1317",i.radiusX=5,i.radiusY=5}get instance(){return this._instance}set instance(t){this._instance!=t&&(this._instance=t,this.doChangeInstance())}doChangeInstance(){null!=this.onChangeInstance&&this.onChangeInstance(this)}doApply(t){this._instance[this.property]=t}}CPropertyEditor.classEditor.set("CFillSet","CFillPropertyEditor"),CPropertyEditor.classEditor.set("CStrokeSet","CStrokePropertyEditor"),CPropertyEditor.classEditor.set("CCanvasLayers","CCustomCanvasLayersPropertyEditor"),CPropertyEditor.classEditor.set("CCanvasItems","CCanvasItemsPropertyEditorCover"),CPropertyEditor.classEditor.set("CNNMap","CStringListPropertyEditor"),CPropertyEditor.classEditor.set("CSSMap","CStringListPropertyEditor"),CPropertyEditor.classEditor.set("CNumberList","CStringListPropertyEditor"),CPropertyEditor.classEditor.set("CStringList","CStringListPropertyEditor"),CPropertyEditor.classEditor.set("Array","CStringListPropertyEditor"),CPropertyEditor.classEditor.set("ArrayString","CStringListPropertyEditor"),CPropertyEditor.classEditor.set("Set","CStringListPropertyEditor"),CPropertyEditor.classEditor.set("Map","CStringListPropertyEditor"),CPropertyEditor.classEditor.set("CPathPointList","CPathPropertyEditor"),CPropertyEditor.classEditor.set("CStringSet","CStringListPropertyEditor"),CPropertyEditor.classEditor.set("CTreeData","CStringListPropertyEditor"),CPropertyEditor.exceptionPropertyEditor.push({className:"CPanel",propertyName:"text",editorClassName:"CStringListPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CCanvasItem",propertyName:"text",editorClassName:"CStringListPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CTab",propertyName:"tabs",editorClassName:"CStringListPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CCanvasItem",propertyName:"disableRoundSet",editorClassName:"CStringListPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CCanvasItem",propertyName:"disableLineSet",editorClassName:"CStringListPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CCustomCanvasListBox",propertyName:"listItem1Data",editorClassName:"CCustomCanvasItemsPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CCustomCanvasListBox",propertyName:"listItem2Data",editorClassName:"CCustomCanvasItemsPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CCustumCanvasGrid",propertyName:"cell1Items",editorClassName:"CCustomCanvasItemsPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CCustumCanvasGrid",propertyName:"cell2Items",editorClassName:"CCustomCanvasItemsPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CListBox",propertyName:"items",editorClassName:"CStringListPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CListBox",propertyName:"listItemResource",editorClassName:"CStringListPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CComboBox",propertyName:"items",editorClassName:"CStringListPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CControl",propertyName:"focusedAnimationTrigger",editorClassName:"CAnimatorPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CControl",propertyName:"enabledAnimationTrigger",editorClassName:"CAnimatorPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CControl",propertyName:"visibleAnimationTrigger",editorClassName:"CAnimatorPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CControl",propertyName:"resourceAnimationTrigger",editorClassName:"CAnimatorPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CControl",propertyName:"selectAnimationTrigger",editorClassName:"CAnimatorPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CControl",propertyName:"checkAnimationTrigger",editorClassName:"CAnimatorPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CControl",propertyName:"removeAnimationTrigger",editorClassName:"CAnimatorPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CPointerEventControl",propertyName:"overAnimationTrigger",editorClassName:"CAnimatorPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CPointerEventControl",propertyName:"thisPointerDownAnimationTrigger",editorClassName:"CAnimatorPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CPointerEventControl",propertyName:"thisPointerUpAnimationTrigger",editorClassName:"CAnimatorPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CPointerEventControl",propertyName:"enterAnimationTrigger",editorClassName:"CAnimatorPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CPointerEventControl",propertyName:"clickAnimationTrigger",editorClassName:"CAnimatorPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CPointerEventControl",propertyName:"doubleClickAnimationTrigger",editorClassName:"CAnimatorPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CPointerEventControl",propertyName:"dragStartAnimationTrigger",editorClassName:"CAnimatorPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CPointerEventControl",propertyName:"dragCancelAnimationTrigger",editorClassName:"CAnimatorPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CPointerEventControl",propertyName:"dragCatchAnimationTrigger",editorClassName:"CAnimatorPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CPointerEventControl",propertyName:"keyDownAnimationTrigger",editorClassName:"CAnimatorPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CCover",propertyName:"showAnimationTrigger",editorClassName:"CAnimatorPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CCover",propertyName:"hideAnimationTrigger",editorClassName:"CAnimatorPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CDragIcon",propertyName:"dropAnimationTrigger",editorClassName:"CAnimatorPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CDragIcon",propertyName:"cancelAnimationTrigger",editorClassName:"CAnimatorPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CHint",propertyName:"hideAnimationTrigger",editorClassName:"CAnimatorPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CWindowModel",propertyName:"showAnimationTrigger",editorClassName:"CAnimatorPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CWindowModel",propertyName:"hideAnimationTrigger",editorClassName:"CAnimatorPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CWindowModel",propertyName:"activateAnimationTrigger",editorClassName:"CAnimatorPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CWindowModel",propertyName:"maximizeAnimationTrigger",editorClassName:"CAnimatorPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CWindowModel",propertyName:"minimizeAnimationTrigger",editorClassName:"CAnimatorPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CWindowModel",propertyName:"customAlignAnimationTrigger",editorClassName:"CAnimatorPropertyEditor"}),CPropertyEditor.exceptionPropertyEditor.push({className:"CFold",propertyName:"foldAnimationTrigger",editorClassName:"CAnimatorPropertyEditor"}),CPropertyEditor.ignoreProperty.add("all.useChangeEvent"),CPropertyEditor.ignoreProperty.add("all.element"),CPropertyEditor.ignoreProperty.add("all.controlElement"),CPropertyEditor.ignoreProperty.add("CNotifyRect.resource"),CPropertyEditor.ignoreProperty.add("CClock.hourAngle"),CPropertyEditor.ignoreProperty.add("CClock.minuteAngle"),CPropertyEditor.ignoreProperty.add("CClock.secondAngle"),CPropertyEditor.ignoreProperty.add("CDataGrid.cellPressed"),CPropertyEditor.ignoreProperty.add("CArrowBackground.arrowLayer"),CPropertyEditor.ignoreProperty.add("CArrowBackground.arrowLayers");class CForceLink{static forceApply(t,e){let i=new Map;this.affectedObject.forEach((function(s){i.set(s,new CPoint3D(s.point.x,s.point.y,s.point.z));for(let i=0;i<s.to.length;i++){let o=CForce.getMomentPoint(s.to[i].speed,s.to[i].from,s.to[i].to,e-t);s.momentPoint.x+=o.x,s.momentPoint.y+=o.y,s.momentPoint.z+=o.z}s.to=[],s.point.x+=s.momentPoint.x,s.point.y+=s.momentPoint.y,s.point.z+=s.momentPoint.z}));for(let i=0;i<this.objects.length;i++)this.objects[i].forceCreator.getApplyForcePoint(this.objects[i].affectedObject,t,e);i.forEach((function(t,e){let s=i.get(e);s&&(e.momentPoint.x=e.point.x-s.x,e.momentPoint.y=e.point.y-s.y,e.momentPoint.z=e.point.z-s.z)}))}static doFrame(t,e){this.forceApply(t,e)}}CForceLink.affectedObject=new Set,CForceLink.objects=new Array,CForceLink.forceTime=new CTime((new Date).getTime()),CSystem.onAnimationFrame.push((function(t,e){CForceLink.doFrame(t,e)}));class CForceCreateObject{constructor(t){if(this.kind="pull",this.speed={time:0,distance:0},this.point=new CPoint3D(0,0,0),this.control=t,t){t.position.left=this.point.x-t.position.width/2,t.position.top=this.point.y-t.position.height/2;let e=this;t.onChangeOffset=function(){e.point.x=t.position.left+t.position.width/2,e.point.y=t.position.top+t.position.height/2},t.onChangeSize=function(){e.speed.distance=t.position.height},t.onClick=function(){t.selected=!t.selected},t.onChangeSelected=function(){t.selected?e.kind="push":e.kind="pull"}}}getApplyForcePoint(t,e,i){let s=t.point,o=this.point,a={time:this.speed.time,distance:this.speed.distance};if(this.limitDistance){CPoint3D.distance(s,o)>this.limitDistance&&(a.distance=0)}if(a.distance>0){let t=CForce.getMomentPoint(a,s,o,i-e);"pull"==this.kind?(s.x=s.x+t.x,s.y=s.y+t.y,s.z=s.z+t.z):(s.x=s.x-t.x,s.y=s.y-t.y,s.z=s.z-t.z)}}}class CForce{constructor(t,e){this.speed=t,this.forceCreatePoint=e}static getMomentPoint(t,e,i,s){let o=e.distance(i);o/=t.distance;let a=(i.x-e.x)/o/t.time;a*=s;let n=(i.y-e.y)/o/t.time;n*=s;let r=(i.z-e.z)/o/t.time;return r*=s,new CPoint3D(a,n,r)}}class CForceAffectedObject{get point(){return this._point}set point(t){this._point=t;let e=this;this._point.onChange.push((function(){e.doPointChange()})),this.doPointChange()}constructor(t){this.to=[],this._point=new CPoint3D(0,0,0),this.momentPoint=new CPoint3D(0,0,0),this.moveKind="position";let e=this;CForceLink.affectedObject.add(this),this.control=t,this._point.onChange.push((function(){e.doPointChange()}))}doPointChange(){this.control&&("translate"==this.moveKind?(this.control.transform.translateX=this.point.x,this.control.transform.translateY=this.point.y,this.control.transform.translateZ=this.point.z):(this.control.position.left=this.point.x-this.control.position.width/2,this.control.position.top=this.point.y-this.control.position.height/2)),this.forceCreateObject&&(this.forceCreateObject.point=this.point)}addForce(t,e,i){this.to.push({from:t,to:e,speed:i})}remove(){CForceLink.affectedObject.delete(this)}}class CColorSelector extends CColorSelectorModel{constructor(t,e){super(t,e),this.resource="rect/colorEditor.frame"}}class CGradientPageDesignModel extends CPage{constructor(t,e){super(t,e),this.lTop1=new CPanel(this),this.btnAdd=new CButton(this.lTop1),this.btnDelete=new CButton(this.lTop1),this.selectRadial=new CSelectGroupBox(this.lTop1),this.selectLinear=new CSelectGroupBox(this.lTop1),this.gradientBar=new CPanel(this),this.startColor=new CColorPickupButton(this.gradientBar),this.stopColor=new CColorPickupButton(this.gradientBar),this.gradientPoints=new CPanel(this),this.handleStart=new CPanel(this.gradientPoints),this.handleStop=new CPanel(this.gradientPoints),this.lBottom=new CPanel(this),this.lBLeft=new CPanel(this.lBottom),this.lblStart=new CPanel(this.lBLeft),this.txtStart=new CTextBox(this.lBLeft),this.btnApplyStartRadius=new CButton(this.lBLeft),this.lBRight=new CPanel(this.lBottom),this.lblStop=new CPanel(this.lBRight),this.txtStop=new CTextBox(this.lBRight),this.btnApplyStopRadius=new CButton(this.lBRight),this.lTop1.propertyName="lTop1",this.btnAdd.propertyName="btnAdd",this.btnDelete.propertyName="btnDelete",this.selectRadial.propertyName="selectRadial",this.selectLinear.propertyName="selectLinear",this.gradientBar.propertyName="gradientBar",this.startColor.propertyName="startColor",this.stopColor.propertyName="stopColor",this.gradientPoints.propertyName="gradientPoints",this.handleStart.propertyName="handleStart",this.handleStop.propertyName="handleStop",this.lBottom.propertyName="lBottom",this.lBLeft.propertyName="lBLeft",this.lblStart.propertyName="lblStart",this.txtStart.propertyName="txtStart",this.btnApplyStartRadius.propertyName="btnApplyStartRadius",this.lBRight.propertyName="lBRight",this.lblStop.propertyName="lblStop",this.txtStop.propertyName="txtStop",this.btnApplyStopRadius.propertyName="btnApplyStopRadius"}doFromData(t){super.doFromData(t)}doResource(){super.doResource()}doChangeSize(){super.doChangeSize()}doChildDataMapHandle(t){super.doChildDataMapHandle(t),t.delete(this.lTop1),t.delete(this.btnAdd),t.delete(this.btnDelete),t.delete(this.selectRadial),t.delete(this.selectLinear),t.delete(this.gradientBar),t.delete(this.startColor),t.delete(this.stopColor),t.delete(this.gradientPoints),t.delete(this.handleStart),t.delete(this.handleStop),t.delete(this.lBottom),t.delete(this.lBLeft),t.delete(this.lblStart),t.delete(this.txtStart),t.delete(this.btnApplyStartRadius),t.delete(this.lBRight),t.delete(this.lblStop),t.delete(this.txtStop),t.delete(this.btnApplyStopRadius)}}class CGradientFrame extends CGradientPageDesignModel{get gradient(){return this._gradient}set gradient(t){this._gradient!=t&&(this._gradient=t,t&&0==t.pointList.length&&(t.pointList.add(new CGradientPoint(0,"rgba(255,255,255,0.5)")),t.pointList.add(new CGradientPoint(1,"rgba(0,0,0,0.5)"))),this.doSetEditor())}constructor(t,e){super(t,e),this._isApplyGradient=!0,this.middleHandle=new Array,this.resource="page/gradientEditor.page",this.lBottom.visible=!1;let i=this;this.btnAdd.onClick=function(){i.doAddColor()},this.btnDelete.onClick=function(){i.doDeleteColor()},this.selectLinear.onChangeSelected=function(){i.selectLinear.selected&&(i.gradient&&(i.gradient.gradientKind=EGradientKind.LINEAR),i.doChangeGradientType())},this.selectRadial.onChangeSelected=function(){i.selectRadial.selected&&(i.gradient&&(i.gradient.gradientKind=EGradientKind.RADIAL,i.txtStart.text=i.gradient.startRadius+"",i.txtStop.text=i.gradient.stopRadius+""),i.doChangeGradientType())},this.gradientPoints.onChangeSize=function(){i.doSetEditor()},this.startColor.onChangeOffset=function(){i.doSetGradient()},this.stopColor.onChangeOffset=function(){i.doSetGradient()},this.startColor.onChangeColor.push((function(){i.doSetGradient()})),this.stopColor.onChangeColor.push((function(){i.doSetGradient()})),this.handleStart.onChangeOffset=function(){i.doSetGradient()},this.handleStop.onChangeOffset=function(){i.doSetGradient()},this.btnApplyStartRadius.onClick=function(){i.doSetGradient()},this.btnApplyStopRadius.onClick=function(){i.doSetGradient()},this.txtStart.onKeyDown=function(t,e){"Enter"==e.key&&i.btnApplyStartRadius.click()},this.txtStop.onKeyDown=function(t,e){"Enter"==e.key&&i.btnApplyStopRadius.click()},this.selectLinear.groupName=this.name+".type",this.selectRadial.groupName=this.name+".type"}doResource(){super.doResource(),this.doInitEditor(),this.doSetGradient()}doAddColor(){this.doCreateColor()}doDeleteColor(){for(let t=this.middleHandle.length-1;t>=0;t--)this.middleHandle[t].selected&&(this.middleHandle[t].remove(),this.middleHandle.splice(t,1))}doChangeGradientType(){this._isApplyGradient=!1;try{this.lBottom.visible=this.selectRadial.selected}finally{this._isApplyGradient=!0}}doSetGradient(){if(this._isApplyGradient){let t=this.gradient;null==t&&(t=new CGradient),this.selectLinear.selected?t.gradientKind=EGradientKind.LINEAR:t.gradientKind=EGradientKind.RADIAL,t.pointList.clear();let e=this.startColor.position.left+this.startColor.position.width/2;t.pointList.add(new CGradientPoint(CCalc.crRange2Value(0,this.gradientBar.position.width,e,0,1),this.startColor.color));for(let i=0;i<this.middleHandle.length;i++){let s=this.middleHandle[i];e=s.position.left+s.position.width/2,t.pointList.add(new CGradientPoint(CCalc.crRange2Value(0,this.gradientBar.position.width,e,0,1),s.color))}e=this.stopColor.position.left+this.stopColor.position.width/2,t.pointList.add(new CGradientPoint(CCalc.crRange2Value(0,this.gradientBar.position.width,e,0,1),this.stopColor.color)),e=this.handleStart.position.left+this.handleStart.position.width/2;let i=this.handleStart.position.top+this.handleStart.position.height/2;t.startPoint.x=CCalc.crRange2Value(0,this.gradientPoints.position.width,e,0,1),t.startPoint.y=CCalc.crRange2Value(0,this.gradientPoints.position.height,i,0,1),e=this.handleStop.position.left+this.handleStop.position.width/2,i=this.handleStop.position.top+this.handleStop.position.height/2,t.stopPoint.x=CCalc.crRange2Value(0,this.gradientPoints.position.width,e,0,1),t.stopPoint.y=CCalc.crRange2Value(0,this.gradientPoints.position.height,i,0,1),t.startRadius=parseFloat(this.txtStart.text),t.stopRadius=parseFloat(this.txtStop.text);let s=this.gradientBar.layers.getCanvasItems("gradient");for(let e=0;e<s.length;e++)s[e].fill.fromData(t.toData()),s[e].fill.styleKind=EStyleKind.GRADIENT,s[e].fill.gradientKind=EGradientKind.LINEAR,s[e].fill.startPoint.x=0,s[e].fill.startPoint.y=0,s[e].fill.stopPoint.x=1,s[e].fill.stopPoint.y=0;s=this.gradientPoints.layers.getCanvasItems("gradient");for(let e=0;e<s.length;e++)s[e].fill.fromData(t.toData()),s[e].fill.styleKind=EStyleKind.GRADIENT}}doCreateColor(){let t=new CColorPickupButton(this.gradientBar),e=this;return t.onChangeOffset=function(){e.doSetGradient()},t.onChangeColor.push((function(){e.doSetGradient()})),t.onChangeColor.push((function(){e.doSetGradient()})),t.fromData(this.startColor.toData()),t.position.width=20,t.position.height=20,t.lockMoveY=!0,t.position.left=-t.position.width/2,t.lockMinX=-t.position.width/2,t.lockMaxX=this.gradientBar.position.width-t.position.width/2,t.position.top=5,this.middleHandle.push(t),t}doSetEditor(){this._isApplyGradient=!1;try{if(this.gradient){for(let t=0;t<this.middleHandle.length;t++)this.middleHandle[t].remove();if(this.middleHandle=[],this.gradient.gradientKind==EGradientKind.LINEAR?this.selectLinear.selected=!0:this.selectRadial.selected=!0,this.txtStart.text=this.gradient.startRadius+"",this.txtStop.text=this.gradient.stopRadius+"",this.handleStart.position.left=this.gradient.startPoint.x*this.gradientPoints.position.width-this.handleStart.position.width/2,this.handleStart.position.top=this.gradient.startPoint.y*this.gradientPoints.position.height-this.handleStart.position.height/2,this.handleStop.position.left=this.gradient.stopPoint.x*this.gradientPoints.position.width-this.handleStop.position.width/2,this.handleStop.position.top=this.gradient.stopPoint.y*this.gradientPoints.position.height-this.handleStop.position.height/2,this.handleStart.lockMinX=-this.handleStart.position.width/2,this.handleStart.lockMinY=-this.handleStart.position.height/2,this.handleStart.lockMaxX=this.gradientPoints.position.width-this.handleStart.position.width/2,this.handleStart.lockMaxY=this.gradientPoints.position.height-this.handleStart.position.height/2,this.handleStop.lockMinX=-this.handleStop.position.width/2,this.handleStop.lockMinY=-this.handleStop.position.height/2,this.handleStop.lockMaxX=this.gradientPoints.position.width-this.handleStop.position.width/2,this.handleStop.lockMaxY=this.gradientPoints.position.height-this.handleStop.position.height/2,this.gradient.pointList.length>=2)for(let t=0;t<this.gradient.pointList.length;t++)if(0==t)this.startColor.position.left=this.gradient.pointList.get(t).offset*this.gradientBar.position.width-this.startColor.position.width/2,this.startColor.color=this.gradient.pointList.get(t).color,this.startColor.lockMinX=-this.startColor.position.width/2,this.startColor.lockMaxX=this.gradientBar.position.width-this.startColor.position.width/2;else if(t==this.gradient.pointList.length-1)this.stopColor.position.left=this.gradient.pointList.get(t).offset*this.gradientBar.position.width-this.stopColor.position.width/2,this.stopColor.color=this.gradient.pointList.get(t).color,this.stopColor.lockMinX=-this.stopColor.position.width/2,this.stopColor.lockMaxX=this.gradientBar.position.width-this.stopColor.position.width/2;else{let e=this.doCreateColor();e.position.left=this.gradient.pointList.get(t).offset*this.gradientBar.position.width-e.position.width/2,e.color=this.gradient.pointList.get(t).color,e.lockMinX=-e.position.width/2,e.lockMaxX=this.gradientBar.position.width-e.position.width/2}else this.startColor.position.left=-this.startColor.position.width/2,this.startColor.color="rgba(255,255,255,0.5)",this.startColor.lockMinX=-this.startColor.position.width/2,this.startColor.lockMaxX=this.gradientBar.position.width-this.startColor.position.width/2,this.stopColor.position.left=this.gradientBar.position.width-this.stopColor.position.width/2,this.stopColor.color="rgba(0,0,0,0.5)",this.stopColor.lockMinX=-this.stopColor.position.width/2,this.stopColor.lockMaxX=this.gradientBar.position.width-this.stopColor.position.width/2}else this.doInitEditor()}finally{this._isApplyGradient=!0,this.doSetGradient()}}doInitEditor(){for(let t=0;t<this.middleHandle.length;t++)this.middleHandle[t].remove();this.startColor.position.left=-this.startColor.position.width/2,this.stopColor.position.left=this.gradientBar.position.width-this.startColor.position.width/2,this.startColor.lockMinX=-this.startColor.position.width/2,this.startColor.lockMaxX=this.gradientBar.position.width-this.startColor.position.width/2,this.stopColor.lockMinX=-this.stopColor.position.width/2,this.stopColor.lockMaxX=this.gradientBar.position.width-this.stopColor.position.width/2,this.handleStart.position.left=-this.handleStart.position.width/2,this.handleStart.position.top=-this.handleStart.position.height/2,this.handleStop.position.left=this.gradientPoints.position.width-this.handleStop.position.width/2,this.handleStop.position.top=this.gradientPoints.position.height-this.handleStop.position.height/2,this.handleStart.lockMinX=-this.handleStart.position.width/2,this.handleStart.lockMinY=-this.handleStart.position.height/2,this.handleStart.lockMaxX=this.gradientPoints.position.width-this.handleStart.position.width/2,this.handleStart.lockMaxY=this.gradientPoints.position.height-this.handleStart.position.height/2,this.handleStop.lockMinX=-this.handleStop.position.width/2,this.handleStop.lockMinY=-this.handleStop.position.height/2,this.handleStop.lockMaxX=this.gradientPoints.position.width-this.handleStop.position.width/2,this.handleStop.lockMaxY=this.gradientPoints.position.height-this.handleStop.position.height/2,this.selectLinear.selected=!0}}class CFillEditorPageDesignModel extends CPage{constructor(t,e){super(t,e),this.tab=new CTab(this),this.colorSelector=new CColorSelector,this.gradient=new CGradientFrame,this.tab.propertyName="tab",this.colorSelector.propertyName="colorSelector",this.gradient.propertyName="gradient"}doFromData(t){super.doFromData(t),this.colorSelector.parent=this.tab.tabSheets.get(1),this.gradient.parent=this.tab.tabSheets.get(2)}doResource(){super.doResource(),this.colorSelector.parent=this.tab.tabSheets.get(1),this.gradient.parent=this.tab.tabSheets.get(2)}doChangeSize(){super.doChangeSize()}doChildDataMapHandle(t){super.doChildDataMapHandle(t),t.delete(this.tab),t.delete(this.colorSelector),t.delete(this.gradient)}}class CStrokeEditorDesignModel extends CPanel{constructor(t,e){super(t,e),this.tab=new CTab(this),this.colorSelector=new CColorSelector,this.gradient=new CGradientFrame,this.lBottom2=new CPanel(this),this.comCap=new CComboBox(this.lBottom2),this.comJoin=new CComboBox(this.lBottom2),this.lBottom1=new CPanel(this),this.lB1Left=new CPanel(this.lBottom1),this.lblLine=new CPanel(this.lB1Left),this.edtLine=new CTextBox(this.lB1Left),this.btnLine=new CButton(this.lB1Left),this.lB1Right=new CPanel(this.lBottom1),this.lblDash=new CPanel(this.lB1Right),this.edtDash=new CTextBox(this.lB1Right),this.btnDash=new CButton(this.lB1Right),this.tab.propertyName="tab",this.colorSelector.propertyName="colorSelector",this.gradient.propertyName="gradient",this.lBottom2.propertyName="lBottom2",this.comCap.propertyName="comCap",this.comJoin.propertyName="comJoin",this.lBottom1.propertyName="lBottom1",this.lB1Left.propertyName="lB1Left",this.lblLine.propertyName="lblLine",this.edtLine.propertyName="edtLine",this.btnLine.propertyName="btnLine",this.lB1Right.propertyName="lB1Right",this.lblDash.propertyName="lblDash",this.edtDash.propertyName="edtDash",this.btnDash.propertyName="btnDash"}doFromData(t){super.doFromData(t),this.colorSelector.parent=this.tab.tabSheets.get(1),this.gradient.parent=this.tab.tabSheets.get(2)}doResource(){super.doResource(),this.colorSelector.parent=this.tab.tabSheets.get(1),this.gradient.parent=this.tab.tabSheets.get(2)}doChangeSize(){super.doChangeSize()}doChildDataMapHandle(t){super.doChildDataMapHandle(t),t.delete(this.tab),t.delete(this.colorSelector),t.delete(this.gradient),t.delete(this.lBottom2),t.delete(this.comCap),t.delete(this.comJoin),t.delete(this.lBottom1),t.delete(this.lB1Left),t.delete(this.lblLine),t.delete(this.edtLine),t.delete(this.btnLine),t.delete(this.lB1Right),t.delete(this.lblDash),t.delete(this.edtDash),t.delete(this.btnDash)}}class CFillEditorFrame extends CFillEditorPageDesignModel{get fill(){return this._fill}set fill(t){this._fill!=t&&(this._fill=t,this.doChangeFill())}constructor(t,e){super(t,e),this._fill=new CFillSet,this.resource="page/fillEditor.page";let i=this;this.colorSelector.onChangeColor=function(){null!=i.colorSelector&&(i.fill.solidColor=i.colorSelector.color)},this.gradient.gradient=this._fill,this.tab.onChangeIndex=function(){switch(i.tab.index){case 0:i.fill.styleKind=EStyleKind.EMPTY;break;case 1:i.fill.styleKind=EStyleKind.SOLID;break;case 2:i.fill.styleKind=EStyleKind.GRADIENT}}}doChangeFill(){let t=this._fill.styleKind;null!=this.colorSelector&&(this.colorSelector.color=this._fill.solidColor),this.gradient.gradient=this._fill,t==EStyleKind.EMPTY&&(this.tab.index=0),t==EStyleKind.SOLID&&(this.tab.index=1),t==EStyleKind.GRADIENT&&(this.tab.index=2),null!=this.onChangeFill&&this.onChangeFill(this)}}class CStrokeEditorFrame extends CStrokeEditorDesignModel{get stroke(){return this._stroke}set stroke(t){this._stroke!=t&&(this._stroke=t,this.doChangeStroke())}constructor(t,e){super(t,e),this._stroke=new CStrokeSet,this.resource="page/strokeEditor.page";let i=this;this.edtLine.onKeyDown=function(t,e){"Enter"==e.key&&(i.stroke.lineWidth=parseFloat(i.edtLine.text))},this.btnLine.onClick=function(){i.stroke.lineWidth=parseFloat(i.edtLine.text)},this.edtDash.onKeyDown=function(t,e){"Enter"==e.key&&(i.stroke.lineDash=i.edtDash.text)},this.btnDash.onClick=function(){i.stroke.lineDash=i.edtDash.text},this.comCap.items.add("LineCap : BUTT"),this.comCap.items.add("LineCap : ROUND"),this.comCap.items.add("LineCap : SQUARE"),this.comJoin.items.add("LineJoin : BUTT"),this.comJoin.items.add("LineJoin : ROUND"),this.comJoin.items.add("LineJoin : SQUARE"),this.comCap.onChangeItem=function(){i.stroke.lineCap=i.comCap.itemIndex},this.comJoin.onChangeItem=function(){i.stroke.lineJoin=i.comJoin.itemIndex},this.colorSelector.onChangeColor=function(){null!=i.colorSelector&&(i.stroke.solidColor=i.colorSelector.color)},this.gradient.gradient=this._stroke,this.tab.onChangeIndex=function(){switch(i.tab.index){case 0:i.stroke.styleKind=EStyleKind.EMPTY;break;case 1:i.stroke.styleKind=EStyleKind.SOLID;break;case 2:i.stroke.styleKind=EStyleKind.GRADIENT}}}doChangeStroke(){let t=this.stroke.styleKind;this.edtLine.text=this.stroke.lineWidth+"",this.edtDash.text=this.stroke.lineDash,this.comCap.itemIndex=this.stroke.lineCap,this.comJoin.itemIndex=this.stroke.lineJoin,null!=this.colorSelector&&(this.colorSelector.color=this.stroke.solidColor),null!=this.gradient&&(this.gradient.gradient=this.stroke),t==EStyleKind.EMPTY&&(this.tab.index=0),t==EStyleKind.SOLID&&(this.tab.index=1),t==EStyleKind.GRADIENT&&(this.tab.index=2),null!=this.onChangeStroke&&this.onChangeStroke(this)}}class CFillPropertyEditor extends CCustomPropertyAppEditor{constructor(){super();let t=this;this.frame=new CFillEditorFrame(this.mainWindow.body),this.frame.position.align=EPositionAlign.CLIENT,this.mainWindow.onShow=function(){t.mainWindow.caption.textSet.languageKey="W_FILL_EDITOR"},this.defaultHeight=400,this.defaultWidth=400}doChangeInstance(){this.frame.fill=this.instance[this.property],super.doChangeInstance()}}class CStrokePropertyEditor extends CCustomPropertyAppEditor{constructor(){super();let t=this;this.frame=new CStrokeEditorFrame(this.mainWindow.body),this.frame.position.align=EPositionAlign.CLIENT,this.mainWindow.onShow=function(){t.mainWindow.caption.textSet.languageKey="W_STROKE_EDITOR"},this.defaultHeight=420,this.defaultWidth=460}doChangeInstance(){this.frame.stroke=this.instance[this.property],super.doChangeInstance()}}class CLoginPageDesignModel extends CPage{constructor(t,e){super(t,e),this.lTop1=new CPanel(this),this.lblAccount=new CPanel(this.lTop1),this.edtAccount=new CTextBox(this.lTop1),this.lTop2=new CPanel(this),this.lblPassword=new CPanel(this.lTop2),this.edtPassword=new CTextBox(this.lTop2),this.lBottom=new CPanel(this),this.btnJoin=new CButton(this.lBottom),this.btnLogin=new CButton(this.lBottom),this.lTop1.propertyName="lTop1",this.lblAccount.propertyName="lblAccount",this.edtAccount.propertyName="edtAccount",this.lTop2.propertyName="lTop2",this.lblPassword.propertyName="lblPassword",this.edtPassword.propertyName="edtPassword",this.lBottom.propertyName="lBottom",this.btnJoin.propertyName="btnJoin",this.btnLogin.propertyName="btnLogin"}doFromData(t){super.doFromData(t)}doResource(){super.doResource()}doChangeSize(){super.doChangeSize()}doChildDataMapHandle(t){super.doChildDataMapHandle(t),t.delete(this.lTop1),t.delete(this.lblAccount),t.delete(this.edtAccount),t.delete(this.lTop2),t.delete(this.lblPassword),t.delete(this.edtPassword),t.delete(this.lBottom),t.delete(this.btnJoin),t.delete(this.btnLogin)}}class CSignupPageDesignModel extends CPage{constructor(t,e){super(t,e),this.lTop1=new CPanel(this),this.lblAccount=new CPanel(this.lTop1),this.edtAccount=new CTextBox(this.lTop1),this.lTop2=new CPanel(this),this.lblPassword1=new CPanel(this.lTop2),this.edtPassword1=new CTextBox(this.lTop2),this.lTop3=new CPanel(this),this.lblPassword2=new CPanel(this.lTop3),this.edtPassword2=new CTextBox(this.lTop3),this.lBottom=new CPanel(this),this.btnOk=new CButton(this.lBottom),this.lTop1.propertyName="lTop1",this.lblAccount.propertyName="lblAccount",this.edtAccount.propertyName="edtAccount",this.lTop2.propertyName="lTop2",this.lblPassword1.propertyName="lblPassword1",this.edtPassword1.propertyName="edtPassword1",this.lTop3.propertyName="lTop3",this.lblPassword2.propertyName="lblPassword2",this.edtPassword2.propertyName="edtPassword2",this.lBottom.propertyName="lBottom",this.btnOk.propertyName="btnOk"}doFromData(t){super.doFromData(t)}doResource(){super.doResource()}doChangeSize(){super.doChangeSize()}doChildDataMapHandle(t){super.doChildDataMapHandle(t),t.delete(this.lTop1),t.delete(this.lblAccount),t.delete(this.edtAccount),t.delete(this.lTop2),t.delete(this.lblPassword1),t.delete(this.edtPassword1),t.delete(this.lTop3),t.delete(this.lblPassword2),t.delete(this.edtPassword2),t.delete(this.lBottom),t.delete(this.btnOk)}}class CBrowserLoginPage extends CLoginPageDesignModel{constructor(t,e){super(t,e),this.onLoginComplete=new Array,this.resource="page/login.page";let i=this;this.btnJoin.onClick=function(){let t=new CAppBrowserSignupLogin;t.desktop=CSystem.desktopList.get(0),t.execute()},this.btnLogin.onClick=function(){i.doLogin()},this.edtPassword.onKeyDown=function(t,e){"Enter"==e.key&&i.doLogin()}}async doLogin(){let t=await CStringUtil.sha256(this.edtAccount.text+"."+this.edtPassword.text),e=await CBufferUtil.stringEncrypt(this.edtAccount.text+"."+this.edtPassword.text,t,!1,!0),i=await CStringUtil.sha256(e.base64),s=await CBrowserUser.getEncryptString(this.edtAccount.text,i),o=new CIndexedDB("localDataBase");if(await o.open(),await o.getObject("user",s)){await doLogout();let t=new CBrowserUser;t.token=i,t.account=await CBrowserUser.getEncryptString(this.edtAccount.text,i),browserLoginUser=t,await this.doLoginSetting();for(let t=0;t<this.onLoginComplete.length;t++)this.onLoginComplete[t](this)}else CShowMessage.showMessage("showMessage.frame",CLanguage.getText("W_ERROR"),CLanguage.getText("S_USER_ERR_LOGIN"))}async doLoginSetting(){if(browserLoginUser){let t=!1,e=!1,i=!1,s=!1,o=browserLoginUser;async function a(o){e&&s&&t&&i&&(await(o.setting?.addIndex("name")),await doLogin(o),await doShowSticker())}browserLoginUser.bookmark=new CFileList(await CBrowserUser.getEncryptString(browserLoginUser.account+".bookmark",browserLoginUser.token),"data"),browserLoginUser.bookmark.onLoadComplete.push((async function(){e=!0,a(o)})),browserLoginUser.sticker=new CFileList(await CBrowserUser.getEncryptString(browserLoginUser.account+".sticker",browserLoginUser.token),"data","disk"),browserLoginUser.sticker.onLoadComplete.push((async function(){i=!0,a(o)})),browserLoginUser.setting=new CFileList(await CBrowserUser.getEncryptString(browserLoginUser.account+".setting",browserLoginUser.token),"data","disk"),browserLoginUser.setting.onLoadComplete.push((async function(e){t=!0,a(o)})),browserLoginUser.browserStorage=new CEncryptBrowserFileStorage(await CBrowserUser.getEncryptString(browserLoginUser.account+".browserStorage",browserLoginUser.token)),browserLoginUser.browserStorage.encryptToken=browserLoginUser.token,browserLoginUser.browserStorage.onLoadComplete.push((async function(){CTimeChecker.startChecker(),await loadUserResource(),console.log("User resource load",CTimeChecker.stopChecker()),s=!0,a(o)}))}}}class CSignupPage extends CSignupPageDesignModel{constructor(t,e){super(t,e),this.resource="page/signup.page";let i=this;this.btnOk.onClick=function(){i.doSignup()},this.edtPassword2.onKeyDown=function(t,e){"Enter"==e.key&&i.doSignup()}}async doSignup(){if(this.edtPassword1.text==this.edtPassword2.text&&""!=this.edtPassword1.text){let t=await CStringUtil.sha256(this.edtAccount.text+"."+this.edtPassword1.text),e=await CBufferUtil.stringEncrypt(this.edtAccount.text+"."+this.edtPassword1.text,t,!1,!0),i=await CStringUtil.sha256(e.base64),s=await CBrowserUser.getEncryptString(this.edtAccount.text,i),o=new CIndexedDB("localDataBase");await o.open(),await o.putObject("user",{account:s}),CShowMessage.showMessage("showMessage.frame",CLanguage.getText("W_MESSAGE"),CLanguage.getText("S_USER_SIGNUP_COMPLETE"))}else CShowMessage.showMessage("showMessage.frame",CLanguage.getText("W_ERROR"),CLanguage.getText("S_USER_ERR_PASS_RE_CHK"))}}class CAppBrowserLogin extends CWindowApplication{constructor(){super(),this.defaultWidth=350,this.defaultHeight=200,this.appName="";let t=this;this.frame=new CBrowserLoginPage(this.mainWindow.body),this.frame.position.align=EPositionAlign.CLIENT,this.mainWindow.onShow=function(){t.mainWindow.caption.textSet.languageKey="W_USER_LOGIN"},this.frame.onLoginComplete.push((function(){t.terminate()}))}}class CAppBrowserSignupLogin extends CWindowApplication{constructor(){super(),this.defaultWidth=350,this.defaultHeight=250,this.appName="";let t=this;this.frame=new CSignupPage(this.mainWindow.body),this.frame.position.align=EPositionAlign.CLIENT,this.mainWindow.onShow=function(){t.mainWindow.caption.textSet.languageKey="W_USER_SIGNUP"}}}class CNewFileFrame extends CNewFilePageDesignModel{constructor(t,e){super(t,e),this.resource="page/newFile.page"}}class CCustomFinderFrame extends CFinderModel{constructor(t,e){super(t,e),this.fraNew=new CNewFileFrame(this.newCover);let i=this;this.fraNew.position.align=EPositionAlign.CENTER,this.fraNew.btnCreateDirectory.onClick=function(){i.doCreateOk("directory")},this.fraNew.btnAddFile.onClick=function(){i.doCreateOk("file")},this.grid.onBeforeCellDraw=function(t,e,s,o,a,n){let r=i.grid.cell(2,o);if(e==EPointerAreaKind.CLIENT&&"string"==typeof r&&"DIRECTORY"==r.toUpperCase()&&0==s){let t=new CCanvasItems,e=o%2+1;t.resource=`rect/cellDirectory${e}.canvasitems`;let s=t.getItem("text");for(let t=0;t<s.length;t++)s[t].text=i.grid.cell(0,o);return t}if(e==EPointerAreaKind.CLIENT&&"string"==typeof r&&"FILE"==r.toUpperCase()&&0==s){let t=new CCanvasItems,e=o%2+1;t.resource=`rect/cellFile${e}.canvasitems`;let s=t.getItem("text");for(let t=0;t<s.length;t++)s[t].text=i.grid.cell(0,o);return t}}}async doCreateOk(t){let e="",i="";"directory"==t?e=this.edtDirectory.text+"/"+this.fraNew.edtDirectory.text:(e=this.edtDirectory.text+"/"+this.fraNew.edtFile.text,i=this.fraNew.txtFile.text);let s=await this.doCreateSave(t,e,i);s.result==EResultKind.SUCCESS?(this.doSetFiles(this.edtDirectory.text),this.newCover.hideCover()):CShowMessage.showMessage("showMessage.frame",CLanguage.getText("W_ERROR"),s.message)}async doCreateSave(t,e,i){return CResultData.success()}doCheckAuth(){return!0}async doFileDblClick(t,e,i){super.doFileDblClick(t,e,i);let s=this.grid.cell(0,e).split(".");if(s.length>=2&&""!=s[s.length-1]){let t=s[s.length-1],e=CCustomFinderFrame.extApp.get(t);if(e){let t=await this.doGetFileData(i);if(t.result==EResultKind.SUCCESS){let i=new Function("value","return new "+e+"(value);")(t.data);i.desktop=CSystem.desktopList.get(0),i.execute()}else CShowMessage.showMessage("showMessage.frame",CLanguage.getText("W_ERROR"),t.message)}}}async doGetFileData(t){return CResultData.success()}async doRename(t,e){}async doDownload(t){return CResultData.success()}async doUpload(t){return CResultData.success()}async doCopy(){}async doPaste(){}async doCreate(){this.newCover.showCover()}async doDelete(){if(this.grid.selectItems.size>0){let t=new Array,e=this;this.grid.selectItems.forEach((function(i){let s=e.grid.get(parseInt(i));s&&("Directory"==s.kind?t.push({kind:"directory",filename:s.fullName}):t.push({kind:"file",filename:s.fullName}))}));let i=await this.doDeleteFiles(t);i.result==EResultKind.SUCCESS?this.doSetFiles(this.edtDirectory.text):CShowMessage.showMessage("showMessage.frame",CLanguage.getText("W_ERROR"),i.message)}}async doDeleteFiles(t){return CResultData.success()}async doSetFiles(t){let e=await this.doGetFiles(t);if(e.result==EResultKind.SUCCESS){this.grid.clear();for(let t=0;t<e.data.length;t++){let i="Directory";0==e.data[t].fileType&&(i="File"),this.grid.add({name:e.data[t].name,modifyTime:CDatetime.toTimeString(new Date(e.data[t].modifyTime),!0,!0),kind:i,size:this.getSizeText(e.data[t].size),fullName:e.data[t].fullName})}this.grid.scrollY=0}else CShowMessage.showMessage("showMessage.frame",CLanguage.getText("W_ERROR"),e.message)}async doGetFiles(t){return CResultData.success()}async setFile(t){return await this.doSetFiles(t)}}CCustomFinderFrame.extApp=new Map,CCustomFinderFrame.idMaker=new CAutoIncId;class CConfirm extends CPanel{constructor(t,e){super(t,e),this.lblTitle=new CPanel(this),this.lblWarn=new CPanel(this),this.btnCancel=new CButton(this),this.btnOk=new CButton(this),this.onCancel=new Array,this.onOk=new Array;let i=this;this.btnCancel.onClick=function(){i.doCancelClick()},this.btnOk.onClick=function(){i.doOkClick()}}doToData(t){super.doToData(t),CDataClass.putData(t,"lblTitle",this.lblTitle.toData(),{},!0),CDataClass.putData(t,"lblWarn",this.lblWarn.toData(),{},!0),CDataClass.putData(t,"btnCancel",this.btnCancel.toData(),{},!0),CDataClass.putData(t,"btnOk",this.btnOk.toData(),{},!0)}doFromData(t){super.doFromData(t),this.lblTitle.fromData(CDataClass.getData(t,"lblTitle",{},!0)),this.lblWarn.fromData(CDataClass.getData(t,"lblWarn",{},!0)),this.btnCancel.fromData(CDataClass.getData(t,"btnCancel",{},!0)),this.btnOk.fromData(CDataClass.getData(t,"btnOk",{},!0))}doCancelClick(){for(let t=0;t<this.onCancel.length;t++)this.onCancel[t](this)}doOkClick(){for(let t=0;t<this.onOk.length;t++)this.onOk[t](this)}}class CBrowserFinder extends CCustomFinderFrame{constructor(t,e){super(t,e),this.resource="page/finderSelect.page",this.edtDirectory.text="/",browserLoginUser&&(this.storage=browserLoginUser.browserStorage,this.refreshBookmark())}async doGetFileData(t){if(browserLoginUser&&browserLoginUser.browserStorage){let e=await browserLoginUser.browserStorage.getFile(t);return e?CResultData.success(e.data):CResultData.error(CLanguage.getText("S_ERR_NOT_EXISTS_FILE"))}return CResultData.error(CLanguage.getText("S_USER_ERR_NEED_LOGIN"))}async doRename(t,e){browserLoginUser&&browserLoginUser.browserStorage?await browserLoginUser.browserStorage.rename(t,e):CShowMessage.showMessage("showMessage.frame",CLanguage.getText("W_ERROR"),CLanguage.getText("S_USER_ERR_NEED_LOGIN"))}async doCopy(){try{let t=this,e=new Array;this.grid.selectItems.forEach((function(i){"/"!=t.edtDirectory.text?e.push(t.edtDirectory.text+"/"+t.grid.cell(0,parseInt(i))):e.push("/"+t.grid.cell(0,parseInt(i)))})),await navigator.clipboard.writeText(JSON.stringify({finderKind:"browser",data:e})),CShowMessage.showMessage("showMessage.frame",CLanguage.getText("W_COPY"),CLanguage.getText("S_COPY_CLIPBOARD"))}catch(t){console.error("Failed to copy: ",t)}}async doPaste(){if(browserLoginUser&&browserLoginUser.browserStorage){let t=JSON.parse(await CSystem.getClipboard());"browser"==t.finderKind&&await browserLoginUser.browserStorage.copyFiles(t.data,this.edtDirectory.text,(async function(t,e){})),this.setFile(this.edtDirectory.text)}else CShowMessage.showMessage("showMessage.frame",CLanguage.getText("W_ERROR"),CLanguage.getText("S_USER_ERR_NEED_LOGIN"))}async doCreateSave(t,e,i){if(!browserLoginUser||!browserLoginUser.browserStorage)return CResultData.error(CLanguage.getText("S_USER_ERR_NEED_LOGIN"));try{return e=CStringUtil.replaceAll(e,"//","/"),"directory"==t?await browserLoginUser.browserStorage.createDirectory(e):await browserLoginUser.browserStorage.saveFile(e,i),CResultData.success()}catch(t){return CResultData.error(CStringUtil.errorMessage(t))}}async doDeleteFiles(t){if(!browserLoginUser||!browserLoginUser.browserStorage)return CResultData.error(CLanguage.getText("S_USER_ERR_NEED_LOGIN"));{let e=[];for(let i=0;i<t.length;i++)e.push(t[i].filename);try{return await browserLoginUser.browserStorage.deleteFiles(e),CResultData.success()}catch(t){return CResultData.error(CStringUtil.errorMessage(t))}}}async doGetFiles(t){if(!browserLoginUser||!browserLoginUser.browserStorage)return CResultData.error(CLanguage.getText("S_USER_ERR_NEED_LOGIN"));try{let e=await browserLoginUser.browserStorage.getFiles(t),i=[];for(let t=0;t<e.length;t++)i.push({name:e[t].fileName,modifyTime:e[t].modifyTime,fileType:e[t].fileType,size:e[t].size,fullName:e[t].fileFullName});return CResultData.success(i)}catch(t){return CResultData.error(CStringUtil.errorMessage(t))}}async doAddBookMark(){let t=this;CPromptMessage.promptSync("prompt.frame",CLanguage.getText("S_FINDER_CONNECTION_INFO"),["Name","Directory"],(async function(e){browserLoginUser&&browserLoginUser.bookmark?(await browserLoginUser.bookmark.add({id:"",name:e[0],path:e[1]}),t.refreshBookmark()):CShowMessage.showMessage("showMessage.frame",CLanguage.getText("W_ERROR"),CLanguage.getText("S_USER_ERR_NEED_LOGIN"))}),t.cover)}async doDeleteBookMark(){if(browserLoginUser&&browserLoginUser.bookmark){if(-1!=this.lstBookmark.itemIndex){let t=this.lstBookmark.items.get(this.lstBookmark.itemIndex);await browserLoginUser.bookmark.delete(t.id),this.refreshBookmark()}}else CShowMessage.showMessage("showMessage.frame",CLanguage.getText("W_ERROR"),CLanguage.getText("S_USER_ERR_NEED_LOGIN"))}async doChangeBookmark(){if(-1!=this.lstBookmark.itemIndex){let t=this.lstBookmark.items.get(this.lstBookmark.itemIndex);this.edtDirectory.text=t.directory,this.doSetFiles(this.edtDirectory.text)}}async refreshBookmark(){if(browserLoginUser&&browserLoginUser.bookmark){this.lstBookmark.items.clear();let t=this;browserLoginUser.bookmark.loop((async function(e){t.lstBookmark.items.add({id:e.id,name:e.name,ipPort:"Browser indexedDB",directory:e.path})}))}else CShowMessage.showMessage("showMessage.frame",CLanguage.getText("W_ERROR"),CLanguage.getText("S_USER_ERR_NEED_LOGIN"))}async getBookmark(){browserLoginUser&&browserLoginUser.bookmark?this.refreshBookmark():CShowMessage.showMessage("showMessage.frame",CLanguage.getText("W_ERROR"),CLanguage.getText("S_USER_ERR_NEED_LOGIN"))}}class CCustomSelectFinder extends CBrowserFinder{constructor(t,e){super(t,e),this.pan.visible=!0}}class CFinder extends CBrowserFinder{constructor(t,e){super(t,e)}}class CSelectFinder extends CCustomSelectFinder{constructor(t,e){super(t,e),this.finderMode="open",this.onSelect=new Array;let i=this;this.btnOk.onClick=function(){"open"==i.finderMode&&(-1!=i.grid.row&&"FILE"==i.grid.cell(2,i.grid.row).toUpperCase()?i.doSelect(i.getFileFullName()):CShowMessage.showMessage("showMessage.frame","Info","Select file")),"save"==i.finderMode&&(""!=i.edtFileName.text.trim()?i.doSelect(CFileUtil.getDirName(i.edtDirectory.text,EDirType.LAST_ADD)+i.edtFileName.text):CShowMessage.showMessage("showMessage.frame","Info","Empty file name"))}}doCellClick(t,e,i,s,o,a,n,r,l){super.doCellClick(t,e,i,s,o,a,n,r,l),-1!=i&&"FILE"==this.grid.cell(2,this.grid.row).toUpperCase()?this.edtFileName.text=this.grid.cell(0,i):this.edtFileName.text=""}async doFileDblClick(t,e,i){this.doSelect(i)}async doSelect(t){for(let e=0;e<this.onSelect.length;e++)this.onSelect[e](this,t)}}class CAppBrowserFinder extends CWindowApplication{constructor(){super(),this.defaultWidth=800,this.defaultHeight=500,this.appName="";let t=this;this.finder=new CBrowserFinder(this.mainWindow.body),this.finder.position.align=EPositionAlign.CLIENT,this.finder.pan.visible=!1,this.mainWindow.onShow=function(){t.mainWindow.caption.textSet.languageKey="W_BROWSER_FINDER"}}doExecute(){super.doExecute(),this.finder.setFile("/")}}class CSettingPageDesignModel extends CPage{constructor(t,e){super(t,e),this.lTopLanguage=new CPanel(this),this.lblLanguage=new CPanel(this.lTopLanguage),this.comLanguage=new CLanguageComboBox(this.lTopLanguage),this.lTopDataExport=new CPanel(this),this.lLeft=new CPanel(this.lTopDataExport),this.lLTop1=new CPanel(this.lLeft),this.lblAccount=new CPanel(this.lLTop1),this.edtAccount=new CTextBox(this.lLTop1),this.lLTop2=new CPanel(this.lLeft),this.lblPassword=new CPanel(this.lLTop2),this.edtPassword=new CTextBox(this.lLTop2),this.lTopData2=new CPanel(this),this.btnDataExport=new CButton(this.lTopData2),this.btnDataFormat=new CButton(this.lTopData2),this.btnDataImport=new CButton(this),this.btnReloadResource=new CButton(this),this.btnLogout=new CButton(this),this.lTopLanguage.propertyName="lTopLanguage",this.lblLanguage.propertyName="lblLanguage",this.comLanguage.propertyName="comLanguage",this.lTopDataExport.propertyName="lTopDataExport",this.lLeft.propertyName="lLeft",this.lLTop1.propertyName="lLTop1",this.lblAccount.propertyName="lblAccount",this.edtAccount.propertyName="edtAccount",this.lLTop2.propertyName="lLTop2",this.lblPassword.propertyName="lblPassword",this.edtPassword.propertyName="edtPassword",this.lTopData2.propertyName="lTopData2",this.btnDataExport.propertyName="btnDataExport",this.btnDataFormat.propertyName="btnDataFormat",this.btnDataImport.propertyName="btnDataImport",this.btnReloadResource.propertyName="btnReloadResource",this.btnLogout.propertyName="btnLogout"}doFromData(t){super.doFromData(t)}doResource(){super.doResource()}doChangeSize(){super.doChangeSize()}doChildDataMapHandle(t){super.doChildDataMapHandle(t),t.delete(this.lTopLanguage),t.delete(this.lblLanguage),t.delete(this.comLanguage),t.delete(this.lTopDataExport),t.delete(this.lLeft),t.delete(this.lLTop1),t.delete(this.lblAccount),t.delete(this.edtAccount),t.delete(this.lLTop2),t.delete(this.lblPassword),t.delete(this.edtPassword),t.delete(this.lTopData2),t.delete(this.btnDataExport),t.delete(this.btnDataFormat),t.delete(this.btnDataImport),t.delete(this.btnReloadResource),t.delete(this.btnLogout)}}class CSettingPage extends CSettingPageDesignModel{constructor(t,e){super(t,e),this.onFormat=new Array,this.resource="page/setting.page";let i=this;this.btnDataExport.onClick=function(){i.dataExport()},this.btnDataImport.onClick=function(){i.dataImport()},this.btnDataFormat.onClick=function(){i.dataFormat()},this.btnReloadResource.onClick=async function(){CTimeChecker.startChecker(),await loadUserResource(),console.log("User resource load",CTimeChecker.stopChecker())}}async dataToBuffer(){if(browserLoginUser){let t=new CBinaryDataWriter;browserLoginUser.browserStorage&&await browserLoginUser.browserStorage.list.loop((async function(e){e.id="",t.putString(JSON.stringify({kind:"storage",data:e}))})),browserLoginUser.sticker&&await browserLoginUser.sticker.loop((async function(e){e.id="",t.putString(JSON.stringify({kind:"sticker",data:e}))})),browserLoginUser.bookmark&&await browserLoginUser.bookmark.loop((async function(e){e.id="",t.putString(JSON.stringify({kind:"bookmark",data:e}))}));let e=t.getBuffer();return(await CBufferUtil.bufferCompressWithEncrypt(e,browserLoginUser.token,!0)).buffer}throw new Error(CLanguage.getText("S_USER_ERR_NEED_LOGIN"))}async dataFromBuffer(t){if(!browserLoginUser)throw new Error(CLanguage.getText("S_USER_ERR_NEED_LOGIN"));{let e=await CBufferUtil.bufferDecompressWithDecrypt(t,browserLoginUser.token),i=new CBinaryDataReader(e).toArray();for(let t=0;t<i.length;t++){let e=JSON.parse(i[t].value);"storage"==e.kind&&browserLoginUser.browserStorage&&"/"!=e.data.fileFullName&&browserLoginUser.browserStorage.list.add(e.data),"sticker"==e.kind&&browserLoginUser.sticker&&browserLoginUser.sticker.add(e.data),"bookmark"==e.kind&&browserLoginUser.bookmark&&browserLoginUser.bookmark.add(e.data)}}}async dataExport(){if(browserLoginUser){let t=await CStringUtil.sha256(this.edtAccount.text+"."+this.edtPassword.text),e=await CBufferUtil.stringEncrypt(this.edtAccount.text+"."+this.edtPassword.text,t,!1,!0),i=await CStringUtil.sha256(e.base64);if(browserLoginUser.token!=i)return void CShowMessage.showMessage("showMessage.frame",CLanguage.getText("W_ERROR"),CLanguage.getText("S_USER_ERR_INVALID_TOKEN"));let s=await this.dataToBuffer(),o=new Blob([s],{type:"text/plain"}),a=URL.createObjectURL(o);try{const t=document.createElement("a");t.href=a,t.download="dataExport_"+CDatetime.getYYYYMMDDHHMMSS(!1)+".dat",document.body.appendChild(t),t.click(),t.remove(),console.log("Data Export : "+s.length)}finally{URL.revokeObjectURL(a)}}else CShowMessage.showMessage("showMessage.frame",CLanguage.getText("W_ERROR"),CLanguage.getText("S_USER_ERR_NEED_LOGIN"))}async dataImport(){if(browserLoginUser){let t=this;const e=document.createElement("input");e.type="file",e.style.display="none",document.body.appendChild(e),e.onchange=function(i){if(i.target){let s=i.target;if(s.files){const i=s.files[0];if(!i)return CShowMessage.showMessage("showMessage.frame",CLanguage.getText("W_ERROR"),CLanguage.getText("S_ST_SELECT_FILE")),void e.remove();const o=new FileReader;o.onload=async function(i){if(i.target){const s=i.target.result;if(s instanceof ArrayBuffer){const i=new Uint8Array(s);console.log("Data Import : ",i.length),await t.dataFromBuffer(i),e.remove(),await loadUserResource()}}else CShowMessage.showMessage("showMessage.frame",CLanguage.getText("W_ERROR"),"Undefined fileEvent.target"),e.remove()},o.readAsArrayBuffer(i)}else CShowMessage.showMessage("showMessage.frame",CLanguage.getText("W_ERROR"),CLanguage.getText("S_ST_NOTFOUND_FILE_LIST")),e.remove()}else CShowMessage.showMessage("showMessage.frame",CLanguage.getText("W_ERROR"),"Undefined event.target"),e.remove()},e.click()}else CShowMessage.showMessage("showMessage.frame",CLanguage.getText("W_ERROR"),CLanguage.getText("S_USER_ERR_NEED_LOGIN"))}async dataFormat(){if(browserLoginUser){let t=await CStringUtil.sha256(this.edtAccount.text+"."+this.edtPassword.text),e=await CBufferUtil.stringEncrypt(this.edtAccount.text+"."+this.edtPassword.text,t,!1,!0),i=await CStringUtil.sha256(e.base64);if(browserLoginUser.token!=i)return void CShowMessage.showMessage("showMessage.frame",CLanguage.getText("W_ERROR"),CLanguage.getText("S_USER_ERR_INVALID_TOKEN"));if(await CWarningPage.warning("page/warning.page",CLanguage.getText("W_WARNING"),CLanguage.getText("S_ST_FORMAT_WARN"))){let t=await CBrowserUser.getEncryptString(browserLoginUser.account+".sticker",browserLoginUser.token),e=await CBrowserUser.getEncryptString(browserLoginUser.account+".setting",browserLoginUser.token),i=await CBrowserUser.getEncryptString(browserLoginUser.account+".browserStorage",browserLoginUser.token),s=await CBrowserUser.getEncryptString(browserLoginUser.account+".bookmark",browserLoginUser.token),o=browserLoginUser.account;await doLogout();let a=await CIndexedDB.deleteDatabase(t);a=await CIndexedDB.deleteDatabase(e),a=await CIndexedDB.deleteDatabase(i),a=await CIndexedDB.deleteDatabase(s);let n=new CIndexedDB("localDataBase");await n.open(),await n.deleteObject("user",o);for(let t=0;t<this.onFormat.length;t++)this.onFormat[t](this)}}else CShowMessage.showMessage("showMessage.frame",CLanguage.getText("W_ERROR"),CLanguage.getText("S_USER_ERR_NEED_LOGIN"))}}class CAppSetting extends CWindowApplication{constructor(){super(),this.defaultWidth=400,this.defaultHeight=350,this.appName="";let t=this;this.frame=new CSettingPage(this.mainWindow.body),this.frame.position.align=EPositionAlign.CLIENT,this.mainWindow.onShow=function(){t.frame.comLanguage.setLocalCodeWithoutUpdate(CLanguage.localCode),t.mainWindow.caption.textSet.languageKey="W_SETTING"},this.frame.onFormat.push((function(){t.terminate()})),this.frame.btnLogout.onClick=async function(){doLogout(),t.terminate()}}doExecute(){super.doExecute(),this.frame.btnLogout.visible=null!=browserLoginUser}}class CJSONTreeListBox extends CTreeListBox{setObject(t,e=!1){this.obj=t,this.items.clear(),function t(e,i,s,o=!1){if(i instanceof Array){let a="";a=s.length>0?s+" : Array":"Array";let n=e.add({type:"array",key:s,text:a,value:void 0});for(let e=0;e<i.length;e++)t(n.childItems,i[e],e+"",o)}else if(i instanceof Object){let a="";a=s.length>0?s+" : Object":"Object";let n=e.add({type:"object",key:s,text:a,value:void 0}),r=Object.keys(i);o&&r.sort((function(t,e){let i=0;return t<e&&(i=-1),t>e&&(i=1),i}));for(let e=0;e<r.length;e++)t(n.childItems,i[r[e]],r[e],o)}else{let t="";t=null==i?"undefined":null==i?"null":"string"==typeof i?`"${i}"`:i.toString();let o="";o=s.length>0?s+" : "+t:t,e.add({type:typeof i,key:s,text:o+" ["+typeof i+"]",value:i})}}(this.items,t,"",e),this.items.expandAll()}}class CJsonToTreeDesignModel extends CPanel{constructor(t,e){super(t,e),this.lTop=new CPanel(this),this.btnOrg=new CButton(this.lTop),this.btnSort=new CButton(this.lTop),this.tree=new CJSONTreeListBox(this),this.lTop.propertyName="lTop",this.btnOrg.propertyName="btnOrg",this.btnSort.propertyName="btnSort",this.tree.propertyName="tree"}doFromData(t){super.doFromData(t)}doResource(){super.doResource()}doChangeSize(){super.doChangeSize()}doChildDataMapHandle(t){super.doChildDataMapHandle(t),t.delete(this.lTop),t.delete(this.btnOrg),t.delete(this.btnSort),t.delete(this.tree)}}class CTextEditorDesignModel extends CPanel{constructor(t,e){super(t,e),this.menu=new CPanel(this),this.mnuFile=new CPopupButton(this.menu),this.mnuEdit=new CPopupButton(this.menu),this.btnApply=new CButton(this.menu),this.txt=new CTextArea(this),this.selectCover=new CCover(this),this.menu.propertyName="menu",this.mnuFile.propertyName="mnuFile",this.mnuEdit.propertyName="mnuEdit",this.btnApply.propertyName="btnApply",this.txt.propertyName="txt",this.selectCover.propertyName="selectCover"}doFromData(t){super.doFromData(t)}doResource(){super.doResource()}doChangeSize(){super.doChangeSize(),this.selectCover.position.width=this.position.width,this.selectCover.position.height=this.position.height}doChildDataMapHandle(t){super.doChildDataMapHandle(t),t.delete(this.menu),t.delete(this.mnuFile),t.delete(this.mnuEdit),t.delete(this.btnApply),t.delete(this.txt),t.delete(this.selectCover)}}class CJsonToTreeFrame extends CJsonToTreeDesignModel{constructor(t,e){super(t,e),this.resource="page/jsonToTree.page";let i=this;this.btnOrg.onClick=function(){i.tree.obj&&i.tree.setObject(i.tree.obj)},this.btnSort.onClick=function(){i.tree.obj&&i.tree.setObject(i.tree.obj,!0)}}}class CTextEditorFrame extends CTextEditorDesignModel{constructor(t,e){super(t,e),this.saveIp="",this.savePort="",this.saveFileName="",this.onSaveFileSet=new Array,this.resource="page/textEditor.page";let i=this;this.mnuFile.onMenuClick.push((function(t,e,s){i.doMenuClick(e)})),this.mnuEdit.onMenuClick.push((function(t,e,s){i.doMenuClick(e)}))}doMenuClick(t){let e=this;if("open"==t&&async function(){let t=await CDialogs.showLocalFileOpenDataDialog();t&&(e.saveFileName=t.fileName,"string"==typeof t.data&&(e.txt.text=t.data,e.doSaveFileSet()))}(),"save"==t&&""!=this.saveFileName&&CDialogs.saveLocalText(e.saveFileName,e.txt.text),("saveas"==t||"save"==t&&""==this.saveFileName)&&async function(){let t=await CDialogs.showLocalFileSaveDataDialog(e.txt.text);t&&(e.saveFileName=t,e.doSaveFileSet())}(),"json"==t){let t=JSON.parse(e.txt.text);e.txt.text=JSON.stringify(t)}if("jsonf"==t){let t=JSON.parse(e.txt.text);e.txt.text=JSON.stringify(t,void 0,4)}if("objtojson"==t){let t=new Function("return "+e.txt.text)();e.txt.text=JSON.stringify(t)}if("jsontotree"==t){let t=new CAppJsonTree;t.desktop=CSystem.desktopList.get(0),t.editor.tree.setObject(JSON.parse(this.txt.text)),t.execute()}}doSaveFileSet(){for(let t=0;t<this.onSaveFileSet.length;t++)this.onSaveFileSet[t](this)}}class CCompareTextFrameModel extends CPanel{constructor(t,e){super(t,e),this.toolbar=new CPanel(this),this.btnCompare=new CButton(this.toolbar),this.lTextArea=new CPanel(this),this.leftTextArea=new CTextArea(this.lTextArea),this.rightTextArea=new CTextArea(this.lTextArea),this.spt=new CSplitter(this),this.lResult=new CPanel(this),this.grid=new CDataGrid(this.lResult),this.toolbar.propertyName="toolbar",this.btnCompare.propertyName="btnCompare",this.lTextArea.propertyName="lTextArea",this.leftTextArea.propertyName="leftTextArea",this.rightTextArea.propertyName="rightTextArea",this.spt.propertyName="spt",this.lResult.propertyName="lResult",this.grid.propertyName="grid"}doToData(t){super.doToData(t),CDataClass.putData(t,"toolbar",this.toolbar.toData(),{},!0),CDataClass.putData(t,"btnCompare",this.btnCompare.toData(),{},!0),CDataClass.putData(t,"lTextArea",this.lTextArea.toData(),{},!0),CDataClass.putData(t,"leftTextArea",this.leftTextArea.toData(),{},!0),CDataClass.putData(t,"rightTextArea",this.rightTextArea.toData(),{},!0),CDataClass.putData(t,"spt",this.spt.toData(),{},!0),CDataClass.putData(t,"lResult",this.lResult.toData(),{},!0),CDataClass.putData(t,"grid",this.grid.toData(),{},!0)}doFromData(t){super.doFromData(t),this.toolbar.fromData(CDataClass.getData(t,"toolbar",{},!0)),this.btnCompare.fromData(CDataClass.getData(t,"btnCompare",{},!0)),this.lTextArea.fromData(CDataClass.getData(t,"lTextArea",{},!0)),this.leftTextArea.fromData(CDataClass.getData(t,"leftTextArea",{},!0)),this.rightTextArea.fromData(CDataClass.getData(t,"rightTextArea",{},!0)),this.spt.fromData(CDataClass.getData(t,"spt",{},!0)),this.lResult.fromData(CDataClass.getData(t,"lResult",{},!0)),this.grid.fromData(CDataClass.getData(t,"grid",{},!0))}}class CCompareTextFrame extends CCompareTextFrameModel{constructor(t,e){super(t,e);let i=this;this.resource="compareText.frame",this.grid.onBeforeCellDraw=function(t,e,s,o,a,n){e==EPointerAreaKind.CLIENT&&(0==s&&i.grid.get(o)?.leftDiff||1==s&&i.grid.get(o)?.rightDiff?a.get(4).textSet.fill.solidColor="#ffff00":a.get(4).textSet.fill.solidColor="#61A4D2")},this.btnCompare.onClick=function(){i.compare()}}compare(){let t=new CNotifyObjectList([{fieldNames:"line,isCheck",isUnique:!1}]),e=new CNotifyObjectList([{fieldNames:"line,isCheck",isUnique:!1}]),i=this.leftTextArea.text.split("\n");for(let e=0;e<i.length;e++)t.add({line:i[e],row:e,otherRow:0,isCheck:!1,isDiff:!1});i=this.rightTextArea.text.split("\n");for(let t=0;t<i.length;t++)e.add({line:i[t],row:t,otherRow:0,isCheck:!1,isDiff:!1});console.log(e.indexes);for(let i=0;i<t.length;i++){let s=e.findIndexData({line:t.get(i).line,isCheck:!1});s.length>0?(s[0].isCheck=!0,t.get(i).otherRow=s[0].row):t.get(i).isDiff=!0}for(let i=0;i<e.length;i++){let s=t.findIndexData({line:e.get(i).line,isCheck:!1});s.length>0?(s[0].isCheck=!0,e.get(i).otherRow=s[0].row):e.get(i).isDiff=!0}let s=Math.max(t.length,e.length);this.grid.clear();for(let t=0;t<s;t++)this.grid.add({leftText:"",leftDiff:!1,rightText:"",rightDiff:!1});for(let e=0;e<t.length;e++){let i=this.grid.get(e);i&&(i.leftText=t.get(e).line),i&&(i.leftDiff=t.get(e).isDiff)}for(let t=0;t<e.length;t++){let i=this.grid.get(t);i&&(i.rightText=e.get(t).line),i&&(i.rightDiff=e.get(t).isDiff)}}}class CAppTextEditor extends CWindowApplication{constructor(t){super(),this.defaultWidth=800,this.defaultHeight=400,this.appName="";let e=this;this.editor=new CTextEditorFrame(this.mainWindow.body),this.editor.btnApply.visible=!1,this.editor.position.align=EPositionAlign.CLIENT,this.mainWindow.onShow=function(){e.mainWindow.caption.textSet.languageKey="W_TEXT_EDITOR"},t&&(this.editor.txt.text=t),e.editor.onSaveFileSet.push((function(){e.mainWindow.caption.textSet.languageKey="W_TEXT_EDITOR, ( "+e.editor.saveFileName+" )"}))}}class CAppCompareSource extends CWindowApplication{constructor(){super();let t=this;this.editor=new CCompareTextFrame(this.mainWindow.body),this.editor.position.align=EPositionAlign.CLIENT,this.mainWindow.onShow=function(){t.mainWindow.caption.text="Compare"},this.defaultWidth=800,this.defaultHeight=400}}class CAppJsonTree extends CWindowApplication{constructor(){super(),this.appName="";let t=this;this.editor=new CJsonToTreeFrame(this.mainWindow.body),this.editor.resource="rect/treeListBox2.control",this.editor.position.align=EPositionAlign.CLIENT,this.mainWindow.onShow=function(){t.mainWindow.caption.text="JSON To Tree"},this.defaultWidth=300,this.defaultHeight=400}}class CStringListPropertyEditor extends CCustomPropertyAppEditor{constructor(){super(),this.editor=new CTextEditorFrame(this.mainWindow.body);let t=this;this.editor.position.align=EPositionAlign.CLIENT,this.mainWindow.onShow=function(){t.mainWindow.caption.textSet.languageKey="W_TEXT_EDITOR"},this.defaultWidth=400,this.defaultHeight=300,this.editor.btnApply.onClick=function(){t.doApply("")}}doChangeInstance(){if("string"==typeof this.instance[this.property]&&(this.editor.txt.text=this.instance[this.property]),"object"==typeof this.instance[this.property]){if(this.instance[this.property]instanceof CList){let t=this.instance[this.property],e="";for(let i=0;i<t.length;i++)e+=0==i?t.get(i):"\n"+t.get(i);this.editor.txt.text=e}if(this.instance[this.property]instanceof Array&&(this.editor.txt.text=JSON.stringify(this.instance[this.property])),this.instance[this.property]instanceof CStringSet){let t=this.instance[this.property],e="";t.forEach((function(t){e+=""==e?t:"\n"+t})),this.editor.txt.text=e}if(this.instance[this.property]instanceof CNNMap||this.instance[this.property]instanceof CSSMap){let t=this.instance[this.property];this.editor.txt.text=JSON.stringify(t.toData(),void 0,2)}if(this.instance[this.property]instanceof Set){let t=[];this.instance[this.property].forEach((function(e){t.push(e)})),this.editor.txt.text=JSON.stringify(t)}if(this.instance[this.property]instanceof Map){let t=[];this.instance[this.property].forEach((function(e,i){t.push({key:i,value:e})})),this.editor.txt.text=JSON.stringify(t)}this.instance[this.property]instanceof CTreeData&&(this.editor.txt.text=JSON.stringify(this.instance[this.property].toData()))}super.doChangeInstance()}doApply(t){if("string"==typeof this.instance[this.property]&&(this.instance[this.property]=this.editor.txt.text),"object"==typeof this.instance[this.property]){if(this.instance[this.property]instanceof CList){let t=this.instance[this.property];t.clear();let e=this.editor.txt.text.split("\n");for(let i=0;i<e.length;i++)t.add(e[i])}if(this.instance[this.property]instanceof Array&&(this.instance[this.property]=JSON.parse(this.editor.txt.text)),this.instance[this.property]instanceof CStringSet){let t=this.instance[this.property];t.clear();let e=this.editor.txt.text.split("\n");for(let i=0;i<e.length;i++)t.add(e[i])}if((this.instance[this.property]instanceof CNNMap||this.instance[this.property]instanceof CSSMap)&&this.instance[this.property].fromData(JSON.parse(this.editor.txt.text)),this.instance[this.property]instanceof Set){let t=JSON.parse(this.editor.txt.text),e=new Set;for(let i=0;i<t.length;i++)e.add(t[i]);this.instance[this.property]=e}if(this.instance[this.property]instanceof Map){let t=JSON.parse(this.editor.txt.text),e=new Map;for(let i=0;i<t.length;i++)e.set(t[i].key,t[i].value);this.instance[this.property]=e}if(this.instance[this.property]instanceof CTreeData){let t=JSON.parse(this.editor.txt.text);this.instance[this.property].fromData(t)}}}}class CCustomControlEditorFrameDesignModel extends CPanel{constructor(t,e){super(t,e),this.menu=new CPanel(this),this.mnuFile=new CPopupButton(this.menu),this.mnuEdit=new CPopupButton(this.menu),this.lLeft=new CPanel(this),this.tree=new CObjectTreeListBox(this.lLeft),this.spl=new CSplitter(this),this.lClient=new CPanel(this),this.background=new CPanel(this.lClient),this.lblFileName=new CPanel(this.lClient),this.lRight=new CPanel(this),this.propertyEditor=new CTabPropertyEditor(this.lRight),this.spr=new CSplitter(this),this.cover=new CCover(this),this.menu.propertyName="menu",this.mnuFile.propertyName="mnuFile",this.mnuEdit.propertyName="mnuEdit",this.lLeft.propertyName="lLeft",this.tree.propertyName="tree",this.spl.propertyName="spl",this.lClient.propertyName="lClient",this.background.propertyName="background",this.lblFileName.propertyName="lblFileName",this.lRight.propertyName="lRight",this.propertyEditor.propertyName="propertyEditor",this.spr.propertyName="spr",this.cover.propertyName="cover"}doToData(t){super.doToData(t),CDataClass.putData(t,"menu",this.menu.toData(),{},!0),CDataClass.putData(t,"mnuFile",this.mnuFile.toData(),{},!0),CDataClass.putData(t,"mnuEdit",this.mnuEdit.toData(),{},!0),CDataClass.putData(t,"lLeft",this.lLeft.toData(),{},!0),CDataClass.putData(t,"tree",this.tree.toData(),{},!0),CDataClass.putData(t,"spl",this.spl.toData(),{},!0),CDataClass.putData(t,"lClient",this.lClient.toData(),{},!0),CDataClass.putData(t,"background",this.background.toData(),{},!0),CDataClass.putData(t,"lblFileName",this.lblFileName.toData(),{},!0),CDataClass.putData(t,"lRight",this.lRight.toData(),{},!0),CDataClass.putData(t,"propertyEditor",this.propertyEditor.toData(),{},!0),CDataClass.putData(t,"spr",this.spr.toData(),{},!0),CDataClass.putData(t,"cover",this.cover.toData(),{},!0)}doFromData(t){super.doFromData(t),this.menu.fromData(CDataClass.getData(t,"menu",{},!0)),this.mnuFile.fromData(CDataClass.getData(t,"mnuFile",{},!0)),this.mnuEdit.fromData(CDataClass.getData(t,"mnuEdit",{},!0)),this.lLeft.fromData(CDataClass.getData(t,"lLeft",{},!0)),this.tree.fromData(CDataClass.getData(t,"tree",{},!0)),this.spl.fromData(CDataClass.getData(t,"spl",{},!0)),this.lClient.fromData(CDataClass.getData(t,"lClient",{},!0)),this.background.fromData(CDataClass.getData(t,"background",{},!0)),this.lblFileName.fromData(CDataClass.getData(t,"lblFileName",{},!0)),this.lRight.fromData(CDataClass.getData(t,"lRight",{},!0)),this.propertyEditor.fromData(CDataClass.getData(t,"propertyEditor",{},!0)),this.spr.fromData(CDataClass.getData(t,"spr",{},!0)),this.cover.fromData(CDataClass.getData(t,"cover",{},!0))}doResource(){super.doResource()}doChangeSize(){super.doChangeSize(),this.cover.position.width=this.position.width,this.cover.position.height=this.position.height}doChildDataMapHandle(t){super.doChildDataMapHandle(t),t.delete(this.menu),t.delete(this.mnuFile),t.delete(this.mnuEdit),t.delete(this.lLeft),t.delete(this.tree),t.delete(this.spl),t.delete(this.lClient),t.delete(this.background),t.delete(this.lblFileName),t.delete(this.lRight),t.delete(this.propertyEditor),t.delete(this.spr),t.delete(this.cover)}}class CCustomControlEditorFrame extends CCustomControlEditorFrameDesignModel{get control(){return this.__control}constructor(t,e){super(t,e),this.saveIp="",this.savePort="",this.saveFileName="",this.resource="page/controlEditor.page";let i=this;this.mnuFile.onMenuClick.push((function(t,e,s){i.doMenuClick(e)})),this.mnuEdit.onMenuClick.push((function(t,e,s){i.doMenuClick(e)})),this.tree.onSelectItem=function(t){for(let t=0;t<i.tree.selectItems.length;t++)i.setControlProperty(i.tree.selectItems[t].value.control)},this.propertyEditor.editorCover=this.cover,this.refresh()}doMenuClick(t){let e=this;"create"==t&&this.doNewControl(),"open"==t&&e.doOpen(),"save"==t&&""!=this.saveFileName&&this.doSave(),("saveas"==t||"save"==t&&""==this.saveFileName)&&this.doSaveAs()}doOpen(){let t=this;!async function(){let e=await CDialogs.showLocalFileOpenDataDialog();if(e&&(t.saveFileName=e.fileName,t.lblFileName.text=e.fileName,"string"==typeof e.data)){let i=JSON.parse(e.data);t.clearControl(),t.__control=CControl.controlFromData(i,t.background),t.refresh()}}()}doSave(){this.__control&&CDialogs.saveLocalText(this.saveFileName,JSON.stringify(this.__control.toData()))}doSaveAs(){let t=this;this.__control&&async function(){let e=t.__control?.toData(),i=await CDialogs.showLocalFileSaveDataDialog(JSON.stringify(e));i&&(t.saveFileName=i,t.lblFileName.text=e.fileName)}()}doNewControl(){let t=this;CPromptMessage.promptSync("prompt.frame","Add control",["Class name","Property name"],(function(e){t.clearControl(),t.__control=t.doCreateControl(t.background,e[0],e[1])}),t.cover,["CPanel",CSequence.getSequence("unnamed")])}doCreateControl(t,e,i){this.clearControl();let s=new Function("parent","return new "+e+"(parent)")(t);return s.position.width=50,s.position.height=50,s.propertyName=i,this.refresh(),s}clearControl(){this.propertyEditor.clear(),this.__control=void 0;let t=CSystem.getChildControls(this.background);for(let e=t.length-1;e>=0;e--)t[e].remove()}setControlProperty(t){this.propertyEditor.clear(),this.propertyEditor.addInstance(t,t.propertyName)}refresh(){function t(e,i){let s;s=""!=i.propertyName?e.add({title:i.className,text:i.propertyName,control:i}):e.add({title:i.className,text:i.className,control:i});let o=CSystem.getChildControls(i);for(let e=0;e<o.length;e++)t(s.childItems,o[e])}this.tree.items.clear();let e=CSystem.getChildControls(this.background);for(let i=0;i<e.length;i++)t(this.tree.items,e[i]),this.setControlProperty(e[i]),this.tree.items.expandAll()}setControl(t){this.__control=t,t.parent=this.background,this.refresh()}}class CAppControlEditor extends CWindowApplication{constructor(){super(),this.defaultWidth=1200,this.defaultHeight=600,this.appName="Control Editor";let t=this;this.editor=new CCustomControlEditorFrame(this.mainWindow.body),this.editor.position.align=EPositionAlign.CLIENT,this.mainWindow.onShow=function(){t.mainWindow.caption.textSet.languageKey="W_CONTROL_EDITOR"}}}class CCustomPageEditorDesignModel extends CPanel{constructor(t,e){super(t,e),this.menu=new CPanel(this),this.mnuFile=new CPopupButton(this.menu),this.mnuEdit=new CPopupButton(this.menu),this.lLeft=new CPanel(this),this.lLTopClass=new CPanel(this.lLeft),this.lblClass=new CPanel(this.lLTopClass),this.edtClass=new CTextBox(this.lLTopClass),this.lLTop=new CPanel(this.lLeft),this.btnAddControl=new CButton(this.lLTop),this.btnDeleteControl=new CButton(this.lLTop),this.btnDown=new CButton(this.lLTop),this.btnUp=new CButton(this.lLTop),this.tree=new CTreeListBox(this.lLeft,[{fieldNames:"item",isUnique:!1}]),this.spl=new CSplitter(this),this.lClient=new CPanel(this),this.background=new CPanel(this.lClient),this.lCTop=new CPanel(this.background),this.lblFileName=new CPanel(this.lCTop),this.btnExec=new CButton(this.lCTop),this.scrollBox=new CScrollBox(this.background),this.page=new CPage,this.lRight=new CPanel(this),this.propertyEditor=new CTabPropertyEditor(this.lRight),this.spr=new CSplitter(this),this.cover=new CCover(this),this.menu.propertyName="menu",this.mnuFile.propertyName="mnuFile",this.mnuEdit.propertyName="mnuEdit",this.lLeft.propertyName="lLeft",this.lLTopClass.propertyName="lLTopClass",this.lblClass.propertyName="lblClass",this.edtClass.propertyName="edtClass",this.lLTop.propertyName="lLTop",this.btnAddControl.propertyName="btnAddControl",this.btnDeleteControl.propertyName="btnDeleteControl",this.btnDown.propertyName="btnDown",this.btnUp.propertyName="btnUp",this.tree.propertyName="tree",this.spl.propertyName="spl",this.lClient.propertyName="lClient",this.background.propertyName="background",this.lCTop.propertyName="lCTop",this.lblFileName.propertyName="lblFileName",this.btnExec.propertyName="btnExec",this.scrollBox.propertyName="scrollBox",this.page.propertyName="page",this.lRight.propertyName="lRight",this.propertyEditor.propertyName="propertyEditor",this.spr.propertyName="spr",this.cover.propertyName="cover"}doToData(t){super.doToData(t),CDataClass.putData(t,"menu",this.menu.toData(),{},!0),CDataClass.putData(t,"mnuFile",this.mnuFile.toData(),{},!0),CDataClass.putData(t,"mnuEdit",this.mnuEdit.toData(),{},!0),CDataClass.putData(t,"lLeft",this.lLeft.toData(),{},!0),CDataClass.putData(t,"lLTopClass",this.lLTopClass.toData(),{},!0),CDataClass.putData(t,"lblClass",this.lblClass.toData(),{},!0),CDataClass.putData(t,"edtClass",this.edtClass.toData(),{},!0),CDataClass.putData(t,"lLTop",this.lLTop.toData(),{},!0),CDataClass.putData(t,"btnAddControl",this.btnAddControl.toData(),{},!0),CDataClass.putData(t,"btnDeleteControl",this.btnDeleteControl.toData(),{},!0),CDataClass.putData(t,"btnDown",this.btnDown.toData(),{},!0),CDataClass.putData(t,"btnUp",this.btnUp.toData(),{},!0),CDataClass.putData(t,"tree",this.tree.toData(),{},!0),CDataClass.putData(t,"spl",this.spl.toData(),{},!0),CDataClass.putData(t,"lClient",this.lClient.toData(),{},!0),CDataClass.putData(t,"background",this.background.toData(),{},!0),CDataClass.putData(t,"lCTop",this.lCTop.toData(),{},!0),CDataClass.putData(t,"lblFileName",this.lblFileName.toData(),{},!0),CDataClass.putData(t,"btnExec",this.btnExec.toData(),{},!0),CDataClass.putData(t,"scrollBox",this.scrollBox.toData(),{},!0),CDataClass.putData(t,"page",this.page.toData(),{},!0),CDataClass.putData(t,"lRight",this.lRight.toData(),{},!0),CDataClass.putData(t,"propertyEditor",this.propertyEditor.toData(),{},!0),CDataClass.putData(t,"spr",this.spr.toData(),{},!0),CDataClass.putData(t,"cover",this.cover.toData(),{},!0)}doFromData(t){super.doFromData(t),this.menu.fromData(CDataClass.getData(t,"menu",{},!0)),this.mnuFile.fromData(CDataClass.getData(t,"mnuFile",{},!0)),this.mnuEdit.fromData(CDataClass.getData(t,"mnuEdit",{},!0)),this.lLeft.fromData(CDataClass.getData(t,"lLeft",{},!0)),this.lLTopClass.fromData(CDataClass.getData(t,"lLTopClass",{},!0)),this.lblClass.fromData(CDataClass.getData(t,"lblClass",{},!0)),this.edtClass.fromData(CDataClass.getData(t,"edtClass",{},!0)),this.lLTop.fromData(CDataClass.getData(t,"lLTop",{},!0)),this.btnAddControl.fromData(CDataClass.getData(t,"btnAddControl",{},!0)),this.btnDeleteControl.fromData(CDataClass.getData(t,"btnDeleteControl",{},!0)),this.btnDown.fromData(CDataClass.getData(t,"btnDown",{},!0)),this.btnUp.fromData(CDataClass.getData(t,"btnUp",{},!0)),this.tree.fromData(CDataClass.getData(t,"tree",{},!0)),this.spl.fromData(CDataClass.getData(t,"spl",{},!0)),this.lClient.fromData(CDataClass.getData(t,"lClient",{},!0)),this.background.fromData(CDataClass.getData(t,"background",{},!0)),this.lCTop.fromData(CDataClass.getData(t,"lCTop",{},!0)),this.lblFileName.fromData(CDataClass.getData(t,"lblFileName",{},!0)),this.btnExec.fromData(CDataClass.getData(t,"btnExec",{},!0)),this.scrollBox.fromData(CDataClass.getData(t,"scrollBox",{},!0)),this.page.fromData(CDataClass.getData(t,"page",{},!0)),this.lRight.fromData(CDataClass.getData(t,"lRight",{},!0)),this.propertyEditor.fromData(CDataClass.getData(t,"propertyEditor",{},!0)),this.spr.fromData(CDataClass.getData(t,"spr",{},!0)),this.cover.fromData(CDataClass.getData(t,"cover",{},!0)),this.page.parent=this.scrollBox.content}doResource(){super.doResource(),this.page.parent=this.scrollBox.content}doChangeSize(){super.doChangeSize(),this.cover.position.width=this.position.width,this.cover.position.height=this.position.height}doChildDataMapHandle(t){super.doChildDataMapHandle(t),t.delete(this.menu),t.delete(this.mnuFile),t.delete(this.mnuEdit),t.delete(this.lLeft),t.delete(this.lLTopClass),t.delete(this.lblClass),t.delete(this.edtClass),t.delete(this.lLTop),t.delete(this.btnAddControl),t.delete(this.btnDeleteControl),t.delete(this.btnDown),t.delete(this.btnUp),t.delete(this.tree),t.delete(this.spl),t.delete(this.lClient),t.delete(this.background),t.delete(this.lCTop),t.delete(this.lblFileName),t.delete(this.btnExec),t.delete(this.scrollBox),t.delete(this.page),t.delete(this.lRight),t.delete(this.propertyEditor),t.delete(this.spr),t.delete(this.cover)}}!function(t){t[t.Panel=0]="Panel",t[t.Button=1]="Button",t[t.CheckButton=2]="CheckButton",t[t.SelectGropuButton=3]="SelectGropuButton",t[t.Scrollbar=4]="Scrollbar",t[t.TextBox=5]="TextBox",t[t.TextArea=6]="TextArea",t[t.ComboBox=7]="ComboBox",t[t.ListBox=8]="ListBox",t[t.TreeListBox=9]="TreeListBox",t[t.Grid=10]="Grid",t[t.Calendar=11]="Calendar",t[t.Scrollbox=12]="Scrollbox",t[t.Cover=13]="Cover",t[t.Splitter=14]="Splitter",t[t.PopupButton=15]="PopupButton",t[t.Tab=16]="Tab",t[t.Progress=17]="Progress",t[t.Class=18]="Class"}(EControlKind||(EControlKind={}));class CCustomPageEditor extends CCustomPageEditorDesignModel{constructor(t,e){super(t,e);let i=this;this.resource="page/pageEditor.page",this.tabIndex="0",this.page.propertyName="Page",this.page.onClick=function(){i.propertyEditor.clear(),i.propertyEditor.addInstance(i.page,"page"),i.doTreeSelect(i.page)},this.page.onChangeSize=function(){i.scrollBox.contentWidth=i.page.position.width,i.scrollBox.contentHeight=i.page.position.height},this.scrollBox.contentWidth=this.page.position.width,this.scrollBox.contentHeight=this.page.position.height,this.lLTop.onClick=function(){console.log(i.toTypeScript())},this.btnAddControl.onClick=async function(){let t=[];CSystem.resources.forEach((function(e,i){t.push(i)}));let e=await CPromptMessage.prompt("prompt.frame","Add control",["Name","Control","Class","Resource"],i.cover,["",["Panel","Button","CheckButton","SelectGropuButton","Scrollbar","TextBox","TextArea","ComboBox","ListBox","TreeListBox","Grid","Calendar","Scrollbox","Cover","Splitter","PopupButton","Tab","Progress"],"",""]);if(e.length>0){if(""==e[0])return void CShowMessage.showMessage("showMessage.frame","Warning","Exists control : "+e[0]);if(CSystem.controls.findControls([{columnName:"name",value:e[0]}]).length>0)return void CShowMessage.showMessage("showMessage.frame","Warning","Exists control : "+e[0]);let t,s=e[2];if(i.tree.selectItems.length>0){t=i.tree.selectItems[0].value.control}else t=i.page;if(""!=s)i.doAddControl(EControlKind.Class,e[0],t,s,e[3]);else{let s=e[1];"Panel"==s&&i.doAddControl(EControlKind.Panel,e[0],t,"",e[3]),"Button"==s&&i.doAddControl(EControlKind.Button,e[0],t,"",e[3]),"CheckButton"==s&&i.doAddControl(EControlKind.CheckButton,e[0],t,"",e[3]),"SelectGropuButton"==s&&i.doAddControl(EControlKind.SelectGropuButton,e[0],t,"",e[3]),"Scrollbar"==s&&i.doAddControl(EControlKind.Scrollbar,e[0],t,"",e[3]),"TextBox"==s&&i.doAddControl(EControlKind.TextBox,e[0],t,"",e[3]),"TextArea"==s&&i.doAddControl(EControlKind.TextArea,e[0],t,"",e[3]),"ComboBox"==s&&i.doAddControl(EControlKind.ComboBox,e[0],t,"",e[3]),"ListBox"==s&&i.doAddControl(EControlKind.ListBox,e[0],t,"",e[3]),"TreeListBox"==s&&i.doAddControl(EControlKind.TreeListBox,e[0],t,"",e[3]),"Grid"==s&&i.doAddControl(EControlKind.Grid,e[0],t,"",e[3]),"Calendar"==s&&i.doAddControl(EControlKind.Calendar,e[0],t,"",e[3]),"Scrollbox"==s&&i.doAddControl(EControlKind.Scrollbox,e[0],t,"",e[3]),"Cover"==s&&i.doAddControl(EControlKind.Cover,e[0],t,"",e[3]),"Splitter"==s&&i.doAddControl(EControlKind.Splitter,e[0],t,"",e[3]),"PopupButton"==s&&i.doAddControl(EControlKind.PopupButton,e[0],t,"",e[3]),"Tab"==s&&i.doAddControl(EControlKind.Tab,e[0],t,"",e[3]),"Progress"==s&&i.doAddControl(EControlKind.Progress,e[0],t,"",e[3])}}},this.propertyEditor.editorCover=this.cover}doResource(){super.doResource()}doKeyDown(t){super.doKeyDown(t),t.altKey&&"F"==t.key.toUpperCase()&&(this.mnuFile.click(),t.preventDefault()),t.altKey&&"E"==t.key.toUpperCase()&&(this.mnuEdit.click(),t.preventDefault())}doAddControl(t,e,i,s,o,a){let n,r=this;if(o&&!CSystem.resources.has(o))throw new Error("Not exists resource : "+o);if(t==EControlKind.Panel&&(n=new CPanel(i,e),n.resource=null!=o&&""!=o?o:"base/basePanel.control"),t==EControlKind.Button&&(n=new CButton(i,e),n.resource=null!=o&&""!=o?o:"base/baseButton.control"),t==EControlKind.CheckButton&&(n=new CCheckBox(i,e),n.resource=null!=o&&""!=o?o:"base/baseCheckBox.control"),t==EControlKind.SelectGropuButton&&(n=new CSelectGroupBox(i,e),n.resource=null!=o&&""!=o?o:"base/baseSelectButton.control"),t==EControlKind.Scrollbar&&(n=new CScrollbar(i,e),n.resource=null!=o&&""!=o?o:"base/baseScrollbar.control"),t==EControlKind.TextBox&&(n=new CTextBox(i,e),n.resource=null!=o&&""!=o?o:"base/baseTextBox.control"),t==EControlKind.TextArea&&(n=new CTextArea(i,e),n.resource=null!=o&&""!=o?o:"base/baseTextArea.control"),t==EControlKind.ComboBox&&(n=new CComboBox(i,e),n.resource=null!=o&&""!=o?o:"base/baseComboBox.control"),t==EControlKind.ListBox&&(n=new CObjectListBox(i,e),n.resource=null!=o&&o?o:"base/baseListBox.control"),t==EControlKind.TreeListBox&&(n=new CObjectTreeListBox(i,[],e),n.resource=null!=o&&o?o:"base/baseTreeListBox.control"),t==EControlKind.Grid&&(n=new CDataGrid(i,[],[],e),n.resource=null!=o&&o?o:"base/baseGrid.control",n.position.width=300,n.position.height=200),t==EControlKind.Calendar&&(n=new CCalendar(i,e),n.resource=null!=o&&o?o:"base/baseCalendar.control",n.position.width=300,n.position.height=200),t==EControlKind.Scrollbox&&(n=new CScrollBox(i,e),n.resource=null!=o&&o?o:"base/baseScrollBox.control"),t==EControlKind.Cover&&(n=new CCover(i,e),n.resource=null!=o&&o?o:"base/baseCover.control"),t==EControlKind.Splitter&&(n=new CSplitter(i,e),n.position.width=50,n.position.height=50),t==EControlKind.PopupButton&&(n=new CPopupButton(i,e),n.resource=null!=o&&o?o:"base/basePopupButton.control"),t==EControlKind.Tab&&(n=new CTab(i,e),n.resource=null!=o&&o?o:"base/baseTab.control",n.onChangeTabs=function(){r.refreshTree()}),t==EControlKind.Progress&&(n=new CProgressBar(i,e),n.resource=null!=o&&o?o:"base/baseProgress.control"),t==EControlKind.Class){let t=new Function("parent","name","return new "+s+"(parent, name)");n=t(i,e),n.resource=o}return a&&(n.position.left=a.x,n.position.top=a.y),n.propertyName=e,n.isDesignMode=!0,n.onClick=function(){r.doTreeSelect(n),r.propertyEditor.clear(),r.propertyEditor.addInstance(n,n.propertyName)},r.propertyEditor.clear(),r.propertyEditor.addInstance(n,n.propertyName),n}doTreeSelect(t){let e=this;this.tree.items.loopWithChild((function(i,s){s.value.control==t&&e.tree.selectItem(s)}))}refreshTree(t){this.tree.clear();let e=this.page.containerListWithChild();!function t(e,i,s){for(let s=0;s<i.length;s++){let o=i.getItem(s);t(e.add({text:o.value.name,control:o.value.control,isMainContainer:o.value.isMainContainer}).childItems,o.childItems)}}(this.tree.items,e),this.tree.items.expandAll(),this.page.childControlsPositionSetAll(),t&&this.doTreeSelect(t)}toTypeScript(){let t=[],e=[],i=[],s=[],o=[],a=[],n=[],r=[],l=[];!function h(d,g,C){if(C>0){let h=!1,c=!1,u=!1,p="this",A=0,m="",f="";if(""!=g){if(0==d.kind.indexOf("sheet:")){let t=d.kind.split(":");p="",m=t[2],A=parseInt(t[1]),h=!0}else if(0==d.kind.indexOf("content:")){p="",f=d.kind.split(":")[1],c=!0}else if(0==d.kind.indexOf("background:")){p="",f=d.kind.split(":")[1],u=!0}else p="this."+g;"this.Page"==p&&(p="this")}let D="";if(""==p)for(let t=0;t<C-1;t++)D+="\t";else for(let t=0;t<C;t++)D+="\t";t.push(d.control.propertyName),e.push("\n"+D+"public "+d.control.propertyName+" = new "+d.control.className+"("+p+")"),i.push("\n\t\tthis."+d.control.propertyName+'.propertyName = "'+d.control.propertyName+'"'),s.push('\n\t\tCDataClass.putData(data, "'+d.control.propertyName+'", this.'+d.control.propertyName+".toData(), {}, true)"),o.push("\n\t\tthis."+d.control.propertyName+'.fromData(CDataClass.getData(data, "'+d.control.propertyName+'", {}, true))'),h&&a.push(`\n\t\tthis.${d.control.propertyName}.parent = this.${m}.tabSheets.get(${A})`),c&&n.push(`\n\t\tthis.${d.control.propertyName}.parent = this.${f}.content`),u&&r.push(`\n\t\tthis.${d.control.propertyName}.parent = this.${f}.background`),d.control instanceof CCover&&(l.push(`\n\t\tthis.${d.control.propertyName}.position.width = this.position.width`),l.push(`\n\t\tthis.${d.control.propertyName}.position.height = this.position.height`))}for(let t=0;t<d.childList.length;t++)h(d.childList[t],d.control.propertyName,C+1)}(this.page.childAllControls(),"",0);let h="class "+this.edtClass.text+" extends CPage {";for(let t=0;t<e.length;t++)h+=e[t];h+="\n\tconstructor(parent?: CControl | HTMLElement, name?: string) {",h+="\n\t\tsuper(parent, name)";for(let t=0;t<i.length;t++)h+=i[t];h+="\n\t}",h+="\n\tdoFromData(data: any): void {",h+="\n\t\tsuper.doFromData(data)";for(let t=0;t<a.length;t++)h+=a[t];for(let t=0;t<n.length;t++)h+=n[t];for(let t=0;t<r.length;t++)h+=r[t];h+="\n\t}",h+="\n\tdoResource(): void {",h+="\n\t\tsuper.doResource()";for(let t=0;t<a.length;t++)h+=a[t];for(let t=0;t<n.length;t++)h+=n[t];for(let t=0;t<r.length;t++)h+=r[t];h+="\n\t}",h+="\n\tdoChangeSize() {",h+="\n\t\tsuper.doChangeSize()";for(let t=0;t<l.length;t++)h+=l[t];h+="\n\t}",h+="\n\tdoChildDataMapHandle(map: Map<CControl, {kind: string, data: any}>): void {",h+="\n\t\tsuper.doChildDataMapHandle(map)";for(let e=0;e<t.length;e++)h+="\n\t\tmap.delete(this."+t[e]+")";return h+="\n\t}",h+="\n}",h}}class CPageEditor extends CCustomPageEditor{constructor(t,e){super(t,e),this.saveIp="",this.savePort="",this.saveFileName="",this.finderKind="open";let i=this;this.tree.onSelectItem=function(){let t=i.tree.selectItems;if(t.length>0){let e=t[0].value;i.propertyEditor.clear(),i.propertyEditor.addInstance(e.control,e.control.propertyName)}},this.btnDeleteControl.onClick=function(){i.doDeleteControl()},this.mnuFile.onMenuClick.push((function(t,e,s){i.doMenuClick(e)})),this.mnuEdit.onMenuClick.push((function(t,e,s){i.doMenuClick(e)})),this.btnExec.onClick=function(){let t=new CAppPreview;t.desktop=CSystem.desktopList.get(0),t.data=i.page.childAllData(),t.execute()},this.btnUp.onClick=function(){i.doUp()},this.btnDown.onClick=function(){i.doDown()},this.propertyEditor.onBeforeEditorApply.push((function(t,e,s,o,a,n){"propertyName"==e.cell(0,o)&&i.tree.items.loopWithChild((function(t,i){i.value.control==e.classInstance&&(i.value.text=n)}))})),this.tree.onKeyDown=function(t,e){e.ctrlKey&&"C"==e.key.toUpperCase()&&i.doCopy(),e.ctrlKey&&"V"==e.key.toUpperCase()&&i.doPaste(),e.ctrlKey&&"L"==e.key.toUpperCase()&&i.doCreateDesignModel(),e.ctrlKey&&"R"==e.key.toUpperCase()&&i.doCreateResource()}}doResource(){super.doResource(),this.tree.tabIndex="0"}doUp(){let t=this.getSelectedTreeItem();t&&t.index>0&&(CSystem.controlElementUp(t.value.control),this.refreshTree(t.value.control))}doDown(){let t=this.getSelectedTreeItem();if(t){let e=t.parentData;t.index<e.length-1&&(CSystem.controlElementDown(t.value.control),this.refreshTree(t.value.control))}}doAddControl(t,e,i,s,o,a){let n=super.doAddControl(t,e,i,s,o,a);return this.refreshTree(n),n}doDeleteControl(){let t=this.getSelectedTreeItem();t&&(t.value.control.remove(),this.refreshTree())}doCopy(){let t=this.getSelectedTreeItem();t&&navigator.clipboard.writeText(JSON.stringify(t.value.control.childAllData()))}doPaste(){let t=this,e=this.getSelectedTreeItem();e&&navigator.clipboard.readText().then((function(i){let s=JSON.parse(i),o=CControl.controlFromData(s.data);o.fromAllChildData(s),o.parent=e?.value.control,t.refreshTree(o)}))}doCreateDesignModel(){let t=new CAppTextEditor(this.toTypeScript());t.desktop=CSystem.desktopList.get(0),t.execute()}doCreateResource(){let t=new CAppTextEditor(JSON.stringify(this.page.childAllData(),void 0,4));t.desktop=CSystem.desktopList.get(0),t.execute()}doMenuClick(t){let e=this;if("createDesignModel"==t&&e.doCreateDesignModel(),"createResource"==t&&e.doCreateResource(),"copy"==t&&e.doCopy(),"paste"==t&&e.doPaste(),"open"==t&&async function(){let t=await CDialogs.showLocalFileOpenDataDialog();if(t&&(e.saveFileName=t.fileName,"string"==typeof t.data)){let i=JSON.parse(t.data),s=CSystem.getChildControls(e.page);for(let t=0;t<s.length;t++)s[t].remove();i.pageClassName&&(e.edtClass.text=i.pageClassName),e.page.fromAllChildData(i),e.refreshTree(),e.lblFileName.text=t.fileName}}(),"save"==t&&""!=this.saveFileName){let t=e.page.childAllData();t.pageClassName=e.edtClass.text,CDialogs.saveLocalText(e.saveFileName,JSON.stringify(t))}("saveas"==t||"save"==t&&""==this.saveFileName)&&async function(){let t=e.page.childAllData();t.pageClassName=e.edtClass.text;let i=await CDialogs.showLocalFileSaveDataDialog(JSON.stringify(t));i&&(e.saveFileName=i,e.lblFileName.text=i)}()}getSelectedTreeItem(){let t=this.tree.selectItems;if(t.length>0){return t[0]}}}class CAppPageEditor extends CWindowApplication{constructor(){super(),this.defaultWidth=1400,this.defaultHeight=750,this.appName="";let t=this;this.editor=new CPageEditor(this.mainWindow.body),this.editor.position.align=EPositionAlign.CLIENT,this.mainWindow.onShow=function(){t.mainWindow.caption.textSet.languageKey="W_PAGE_EDITOR"},this.editor.refreshTree()}}class CAppPreview extends CWindowApplication{constructor(){super(),this.defaultWidth=800,this.defaultHeight=600,this.appName="";let t=this;this.frame=new CPanel(this.mainWindow.body),this.mainWindow.onShow=function(){t.mainWindow.caption.textSet.languageKey="W_PREVIEW"}}doExecute(){super.doExecute(),this.frame.fromAllChildData(this.data),this.frame.position.align=EPositionAlign.CLIENT}}class CCanvasItemsEditorFrameDesignModel extends CPanel{constructor(t,e){super(t,e),this.menu=new CPanel(this),this.mnuFile=new CPopupButton(this.menu),this.mnuEdit=new CPopupButton(this.menu),this.btnItemsApply=new CButton(this.menu),this.lLeft=new CPanel(this),this.lLTop=new CPanel(this.lLeft),this.btnAddItem=new CButton(this.lLTop),this.btnDeleteItem=new CButton(this.lLTop),this.btnDown=new CButton(this.lLTop),this.btnUp=new CButton(this.lLTop),this.lstItem=new CObjectListBox(this.lLeft),this.spl=new CSplitter(this),this.lClient=new CPanel(this),this.lCClient=new CPanel(this.lClient),this.itemControl=new CPanel(this.lCClient),this.dash=new CPanel(this.itemControl),this.lblFileName=new CPanel(this.lCClient),this.lCBottom=new CPanel(this.lClient),this.lblWidth=new CPanel(this.lCBottom),this.edtWidth=new CTextBox(this.lCBottom),this.lblHeight=new CPanel(this.lCBottom),this.edtHeight=new CTextBox(this.lCBottom),this.btnSizeApply=new CButton(this.lCBottom),this.btnDash=new CCheckBox(this.lCBottom),this.lRight=new CPanel(this),this.propertyEditor=new CTabPropertyEditor(this.lRight),this.spr=new CSplitter(this),this.cover=new CCover(this),this.menu.propertyName="menu",this.mnuFile.propertyName="mnuFile",this.mnuEdit.propertyName="mnuEdit",this.btnItemsApply.propertyName="btnItemsApply",this.lLeft.propertyName="lLeft",this.lLTop.propertyName="lLTop",this.btnAddItem.propertyName="btnAddItem",this.btnDeleteItem.propertyName="btnDeleteItem",this.btnDown.propertyName="btnDown",this.btnUp.propertyName="btnUp",this.lstItem.propertyName="lstItem",this.spl.propertyName="spl",this.lClient.propertyName="lClient",this.lCClient.propertyName="lCClient",this.itemControl.propertyName="itemControl",this.dash.propertyName="dash",this.lblFileName.propertyName="lblFileName",this.lCBottom.propertyName="lCBottom",this.lblWidth.propertyName="lblWidth",this.edtWidth.propertyName="edtWidth",this.lblHeight.propertyName="lblHeight",this.edtHeight.propertyName="edtHeight",this.btnSizeApply.propertyName="btnSizeApply",this.btnDash.propertyName="btnDash",this.lRight.propertyName="lRight",this.propertyEditor.propertyName="propertyEditor",this.spr.propertyName="spr",this.cover.propertyName="cover"}doToData(t){super.doToData(t),CDataClass.putData(t,"menu",this.menu.toData(),{},!0),CDataClass.putData(t,"mnuFile",this.mnuFile.toData(),{},!0),CDataClass.putData(t,"mnuEdit",this.mnuEdit.toData(),{},!0),CDataClass.putData(t,"btnItemsApply",this.btnItemsApply.toData(),{},!0),CDataClass.putData(t,"lLeft",this.lLeft.toData(),{},!0),CDataClass.putData(t,"lLTop",this.lLTop.toData(),{},!0),CDataClass.putData(t,"btnAddItem",this.btnAddItem.toData(),{},!0),CDataClass.putData(t,"btnDeleteItem",this.btnDeleteItem.toData(),{},!0),CDataClass.putData(t,"btnDown",this.btnDown.toData(),{},!0),CDataClass.putData(t,"btnUp",this.btnUp.toData(),{},!0),CDataClass.putData(t,"lstItem",this.lstItem.toData(),{},!0),CDataClass.putData(t,"spl",this.spl.toData(),{},!0),CDataClass.putData(t,"lClient",this.lClient.toData(),{},!0),CDataClass.putData(t,"lCClient",this.lCClient.toData(),{},!0),CDataClass.putData(t,"itemControl",this.itemControl.toData(),{},!0),CDataClass.putData(t,"dash",this.dash.toData(),{},!0),CDataClass.putData(t,"lblFileName",this.lblFileName.toData(),{},!0),CDataClass.putData(t,"lCBottom",this.lCBottom.toData(),{},!0),CDataClass.putData(t,"lblWidth",this.lblWidth.toData(),{},!0),CDataClass.putData(t,"edtWidth",this.edtWidth.toData(),{},!0),CDataClass.putData(t,"lblHeight",this.lblHeight.toData(),{},!0),CDataClass.putData(t,"edtHeight",this.edtHeight.toData(),{},!0),CDataClass.putData(t,"btnSizeApply",this.btnSizeApply.toData(),{},!0),CDataClass.putData(t,"btnDash",this.btnDash.toData(),{},!0),CDataClass.putData(t,"lRight",this.lRight.toData(),{},!0),CDataClass.putData(t,"propertyEditor",this.propertyEditor.toData(),{},!0),CDataClass.putData(t,"spr",this.spr.toData(),{},!0),CDataClass.putData(t,"cover",this.cover.toData(),{},!0)}doFromData(t){super.doFromData(t),this.menu.fromData(CDataClass.getData(t,"menu",{},!0)),this.mnuFile.fromData(CDataClass.getData(t,"mnuFile",{},!0)),this.mnuEdit.fromData(CDataClass.getData(t,"mnuEdit",{},!0)),this.btnItemsApply.fromData(CDataClass.getData(t,"btnItemsApply",{},!0)),this.lLeft.fromData(CDataClass.getData(t,"lLeft",{},!0)),this.lLTop.fromData(CDataClass.getData(t,"lLTop",{},!0)),this.btnAddItem.fromData(CDataClass.getData(t,"btnAddItem",{},!0)),this.btnDeleteItem.fromData(CDataClass.getData(t,"btnDeleteItem",{},!0)),this.btnDown.fromData(CDataClass.getData(t,"btnDown",{},!0)),this.btnUp.fromData(CDataClass.getData(t,"btnUp",{},!0)),this.lstItem.fromData(CDataClass.getData(t,"lstItem",{},!0)),this.spl.fromData(CDataClass.getData(t,"spl",{},!0)),this.lClient.fromData(CDataClass.getData(t,"lClient",{},!0)),this.lCClient.fromData(CDataClass.getData(t,"lCClient",{},!0)),this.itemControl.fromData(CDataClass.getData(t,"itemControl",{},!0)),this.dash.fromData(CDataClass.getData(t,"dash",{},!0)),this.lblFileName.fromData(CDataClass.getData(t,"lblFileName",{},!0)),this.lCBottom.fromData(CDataClass.getData(t,"lCBottom",{},!0)),this.lblWidth.fromData(CDataClass.getData(t,"lblWidth",{},!0)),this.edtWidth.fromData(CDataClass.getData(t,"edtWidth",{},!0)),this.lblHeight.fromData(CDataClass.getData(t,"lblHeight",{},!0)),this.edtHeight.fromData(CDataClass.getData(t,"edtHeight",{},!0)),this.btnSizeApply.fromData(CDataClass.getData(t,"btnSizeApply",{},!0)),this.btnDash.fromData(CDataClass.getData(t,"btnDash",{},!0)),this.lRight.fromData(CDataClass.getData(t,"lRight",{},!0)),this.propertyEditor.fromData(CDataClass.getData(t,"propertyEditor",{},!0)),this.spr.fromData(CDataClass.getData(t,"spr",{},!0)),this.cover.fromData(CDataClass.getData(t,"cover",{},!0))}doResource(){super.doResource()}doChangeSize(){super.doChangeSize(),this.cover.position.width=this.position.width,this.cover.position.height=this.position.height}doChildDataMapHandle(t){super.doChildDataMapHandle(t),t.delete(this.menu),t.delete(this.mnuFile),t.delete(this.mnuEdit),t.delete(this.btnItemsApply),t.delete(this.lLeft),t.delete(this.lLTop),t.delete(this.btnAddItem),t.delete(this.btnDeleteItem),t.delete(this.btnDown),t.delete(this.btnUp),t.delete(this.lstItem),t.delete(this.spl),t.delete(this.lClient),t.delete(this.lCClient),t.delete(this.itemControl),t.delete(this.dash),t.delete(this.lblFileName),t.delete(this.lCBottom),t.delete(this.lblWidth),t.delete(this.edtWidth),t.delete(this.lblHeight),t.delete(this.edtHeight),t.delete(this.btnSizeApply),t.delete(this.btnDash),t.delete(this.lRight),t.delete(this.propertyEditor),t.delete(this.spr),t.delete(this.cover)}}class CCustomLayersEditorDesignModel extends CPanel{constructor(t,e){super(t,e),this.menu=new CPanel(this),this.mnuFile=new CPopupButton(this.menu),this.mnuEdit=new CPopupButton(this.menu),this.btnLayersApply=new CButton(this.menu),this.lLeft=new CPanel(this),this.lLTopLayer=new CPanel(this.lLeft),this.btnAddLayer=new CButton(this.lLTopLayer),this.btnDeleteLayer=new CButton(this.lLTopLayer),this.btnDownLayer=new CButton(this.lLTopLayer),this.btnUpLayer=new CButton(this.lLTopLayer),this.lstLayer=new CObjectListBox(this.lLeft),this.spt=new CSplitter(this.lLeft),this.lLTop=new CPanel(this.lLeft),this.btnAddItem=new CButton(this.lLTop),this.btnDeleteItem=new CButton(this.lLTop),this.btnDown=new CButton(this.lLTop),this.btnUp=new CButton(this.lLTop),this.lstItem=new CObjectListBox(this.lLeft),this.spl=new CSplitter(this),this.lClient=new CPanel(this),this.lCClient=new CPanel(this.lClient),this.itemControl=new CPanel(this.lCClient),this.dash=new CPanel(this.itemControl),this.lblFileName=new CPanel(this.lCClient),this.lCBottom=new CPanel(this.lClient),this.lblWidth=new CPanel(this.lCBottom),this.edtWidth=new CTextBox(this.lCBottom),this.lblHeight=new CPanel(this.lCBottom),this.edtHeight=new CTextBox(this.lCBottom),this.btnSizeApply=new CButton(this.lCBottom),this.btnDash=new CCheckBox(this.lCBottom),this.lRight=new CPanel(this),this.propertyEditor=new CTabPropertyEditor(this.lRight),this.spr=new CSplitter(this),this.cover=new CCover(this),this.menu.propertyName="menu",this.mnuFile.propertyName="mnuFile",this.mnuEdit.propertyName="mnuEdit",this.btnLayersApply.propertyName="btnLayersApply",this.lLeft.propertyName="lLeft",this.lLTopLayer.propertyName="lLTopLayer",this.btnAddLayer.propertyName="btnAddLayer",this.btnDeleteLayer.propertyName="btnDeleteLayer",this.btnDownLayer.propertyName="btnDownLayer",this.btnUpLayer.propertyName="btnUpLayer",this.lstLayer.propertyName="lstLayer",this.spt.propertyName="spt",this.lLTop.propertyName="lLTop",this.btnAddItem.propertyName="btnAddItem",this.btnDeleteItem.propertyName="btnDeleteItem",this.btnDown.propertyName="btnDown",this.btnUp.propertyName="btnUp",this.lstItem.propertyName="lstItem",this.spl.propertyName="spl",this.lClient.propertyName="lClient",this.lCClient.propertyName="lCClient",this.itemControl.propertyName="itemControl",this.dash.propertyName="dash",this.lblFileName.propertyName="lblFileName",this.lCBottom.propertyName="lCBottom",this.lblWidth.propertyName="lblWidth",this.edtWidth.propertyName="edtWidth",this.lblHeight.propertyName="lblHeight",this.edtHeight.propertyName="edtHeight",this.btnSizeApply.propertyName="btnSizeApply",this.btnDash.propertyName="btnDash",this.lRight.propertyName="lRight",this.propertyEditor.propertyName="propertyEditor",this.spr.propertyName="spr",this.cover.propertyName="cover"}doToData(t){super.doToData(t),CDataClass.putData(t,"menu",this.menu.toData(),{},!0),CDataClass.putData(t,"mnuFile",this.mnuFile.toData(),{},!0),CDataClass.putData(t,"mnuEdit",this.mnuEdit.toData(),{},!0),CDataClass.putData(t,"btnLayersApply",this.btnLayersApply.toData(),{},!0),CDataClass.putData(t,"lLeft",this.lLeft.toData(),{},!0),CDataClass.putData(t,"lLTopLayer",this.lLTopLayer.toData(),{},!0),CDataClass.putData(t,"btnAddLayer",this.btnAddLayer.toData(),{},!0),CDataClass.putData(t,"btnDeleteLayer",this.btnDeleteLayer.toData(),{},!0),CDataClass.putData(t,"btnDownLayer",this.btnDownLayer.toData(),{},!0),CDataClass.putData(t,"btnUpLayer",this.btnUpLayer.toData(),{},!0),CDataClass.putData(t,"lstLayer",this.lstLayer.toData(),{},!0),CDataClass.putData(t,"spt",this.spt.toData(),{},!0),CDataClass.putData(t,"lLTop",this.lLTop.toData(),{},!0),CDataClass.putData(t,"btnAddItem",this.btnAddItem.toData(),{},!0),CDataClass.putData(t,"btnDeleteItem",this.btnDeleteItem.toData(),{},!0),CDataClass.putData(t,"btnDown",this.btnDown.toData(),{},!0),CDataClass.putData(t,"btnUp",this.btnUp.toData(),{},!0),CDataClass.putData(t,"lstItem",this.lstItem.toData(),{},!0),CDataClass.putData(t,"spl",this.spl.toData(),{},!0),CDataClass.putData(t,"lClient",this.lClient.toData(),{},!0),CDataClass.putData(t,"lCClient",this.lCClient.toData(),{},!0),CDataClass.putData(t,"itemControl",this.itemControl.toData(),{},!0),CDataClass.putData(t,"dash",this.dash.toData(),{},!0),CDataClass.putData(t,"lblFileName",this.lblFileName.toData(),{},!0),CDataClass.putData(t,"lCBottom",this.lCBottom.toData(),{},!0),CDataClass.putData(t,"lblWidth",this.lblWidth.toData(),{},!0),CDataClass.putData(t,"edtWidth",this.edtWidth.toData(),{},!0),CDataClass.putData(t,"lblHeight",this.lblHeight.toData(),{},!0),CDataClass.putData(t,"edtHeight",this.edtHeight.toData(),{},!0),CDataClass.putData(t,"btnSizeApply",this.btnSizeApply.toData(),{},!0),CDataClass.putData(t,"btnDash",this.btnDash.toData(),{},!0),CDataClass.putData(t,"lRight",this.lRight.toData(),{},!0),CDataClass.putData(t,"propertyEditor",this.propertyEditor.toData(),{},!0),CDataClass.putData(t,"spr",this.spr.toData(),{},!0),CDataClass.putData(t,"cover",this.cover.toData(),{},!0)}doFromData(t){super.doFromData(t),this.menu.fromData(CDataClass.getData(t,"menu",{},!0)),this.mnuFile.fromData(CDataClass.getData(t,"mnuFile",{},!0)),this.mnuEdit.fromData(CDataClass.getData(t,"mnuEdit",{},!0)),this.btnLayersApply.fromData(CDataClass.getData(t,"btnLayersApply",{},!0)),this.lLeft.fromData(CDataClass.getData(t,"lLeft",{},!0)),this.lLTopLayer.fromData(CDataClass.getData(t,"lLTopLayer",{},!0)),this.btnAddLayer.fromData(CDataClass.getData(t,"btnAddLayer",{},!0)),this.btnDeleteLayer.fromData(CDataClass.getData(t,"btnDeleteLayer",{},!0)),this.btnDownLayer.fromData(CDataClass.getData(t,"btnDownLayer",{},!0)),this.btnUpLayer.fromData(CDataClass.getData(t,"btnUpLayer",{},!0)),this.lstLayer.fromData(CDataClass.getData(t,"lstLayer",{},!0)),this.spt.fromData(CDataClass.getData(t,"spt",{},!0)),this.lLTop.fromData(CDataClass.getData(t,"lLTop",{},!0)),this.btnAddItem.fromData(CDataClass.getData(t,"btnAddItem",{},!0)),this.btnDeleteItem.fromData(CDataClass.getData(t,"btnDeleteItem",{},!0)),this.btnDown.fromData(CDataClass.getData(t,"btnDown",{},!0)),this.btnUp.fromData(CDataClass.getData(t,"btnUp",{},!0)),this.lstItem.fromData(CDataClass.getData(t,"lstItem",{},!0)),this.spl.fromData(CDataClass.getData(t,"spl",{},!0)),this.lClient.fromData(CDataClass.getData(t,"lClient",{},!0)),this.lCClient.fromData(CDataClass.getData(t,"lCClient",{},!0)),this.itemControl.fromData(CDataClass.getData(t,"itemControl",{},!0)),this.dash.fromData(CDataClass.getData(t,"dash",{},!0)),this.lblFileName.fromData(CDataClass.getData(t,"lblFileName",{},!0)),this.lCBottom.fromData(CDataClass.getData(t,"lCBottom",{},!0)),this.lblWidth.fromData(CDataClass.getData(t,"lblWidth",{},!0)),this.edtWidth.fromData(CDataClass.getData(t,"edtWidth",{},!0)),this.lblHeight.fromData(CDataClass.getData(t,"lblHeight",{},!0)),this.edtHeight.fromData(CDataClass.getData(t,"edtHeight",{},!0)),this.btnSizeApply.fromData(CDataClass.getData(t,"btnSizeApply",{},!0)),this.btnDash.fromData(CDataClass.getData(t,"btnDash",{},!0)),this.lRight.fromData(CDataClass.getData(t,"lRight",{},!0)),this.propertyEditor.fromData(CDataClass.getData(t,"propertyEditor",{},!0)),this.spr.fromData(CDataClass.getData(t,"spr",{},!0)),this.cover.fromData(CDataClass.getData(t,"cover",{},!0))}doResource(){super.doResource()}doChangeSize(){super.doChangeSize(),this.cover.position.width=this.position.width,this.cover.position.height=this.position.height}doChildDataMapHandle(t){super.doChildDataMapHandle(t),t.delete(this.menu),t.delete(this.mnuFile),t.delete(this.mnuEdit),t.delete(this.btnLayersApply),t.delete(this.lLeft),t.delete(this.lLTopLayer),t.delete(this.btnAddLayer),t.delete(this.btnDeleteLayer),t.delete(this.btnDownLayer),t.delete(this.btnUpLayer),t.delete(this.lstLayer),t.delete(this.spt),t.delete(this.lLTop),t.delete(this.btnAddItem),t.delete(this.btnDeleteItem),t.delete(this.btnDown),t.delete(this.btnUp),t.delete(this.lstItem),t.delete(this.spl),t.delete(this.lClient),t.delete(this.lCClient),t.delete(this.itemControl),t.delete(this.dash),t.delete(this.lblFileName),t.delete(this.lCBottom),t.delete(this.lblWidth),t.delete(this.edtWidth),t.delete(this.lblHeight),t.delete(this.edtHeight),t.delete(this.btnSizeApply),t.delete(this.btnDash),t.delete(this.lRight),t.delete(this.propertyEditor),t.delete(this.spr),t.delete(this.cover)}}class CCanvasItemsEditorFrame extends CCanvasItemsEditorFrameDesignModel{get items(){return this.itemControl.layers.get(0).items}set items(t){this.items!=t&&(this.items.fromData(t.toData()),this.refresh())}constructor(t,e){super(t,e),this.saveIp="",this.savePort="",this.saveFileName="";let i=this;this.resource="page/canvasItemsEditor.page",0==this.itemControl.layers.length&&this.itemControl.layers.addLayer(),this.lstItem.onItemClick=function(){-1!=i.lstItem.itemIndex&&i.doSelectItem(i.lstItem.items.get(i.lstItem.itemIndex).item)},this.lstItem.onChangeItemIndex=function(){-1!=i.lstItem.itemIndex&&i.doSelectItem(i.lstItem.items.get(i.lstItem.itemIndex).item)},this.btnAddItem.onClick=function(){i.doAddItem()},this.btnDeleteItem.onClick=function(){i.doDeleteItem()},this.btnUp.onClick=function(){i.doUpItem()},this.btnDown.onClick=function(){i.doDownItem()},this.btnSizeApply.onClick=function(){let t=parseInt(i.edtWidth.text),e=parseInt(i.edtHeight.text);i.itemControl.position.width=t,i.itemControl.position.height=e},this.propertyEditor.onBeforeEditorApply.push((function(t,e,s,o,a,n){if("name"==e.cell(0,o))for(let t=0;t<i.lstItem.length;t++)if(i.lstItem.items.get(t).item==e.classInstance){i.lstItem.items.get(t).text=n;break}})),this.btnItemsApply.onClick=function(){i.srcItems&&i.srcItems.fromData(i.itemControl.layers.get(0).items.toData())},this.mnuFile.onMenuClick.push((function(t,e){i.doMenuClick(e)})),this.mnuEdit.onMenuClick.push((function(t,e){i.doMenuClick(e)})),this.onKeyDown=function(t,e){e.ctrlKey&&"O"==e.key.toUpperCase()&&(i.doOpen(),e.preventDefault()),e.ctrlKey&&e.shiftKey&&"S"==e.key.toUpperCase()?(i.doSaveAs(),e.preventDefault()):e.ctrlKey&&"S"==e.key.toUpperCase()&&(i.doSave(),e.preventDefault())},this.lstItem.onKeyDown=function(t,e){e.ctrlKey&&"C"==e.key.toUpperCase()&&i.doCopy(),e.ctrlKey&&"V"==e.key.toUpperCase()&&i.doPaste()},this.btnDash.onChangeChecked=function(){i.dash.visible=i.btnDash.checked},this.propertyEditor.editorCover=this.cover}doMenuClick(t){"listboxitem"==t&&(this.items.resource="base/baseListitem.canvasitems",this.refresh()),"checklistboxitem"==t&&(this.items.resource="base/baseCheckListitem.canvasitems",this.refresh()),"treelistboxitem"==t&&(this.items.resource="base/baseTreeListitem.canvasitems",this.refresh()),"checktreelistboxitem"==t&&(this.items.resource="base/baseCheckTreeListitem.canvasitems",this.refresh()),"cellitem"==t&&(this.items.resource="base/baseCell.canvasitems",this.refresh()),"copy"==t&&this.doCopy(),"paste"==t&&this.doPaste(),"open"==t&&this.doOpen(),"save"==t&&""!=this.saveFileName&&this.doSave(),("saveas"==t||"save"==t&&""==this.saveFileName)&&this.doSaveAs()}async doCopy(){let t=this.lstItem.getSelectedItem();t&&CSystem.setClipboard(JSON.stringify(t.item.toData()))}async doPaste(){let t=JSON.parse(await CSystem.getClipboard()),e=this.items.addItem();e.fromData(t),e.name+="_copy",this.refresh()}async doOpen(){let t=await CDialogs.showLocalFileOpenDataDialog();if(t&&(this.saveFileName=t.fileName,this.lblFileName.text=t.fileName,"string"==typeof t.data)){let e=JSON.parse(t.data);e.layers&&e.layers.length>0?(this.itemControl.layers.get(0).items.fromData(e.layers[0].items),this.refresh()):e instanceof Array&&e.length>0&&(this.itemControl.layers.get(0).items.fromData(e),this.refresh())}}async doSave(){await CDialogs.saveLocalText(this.saveFileName,JSON.stringify(this.itemControl.layers.get(0).items.toData()))}async doSaveAs(){let t=await CDialogs.showLocalFileSaveDataDialog(JSON.stringify(this.itemControl.layers.get(0).items.toData()));t&&(this.saveFileName=t,this.lblFileName.text=t)}doSelectItem(t){this.propertyEditor.clear(),this.propertyEditor.addInstance(t,t.name)}doAddItem(){this.items.addItem().name="item"+(this.lstItem.length+1),this.refresh()}doDeleteItem(){-1!=this.lstItem.itemIndex&&(this.items.deleteItem(this.lstItem.items.get(this.lstItem.itemIndex).item),this.refresh())}doUpItem(){if(this.lstItem.itemIndex>0){let t=this.lstItem.itemIndex;this.itemControl.layers.get(0).itemUp(this.lstItem.items.get(this.lstItem.itemIndex).item),this.refresh(),this.lstItem.itemIndex=t-1}}doDownItem(){if(this.lstItem.itemIndex<this.lstItem.length-1){let t=this.lstItem.itemIndex;this.itemControl.layers.get(0).itemDown(this.lstItem.items.get(this.lstItem.itemIndex).item),this.refresh(),this.lstItem.itemIndex=t+1}}refresh(){this.propertyEditor.clear(),this.lstItem.items.clear();for(let t=0;t<this.items.length;t++)this.lstItem.items.add({text:this.items.get(t).name,item:this.items.get(t)})}}class CCustomLayersEditorFrame extends CCustomLayersEditorDesignModel{constructor(t,e){super(t,e),this._lastSelected="none",this._layerCnt=1,this._itemCnt=1,this.saveIp="",this.savePort="",this.saveFileName="",this.resource="page/layerEditor.page";let i=this;this.btnAddLayer.onClick=function(){i.doAddLayer()},this.btnDeleteLayer.onClick=function(){i.doDeleteLayer()},this.btnUpLayer.onClick=function(){i.doUpLayer()},this.btnDownLayer.onClick=function(){i.doDownLayer()},this.btnAddItem.onClick=function(){i.doAddItem()},this.btnDeleteItem.onClick=function(){i.doDeleteItem()},this.btnUp.onClick=function(){i.doUpItem()},this.btnDown.onClick=function(){i.doDownItem()},this.btnLayersApply.onClick=function(){i.doApplyLayers()},this.btnSizeApply.onClick=function(){let t=parseInt(i.edtWidth.text),e=parseInt(i.edtHeight.text);i.itemControl.position.width=t,i.itemControl.position.height=e},this.lstLayer.onItemClick=function(){i.propertyEditor.clear(),i.refreshItems(),-1!=i.lstLayer.itemIndex&&i.propertyEditor.addInstance(i.lstLayer.items.get(i.lstLayer.itemIndex).layer)},this.lstLayer.onChangeItemIndex=function(){i.propertyEditor.clear(),i.refreshItems(),-1!=i.lstLayer.itemIndex&&i.propertyEditor.addInstance(i.lstLayer.items.get(i.lstLayer.itemIndex).layer)},this.lstItem.onItemClick=function(){i.propertyEditor.clear(),-1!=i.lstItem.itemIndex&&i.propertyEditor.addInstance(i.lstItem.items.get(i.lstItem.itemIndex).item)},this.lstItem.onChangeItemIndex=function(){i.propertyEditor.clear(),-1!=i.lstItem.itemIndex&&i.propertyEditor.addInstance(i.lstItem.items.get(i.lstItem.itemIndex).item)},this.lstLayer.onChangeFocus=function(){i.lstLayer.focused||(i._lastSelected="layer")},this.lstItem.onChangeFocus=function(){i.lstItem.focused||(i._lastSelected="item")},this.propertyEditor.onBeforeEditorApply.push((function(t,e,s,o,a,n){if("name"==e.cell(0,o)){if(e.classInstance instanceof CCanvasLayer)for(let t=0;t<i.lstLayer.length;t++)i.lstLayer.items.get(t).layer==e.classInstance&&(i.lstLayer.items.get(t).text=n);if(e.classInstance instanceof CCanvasItem)for(let t=0;t<i.lstItem.length;t++)i.lstItem.items.get(t).item==e.classInstance&&(i.lstItem.items.get(t).text=n)}})),this.mnuFile.onMenuClick.push((function(t,e){i.doMenuClick(e)})),this.mnuEdit.onMenuClick.push((function(t,e){i.doMenuClick(e)})),this.lstLayer.onKeyDown=function(t,e){e.ctrlKey&&"C"==e.key.toUpperCase()&&i.doCopy(),e.ctrlKey&&"V"==e.key.toUpperCase()&&i.doPaste()},this.lstItem.onKeyDown=function(t,e){e.ctrlKey&&"C"==e.key.toUpperCase()&&i.doCopy(),e.ctrlKey&&"V"==e.key.toUpperCase()&&i.doPaste()},this.onKeyDown=function(t,e){e.ctrlKey&&"O"==e.key.toUpperCase()&&(i.doOpen(),e.preventDefault()),e.ctrlKey&&e.shiftKey&&"S"==e.key.toUpperCase()?(i.doSaveAs(),e.preventDefault()):e.ctrlKey&&"S"==e.key.toUpperCase()&&(i.doSave(),e.preventDefault())},this.btnDash.onChangeChecked=function(){i.dash.visible=i.btnDash.checked},this.propertyEditor.editorCover=this.cover,this.tabIndex="0"}doMenuClick(t){"copy"==t&&this.doCopy(),"paste"==t&&this.doPaste(),"open"==t&&this.doOpen(),"save"==t&&""!=this.saveFileName&&this.doSave(),("saveas"==t||"save"==t&&""==this.saveFileName)&&this.doSaveAs()}async doOpen(){let t=await CDialogs.showLocalFileOpenDataDialog();if(t&&(this.saveFileName=t.fileName,this.lblFileName.text=t.fileName,"string"==typeof t.data)){let e=JSON.parse(t.data);e.layers?(this.itemControl.layers.fromData(e.layers),this.refreshLayers()):e instanceof Array&&e.length>0&&(this.itemControl.layers.fromData(e),this.refreshLayers())}}async doSave(){await CDialogs.saveLocalText(this.saveFileName,JSON.stringify(this.itemControl.layers.toData()))}async doSaveAs(){let t=await CDialogs.showLocalFileSaveDataDialog(JSON.stringify(this.itemControl.layers.toData()));t&&(this.saveFileName=t,this.lblFileName.text=t)}async doCopy(){if(this.lstLayer.focused&&-1!=this.lstLayer.itemIndex){let t=this.lstLayer.getSelectedItem();t&&await CSystem.setClipboard(JSON.stringify({kind:"layer",data:t.layer.toData()}))}if(this.lstItem.focused&&-1!=this.lstItem.itemIndex){let t=this.lstItem.getSelectedItem();t&&await CSystem.setClipboard(JSON.stringify({kind:"item",data:t.item.toData()}))}if(!this.lstLayer.focused&&!this.lstLayer.focused){if("layer"==this._lastSelected){let t=this.lstLayer.getSelectedItem();t&&await CSystem.setClipboard(JSON.stringify({kind:"layer",data:t.layer.toData()}))}if("item"==this._lastSelected){let t=this.lstItem.getSelectedItem();t&&await CSystem.setClipboard(JSON.stringify({kind:"item",data:t.item.toData()}))}}}async doPaste(){let t=JSON.parse(await CSystem.getClipboard());if(t.kind){if("layer"==t.kind){let e=this.itemControl.layers.addLayer();e.fromData(t.data),e.name=e.name+"_copy",this.refreshLayers()}if("item"==t.kind){let e=this.lstLayer.getSelectedItem();if(e){let i=e.layer.addItem();i.fromData(t.data),i.name=i.name+"_copy",this.refreshItems()}}}}doApplyLayers(){this.srcLayers&&this.srcLayers.fromData(this.itemControl.layers.toData())}doAddLayer(){this.itemControl.layers.addLayer().name="Layer"+this._layerCnt,this._layerCnt++,this.refreshLayers(),this.lstLayer.itemIndex=this.lstLayer.length-1}doDeleteLayer(){let t=this.lstLayer.getSelectedItem();t&&(this.itemControl.layers.deleteLayer(t.layer),this.refreshLayers())}doUpLayer(){if(-1!=this.lstLayer.itemIndex&&this.lstLayer.itemIndex>0){let t=this.lstLayer.itemIndex;this.itemControl.layers.layerUp(this.lstLayer.items.get(this.lstLayer.itemIndex).layer),this.refreshLayers(),this.lstLayer.itemIndex=t-1}}doDownLayer(){if(-1!=this.lstLayer.itemIndex&&this.lstLayer.itemIndex<this.lstLayer.length-1){let t=this.lstLayer.itemIndex;this.itemControl.layers.layerDown(this.lstLayer.items.get(this.lstLayer.itemIndex).layer),this.refreshLayers(),this.lstLayer.itemIndex=t+1}}doAddItem(){if(-1!=this.lstLayer.itemIndex){this.lstLayer.items.get(this.lstLayer.itemIndex).layer.items.addItem().name="Item"+this._itemCnt,this._itemCnt++,this.refreshItems(),this.lstItem.itemIndex=this.lstItem.length-1}}doDeleteItem(){if(-1!=this.lstLayer.itemIndex){let t=this.lstItem.getSelectedItem();if(t){this.lstLayer.items.get(this.lstLayer.itemIndex).layer.items.deleteItem(t.item),this.refreshItems()}}}doUpItem(){if(-1!=this.lstLayer.itemIndex&&this.lstItem.itemIndex>0){let t=this.lstItem.itemIndex;this.lstLayer.items.get(this.lstLayer.itemIndex).layer.itemUp(this.lstItem.items.get(this.lstItem.itemIndex).item),this.refreshItems(),this.lstItem.itemIndex=t-1}}doDownItem(){if(-1!=this.lstLayer.itemIndex&&this.lstItem.itemIndex<this.lstItem.length-1){let t=this.lstItem.itemIndex;this.lstLayer.items.get(this.lstLayer.itemIndex).layer.itemDown(this.lstItem.items.get(this.lstItem.itemIndex).item),this.refreshItems(),this.lstItem.itemIndex=t+1}}refreshLayers(){this.lstItem.clear(),this.lstLayer.items.clear();for(let t=0;t<this.itemControl.layers.length;t++)this.lstLayer.items.add({text:this.itemControl.layers.get(t).name,layer:this.itemControl.layers.get(t)})}refreshItems(){if(this.lstItem.clear(),-1!=this.lstLayer.itemIndex){let t=this.lstLayer.items.get(this.lstLayer.itemIndex).layer;for(let e=0;e<t.items.length;e++)this.lstItem.items.add({text:t.items.get(e).name,item:t.items.get(e)})}}setItemControlLayers(t){this.srcLayers=t,t&&this.itemControl.layers.fromData(t.toData()),this.refreshLayers()}}class CAppCanvasItemsEditor extends CWindowApplication{constructor(){super(),this.defaultWidth=1400,this.defaultHeight=750,this.appName="";let t=this;this.editor=new CCanvasItemsEditorFrame(this.mainWindow.body),this.editor.btnItemsApply.visible=!1,this.editor.position.align=EPositionAlign.CLIENT,this.mainWindow.onShow=function(){t.mainWindow.caption.textSet.languageKey="W_CANVAS_ITEMS_EDITOR"}}}class CAppLayersEditor extends CWindowApplication{constructor(){super(),this.defaultWidth=1400,this.defaultHeight=750,this.appName="";let t=this;this.editor=new CCustomLayersEditorFrame(this.mainWindow.body),this.editor.btnLayersApply.visible=!1,this.editor.position.align=EPositionAlign.CLIENT,this.mainWindow.onShow=function(){t.mainWindow.caption.textSet.languageKey="W_LAYERS_EDITOR"},this.editor.refreshLayers()}}class CCustomCanvasItemsPropertyEditor extends CCustomPropertyAppEditor{constructor(){super();let t=this;this.frame=new CCanvasItemsEditorFrame(this.mainWindow.body),this.frame.position.align=EPositionAlign.CLIENT,this.mainWindow.onShow=function(){t.mainWindow.caption.textSet.languageKey="W_CANVAS_ITEMS_EDITOR"},this.frame.propertyEditor.editorCover=this.frame.cover,this.defaultWidth=1e3,this.defaultHeight=600}doChangeInstance(){let t=this.instance[this.property];null==t&&(t=new CCanvasItems,this.instance[this.property]=t),this.frame.srcItems=t,this.frame.itemControl.layers.get(0).items.fromData(t.toData()),this.frame.refresh(),super.doChangeInstance()}}class CCustomCanvasLayersPropertyEditor extends CCustomPropertyAppEditor{constructor(){super();let t=this;this.frame=new CCustomLayersEditorFrame(this.mainWindow.body),this.frame.position.align=EPositionAlign.CLIENT,this.mainWindow.onShow=function(){t.mainWindow.caption.textSet.languageKey="W_LAYERS_EDITOR"},this.frame.propertyEditor.editorCover=this.frame.cover,this.defaultWidth=1e3,this.defaultHeight=600}doChangeInstance(){this.frame.srcLayers=this.instance[this.property],this.frame.setItemControlLayers(this.instance[this.property]),this.frame.refreshLayers(),super.doChangeInstance()}}class CPathEditorModel extends CPanel{get backItemStrokeColor(){return this._backItemStrokeColor}set backItemStrokeColor(t){this._backItemStrokeColor!=t&&(this._backItemStrokeColor=t,this.__backItem.stroke.solidColor=t)}get itemFillColor(){return this._itemFillColor}set itemFillColor(t){this._itemFillColor!=t&&(this._itemFillColor=t,this.__item.fill.solidColor=t)}get itemStrokeColor(){return this._itemStrokeColor}set itemStrokeColor(t){this._itemStrokeColor!=t&&(this._itemStrokeColor=t,this.__item.stroke.solidColor=t)}get item(){return this.__item}get pointResource(){return this._pointResource}set pointResource(t){if(this._pointResource!=t){this._pointResource=t;for(let e=0;e<this.__points.length;e++)this.__points.get(e).point.resource=t}}get cpoint1Resource(){return this._cpoint1Resource}set cpoint1Resource(t){if(this._cpoint1Resource!=t){this._cpoint1Resource=t;for(let e=0;e<this.__points.length;e++){let i=this.__points.get(e).cpoint1;null!=i&&(i.resource=t)}}}get cpoint2Resource(){return this._cpoint2Resource}set cpoint2Resource(t){if(this._cpoint2Resource!=t){this._cpoint2Resource=t;for(let e=0;e<this.__points.length;e++){let i=this.__points.get(e).cpoint2;null!=i&&(i.resource=t)}}}constructor(t,e){super(t,e),this.__points=new CList,this._pointResource="",this._cpoint1Resource="",this._cpoint2Resource="",this._backItemStrokeColor="#404040",this._itemFillColor="rgba(255,255,255,0.05)",this._itemStrokeColor="#ffffff",this.menu=new CPanel(this),this.mnuFile=new CPopupButton(this.menu),this.toolbar=new CPanel(this),this.lblKind=new CPanel(this.toolbar),this.btnNone=new CButton(this.toolbar),this.btnMoveTo=new CButton(this.toolbar),this.btnLineTo=new CButton(this.toolbar),this.btnCurveTo=new CButton(this.toolbar),this.btnClose=new CButton(this.toolbar),this.toolbarBottom=new CPanel(this),this.lblWidth=new CPanel(this.toolbarBottom),this.edtWidth=new CTextBox(this.toolbarBottom),this.lblheight=new CPanel(this.toolbarBottom),this.edtHeight=new CTextBox(this.toolbarBottom),this.btnSize=new CButton(this.toolbarBottom),this.chkAlignPixel=new CCheckBox(this.toolbarBottom),this.edtAlignPixel=new CTextBox(this.toolbarBottom),this.btnApply=new CButton(this.toolbarBottom),this.lRight=new CPanel(this),this.spr=new CSplitter(this),this.lRTop=new CPanel(this.lRight),this.btnDelete=new CButton(this.lRTop),this.btnClear=new CButton(this.lRTop),this.grid=new CDataGrid(this.lRight),this.lClient=new CPanel(this),this.lCTop=new CPanel(this.lClient),this.lCClient=new CPanel(this.lClient),this.lblFileName=new CPanel(this.lClient),this.path=new CPanel(this.lCClient),this.pathGraphic=new CSelectArea(this.path),this.saveIp="",this.savePort="",this.saveFileName="";let i=this;this.pathGraphic.position.align=EPositionAlign.CLIENT;let s,o=this.pathGraphic.layers.addLayer();this.__backItem=o.addItem(),this.__backItem.kind=ECanvasItemKind.PATH,this.__backItem.stroke.styleKind=EStyleKind.SOLID,this.__backItem.stroke.solidColor="#404040",this.__backItem.stroke.lineWidth=1,this.__backItem.pathFitMode=EFitMode.ORIGINAL,this.__item=o.addItem(),this.__item.kind=ECanvasItemKind.PATH,this.__item.fill.styleKind=EStyleKind.SOLID,this.__item.fill.solidColor="rgba(255,255,255,0.05)",this.__item.stroke.styleKind=EStyleKind.SOLID,this.__item.stroke.solidColor="#ffffff",this.__item.stroke.lineWidth=1,this.__item.pathFitMode=EFitMode.ORIGINAL,this.btnSize.onClick=function(){i.path.position.width=parseInt(i.edtWidth.text),i.path.position.height=parseInt(i.edtHeight.text),i.__item.pathData.width=parseInt(i.edtWidth.text),i.__item.pathData.height=parseInt(i.edtHeight.text)},this.btnNone.onClick=function(){i.lblKind.text="None"},this.btnMoveTo.onClick=function(){i.lblKind.text="MoveTo"},this.btnLineTo.onClick=function(){i.lblKind.text="LineTo"},this.btnCurveTo.onClick=function(){i.lblKind.text="CurveTo"},this.btnClose.onClick=function(){i.lblKind.text="Close";let t=i.__item.pathData.addPointClose();i.grid.add({kind:"CL",point1:CPoint.create(0,0).toString(),point2:CPoint.create(0,0).toString(),point3:CPoint.create(0,0).toString(),pathPoint:t})},this.edtWidth.onKeyDown=function(t,e){"Enter"==e.key&&i.btnSize.click()},this.edtHeight.onKeyDown=function(t,e){"Enter"==e.key&&i.btnSize.click()},this.pathGraphic.selectAreaResource="selectAreaCursor.control",this.pathGraphic.usePointerCapture=!0,this.pathGraphic.onThisPointerDown=function(t,e,o){if("MoveTo"==i.lblKind.text){let t=CPoint.create(e.offsetX,e.offsetY),o=i.__item.pathData.addPointMoveTo(t);s=t;let a=i.grid.add({kind:"M",point1:t.toString(),point2:CPoint.create(0,0).toString(),point3:CPoint.create(0,0).toString(),pathPoint:o});o.onChange=function(){null!=a&&(a.point1=o.point.toString())};let n=new CPathPointSelectorModel(i.pointResource,i.cpoint1Resource,i.cpoint2Resource);n.parent=i.pathGraphic,n.pathPoint=o,i.__points.add(n)}if("LineTo"==i.lblKind.text){let t=CPoint.create(e.offsetX,e.offsetY),o=i.__item.pathData.addPointLineTo(CPoint.create(e.offsetX,e.offsetY));s=t;let a=i.grid.add({kind:"L",point1:t.toString(),point2:CPoint.create(0,0).toString(),point3:CPoint.create(0,0).toString(),pathPoint:o});o.onChange=function(){null!=a&&(a.point1=o.point.toString())};let n=new CPathPointSelectorModel(i.pointResource,i.cpoint1Resource,i.cpoint2Resource);n.parent=i.pathGraphic,n.pathPoint=o,i.__points.add(n)}if("CurveTo"==i.lblKind.text){let t=CPoint.create(e.offsetX,e.offsetY);if(null!=s){let e=CPoint.getDistancePoints(t,s),o=CPoint.getLineMiddlePoint(s,t,CCalc.crRange2Value(0,e,e/3,0,1)),a=CPoint.getLineMiddlePoint(s,t,CCalc.crRange2Value(0,e,e/3*2,0,1)),n=i.__item.pathData.addPointCurveTo3(t,o,a),r=i.grid.add({kind:"C",point1:t.toString(),point2:o.toString(),point3:a.toString(),pathPoint:n});s=t;let l=new CPathPointSelectorModel(i.pointResource,i.cpoint1Resource,i.cpoint2Resource);l.parent=i.pathGraphic,l.pathPoint=n,i.__points.add(l),n.onChange=function(){null!=r&&(r.point1=n.point.toString(),r.point2=n.cPoint1.toString(),r.point3=n.cPoint2.toString())}}}},this.grid.onEditorApply=function(t,e,s,o){let a=i.grid.cell(4,s);if(null!=a){let t=o.split(",");1==e&&(a.point.x=parseFloat(t[0]),a.point.y=parseFloat(t[1]),i.pathGraphic.draw()),2==e&&(a.cPoint1.x=parseFloat(t[0]),a.cPoint1.y=parseFloat(t[1]),i.pathGraphic.draw()),3==e&&(a.cPoint2.x=parseFloat(t[0]),a.cPoint2.y=parseFloat(t[1]),i.pathGraphic.draw())}i.refreshPoints()},this.btnClear.onClick=function(){i.clear()},this.btnDelete.onClick=function(){-1!=i.grid.row&&i.deletePoint(i.grid.cell(4,i.grid.row))},this.chkAlignPixel.onChangeChecked=function(){i.setAlignPixel()},this.edtAlignPixel.onKeyDown=function(t,e){"Enter"==e.key&&i.setAlignPixel()},this.btnApply.onClick=function(){null!=i.pathData&&i.pathData.copyFrom(i.__item.pathData)},this.mnuFile.onMenuClick.push((function(t,e){i.doMenuClick(e)}))}doToData(t){super.doToData(t),CDataClass.putData(t,"menu",this.menu.toData(),{},!0),CDataClass.putData(t,"mnuFile",this.mnuFile.toData(),{},!0),CDataClass.putData(t,"toolbar",this.toolbar.toData(),{},!0),CDataClass.putData(t,"lblKind",this.lblKind.toData(),{},!0),CDataClass.putData(t,"btnNone",this.btnNone.toData(),{},!0),CDataClass.putData(t,"btnMoveTo",this.btnMoveTo.toData(),{},!0),CDataClass.putData(t,"btnLineTo",this.btnLineTo.toData(),{},!0),CDataClass.putData(t,"btnCurveTo",this.btnCurveTo.toData(),{},!0),CDataClass.putData(t,"btnClose",this.btnClose.toData(),{},!0),CDataClass.putData(t,"toolbarBottom",this.toolbarBottom.toData(),{},!0),CDataClass.putData(t,"lblWidth",this.lblWidth.toData(),{},!0),CDataClass.putData(t,"edtWidth",this.edtWidth.toData(),{},!0),CDataClass.putData(t,"lblheight",this.lblheight.toData(),{},!0),CDataClass.putData(t,"edtHeight",this.edtHeight.toData(),{},!0),CDataClass.putData(t,"btnSize",this.btnSize.toData(),{},!0),CDataClass.putData(t,"chkAlignPixel",this.chkAlignPixel.toData(),{},!0),CDataClass.putData(t,"edtAlignPixel",this.edtAlignPixel.toData(),{},!0),CDataClass.putData(t,"btnApply",this.btnApply.toData(),{},!0),CDataClass.putData(t,"lRight",this.lRight.toData(),{},!0),CDataClass.putData(t,"spr",this.spr.toData(),{},!0),CDataClass.putData(t,"lRTop",this.lRTop.toData(),{},!0),CDataClass.putData(t,"btnDelete",this.btnDelete.toData(),{},!0),CDataClass.putData(t,"btnClear",this.btnClear.toData(),{},!0),CDataClass.putData(t,"grid",this.grid.toData(),{},!0),CDataClass.putData(t,"lClient",this.lClient.toData(),{},!0),CDataClass.putData(t,"lCTop",this.lCTop.toData(),{},!0),CDataClass.putData(t,"lCClient",this.lCClient.toData(),{},!0),CDataClass.putData(t,"lblFileName",this.lblFileName.toData(),{},!0),CDataClass.putData(t,"path",this.path.toData(),{},!0),CDataClass.putData(t,"pointResource",this.pointResource,""),CDataClass.putData(t,"cpoint1Resource",this.cpoint1Resource,""),CDataClass.putData(t,"cpoint2Resource",this.cpoint2Resource,""),CDataClass.putData(t,"backItemStrokeColor",this.backItemStrokeColor,"#404040"),CDataClass.putData(t,"itemFillColor",this.itemFillColor,"rgba(255,255,255,0.05)"),CDataClass.putData(t,"itemStrokeColor",this.itemStrokeColor,"#ffffff")}doFromData(t){super.doFromData(t),this.menu.fromData(CDataClass.getData(t,"menu",{},!0)),this.mnuFile.fromData(CDataClass.getData(t,"mnuFile",{},!0)),this.toolbar.fromData(CDataClass.getData(t,"toolbar",{},!0)),this.lblKind.fromData(CDataClass.getData(t,"lblKind",{},!0)),this.btnNone.fromData(CDataClass.getData(t,"btnNone",{},!0)),this.btnMoveTo.fromData(CDataClass.getData(t,"btnMoveTo",{},!0)),this.btnLineTo.fromData(CDataClass.getData(t,"btnLineTo",{},!0)),this.btnCurveTo.fromData(CDataClass.getData(t,"btnCurveTo",{},!0)),this.btnClose.fromData(CDataClass.getData(t,"btnClose",{},!0)),this.toolbarBottom.fromData(CDataClass.getData(t,"toolbarBottom",{},!0)),this.lblWidth.fromData(CDataClass.getData(t,"lblWidth",{},!0)),this.edtWidth.fromData(CDataClass.getData(t,"edtWidth",{},!0)),this.lblheight.fromData(CDataClass.getData(t,"lblheight",{},!0)),this.edtHeight.fromData(CDataClass.getData(t,"edtHeight",{},!0)),this.btnSize.fromData(CDataClass.getData(t,"btnSize",{},!0)),this.chkAlignPixel.fromData(CDataClass.getData(t,"chkAlignPixel",{},!0)),this.edtAlignPixel.fromData(CDataClass.getData(t,"edtAlignPixel",{},!0)),this.btnApply.fromData(CDataClass.getData(t,"btnApply",{},!0)),this.lRight.fromData(CDataClass.getData(t,"lRight",{},!0)),this.spr.fromData(CDataClass.getData(t,"spr",{},!0)),this.lRTop.fromData(CDataClass.getData(t,"lRTop",{},!0)),this.btnDelete.fromData(CDataClass.getData(t,"btnDelete",{},!0)),this.btnClear.fromData(CDataClass.getData(t,"btnClear",{},!0)),this.grid.fromData(CDataClass.getData(t,"grid",{},!0)),this.lClient.fromData(CDataClass.getData(t,"lClient",{},!0)),this.lCTop.fromData(CDataClass.getData(t,"lCTop",{},!0)),this.lCClient.fromData(CDataClass.getData(t,"lCClient",{},!0)),this.lblFileName.fromData(CDataClass.getData(t,"lblFileName",{},!0)),this.path.fromData(CDataClass.getData(t,"path",{},!0)),this.pointResource=CDataClass.getData(t,"pointResource",""),this.cpoint1Resource=CDataClass.getData(t,"cpoint1Resource",""),this.cpoint2Resource=CDataClass.getData(t,"cpoint2Resource",""),this.backItemStrokeColor=CDataClass.getData(t,"backItemStrokeColor","#404040"),this.itemFillColor=CDataClass.getData(t,"itemFillColor","rgba(255,255,255,0.05)"),this.itemStrokeColor=CDataClass.getData(t,"itemStrokeColor","#ffffff")}doMenuClick(t){"open"==t&&this.doOpen(),"save"==t&&""!=this.saveFileName&&this.doSave(),("saveas"==t||"save"==t&&""==this.saveFileName)&&this.doSaveAs()}async doOpen(){let t=await CDialogs.showLocalFileOpenDataDialog();if(t&&(this.saveFileName=t.fileName,this.lblFileName.text=t.fileName,"string"==typeof t.data)){let e=JSON.parse(t.data);this.edtWidth.text=e.width+"",this.edtHeight.text=e.height+"",this.btnSize.click(),this.__item.pathData.fromData(e.path),this.refresh()}}async doSave(){await CDialogs.saveLocalText(this.saveFileName,JSON.stringify({width:this.pathGraphic.position.width,height:this.pathGraphic.position.height,path:this.__item.pathData.toData()}))}async doSaveAs(){let t=await CDialogs.showLocalFileSaveDataDialog(JSON.stringify({width:this.pathGraphic.position.width,height:this.pathGraphic.position.height,path:this.__item.pathData.toData()}));t&&(this.saveFileName=t,this.lblFileName.text=t)}deletePoint(t){for(let e=0;e<this.__points.length;e++)if(this.__points.get(e).pathPoint==t){this.__points.get(e).point.remove();let t=this.__points.get(e).cpoint1;null!=t&&t.remove();let i=this.__points.get(e).cpoint2;null!=i&&i.remove(),this.__points.delete(e);break}for(let e=0;e<this.grid.length;e++)if(this.grid.cell(4,e)==t){this.grid.delete(e);break}for(let e=0;e<this.__item.pathData.length;e++)if(this.__item.pathData.get(e)==t){this.__item.pathData.delete(e);break}}clearPoints(){for(let t=0;t<this.__points.length;t++){this.__points.get(t).point.remove();let e=this.__points.get(t).cpoint1;null!=e&&e.remove();let i=this.__points.get(t).cpoint2;null!=i&&i.remove()}this.__points.clear()}reCreatePoints(){this.clearPoints();for(let t=0;t<this.item.pathData.length;t++){if(this.item.pathData.get(t).pointKind==EPathPointKind.MOVETO){let e=new CPathPointSelectorModel(this.pointResource,this.cpoint1Resource,this.cpoint2Resource);e.parent=this.pathGraphic,e.pathPoint=this.item.pathData.get(t),this.__points.add(e)}if(this.item.pathData.get(t).pointKind==EPathPointKind.LINETO){let e=new CPathPointSelectorModel(this.pointResource,this.cpoint1Resource,this.cpoint2Resource);e.parent=this.pathGraphic,e.pathPoint=this.item.pathData.get(t),this.__points.add(e)}if(this.item.pathData.get(t).pointKind==EPathPointKind.CURVETO3){let e=new CPathPointSelectorModel(this.pointResource,this.cpoint1Resource,this.cpoint2Resource);e.parent=this.pathGraphic,e.pathPoint=this.item.pathData.get(t),this.__points.add(e)}}}refreshPoints(){for(let t=0;t<this.__points.length;t++){let e=this.__points.get(t).pathPoint;if(null!=e){this.__points.get(t).isUpdate=!1,this.__points.get(t).point.position.left=e.point.x-5,this.__points.get(t).point.position.top=e.point.y-5;let i=this.__points.get(t).cpoint1;null!=i&&(i.position.left=e.cPoint1.x-3,i.position.top=e.cPoint1.y-3);let s=this.__points.get(t).cpoint2;null!=s&&(s.position.left=e.cPoint2.x-3,s.position.top=e.cPoint2.y-3),this.__points.get(t).isUpdate=!0}}}setAlignPixel(){for(let t=0;t<this.__points.length;t++)this.chkAlignPixel.checked?this.__points.get(t).alignPixel=parseInt(this.edtAlignPixel.text):this.__points.get(t).alignPixel=0}clear(){this.__item.pathData.clear(),this.clearPoints(),this.grid.clear()}refresh(){this.grid.clear(),this.reCreatePoints();for(let t=0;t<this.__item.pathData.length;t++){let e="";this.__item.pathData.get(t).pointKind==EPathPointKind.BEGIN?e="B":this.__item.pathData.get(t).pointKind==EPathPointKind.MOVETO?e="M":this.__item.pathData.get(t).pointKind==EPathPointKind.LINETO?e="L":this.__item.pathData.get(t).pointKind==EPathPointKind.CURVETO3?e="C":this.__item.pathData.get(t).pointKind==EPathPointKind.CLOSE&&(e="CL");let i=this.grid.add({kind:e,point1:this.__item.pathData.get(t).point.toString(),point2:this.__item.pathData.get(t).cPoint1.toString(),point3:this.__item.pathData.get(t).cPoint2.toString(),pathPoint:this.__item.pathData.get(t)}),s=this;this.item.pathData.get(t).onChange=function(){null!=i&&(i.point1=s.item.pathData.get(t).point.toString(),i.point2=s.item.pathData.get(t).cPoint1.toString(),i.point3=s.item.pathData.get(t).cPoint2.toString())}}}async loadFile(t){}async saveFile(t){}}class CPathEditorFrame extends CPathEditorModel{constructor(t,e){super(t,e),this.resource="rect/pathEditor.frame"}}class CAppPathEditor extends CWindowApplication{constructor(){super(),this.defaultWidth=800,this.defaultHeight=650,this.appName="";let t=this;this.editor=new CPathEditorFrame(this.mainWindow.body),this.editor.btnApply.visible=!1,this.editor.position.align=EPositionAlign.CLIENT,this.mainWindow.onShow=function(){t.mainWindow.caption.textSet.languageKey="W_PATH_EDITOR"},this.editor.refresh()}}class CPathPropertyEditor extends CCustomPropertyAppEditor{constructor(){super(),this.frame=new CPathEditorFrame(this.mainWindow.body),this.defalutWidth=800,this.defalutHeight=650;let t=this;this.frame.position.align=EPositionAlign.CLIENT,this.mainWindow.onShow=function(){t.mainWindow.caption.textSet.languageKey="W_PATH_EDITOR"},this.defaultHeight=600,this.defaultWidth=1e3}doChangeInstance(){this.frame.pathData=this.instance[this.property],null!=this.frame.pathData&&this.frame.item.pathData.copyFrom(this.frame.pathData),this.frame.edtWidth.text=this.frame.item.pathData.width+"",this.frame.edtHeight.text=this.frame.item.pathData.height+"",this.frame.btnSize.click(),this.frame.refresh(),super.doChangeInstance()}}class CGraphEditorModel extends CPathEditorModel{constructor(t,e){super(t,e),this._graphData=new Array,this.cover=new CCover(this),this.testArea=new CPanel(this.toolbar),this.testObject=new CPanel(this.testArea),this.lblStartTest=new CPanel(this.testArea),this.lblStopTest=new CPanel(this.testArea),this.btnTest=new CButton(this.toolbar),this.edtTestDuration=new CTextBox(this.toolbar),this.startValueHandle=new CPanel(this.pathGraphic),this.stopValueHandle=new CPanel(this.pathGraphic),this.lblScaleY=new CPanel(this.lCTop),this.edtScaleY=new CTextBox(this.lCTop),this.lblPrecision=new CPanel(this.lCTop),this.edtPrecision=new CTextBox(this.lCTop),this.lblDuration=new CPanel(this.lCTop),this.edtDuration=new CTextBox(this.lCTop),this.lblFrame=new CPanel(this.lCTop),this.edtFrame=new CTextBox(this.lCTop),this.lblStart=new CPanel(this.toolbarBottom),this.edtStart=new CTextBox(this.toolbarBottom),this.lblStop=new CPanel(this.toolbarBottom),this.edtStop=new CTextBox(this.toolbarBottom);let i=this;this.item.fill.styleKind=EStyleKind.EMPTY,this.tagItem=this.pathGraphic.layers.get(0).items.addItem(),this.tagItem.stroke.lineWidth=1,this.tagItem.stroke.styleKind=EStyleKind.SOLID,this.tagItem.kind=ECanvasItemKind.PATH,this.tagItem.pathFitMode=EFitMode.ORIGINAL,this.tagItem.stroke.solidColor="#808080",this.tagItem.pathData.clear(),this.onChangeSize=function(){i.cover.position.width=i.position.width,i.cover.position.height=i.position.height,i.setHandle()},this.path.onChangeSize=function(){i.setHandle()},this.startValueHandle.onChangeOffset=function(){i.edtStart.text=i.pathGraphic.position.height-(i.startValueHandle.position.top+i.startValueHandle.position.height/2)+"",i.setStartStopValue()},this.stopValueHandle.onChangeOffset=function(){i.edtStop.text=i.pathGraphic.position.height-(i.stopValueHandle.position.top+i.stopValueHandle.position.height/2)+"",i.setStartStopValue()},this.edtStart.onKeyDown=function(t,e){"Enter"==e.key&&(i.startValueHandle.position.top=i.pathGraphic.position.height-(parseInt(i.edtStart.text)+i.startValueHandle.position.height/2),i.setStartStopValue())},this.edtStop.onKeyDown=function(t,e){"Enter"==e.key&&(i.stopValueHandle.position.top=i.pathGraphic.position.height-(parseInt(i.edtStop.text)+i.stopValueHandle.position.height/2),i.setStartStopValue())},this.btnTest.onClick=async function(){if("▶"==i.btnTest.textSet.languageKey){let t=i._graphData,e=i.lblStartTest.position.left+i.lblStartTest.position.width/2,s=i.lblStopTest.position.left+i.lblStopTest.position.width/2,o=t.length;CAnimation.animate(parseInt(i.edtTestDuration.text),(function(a,n,r){let l=t[Math.round(CCalc.crRange2Value(0,1,n,0,o-1))];i.testObject.position.left=CCalc.crRange2Value(0,1,l,e,s)-i.testObject.position.width/2}),void 0,void 0,void 0,void 0,(function(){i.btnTest.textSet.languageKey="W_ANAL_GRAPH",i.setStartStopValue()}))}if("W_ANAL_GRAPH"==i.btnTest.textSet.languageKey){let t=Math.ceil(parseInt(i.edtTestDuration.text)/1e3*parseInt(i.edtFrame.text)),e=await CAssembly.getBezierGraphValue(i.__item.pathData,t/i.path.position.width,parseInt(i.edtScaleY.text),parseInt(i.edtStart.text),parseInt(i.edtStop.text),i.path.position.height,parseInt(i.edtPrecision.text),parseInt(i.edtTestDuration.text),parseInt(i.edtFrame.text));return"string"==typeof e?void CShowMessage.showMessage("showMessage.frame","Error",e):(i._graphData=e,i.btnTest.textSet.languageKey="▶",void i.setStartStopValue())}}}doToData(t){super.doToData(t),CDataClass.putData(t,"startValueHandle",this.startValueHandle.toData(),{},!0),CDataClass.putData(t,"stopValueHandle",this.stopValueHandle.toData(),{},!0),CDataClass.putData(t,"lblScaleY",this.lblScaleY.toData(),{},!0),CDataClass.putData(t,"edtScaleY",this.edtScaleY.toData(),{},!0),CDataClass.putData(t,"lblPrecision",this.lblPrecision.toData(),{},!0),CDataClass.putData(t,"edtPrecision",this.edtPrecision.toData(),{},!0),CDataClass.putData(t,"lblDuration",this.lblDuration.toData(),{},!0),CDataClass.putData(t,"edtDuration",this.edtDuration.toData(),{},!0),CDataClass.putData(t,"lblFrame",this.lblFrame.toData(),{},!0),CDataClass.putData(t,"edtFrame",this.edtFrame.toData(),{},!0),CDataClass.putData(t,"lblStart",this.lblStart.toData(),{},!0),CDataClass.putData(t,"edtStart",this.edtStart.toData(),{},!0),CDataClass.putData(t,"lblStop",this.lblStop.toData(),{},!0),CDataClass.putData(t,"edtStop",this.edtStop.toData(),{},!0),CDataClass.putData(t,"cover",this.cover.toData(),{},!0),CDataClass.putData(t,"testArea",this.testArea.toData(),{},!0),CDataClass.putData(t,"lblStartTest",this.lblStartTest.toData(),{},!0),CDataClass.putData(t,"lblStopTest",this.lblStopTest.toData(),{},!0),CDataClass.putData(t,"testObject",this.testObject.toData(),{},!0),CDataClass.putData(t,"btnTest",this.btnTest.toData(),{},!0),CDataClass.putData(t,"edtTestDuration",this.edtTestDuration.toData(),{},!0)}doFromData(t){super.doFromData(t),this.startValueHandle.fromData(CDataClass.getData(t,"startValueHandle",{},!0)),this.stopValueHandle.fromData(CDataClass.getData(t,"stopValueHandle",{},!0)),this.lblScaleY.fromData(CDataClass.getData(t,"lblScaleY",{},!0)),this.edtScaleY.fromData(CDataClass.getData(t,"edtScaleY",{},!0)),this.lblPrecision.fromData(CDataClass.getData(t,"lblPrecision",{},!0)),this.edtPrecision.fromData(CDataClass.getData(t,"edtPrecision",{},!0)),this.lblDuration.fromData(CDataClass.getData(t,"lblDuration",{},!0)),this.edtDuration.fromData(CDataClass.getData(t,"edtDuration",{},!0)),this.lblFrame.fromData(CDataClass.getData(t,"lblFrame",{},!0)),this.edtFrame.fromData(CDataClass.getData(t,"edtFrame",{},!0)),this.lblStart.fromData(CDataClass.getData(t,"lblStart",{},!0)),this.edtStart.fromData(CDataClass.getData(t,"edtStart",{},!0)),this.lblStop.fromData(CDataClass.getData(t,"lblStop",{},!0)),this.edtStop.fromData(CDataClass.getData(t,"edtStop",{},!0)),this.cover.fromData(CDataClass.getData(t,"cover",{},!0)),this.testArea.fromData(CDataClass.getData(t,"testArea",{},!0)),this.lblStartTest.fromData(CDataClass.getData(t,"lblStartTest",{},!0)),this.lblStopTest.fromData(CDataClass.getData(t,"lblStopTest",{},!0)),this.testObject.fromData(CDataClass.getData(t,"testObject",{},!0)),this.btnTest.fromData(CDataClass.getData(t,"btnTest",{},!0)),this.edtTestDuration.fromData(CDataClass.getData(t,"edtTestDuration",{},!0)),this.setHandle()}doResource(){super.doResource(),this.setHandle()}doMenuClick(t){super.doMenuClick(t),"valuesave"==t&&this.doSaveGraphValue()}async doOpen(){let t=await CDialogs.showLocalFileOpenDataDialog();if(t&&(this.saveFileName=t.fileName,this.lblFileName.text=t.fileName,"string"==typeof t.data)){let e=JSON.parse(t.data);this.edtScaleY.text=e.scaleY+"",this.edtPrecision.text=e.precision+"",this.edtDuration.text=e.duration+"",this.edtFrame.text=e.frame+"",this.edtStart.text=e.start+"",this.edtStop.text=e.stop+"",this.edtWidth.text=e.width+"",this.edtHeight.text=e.height+"",this.btnSize.click(),this.__item.pathData.fromData(e.path),this.refresh(),this.setHandle()}}async doSave(){let t={width:this.pathGraphic.position.width,height:this.pathGraphic.position.height,path:this.__item.pathData.toData(),scaleY:parseInt(this.edtScaleY.text),precision:parseInt(this.edtPrecision.text),duration:parseInt(this.edtDuration.text),frame:parseInt(this.edtFrame.text),start:parseInt(this.edtStart.text),stop:parseInt(this.edtStop.text)};await CDialogs.saveLocalText(this.saveFileName,JSON.stringify(t))}async doSaveAs(){let t={width:this.pathGraphic.position.width,height:this.pathGraphic.position.height,path:this.__item.pathData.toData(),scaleY:parseInt(this.edtScaleY.text),precision:parseInt(this.edtPrecision.text),duration:parseInt(this.edtDuration.text),frame:parseInt(this.edtFrame.text),start:parseInt(this.edtStart.text),stop:parseInt(this.edtStop.text)},e=await CDialogs.showLocalFileSaveDataDialog(JSON.stringify(t));e&&(this.saveFileName=e,this.lblFileName.text=e)}async doSaveGraphValue(){let t=Math.ceil(parseInt(this.edtDuration.text)/1e3*parseInt(this.edtFrame.text)),e=await CAssembly.getBezierGraphValue(this.__item.pathData,t/this.path.position.width,parseInt(this.edtScaleY.text),parseInt(this.edtStart.text),parseInt(this.edtStop.text),this.path.position.height,parseInt(this.edtPrecision.text),parseInt(this.edtDuration.text),parseInt(this.edtFrame.text));if("string"==typeof e)return void CShowMessage.showMessage("showMessage.frame","Error",e);let i=await CDialogs.showLocalFileSaveDataDialog(JSON.stringify(e));i&&(this.saveFileName=i,this.lblFileName.text=i)}setStartStopValue(){let t=this.startValueHandle.position.top+this.startValueHandle.position.height/2,e=this.stopValueHandle.position.top+this.stopValueHandle.position.height/2;this.__backItem.pathData.clear(),this.__backItem.pathData.addPointMoveTo(new CPoint(0,t)),this.__backItem.pathData.addPointLineTo(new CPoint(this.pathGraphic.position.width,t)),this.__backItem.pathData.addPointMoveTo(new CPoint(0,e)),this.__backItem.pathData.addPointLineTo(new CPoint(this.pathGraphic.position.width,e)),this.lblStartTest.position.left=CCalc.crRange2Value(0,this.path.position.height,this.path.position.height-t,0,this.testArea.position.width)-this.lblStartTest.position.width/2,this.lblStopTest.position.left=CCalc.crRange2Value(0,this.path.position.height,this.path.position.height-e,0,this.testArea.position.width)-this.lblStopTest.position.width/2,this.testObject.position.left=this.lblStartTest.position.left+this.lblStartTest.position.width/2-this.testObject.position.width/2,this.pathGraphic.draw()}setHandle(){this.startValueHandle.position.top=this.pathGraphic.position.height-(parseInt(this.edtStart.text)+this.startValueHandle.position.height/2),this.stopValueHandle.position.top=this.pathGraphic.position.height-(parseInt(this.edtStop.text)+this.stopValueHandle.position.height/2),this.setStartStopValue()}setAlignPixel(){super.setAlignPixel(),this.startValueHandle.magneticLength=parseInt(this.edtAlignPixel.text),this.stopValueHandle.magneticLength=parseInt(this.edtAlignPixel.text)}}class CGraphEditorFrame extends CGraphEditorModel{constructor(t,e){super(t,e),this.resource="rect/graphEditor.frame"}}class CAppGraphEditor extends CWindowApplication{constructor(){super(),this.defaultWidth=880,this.defaultHeight=650,this.appName="";let t=this;this.editor=new CGraphEditorFrame(this.mainWindow.body),this.editor.btnApply.visible=!1,this.editor.position.align=EPositionAlign.CLIENT,this.mainWindow.onShow=function(){t.mainWindow.caption.textSet.languageKey="W_GRAPH_EDITOR"},this.editor.refresh()}}class CAnimationEditorDesignModel extends CPanel{constructor(t,e){super(t,e),this.menu=new CPanel(this),this.mnuFile=new CPopupButton(this.menu),this.btnApply=new CButton(this.menu),this.btnAnimationRemove=new CButton(this.menu),this.comAnimator=new CComboBox(this.menu),this.lblAnimator=new CPanel(this.menu),this.lTop1=new CPanel(this),this.lblAnimationTime=new CPanel(this.lTop1),this.edtAnimationTime=new CTextBox(this.lTop1),this.selectLoopOn=new CSelectGroupBox(this.lTop1),this.selectLoopOff=new CSelectGroupBox(this.lTop1),this.lblGraphNames=new CPanel(this.lTop1),this.edtGraphNames=new CTextBox(this.lTop1),this.btnGraph=new CButton(this.edtGraphNames),this.lTop2=new CPanel(this),this.btnAdd=new CButton(this.lTop2),this.btnDelete=new CButton(this.lTop2),this.grid=new CDataGrid(this,void 0),this.lBottom=new CPanel(this),this.btnBeforeScript=new CButton(this.lBottom),this.btnScript=new CButton(this.lBottom),this.btnAfterScript=new CButton(this.lBottom),this.menu.propertyName="menu",this.mnuFile.propertyName="mnuFile",this.btnApply.propertyName="btnApply",this.btnAnimationRemove.propertyName="btnAnimationRemove",this.comAnimator.propertyName="comAnimator",this.lblAnimator.propertyName="lblAnimator",this.lTop1.propertyName="lTop1",this.lblAnimationTime.propertyName="lblAnimationTime",this.edtAnimationTime.propertyName="edtAnimationTime",this.selectLoopOn.propertyName="selectLoopOn",this.selectLoopOff.propertyName="selectLoopOff",this.lblGraphNames.propertyName="lblGraphNames",this.edtGraphNames.propertyName="edtGraphNames",this.btnGraph.propertyName="btnGraph",this.lTop2.propertyName="lTop2",this.btnAdd.propertyName="btnAdd",this.btnDelete.propertyName="btnDelete",this.grid.propertyName="grid",this.lBottom.propertyName="lBottom",this.btnBeforeScript.propertyName="btnBeforeScript",this.btnScript.propertyName="btnScript",this.btnAfterScript.propertyName="btnAfterScript"}doFromData(t){super.doFromData(t)}doResource(){super.doResource()}doChangeSize(){super.doChangeSize()}doChildDataMapHandle(t){super.doChildDataMapHandle(t),t.delete(this.menu),t.delete(this.mnuFile),t.delete(this.btnApply),t.delete(this.btnAnimationRemove),t.delete(this.comAnimator),t.delete(this.lblAnimator),t.delete(this.lTop1),t.delete(this.lblAnimationTime),t.delete(this.edtAnimationTime),t.delete(this.selectLoopOn),t.delete(this.selectLoopOff),t.delete(this.lblGraphNames),t.delete(this.edtGraphNames),t.delete(this.btnGraph),t.delete(this.lTop2),t.delete(this.btnAdd),t.delete(this.btnDelete),t.delete(this.grid),t.delete(this.lBottom),t.delete(this.btnBeforeScript),t.delete(this.btnScript),t.delete(this.btnAfterScript)}}class CAnimatorEditorFrame extends CAnimationEditorDesignModel{constructor(t,e){super(t,e),this.__beforeScript="//parameter : animator, params",this.__script="//parameter : animator, params, graphName, graphValue",this.__afterScript="//parameter : animator, params",this.resource="page/animationEditor.page";let i=this;this.selectLoopOn.groupName=this.id+"loop",this.selectLoopOff.groupName=this.id+"loop",this.btnAdd.onClick=function(){i.grid.add({property:"",graph:"",start:"",stop:""})},this.btnDelete.onClick=function(){-1!=i.grid.row&&i.grid.delete(i.grid.row)},this.btnBeforeScript.onClick=function(){let t=new CAppTextEditor;t.desktop=CSystem.desktopList.get(0),t.editor.btnApply.visible=!0,t.editor.txt.text=i.__beforeScript,t.editor.btnApply.onClick=function(){i.__beforeScript=t.editor.txt.text},t.execute()},this.btnScript.onClick=function(){let t=new CAppTextEditor;t.desktop=CSystem.desktopList.get(0),t.editor.btnApply.visible=!0,t.editor.txt.text=i.__script,t.editor.btnApply.onClick=function(){i.__script=t.editor.txt.text},t.execute()},this.btnAfterScript.onClick=function(){let t=new CAppTextEditor;t.desktop=CSystem.desktopList.get(0),t.editor.btnApply.visible=!0,t.editor.txt.text=i.__afterScript,t.editor.btnApply.onClick=function(){i.__afterScript=t.editor.txt.text},t.execute()},this.btnGraph.onClick=function(){let t=new CAppGraphEditor;t.desktop=CSystem.desktopList.get(0),t.execute()},this.comAnimator.items.add("CAnimator"),this.comAnimator.items.add("CCopyCanvasAnimator"),this.comAnimator.itemIndex=0}doResource(){super.doResource(),this.comAnimator.itemIndex=-1,this.comAnimator.items.clear(),this.comAnimator.items.add("CAnimator"),this.comAnimator.items.add("CCopyCanvasAnimator"),this.comAnimator.itemIndex=0}setAnimatorFromData(t){let e;"CAnimator"==t.className&&(e=new CAnimator(void 0)),"CCopyCanvasAnimator"==t.className&&(e=new CCopyCanvasAnimator(void 0)),e.fromData(t),this.setAnimator(e)}setAnimator(t){this.animator=t,this.__beforeScript=t.beforeScript,this.__script=t.animationScript,this.__afterScript=t.afterScript,this.refresh()}refresh(){if(null!=this.animator){this.comAnimator.text=this.animator.className,this.edtAnimationTime.text=this.animator.duration+"",this.animator.isLoop?this.selectLoopOn.selected=!0:this.selectLoopOff.selected=!0;let t="";for(let e=0;e<this.animator.graphNames.length;e++)t+=0==e?this.animator.graphNames[e]:","+this.animator.graphNames[e];this.edtGraphNames.text=t,this.grid.clear();for(let t=0;t<this.animator.graphProperties.length;t++){let e=this.animator.graphProperties[t];this.grid.add({property:e.properties,graph:e.changeValue.name,start:e.changeValue.startValueString,stop:e.changeValue.stopValueString})}}}getAnimator(t){let e=new Function("parent","graphNames","duration","isLoop","return new "+this.comAnimator.text+"(parent, graphNames, undefined, duration, 0, isLoop)"),i=!1;this.selectLoopOn.selected&&(i=!0);let s=e(t,this.edtGraphNames.text.split(","),parseInt(this.edtAnimationTime.text),i);s.beforeScript=this.__beforeScript,s.animationScript=this.__script,s.afterScript=this.__afterScript;for(let t=0;t<this.grid.length;t++){let e=new Function("return "+this.grid.cell(2,t)),i=new Function("return "+this.grid.cell(3,t));s.addAnimationGraphProperty(this.grid.cell(0,t),this.grid.cell(1,t),e(),i())}return s}}class CAppAnimationEditor extends CWindowApplication{constructor(){super(),this.appName="";let t=this;this.editor=new CAnimatorEditorFrame(this.mainWindow.body),this.editor.btnAnimationRemove.visible=!1,this.editor.btnApply.visible=!1,this.editor.position.align=EPositionAlign.CLIENT,this.mainWindow.onShow=function(){t.mainWindow.caption.textSet.languageKey="W_ANI_ANIMATION_EDITOR"},this.defaultWidth=800,this.defaultHeight=400}}class CAnimatorPropertyEditor extends CCustomPropertyAppEditor{constructor(){super(),this.frame=new CAnimatorEditorFrame(this.mainWindow.body);let t=this;this.frame.btnAnimationRemove.visible=!0,this.frame.btnApply.visible=!0,this.frame.position.align=EPositionAlign.CLIENT,this.frame.btnApply.onClick=function(){if(null!=t.frame.animatorParent){let e=t.frame.edtGraphNames.text.split(","),i=new Function("parent","graphNames","duration","isLoop","return new "+t.frame.comAnimator.text+"(parent, graphNames, undefined, duration, 0, isLoop)"),s=!1;if(t.frame.selectLoopOn.selected&&(s=!0),t.frame.animator=i(t.frame.animatorParent,e,parseInt(t.frame.edtAnimationTime.text),s),null!=t.frame.animator&&(t.frame.animator.beforeScript=t.frame.__beforeScript),null!=t.frame.animator&&(t.frame.animator.animationScript=t.frame.__script),null!=t.frame.animator&&(t.frame.animator.afterScript=t.frame.__afterScript),null!=t.frame.animator){for(let e=0;e<t.frame.grid.length;e++){let i=new Function("return "+t.frame.grid.cell(2,e)),s=new Function("return "+t.frame.grid.cell(3,e));t.frame.animator.addAnimationGraphProperty(t.frame.grid.cell(0,e),t.frame.grid.cell(1,e),i(),s())}t.doApply(t.frame.animator)}}},this.frame.btnAnimationRemove.onClick=function(){t.doApply(void 0)},this.mainWindow.onShow=function(){t.mainWindow.caption.textSet.languageKey="W_ANI_ANIMATION_EDITOR"},this.defaultWidth=800,this.defaultHeight=400}doChangeInstance(){if(this.frame.animatorParent=this.instance,null!=this.instance[this.property]){let t=this.instance[this.property];this.frame.setAnimator(t)}super.doChangeInstance()}doApply(t){this.instance[this.property]=t}}class CTextSetPageDesignModel extends CPage{constructor(t,e){super(t,e),this.lTopSample=new CPanel(this),this.lblSample=new CPanel(this.lTopSample),this.spt=new CSplitter(this),this.lTop1=new CPanel(this),this.btnFill=new CButton(this.lTop1),this.btnStroke=new CButton(this.lTop1),this.lTop2=new CPanel(this),this.lT2Left=new CPanel(this.lTop2),this.lblFamily=new CPanel(this.lT2Left),this.txtFamily=new CTextBox(this.lT2Left),this.lT2Right=new CPanel(this.lTop2),this.lblStyle=new CPanel(this.lT2Right),this.txtStyle=new CTextBox(this.lT2Right),this.lTop3=new CPanel(this),this.lT3Left=new CPanel(this.lTop3),this.lblVariant=new CPanel(this.lT3Left),this.txtVariant=new CTextBox(this.lT3Left),this.lT3Right=new CPanel(this.lTop3),this.lblWeight=new CPanel(this.lT3Right),this.txtWeight=new CTextBox(this.lT3Right),this.lTop4=new CPanel(this),this.lT4Left=new CPanel(this.lTop4),this.lblSize=new CPanel(this.lT4Left),this.txtSize=new CTextBox(this.lT4Left),this.lT4Right=new CPanel(this.lTop4),this.lblLine=new CPanel(this.lT4Right),this.txtLine=new CTextBox(this.lT4Right),this.lTop5=new CPanel(this),this.lTop6=new CPanel(this),this.lT6Left=new CPanel(this.lTop6),this.lblLeft=new CPanel(this.lT6Left),this.txtLeft=new CTextBox(this.lT6Left),this.lT6Right=new CPanel(this.lTop6),this.lblTop=new CPanel(this.lT6Right),this.txtTop=new CTextBox(this.lT6Right),this.lTop7=new CPanel(this),this.lT7Left=new CPanel(this.lTop7),this.lblRight=new CPanel(this.lT7Left),this.txtRight=new CTextBox(this.lT7Left),this.lT7Right=new CPanel(this.lTop7),this.lblBottom=new CPanel(this.lT7Right),this.txtBottom=new CTextBox(this.lT7Right),this.lTop8=new CPanel(this),this.lT8Left=new CPanel(this.lTop8),this.lblHAlign=new CPanel(this.lT8Left),this.comHAlign=new CComboBox(this.lT8Left),this.lT8Right=new CPanel(this.lTop8),this.lblVAlign=new CPanel(this.lT8Right),this.comVAlign=new CComboBox(this.lT8Right),this.btnApply=new CButton(this),this.lTopSample.propertyName="lTopSample",this.lblSample.propertyName="lblSample",this.spt.propertyName="spt",this.lTop1.propertyName="lTop1",this.btnFill.propertyName="btnFill",this.btnStroke.propertyName="btnStroke",this.lTop2.propertyName="lTop2",this.lT2Left.propertyName="lT2Left",this.lblFamily.propertyName="lblFamily",this.txtFamily.propertyName="txtFamily",this.lT2Right.propertyName="lT2Right",this.lblStyle.propertyName="lblStyle",this.txtStyle.propertyName="txtStyle",this.lTop3.propertyName="lTop3",this.lT3Left.propertyName="lT3Left",this.lblVariant.propertyName="lblVariant",this.txtVariant.propertyName="txtVariant",this.lT3Right.propertyName="lT3Right",this.lblWeight.propertyName="lblWeight",this.txtWeight.propertyName="txtWeight",this.lTop4.propertyName="lTop4",this.lT4Left.propertyName="lT4Left",this.lblSize.propertyName="lblSize",this.txtSize.propertyName="txtSize",this.lT4Right.propertyName="lT4Right",this.lblLine.propertyName="lblLine",this.txtLine.propertyName="txtLine",this.lTop5.propertyName="lTop5",this.lTop6.propertyName="lTop6",this.lT6Left.propertyName="lT6Left",this.lblLeft.propertyName="lblLeft",this.txtLeft.propertyName="txtLeft",this.lT6Right.propertyName="lT6Right",this.lblTop.propertyName="lblTop",this.txtTop.propertyName="txtTop",this.lTop7.propertyName="lTop7",this.lT7Left.propertyName="lT7Left",this.lblRight.propertyName="lblRight",this.txtRight.propertyName="txtRight",this.lT7Right.propertyName="lT7Right",this.lblBottom.propertyName="lblBottom",this.txtBottom.propertyName="txtBottom",this.lTop8.propertyName="lTop8",this.lT8Left.propertyName="lT8Left",this.lblHAlign.propertyName="lblHAlign",this.comHAlign.propertyName="comHAlign",this.lT8Right.propertyName="lT8Right",this.lblVAlign.propertyName="lblVAlign",this.comVAlign.propertyName="comVAlign",this.btnApply.propertyName="btnApply"}doFromData(t){super.doFromData(t)}doResource(){super.doResource()}doChangeSize(){super.doChangeSize()}doChildDataMapHandle(t){super.doChildDataMapHandle(t),t.delete(this.lTopSample),t.delete(this.lblSample),t.delete(this.spt),t.delete(this.lTop1),t.delete(this.btnFill),t.delete(this.btnStroke),t.delete(this.lTop2),t.delete(this.lT2Left),t.delete(this.lblFamily),t.delete(this.txtFamily),t.delete(this.lT2Right),t.delete(this.lblStyle),t.delete(this.txtStyle),t.delete(this.lTop3),t.delete(this.lT3Left),t.delete(this.lblVariant),t.delete(this.txtVariant),t.delete(this.lT3Right),t.delete(this.lblWeight),t.delete(this.txtWeight),t.delete(this.lTop4),t.delete(this.lT4Left),t.delete(this.lblSize),t.delete(this.txtSize),t.delete(this.lT4Right),t.delete(this.lblLine),t.delete(this.txtLine),t.delete(this.lTop5),t.delete(this.lTop6),t.delete(this.lT6Left),t.delete(this.lblLeft),t.delete(this.txtLeft),t.delete(this.lT6Right),t.delete(this.lblTop),t.delete(this.txtTop),t.delete(this.lTop7),t.delete(this.lT7Left),t.delete(this.lblRight),t.delete(this.txtRight),t.delete(this.lT7Right),t.delete(this.lblBottom),t.delete(this.txtBottom),t.delete(this.lTop8),t.delete(this.lT8Left),t.delete(this.lblHAlign),t.delete(this.comHAlign),t.delete(this.lT8Right),t.delete(this.lblVAlign),t.delete(this.comVAlign),t.delete(this.btnApply)}}class CTextAreaSettingPageDesignModel extends CPage{constructor(t,e){super(t,e),this.lClient=new CPanel(this),this.checkWrap=new CCheckBox(this.lClient),this.checkScrollbar=new CCheckBox(this.lClient),this.lTop1=new CPanel(this.lClient),this.lblSize=new CPanel(this.lTop1),this.edtSize=new CTextBox(this.lTop1),this.lTop2=new CPanel(this.lClient),this.lblFamily=new CPanel(this.lTop2),this.edtFamily=new CTextBox(this.lTop2),this.lTop3=new CPanel(this.lClient),this.lblStyle=new CPanel(this.lTop3),this.edtStyle=new CTextBox(this.lTop3),this.lTop4=new CPanel(this.lClient),this.lblVariant=new CPanel(this.lTop4),this.edtVariant=new CTextBox(this.lTop4),this.lTop5=new CPanel(this.lClient),this.lblWeight=new CPanel(this.lTop5),this.edtWeight=new CTextBox(this.lTop5),this.sample=new CPanel(this.lClient),this.lRight=new CPanel(this),this.lblColor=new CPanel(this.lRight),this.color=new CColorSelectorModel(this.lRight),this.spr=new CSplitter(this),this.btnApply=new CButton(this),this.lClient.propertyName="lClient",this.checkWrap.propertyName="checkWrap",this.checkScrollbar.propertyName="checkScrollbar",this.lTop1.propertyName="lTop1",this.lblSize.propertyName="lblSize",this.edtSize.propertyName="edtSize",this.lTop2.propertyName="lTop2",this.lblFamily.propertyName="lblFamily",this.edtFamily.propertyName="edtFamily",this.lTop3.propertyName="lTop3",this.lblStyle.propertyName="lblStyle",this.edtStyle.propertyName="edtStyle",this.lTop4.propertyName="lTop4",this.lblVariant.propertyName="lblVariant",this.edtVariant.propertyName="edtVariant",this.lTop5.propertyName="lTop5",this.lblWeight.propertyName="lblWeight",this.edtWeight.propertyName="edtWeight",this.sample.propertyName="sample",this.lRight.propertyName="lRight",this.lblColor.propertyName="lblColor",this.color.propertyName="color",this.spr.propertyName="spr",this.btnApply.propertyName="btnApply"}doFromData(t){super.doFromData(t)}doResource(){super.doResource()}doChangeSize(){super.doChangeSize()}doChildDataMapHandle(t){super.doChildDataMapHandle(t),t.delete(this.lClient),t.delete(this.checkWrap),t.delete(this.checkScrollbar),t.delete(this.lTop1),t.delete(this.lblSize),t.delete(this.edtSize),t.delete(this.lTop2),t.delete(this.lblFamily),t.delete(this.edtFamily),t.delete(this.lTop3),t.delete(this.lblStyle),t.delete(this.edtStyle),t.delete(this.lTop4),t.delete(this.lblVariant),t.delete(this.edtVariant),t.delete(this.lTop5),t.delete(this.lblWeight),t.delete(this.edtWeight),t.delete(this.sample),t.delete(this.lRight),t.delete(this.lblColor),t.delete(this.color),t.delete(this.spr),t.delete(this.btnApply)}}class CTextSetPage extends CTextSetPageDesignModel{get orgTextSet(){return this._orgTextSet}set orgTextSet(t){this._orgTextSet!=t&&(this._orgTextSet=t,t&&(this.textSet.copyFrom(t),this.doSetEditor()))}constructor(t,e){super(t,e),this._isSetEditor=!0,this.resource="page/textSetEditor.page";let i=this;this.comHAlign.items.add("HEAD"),this.comHAlign.items.add("CENTER"),this.comHAlign.items.add("TAIL"),this.comVAlign.items.add("HEAD"),this.comVAlign.items.add("CENTER"),this.comVAlign.items.add("TAIL"),this.comHAlign.itemIndex=1,this.comVAlign.itemIndex=1,this.btnFill.onClick=function(){let t=new CFillPropertyEditor;t.desktop=CSystem.desktopList.get(0),t.instance=this.textSet.fill,t.execute()},this.btnStroke.onClick=function(){let t=new CStrokePropertyEditor;t.desktop=CSystem.desktopList.get(0),t.instance=this.textSet.stroke,t.execute()},this.btnApply.onClick=function(){i.doSetTextSet()}}doChangeTextSet(){super.doChangeTextSet(),this.lblSample.textSet.copyFrom(this.textSet)}doSetTextSet(){this.textSet.fontFamily=this.txtFamily.text,this.textSet.fontStyle=this.txtStyle.text,this.textSet.fontVariant=this.txtVariant.text,this.textSet.fontWeight=this.txtWeight.text,this.textSet.fontSize=parseInt(this.txtSize.text),this.textSet.lineSpacing=parseInt(this.txtLine.text),this.textSet.margins.left=parseInt(this.txtLeft.text),this.textSet.margins.top=parseInt(this.txtTop.text),this.textSet.margins.right=parseInt(this.txtRight.text),this.textSet.margins.bottom=parseInt(this.txtBottom.text),this.textSet.hAlign=this.comHAlign.itemIndex,this.textSet.vAlign=this.comVAlign.itemIndex,this.lblSample.textSet.copyFrom(this.textSet),this.orgTextSet&&this.orgTextSet.copyFrom(this.textSet)}doSetEditor(){this._isSetEditor&&(this.txtFamily.text=this.textSet.fontFamily,this.txtStyle.text=this.textSet.fontStyle,this.txtVariant.text=this.textSet.fontVariant,this.txtWeight.text=this.textSet.fontWeight,this.txtSize.text=this.textSet.fontSize+"",this.txtLine.text=this.textSet.lineSpacing+"",this.txtLeft.text=this.textSet.margins.left+"",this.txtTop.text=this.textSet.margins.top+"",this.txtRight.text=this.textSet.margins.right+"",this.txtBottom.text=this.textSet.margins.bottom+"",this.comHAlign.itemIndex=this.textSet.hAlign,this.comVAlign.itemIndex=this.textSet.vAlign)}}class CTextAreaSettingPage extends CTextAreaSettingPageDesignModel{get textArea(){return this._textArea}set textArea(t){this._textArea=t,null!=t&&this.doSetEditor(t)}constructor(t,e){super(t,e),this.resource="page/textAreaSetting.page";let i=this;this.btnApply.onClick=function(){i.doSetTextArea()}}doSetTextArea(){if(null!=this.textArea){this.textArea.wrap=this.checkWrap.checked,this.textArea.wrap?(this.textArea.useVScrollbar=this.checkScrollbar.checked,this.checkScrollbar.checked||(this.textArea.useHScrollbar=!1)):(this.textArea.useVScrollbar=this.checkScrollbar.checked,this.textArea.useHScrollbar=this.checkScrollbar.checked);let t=this.editorToTextSet();this.sample.textSet.fromData(t.toData()),this.textArea.textSet.fromData(t.toData())}}doSetEditor(t){null!=t?(this.checkWrap.checked=t.wrap,this.checkScrollbar.checked=t.useVScrollbar,this.edtSize.text=t.textSet.fontSize+"",this.edtFamily.text=t.textSet.fontFamily,this.edtStyle.text=t.textSet.fontStyle,this.edtVariant.text=t.textSet.fontVariant,this.edtWeight.text=t.textSet.fontWeight,this.color.color=t.textSet.fill.solidColor):(this.checkWrap.checked=!1,this.checkScrollbar.checked=!0,this.edtSize.text="12",this.edtFamily.text="Arial",this.edtStyle.text="normal",this.edtVariant.text="normal",this.edtWeight.text="normal",this.color.color="#000000");let e=this.editorToTextSet();this.sample.textSet.fromData(e.toData())}editorToTextSet(){let t=new CTextSet;return t.fill.solidColor=this.color.color,t.fontSize=parseInt(this.edtSize.text),t.fontFamily=this.edtFamily.text,t.fontVariant=this.edtVariant.text,t.fontWeight=this.edtWeight.text,t}}class CAppTextSetEditor extends CWindowApplication{constructor(){super(),this.defaultWidth=400,this.defaultHeight=460;let t=this;this.editor=new CTextSetPage(this.mainWindow.body),this.editor.position.align=EPositionAlign.CLIENT,this.mainWindow.onShow=function(){t.mainWindow.caption.textSet.languageKey="W_ST_SETTING_STICKER"}}}class CCustomStickerPageDesignModel extends CPage{constructor(t,e){super(t,e),this.caption=new CPanel(this),this.btnNew=new CButton(this.caption),this.btnClose=new CButton(this.caption),this.btnWrap=new CButton(this.caption),this.edtTitle=new CTextBox(this.caption),this.btnTitleApply=new CButton(this.edtTitle),this.txt=new CTextArea(this),this.caption.propertyName="caption",this.btnNew.propertyName="btnNew",this.btnClose.propertyName="btnClose",this.btnWrap.propertyName="btnWrap",this.edtTitle.propertyName="edtTitle",this.btnTitleApply.propertyName="btnTitleApply",this.txt.propertyName="txt"}doFromData(t){super.doFromData(t)}doResource(){super.doResource()}doChangeSize(){super.doChangeSize()}doChildDataMapHandle(t){super.doChildDataMapHandle(t),t.delete(this.caption),t.delete(this.btnNew),t.delete(this.btnClose),t.delete(this.btnWrap),t.delete(this.edtTitle),t.delete(this.btnTitleApply),t.delete(this.txt)}}class CStickerManagerPageDesignModel extends CPage{constructor(t,e){super(t,e),this.toolbar=new CPanel(this),this.btnRefresh=new CButton(this.toolbar),this.btnAdd=new CButton(this.toolbar),this.btnDelete=new CButton(this.toolbar),this.btnReLoad=new CButton(this.toolbar),this.btnPositionReset=new CButton(this.toolbar),this.grid=new CDataGrid(this),this.toolbar.propertyName="toolbar",this.btnRefresh.propertyName="btnRefresh",this.btnAdd.propertyName="btnAdd",this.btnDelete.propertyName="btnDelete",this.btnReLoad.propertyName="btnReLoad",this.btnPositionReset.propertyName="btnPositionReset",this.grid.propertyName="grid"}doFromData(t){super.doFromData(t)}doResource(){super.doResource()}doChangeSize(){super.doChangeSize()}doChildDataMapHandle(t){super.doChildDataMapHandle(t),t.delete(this.toolbar),t.delete(this.btnRefresh),t.delete(this.btnAdd),t.delete(this.btnDelete),t.delete(this.btnReLoad),t.delete(this.btnPositionReset),t.delete(this.grid)}}class CCustomStickerPage extends CCustomStickerPageDesignModel{constructor(t,e){super(t,e),this.dataPage=new CPage(this);let i=this;this.dataPage.onResource=function(){i.dataPage.position.align=EPositionAlign.CLIENT},this.dataPage.position.align=EPositionAlign.CLIENT,this.dataPage.visible=!1}setStickerData(t){let e=!1;try{let i=JSON.parse(t);if(e=!0,"root"==i.kind){this.dataPage.visible=!0;let t=CCustomStickerPage.idmaker.nextId;CSystem.resources.set(t,i),this.dataPage.resource=t,this.txt.visible=!1}}catch(t){}e||(this.txt.text=t)}}CCustomStickerPage.idmaker=new CAutoIncId("stickerpagedata");class CNoticeStickerPage extends CCustomStickerPage{static createNotice(){let t=new CNoticeStickerPage(CSystem.desktopList.get(0).applicationLayer);t.resource="sticker.page",t.caption.text="",t.position.left=400,t.position.top=80,t.position.width=720,t.position.height=200,t.txt.textSet.languageKey="S_HELLO",t.txt.useHScrollbar=!1,t.txt.useVScrollbar=!1;let e=new CNoticeStickerPage(CSystem.desktopList.get(0).applicationLayer);e.resource="warningSticker.page",e.position.left=400,e.position.top=320,e.position.height=150,e.caption.textSet.languageKey="W_IMPORTANT_NOTE",e.txt.textSet.languageKey="S_ST_NOTICE_DATA",e.txt.useHScrollbar=!1,e.txt.useVScrollbar=!1;let i=new CNoticeStickerPage(CSystem.desktopList.get(0).applicationLayer);i.resource="sticker.page",i.position.left=802,i.position.top=320,i.position.width=318,i.position.height=150,i.caption.text="",i.txt.text="(C) 2023. (bellground) all right reserved.\nbellground@gmail.com",i.txt.useHScrollbar=!1,i.txt.useVScrollbar=!1,i.txt.onChangeText=function(){i.setStickerData(i.txt.text)}}static clearNotice(){this.notice.forEach((function(t){t.remove()})),this.notice.clear()}constructor(t,e){super(t,e);let i=this;CNoticeStickerPage.notice.add(this),this.btnClose.onClick=function(){i.doClose()}}doResource(){super.doResource(),this.btnWrap.visible=!1}doRemove(){CNoticeStickerPage.notice.delete(this),super.doRemove()}doClose(){CNoticeStickerPage.notice.delete(this),this.remove()}close(){this.doClose()}}CNoticeStickerPage.notice=new Set,CSystem.onResourceLoad.push((async function(){setTimeout((()=>{CNoticeStickerPage.createNotice()}),1e3)}));class CUserStickerPage extends CCustomStickerPageDesignModel{constructor(t,e){super(t,e),this.stickerId="",this.stickerResource="";let i=this;this.btnClose.onClick=function(){i.doClose()},this.btnNew.onClick=function(){i.doNewSticker()},this.txt.onChangeText=function(){i.doSetText()},this.edtTitle.onChangeFocus=function(){i.edtTitle.focused||i.doTitleApply()},this.edtTitle.onKeyDown=function(t,e){"Enter"==e.key&&i.doTitleApply()},this.btnTitleApply.onClick=function(){i.doTitleApply()},this.onDoubleClick=function(){i.doShowTitleEditor()},this.btnWrap.onClick=function(){let t=new CAppStickerSetEditor;t.desktop=CSystem.desktopList.get(0),t.editor.sticker=i,t.execute()},CUserStickerPage.stickers.add(this)}doRemove(){CUserStickerPage.stickers.delete(this),super.doRemove()}doPointerDown(t){super.doPointerDown(t),this.bringToFront()}async doTitleApply(){this.caption.text=this.edtTitle.text,this.edtTitle.visible=!1,this.doSetTitle()}async doChangeSize(){if(super.doChangeSize(),browserLoginUser&&browserLoginUser.sticker){let t=await browserLoginUser.sticker.get(this.stickerId);if(t){await browserLoginUser.sticker.modifyStart();try{t.width=this.position.width,t.height=this.position.height,t.zindex=""==this.controlElement.style.zIndex?0:parseInt(this.controlElement.style.zIndex)}finally{await browserLoginUser.sticker.modifySave()}}}}async doChangeOffset(){if(super.doChangeOffset(),browserLoginUser&&browserLoginUser.sticker){let t=await browserLoginUser.sticker.get(this.stickerId);if(t){await browserLoginUser.sticker.modifyStart();try{t.left=this.position.left,t.top=this.position.top,t.zindex=""==this.controlElement.style.zIndex?0:parseInt(this.controlElement.style.zIndex)}finally{await browserLoginUser.sticker.modifySave()}}}}async doSetSettingData(t){if(browserLoginUser&&browserLoginUser.sticker){this.txt.setSettingData(t);let e=await browserLoginUser.sticker.get(this.stickerId);if(e){await browserLoginUser.sticker.modifyStart();try{e.settingData=t}finally{await browserLoginUser.sticker.modifySave()}}}}doShowTitleEditor(){this.edtTitle.text=this.caption.text,this.edtTitle.visible=!0,this.edtTitle.focused=!0}async doSetTitle(){if(browserLoginUser&&browserLoginUser.sticker){let t=await browserLoginUser.sticker.get(this.stickerId);if(t){await browserLoginUser.sticker.modifyStart();try{t.title=(await CBufferUtil.stringEncrypt(this.caption.text,browserLoginUser.token,!1,!0)).base64}finally{await browserLoginUser.sticker.modifySave()}}}}async doSetText(){if(browserLoginUser&&browserLoginUser.sticker){let t=await browserLoginUser.sticker.get(this.stickerId);if(t){await browserLoginUser.sticker.modifyStart();try{t.data=(await CBufferUtil.stringEncrypt(this.txt.text,browserLoginUser.token,!1,!0)).base64}finally{await browserLoginUser.sticker.modifySave()}}}}async doClose(){if(browserLoginUser&&browserLoginUser.sticker){let t=await browserLoginUser.sticker.get(this.stickerId);if(t){await browserLoginUser.sticker.modifyStart();try{t.show=!1}finally{await browserLoginUser.sticker.modifySave()}}}this.remove()}async doNewSticker(){if(browserLoginUser&&browserLoginUser.sticker){let t=CSystem.getZPlus(),e=await browserLoginUser.sticker.add({id:"",title:"",data:"",left:this.position.left+50,top:this.position.top+50,width:350,height:250,show:!0,wrap:!1,resource:this.stickerResource,zindex:t,settingData:void 0});new CUserStickerPage(CSystem.desktopList.get(0).applicationLayer).setSticker(e.data)}}async setSticker(t){browserLoginUser&&(this.stickerResource=t.resource,this.resource=t.resource,this.stickerId=t.id,this.position.left=t.left,this.position.top=t.top,this.position.width=t.width,this.position.height=t.height,this.controlElement.style.zIndex=t.zindex+"",this.caption.text=await CBufferUtil.stringDecrypt(t.title,browserLoginUser.token,void 0,void 0,!0),this.txt.text=await CBufferUtil.stringDecrypt(t.data,browserLoginUser.token,void 0,void 0,!0),null!=t.settingData&&this.txt.setSettingData(t.settingData))}setSettingData(t){this.doSetSettingData(t)}}CUserStickerPage.stickers=new Set;class CStickerManagerPage extends CStickerManagerPageDesignModel{constructor(t,e){super(t,e),this.resource="page/stickerManager.page";let i=this;this.btnAdd.onClick=function(){i.doCreateSticker("sticker/stickerPages/blue.page")},this.btnDelete.onClick=function(){if(-1!=i.grid.row){let t=i.grid.get(i.grid.row);t&&i.doDeleteSticker(t.id)}},this.btnRefresh.onClick=function(){i.doLoad()},this.grid.onBeforeEditorApply=function(t,e,s,o,a){i.doEdit(e,s,o,a)},this.btnReLoad.onClick=async function(){await doClearSticker(),await doShowSticker()},this.btnPositionReset.onClick=async function(){i.doReset()}}async doEdit(t,e,i,s){if(browserLoginUser&&browserLoginUser.sticker){let i=browserLoginUser.sticker,o=this.grid.get(e);if(o){let a=await i.get(o.id);if(a){await i.modifyStart();try{this.grid.get(e)&&(0==t&&(a.title=(await CBufferUtil.stringEncrypt(s,browserLoginUser.token,!1,!0)).base64),1==t&&(a.left=parseInt(s)),2==t&&(a.top=parseInt(s)),3==t&&(a.width=parseInt(s)),4==t&&(a.height=parseInt(s)),5==t&&(a.show="TRUE"==s.toUpperCase()),6==t&&(a.resource=s),7==t&&(a.zindex=parseInt(s)))}finally{await i.modifySave(),await this.doStickerReset(o.id)}}}}}async doReset(){if(browserLoginUser&&browserLoginUser.sticker){let t=browserLoginUser.sticker;await t.modifyStart();try{await t.loop((async function(t){t.left=50,t.top=50,t.zindex=0}))}finally{await t.modifySave(),await doClearSticker(),await doShowSticker()}}}async doLoad(){if(browserLoginUser&&browserLoginUser.sticker){let t=this,e=browserLoginUser,i=browserLoginUser.sticker;this.grid.clear(),await i.loop((async function(i){i.title=await CBufferUtil.stringDecrypt(i.title,e.token,void 0,void 0,!0),t.grid.add(i)}))}}async doStickerReset(t){if(browserLoginUser&&browserLoginUser.sticker){let e=browserLoginUser.sticker,i=await e.get(t);if(i)if(i.show)CUserStickerPage.stickers.forEach((async function(e){e.stickerId==t&&e.setSticker(i)}));else{new CUserStickerPage(CSystem.desktopList.get(0).applicationLayer).setSticker(i)}await this.doLoad()}}async doCreateSticker(t){if(browserLoginUser&&browserLoginUser.sticker){let e=CSystem.getZPlus(),i=await browserLoginUser.sticker.add({id:"",title:(await CBufferUtil.stringEncrypt("",browserLoginUser.token,!1,!0)).base64,data:"",left:(window.innerWidth-350)/2,top:(window.innerHeight-250)/2,width:350,height:250,show:!0,wrap:!1,resource:t,zindex:e,settingData:void 0});new CUserStickerPage(CSystem.desktopList.get(0).applicationLayer).setSticker(i.data),await this.doLoad()}}async doDeleteSticker(t){if(browserLoginUser&&browserLoginUser.sticker){let e=browserLoginUser.sticker;await e.delete(t),await this.doLoad()}}async load(){await this.doLoad()}}class CStickerSettingPage extends CTextAreaSettingPageDesignModel{get sticker(){return this._sticker}set sticker(t){this._sticker=t,null!=t&&this.doSetEditor(t.txt)}constructor(t,e){super(t,e),this.resource="page/textAreaSetting.page";let i=this;this.btnApply.onClick=function(){i.doSetTextArea()}}doSetTextArea(){if(null!=this.sticker){let t=this.editorToTextSet();this.sticker.setSettingData({wrap:this.checkWrap.checked,scrollbar:this.checkScrollbar.checked,textSetData:t.toData()}),this.sample.textSet.fromData(t.toData())}}doSetEditor(t){null!=t?(this.checkWrap.checked=t.wrap,this.checkScrollbar.checked=t.useVScrollbar,this.edtSize.text=t.textSet.fontSize+"",this.edtFamily.text=t.textSet.fontFamily,this.edtStyle.text=t.textSet.fontStyle,this.edtVariant.text=t.textSet.fontVariant,this.edtWeight.text=t.textSet.fontWeight,this.color.color=t.textSet.fill.solidColor):(this.checkWrap.checked=!1,this.checkScrollbar.checked=!0,this.edtSize.text="12",this.edtFamily.text="Arial",this.edtStyle.text="normal",this.edtVariant.text="normal",this.edtWeight.text="normal",this.color.color="#000000");let e=this.editorToTextSet();this.sample.textSet.fromData(e.toData())}editorToTextSet(){let t=new CTextSet;return t.fill.solidColor=this.color.color,t.fontSize=parseInt(this.edtSize.text),t.fontFamily=this.edtFamily.text,t.fontVariant=this.edtVariant.text,t.fontWeight=this.edtWeight.text,t}}class CAppStickerSetEditor extends CWindowApplication{constructor(){super(),this.defaultWidth=400,this.defaultHeight=460;let t=this;this.editor=new CStickerSettingPage(this.mainWindow.body),this.editor.position.align=EPositionAlign.CLIENT,this.mainWindow.onShow=function(){t.mainWindow.caption.textSet.languageKey="W_ST_SETTING_STICKER"}}}class CAppStickerManager extends CWindowApplication{constructor(){super();let t=this;this.editor=new CStickerManagerPage(this.mainWindow.body),this.editor.position.align=EPositionAlign.CLIENT,this.mainWindow.onShow=function(){t.mainWindow.caption.textSet.languageKey="W_ST_STICKER_MANAGER"},this.defaultWidth=800,this.defaultHeight=400}doExecute(){super.doExecute(),this.editor.load()}}class CDonatePageDesignModel extends CPage{constructor(t,e){super(t,e),this.back=new CPanel(this),this.caption=new CPanel(this),this.donate1=new CButton(this),this.donate5=new CButton(this),this.donate10=new CButton(this),this.donate50=new CButton(this),this.donate100=new CButton(this),this.usd=new CPanel(this),this.cover=new CCover(this),this.pan=new CPanel(this),this.edtAmount=new CTextBox(this.pan),this.btnWant=new CButton(this.pan),this.back.propertyName="back",this.caption.propertyName="caption",this.donate1.propertyName="donate1",this.donate5.propertyName="donate5",this.donate10.propertyName="donate10",this.donate50.propertyName="donate50",this.donate100.propertyName="donate100",this.usd.propertyName="usd",this.cover.propertyName="cover",this.pan.propertyName="pan",this.edtAmount.propertyName="edtAmount",this.btnWant.propertyName="btnWant"}doFromData(t){super.doFromData(t)}doResource(){super.doResource()}doChangeSize(){super.doChangeSize(),this.cover.position.width=this.position.width,this.cover.position.height=this.position.height}doChildDataMapHandle(t){super.doChildDataMapHandle(t),t.delete(this.back),t.delete(this.caption),t.delete(this.donate1),t.delete(this.donate5),t.delete(this.donate10),t.delete(this.donate50),t.delete(this.donate100),t.delete(this.usd),t.delete(this.cover),t.delete(this.pan),t.delete(this.edtAmount),t.delete(this.btnWant)}}class CDonatePage extends CDonatePageDesignModel{constructor(t,e){super(t,e),this.resource="page/donate.page";let i=this;this.donate1.onClick=function(){i.doDonate(1)},this.donate5.onClick=function(){i.doDonate(5)},this.donate10.onClick=function(){i.doDonate(10)},this.donate50.onClick=function(){i.doDonate(50)},this.donate100.onClick=function(){i.doDonate(100)},this.btnWant.onClick=async function(){try{let t=parseFloat(i.edtAmount.text);i.doDonate(t)}catch(t){CShowMessage.showMessage("showMessage.frame",CLanguage.getText("W_ERROR"),CStringUtil.errorMessage(t))}}}doChangeSize(){super.doChangeSize(),this.cover.position.width=this.position.width,this.cover.position.height=this.position.height}doDonate(t){t<1?CShowMessage.showMessage("showMessage.frame",CLanguage.getText("W_ERROR"),CLanguage.getText("S_ERR_MIN_DONATE")):window.open("http://127.0.0.1:8787/paypal?amount="+t.toFixed(2),"popup","width=500,height=500")}}class CAppDonate extends CWindowApplication{constructor(){super(),this.defaultWidth=700,this.defaultHeight=480,this.appName="";let t=this;this.mainWindow.resource="window_red.frame",this.frame=new CDonatePage(this.mainWindow.body),this.frame.position.align=EPositionAlign.CLIENT,this.mainWindow.onShow=function(){t.mainWindow.caption.textSet.languageKey="W_DONATE"}}}window.addEventListener("message",(function(t){let e=t.data;JSON.parse(e);alert(t.data)}));class CDialogs extends CDialog{static getNewFinder(){let t=new CSelectFinder;return t.resource="page/finderSelect.page",t}static async showLocalFileOpenDataDialog(){return new Promise((function(t){let e=CDialogs.getNewFinder(),i=CDialog.getNewDialogCover(e);e.finderMode="open",e.onSelect.push((async function(e,s){if(browserLoginUser&&browserLoginUser.browserStorage){let e=await browserLoginUser.browserStorage.getFile(s);if(!e)throw new Error("Not exists file : "+s);i.hideCover(),t({fileName:s,data:e.data})}else CShowMessage.showMessage("showMessage.frame",CLanguage.getText("W_ERROR"),CLanguage.getText("S_USER_ERR_NEED_LOGIN"))}))}))}static async showLocalFileOpenDialog(){return new Promise((function(t){let e=CDialogs.getNewFinder(),i=CDialog.getNewDialogCover(e);e.finderMode="open",e.onSelect.push((async function(e,s){browserLoginUser?(i.hideCover(),t(s)):CShowMessage.showMessage("showMessage.frame",CLanguage.getText("W_ERROR"),CLanguage.getText("S_USER_ERR_NEED_LOGIN"))}))}))}static async showLocalFileSaveDataDialog(t){return new Promise((function(e){let i=CDialogs.getNewFinder(),s=CDialog.getNewDialogCover(i);i.finderMode="save",i.onSelect.push((async function(i,o){browserLoginUser&&browserLoginUser.browserStorage?(await browserLoginUser.browserStorage.saveFile(o,t),s.hideCover(),e(o)):CShowMessage.showMessage("showMessage.frame",CLanguage.getText("W_ERROR"),CLanguage.getText("S_USER_ERR_NEED_LOGIN"))}))}))}static async showLocalFileSaveDialog(){return new Promise((function(t){let e=CDialogs.getNewFinder(),i=CDialog.getNewDialogCover(e);e.finderMode="save",e.onSelect.push((async function(e,s){browserLoginUser?(i.hideCover(),t(s)):CShowMessage.showMessage("showMessage.frame",CLanguage.getText("W_ERROR"),CLanguage.getText("S_USER_ERR_NEED_LOGIN"))}))}))}static async saveLocalText(t,e){return browserLoginUser&&browserLoginUser.browserStorage?(await browserLoginUser.browserStorage.saveFile(t,e),CResultData.success()):CResultData.error(CLanguage.getText("S_USER_ERR_NEED_LOGIN"))}}function loadSystemResource(){return new Promise((async function(t){let e=new CFileList("systemResource","data","disk");e.onLoadComplete.push((async function(){await e.addIndex("resourceName");let i=new Map,s=JSON.parse(await fetchBody("https://www.bellground.com/systemresource/resourceVersion.json"));for(let t=0;t<s.length;t++){let o=!0,a=await e.findIndexData({resourceName:s[t].resourceName});a.length>0&&a[0].version>=s[t].version&&(o=!1,console.log("local load",a[0].version,s[t].version,a[0].resourceName),CSystem.resources.set(a[0].resourceName,a[0].data)),o&&i.set(s[t].resourceName,{version:s[t].version,url:s[t].url})}let o=[];i.forEach((function(t,i){o.push(new Promise((function(s,o){let a=t.url,n=t.version;fetchBody(a).then((async function(t){let o=JSON.parse(t);console.log("server load",n,i),CSystem.resources.set(i,o),await e.add({resourceName:i,version:n,data:o}),s()})).catch((function(t){o(t)}))})))})),Promise.all(o).then((()=>{CSystem.resourcesLoad=!0,CSystem.doResourceLoad(),e.close(),t()}))}))}))}function loadLazyResource(){return new Promise((function(t){let e=new CFileList("lazyResource","data","disk");e.onLoadComplete.push((async function(){await e.addIndex("resourceName");let i=new Map,s=JSON.parse(await fetchBody("https://www.bellground.com/lazyresource/resourceVersion.json"));for(let t=0;t<s.length;t++){let o=!0,a=await e.findIndexData({resourceName:s[t].resourceName});a.length>0&&a[0].version>=s[t].version&&(o=!1,console.log("local load",a[0].version,s[t].version,a[0].resourceName),CSystem.resources.set(a[0].resourceName,a[0].data)),o&&i.set(s[t].resourceName,{version:s[t].version,url:s[t].url})}let o=[];i.forEach((function(t,i){o.push(new Promise((function(s,o){let a=t.url,n=t.version;fetchBody(a).then((async function(t){let o=JSON.parse(t);console.log("server load",n,i),CSystem.resources.set(i,o),await e.add({resourceName:i,version:n,data:o}),s()})).catch((function(t){o(t)}))})))})),Promise.all(o).then((()=>{e.close(),t()}))}))}))}async function loadUserResource(){if(browserLoginUser&&browserLoginUser.browserStorage){for(let t=0;t<browserLoginUser.userResource.length;t++)CSystem.resources.delete(browserLoginUser.userResource[t]);if(await browserLoginUser.browserStorage.exists("/resource")){let t=await browserLoginUser.browserStorage.getFiles("/resource",!0);browserLoginUser.userResource=[];for(let e=0;e<t.length;e++){let i=CFileUtil.extractFileExt(t[e].fileFullName),s=t[e].data;if(("graph"==i||"canvasitems"==i||"layers"==i||"control"==i||"frame"==i||"page"==i||"path"==i||"graphvalue"==i)&&"string"==typeof s&&t[e].fileType==EFileType.FILE){let i=CStringUtil.replaceAll(t[e].fileFullName,"/resource/","");if(CSystem.resources.has(i))throw new Error("Exists resource name : "+i);CSystem.resources.set(i,JSON.parse(s)),browserLoginUser.userResource.push(i),console.log("User resource load : "+i)}}}}}function addParticle(){CTimeChecker.startChecker();let t=new CForceCreateObject;t.speed.time=1e3,t.speed.distance=1,t.point.x=0,t.point.y=1e6;for(let e=0;e<100;e++){let e=new CPanel(document.body);e.resource="darkblue/panel1.control",e.position.width=10,e.position.height=10,e.position.left=Math.floor(1e3*Math.random()),e.position.top=Math.floor(500*Math.random());let i=new CForceAffectedObject(e);i.moveKind="position",i.point.x=Math.floor(1e3*Math.random()),i.point.y=Math.floor(500*Math.random()),CForceLink.objects.push({forceCreator:t,affectedObject:i})}console.log("1000개",CTimeChecker.stopChecker())}function loadDictionary(){return new Promise((function(t){let e=[new Promise((function(t,e){fetchBody("https://www.bellground.com/dictionary/animationDictionary.json").then((function(e){dictionaryList.push(JSON.parse(e)),t()})).catch((function(t){e(t)}))})),new Promise((function(t,e){fetchBody("https://www.bellground.com/dictionary/finderDictionary.json").then((function(e){dictionaryList.push(JSON.parse(e)),t()})).catch((function(t){e(t)}))})),new Promise((function(t,e){fetchBody("https://www.bellground.com/dictionary/pageEditorDictionary.json").then((function(e){dictionaryList.push(JSON.parse(e)),t()})).catch((function(t){e(t)}))})),new Promise((function(t,e){fetchBody("https://www.bellground.com/dictionary/pathDictionary.json").then((function(e){dictionaryList.push(JSON.parse(e)),t()})).catch((function(t){e(t)}))})),new Promise((function(t,e){fetchBody("https://www.bellground.com/dictionary/systemDictionary.json").then((function(e){dictionaryList.push(JSON.parse(e)),t()})).catch((function(t){e(t)}))})),new Promise((function(t,e){fetchBody("https://www.bellground.com/dictionary/userDictionary.json").then((function(e){dictionaryList.push(JSON.parse(e)),t()})).catch((function(t){e(t)}))})),new Promise((function(t,e){fetchBody("https://www.bellground.com/dictionary/stickerDictionary.json").then((function(e){dictionaryList.push(JSON.parse(e)),t()})).catch((function(t){e(t)}))}))];Promise.all(e).then((()=>{t()}))}))}function getDictionary(t){let e=[];for(let t=0;t<dictionaryList.length;t++){for(let i=0;i<dictionaryList[t].word.length;i++)dictionaryList[t].word[i].languageCode==CLanguage.localCode&&(e=e.concat(dictionaryList[t].word[i].data));for(let i=0;i<dictionaryList[t].sentence.length;i++)dictionaryList[t].sentence[i].languageCode==CLanguage.localCode&&(e=e.concat(dictionaryList[t].sentence[i].data))}return e}let browserLoginUser,dictionaryList=new Array;class CBrowserUser{constructor(){this.userResource=[],this.token="",this.account=""}static async getEncryptString(t,e){let i=await CBufferUtil.stringEncrypt(t,e,!1,!0);return await CStringUtil.sha256(i.base64)}}async function doShowSticker(){if(browserLoginUser&&browserLoginUser.sticker){let t=browserLoginUser.sticker,e=[];await t.loop((async function(t){t.show&&e.push(t)})),e.sort((function(t,e){let i=0;return t.zindex<e.zindex&&(i=-1),t.zindex>e.zindex&&(i=1),i}));for(let t=0;t<e.length;t++){let i=new CUserStickerPage(CSystem.desktopList.get(0).applicationLayer);e[t].zindex=CSystem.getZPlus(),i.setSticker(e[t])}}}async function doClearSticker(){CUserStickerPage.stickers.forEach((function(t){t.remove()})),CUserStickerPage.stickers.clear()}async function doLogin(t){if(t.setting){let e=await t.setting.findIndexData({name:"languageCode"});if(e.length>0)CLanguage.localCode=e[0].value;else{let t=new CAppSetting;t.desktop=CSystem.desktopList.get(0),t.execute()}}CNoticeStickerPage.clearNotice()}async function doLogout(){if(browserLoginUser){await doClearSticker();for(let t=0;t<browserLoginUser.userResource.length;t++)CSystem.resources.delete(browserLoginUser.userResource[t]);browserLoginUser.userResource=[],browserLoginUser.sticker?.close(),browserLoginUser.bookmark?.close(),browserLoginUser.browserStorage?.list.close(),browserLoginUser.setting?.close(),browserLoginUser.sticker=void 0,browserLoginUser.bookmark=void 0,browserLoginUser.browserStorage=void 0,browserLoginUser.setting=void 0,browserLoginUser=void 0}await CSystem.databaseTransaction("localDataBase","setting",(async function(t,e){let i=await t.getObject("setting","public");i&&(CLanguage.localCode=i.languageCode)})),CNoticeStickerPage.createNotice()}async function loadHtml(){CTimeChecker.startChecker(),await loadSystemResource(),console.log("system resource load complete",CTimeChecker.stopChecker()),CTimeChecker.startChecker(),await loadDictionary(),console.log("dictionary load complete",CTimeChecker.stopChecker()),CTimeChecker.startChecker(),loadLazyResource().then((function(){console.log("lazy resource load complete",CTimeChecker.stopChecker())})),await CSystem.addDatabase("localDataBase",1,(function(t){t.objectStoreNames.contains("setting")||t.createObjectStore("setting",{keyPath:"userId"}),t.objectStoreNames.contains("user")||t.createObjectStore("user",{keyPath:"account"})}));let t="en";await CSystem.databaseTransaction("localDataBase","setting",(async function(e,i){let s=await e.getObject("setting","public");s&&(t=s.languageCode)})),CLanguage.onSetDictionary.push((async function(){if(browserLoginUser&&browserLoginUser.setting){let t=await browserLoginUser.setting.findIndexData({name:"languageCode"});if(t.length>0){await browserLoginUser.setting.modifyStart();try{t[0].value=CLanguage.localCode}finally{await browserLoginUser.setting.modifySave()}}else await browserLoginUser.setting.add({id:"",name:"languageCode",value:CLanguage.localCode})}else await CSystem.databaseTransaction("localDataBase","setting",(async function(t,e){await t.putObject("setting",{userId:"public",languageCode:CLanguage.localCode})}));CLanguage.loadDictionary(getDictionary(CLanguage.localCode))})),CLanguage.localCode=t;let e=CSystem.newDesktop();e.resource="desktop_black.control",e.taskbar.iconLength=40,e.taskbar.iconMargin=10,CApplication.onBeforeExecute.push((async function(t){return"CAppTabFinder"!=t.className&&"CAppCmd"!=t.className||null!=browserLoginUser?{result:!0,message:""}:{result:!1,message:"Login"}})),CApplication.onRejectExecute.push((async function(t,e){CShowMessage.showMessage("showMessage.frame","Error",e.className+" reject : "+t.message)})),CApplication.addSystemIcon("CAppSetting","setting.icon",!0),CApplication.addSystemIcon("CAppDonate","heart.icon",!0),CApplication.addSystemIcon("CAppBrowserLogin","login.icon",!0),CApplication.addSystemIcon("CAppBrowserFinder","directory.icon"),CApplication.addSystemIcon("CAppPageEditor","page.icon"),CApplication.addSystemIcon("CAppControlEditor","controlEditor.icon"),CApplication.addSystemIcon("CAppLayersEditor","layers.icon"),CApplication.addSystemIcon("CAppCanvasItemsEditor","canvasitems.icon"),CApplication.addSystemIcon("CAppPathEditor","path.icon"),CApplication.addSystemIcon("CAppAnimationEditor","animation.icon"),CApplication.addSystemIcon("CAppGraphEditor","graph.icon"),CApplication.addSystemIcon("CAppTextEditor","txt.icon"),CApplication.addSystemIcon("CAppStickerManager","sticker.icon"),e.taskbar.init(),CCustomFinderFrame.extApp.set("txt","CAppTextEditor"),CCustomFinderFrame.extApp.set("json","CAppTextEditor"),CCustomFinderFrame.extApp.set("jsonc","CAppTextEditor"),CCustomFinderFrame.extApp.set("yaml","CAppTextEditor"),CCustomFinderFrame.extApp.set("frame","CAppControlEditor"),CCustomFinderFrame.extApp.set("control","CAppControlEditor"),CCustomFinderFrame.extApp.set("page","CAppPageEditor")}
